'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var util = require('../../util'),
    ParseableToken = require('../common/token/parseable'),
    WhitespaceToken = require('../common/token/whitespace'),
    SingleLineCommentToken = require('./token/comment/singleLine'),
    EndOfMultiLineCommentToken = require('./token/comment/endOfMultiLine'),
    StartOfMultiLineCommentToken = require('./token/comment/startOfMultiLine'),
    MiddleOfMultiLineCommentToken = require('./token/comment/middleOfMultiLine');

var NonSignificantTokens = function () {
  function NonSignificantTokens() {
    _classCallCheck(this, NonSignificantTokens);
  }

  _createClass(NonSignificantTokens, null, [{
    key: 'hasEndOfMultiLineCommentToken',
    value: function hasEndOfMultiLineCommentToken(tokens) {
      return tokens.some(function (token) {
        return token instanceof EndOfMultiLineCommentToken;
      });
    }
  }, {
    key: 'hasStartOfMultiLineCommentToken',
    value: function hasStartOfMultiLineCommentToken(tokens) {
      return tokens.some(function (token) {
        return token instanceof StartOfMultiLineCommentToken;
      });
    }
  }, {
    key: 'pass',
    value: function pass(context) {
      var content = context.getContent(),
          inMultiLineComment = context.isInMultiLineComment();

      while (content !== '') {
        if (inMultiLineComment) {
          var endOfMultiLineCommentTokenPosition = endOfMultiLineCommentToken(context);

          if (endOfMultiLineCommentTokenPosition !== 0) {
            middleOfMultiLineCommentToken(context, endOfMultiLineCommentTokenPosition);
          }
        } else {
          var startOfMultiLineCommentTokenPosition = startOfMultiLineCommentToken(context);

          if (startOfMultiLineCommentTokenPosition !== 0) {
            var singleLineCommentTokenPosition = singleLineCommentToken(context);

            if (singleLineCommentTokenPosition !== 0) {
              var whitespaceTokenPosition = whitespaceToken(context);

              if (whitespaceTokenPosition !== 0) {
                parseableToken(context, startOfMultiLineCommentTokenPosition, singleLineCommentTokenPosition, whitespaceTokenPosition);
              }
            }
          }
        }

        content = context.getContent();
        inMultiLineComment = context.isInMultiLineComment();
      }
    }
  }]);

  return NonSignificantTokens;
}();

module.exports = NonSignificantTokens;

function endOfMultiLineCommentToken(context) {
  var content = context.getContent(),
      endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.positionInContent(content);

  if (endOfMultiLineCommentTokenPosition === 0) {
    var endOfMultiLineCommentToken = EndOfMultiLineCommentToken.fromContent(content),
        endOfMultiLineCommentTokenLength = endOfMultiLineCommentToken.getLength();

    context.pushToken(endOfMultiLineCommentToken);
    context.chopContent(endOfMultiLineCommentTokenLength);
    context.setInMultiLineComment(false);
  }

  return endOfMultiLineCommentTokenPosition;
}

function middleOfMultiLineCommentToken(context, endOfMultiLineCommentTokenPosition) {
  var content = context.getContent(),
      commentedContent = endOfMultiLineCommentTokenPosition === -1 ? content : content.substring(0, endOfMultiLineCommentTokenPosition);

  var middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(commentedContent),
      middleOfMultiLineCommentTokenLength = middleOfMultiLineCommentToken.getLength();

  context.pushToken(middleOfMultiLineCommentToken);
  context.chopContent(middleOfMultiLineCommentTokenLength);
}

function startOfMultiLineCommentToken(context) {
  var content = context.getContent(),
      startOfMultiLineCommentTokenPosition = StartOfMultiLineCommentToken.positionInContent(content);

  if (startOfMultiLineCommentTokenPosition === 0) {
    var startOfMultiLineCommentToken = StartOfMultiLineCommentToken.fromContent(content),
        startOfMultiLineCommentTokenLength = startOfMultiLineCommentToken.getLength();

    context.pushToken(startOfMultiLineCommentToken);
    context.chopContent(startOfMultiLineCommentTokenLength);
    context.setInMultiLineComment(true);
  }
}

function singleLineCommentToken(context) {
  var content = context.getContent(),
      singleLineCommentTokenPosition = SingleLineCommentToken.positionInContent(content);

  if (singleLineCommentTokenPosition === 0) {
    var singleLineCommentToken = SingleLineCommentToken.fromContent(content);

    context.pushToken(singleLineCommentToken);
    context.setContent('');
  }

  return singleLineCommentTokenPosition;
}

function whitespaceToken(context) {
  var content = context.getContent(),
      whitespaceTokenPosition = WhitespaceToken.positionInContent(content);

  if (whitespaceTokenPosition === 0) {
    var whitespaceToken = WhitespaceToken.fromContent(content),
        whitespaceTokenLength = whitespaceToken.getLength();

    context.pushToken(whitespaceToken);
    context.chopContent(whitespaceTokenLength);
  }

  return whitespaceTokenPosition;
}

function parseableToken(context, startOfMultiLineCommentTokenPosition, singleLineCommentTokenPosition, whitespaceTokenPosition) {
  var contentLength = context.getContentLength(),
      parseableContentLength = util.minBarMinusOne(startOfMultiLineCommentTokenPosition, singleLineCommentTokenPosition, whitespaceTokenPosition, contentLength),
      parseableContent = context.getContentSubstring(parseableContentLength),
      content = parseableContent,
      ///
  parseableContentToken = new ParseableToken(content);

  context.pushToken(parseableContentToken);
  context.chopContent(parseableContentLength);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9mbG9yZW5jZS9ub25TaWduaWZpY2FudFRva2Vucy5qcyJdLCJuYW1lcyI6WyJ1dGlsIiwicmVxdWlyZSIsIlBhcnNlYWJsZVRva2VuIiwiV2hpdGVzcGFjZVRva2VuIiwiU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIkVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsIk1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiTm9uU2lnbmlmaWNhbnRUb2tlbnMiLCJ0b2tlbnMiLCJzb21lIiwidG9rZW4iLCJjb250ZXh0IiwiY29udGVudCIsImdldENvbnRlbnQiLCJpbk11bHRpTGluZUNvbW1lbnQiLCJpc0luTXVsdGlMaW5lQ29tbWVudCIsImVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24iLCJlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsIm1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwic3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uIiwic3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsInNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInNpbmdsZUxpbmVDb21tZW50VG9rZW4iLCJ3aGl0ZXNwYWNlVG9rZW5Qb3NpdGlvbiIsIndoaXRlc3BhY2VUb2tlbiIsInBhcnNlYWJsZVRva2VuIiwibW9kdWxlIiwiZXhwb3J0cyIsInBvc2l0aW9uSW5Db250ZW50IiwiZnJvbUNvbnRlbnQiLCJlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbkxlbmd0aCIsImdldExlbmd0aCIsInB1c2hUb2tlbiIsImNob3BDb250ZW50Iiwic2V0SW5NdWx0aUxpbmVDb21tZW50IiwiY29tbWVudGVkQ29udGVudCIsInN1YnN0cmluZyIsIm1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuTGVuZ3RoIiwic3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbkxlbmd0aCIsInNldENvbnRlbnQiLCJ3aGl0ZXNwYWNlVG9rZW5MZW5ndGgiLCJjb250ZW50TGVuZ3RoIiwiZ2V0Q29udGVudExlbmd0aCIsInBhcnNlYWJsZUNvbnRlbnRMZW5ndGgiLCJtaW5CYXJNaW51c09uZSIsInBhcnNlYWJsZUNvbnRlbnQiLCJnZXRDb250ZW50U3Vic3RyaW5nIiwicGFyc2VhYmxlQ29udGVudFRva2VuIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FBRUEsSUFBSUEsT0FBT0MsUUFBUSxZQUFSLENBQVg7QUFBQSxJQUNJQyxpQkFBaUJELFFBQVEsMkJBQVIsQ0FEckI7QUFBQSxJQUVJRSxrQkFBa0JGLFFBQVEsNEJBQVIsQ0FGdEI7QUFBQSxJQUdJRyx5QkFBeUJILFFBQVEsNEJBQVIsQ0FIN0I7QUFBQSxJQUlJSSw2QkFBNkJKLFFBQVEsZ0NBQVIsQ0FKakM7QUFBQSxJQUtJSywrQkFBK0JMLFFBQVEsa0NBQVIsQ0FMbkM7QUFBQSxJQU1JTSxnQ0FBZ0NOLFFBQVEsbUNBQVIsQ0FOcEM7O0lBUU1PLG9COzs7Ozs7O2tEQUNpQ0MsTSxFQUFRO0FBQzNDLGFBQU9BLE9BQU9DLElBQVAsQ0FBWSxVQUFTQyxLQUFULEVBQWdCO0FBQ2pDLGVBQU9BLGlCQUFpQk4sMEJBQXhCO0FBQ0QsT0FGTSxDQUFQO0FBR0Q7OztvREFFc0NJLE0sRUFBUTtBQUM3QyxhQUFPQSxPQUFPQyxJQUFQLENBQVksVUFBU0MsS0FBVCxFQUFnQjtBQUNqQyxlQUFPQSxpQkFBaUJMLDRCQUF4QjtBQUNELE9BRk0sQ0FBUDtBQUdEOzs7eUJBRVdNLE8sRUFBUztBQUNuQixVQUFJQyxVQUFVRCxRQUFRRSxVQUFSLEVBQWQ7QUFBQSxVQUNJQyxxQkFBcUJILFFBQVFJLG9CQUFSLEVBRHpCOztBQUdBLGFBQU9ILFlBQVksRUFBbkIsRUFBdUI7QUFDckIsWUFBSUUsa0JBQUosRUFBd0I7QUFDdEIsY0FBSUUscUNBQXFDQywyQkFBMkJOLE9BQTNCLENBQXpDOztBQUVBLGNBQUlLLHVDQUF1QyxDQUEz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Y3QnO1xyXG5cclxudmFyIHV0aWwgPSByZXF1aXJlKCcuLi8uLi91dGlsJyksXHJcbiAgICBQYXJzZWFibGVUb2tlbiA9IHJlcXVpcmUoJy4uL2NvbW1vbi90b2tlbi9wYXJzZWFibGUnKSxcclxuICAgIFdoaXRlc3BhY2VUb2tlbiA9IHJlcXVpcmUoJy4uL2NvbW1vbi90b2tlbi93aGl0ZXNwYWNlJyksXHJcbiAgICBTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi90b2tlbi9jb21tZW50L3NpbmdsZUxpbmUnKSxcclxuICAgIEVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi90b2tlbi9jb21tZW50L2VuZE9mTXVsdGlMaW5lJyksXHJcbiAgICBTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi90b2tlbi9jb21tZW50L3N0YXJ0T2ZNdWx0aUxpbmUnKSxcclxuICAgIE1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi90b2tlbi9jb21tZW50L21pZGRsZU9mTXVsdGlMaW5lJyk7XHJcblxyXG5jbGFzcyBOb25TaWduaWZpY2FudFRva2VucyB7XHJcbiAgc3RhdGljIGhhc0VuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKHRva2Vucykge1xyXG4gICAgcmV0dXJuIHRva2Vucy5zb21lKGZ1bmN0aW9uKHRva2VuKSB7XHJcbiAgICAgIHJldHVybiB0b2tlbiBpbnN0YW5jZW9mIEVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgaGFzU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbih0b2tlbnMpIHtcclxuICAgIHJldHVybiB0b2tlbnMuc29tZShmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICByZXR1cm4gdG9rZW4gaW5zdGFuY2VvZiBTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcGFzcyhjb250ZXh0KSB7XHJcbiAgICB2YXIgY29udGVudCA9IGNvbnRleHQuZ2V0Q29udGVudCgpLFxyXG4gICAgICAgIGluTXVsdGlMaW5lQ29tbWVudCA9IGNvbnRleHQuaXNJbk11bHRpTGluZUNvbW1lbnQoKTtcclxuXHJcbiAgICB3aGlsZSAoY29udGVudCAhPT0gJycpIHtcclxuICAgICAgaWYgKGluTXVsdGlMaW5lQ29tbWVudCkge1xyXG4gICAgICAgIHZhciBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29udGV4dCk7XHJcblxyXG4gICAgICAgIGlmIChlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uICE9PSAwKSB7XHJcbiAgICAgICAgICBtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb250ZXh0LCBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdmFyIHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29udGV4dCk7XHJcblxyXG4gICAgICAgIGlmIChzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gIT09IDApIHtcclxuICAgICAgICAgIHZhciBzaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBzaW5nbGVMaW5lQ29tbWVudFRva2VuKGNvbnRleHQpO1xyXG5cclxuICAgICAgICAgIGlmIChzaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gIT09IDApIHtcclxuICAgICAgICAgICAgdmFyIHdoaXRlc3BhY2VUb2tlblBvc2l0aW9uID0gd2hpdGVzcGFjZVRva2VuKGNvbnRleHQpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHdoaXRlc3BhY2VUb2tlblBvc2l0aW9uICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgcGFyc2VhYmxlVG9rZW4oY29udGV4dCwgc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uLCBzaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24sIHdoaXRlc3BhY2VUb2tlblBvc2l0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgY29udGVudCA9IGNvbnRleHQuZ2V0Q29udGVudCgpOyAgICAgIFxyXG4gICAgICBpbk11bHRpTGluZUNvbW1lbnQgPSBjb250ZXh0LmlzSW5NdWx0aUxpbmVDb21tZW50KCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IE5vblNpZ25pZmljYW50VG9rZW5zO1xyXG5cclxuZnVuY3Rpb24gZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29udGV4dCkge1xyXG4gIHZhciBjb250ZW50ID0gY29udGV4dC5nZXRDb250ZW50KCksXHJcbiAgICAgIGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbkluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgaWYgKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPT09IDApIHtcclxuICAgIHZhciBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IEVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLmZyb21Db250ZW50KGNvbnRlbnQpLFxyXG4gICAgICAgIGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuTGVuZ3RoID0gZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZ2V0TGVuZ3RoKCk7XHJcblxyXG4gICAgY29udGV4dC5wdXNoVG9rZW4oZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgY29udGV4dC5jaG9wQ29udGVudChlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbkxlbmd0aCk7XHJcbiAgICBjb250ZXh0LnNldEluTXVsdGlMaW5lQ29tbWVudChmYWxzZSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbjtcclxufVxyXG5cclxuZnVuY3Rpb24gbWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29udGV4dCwgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbikge1xyXG4gIHZhciBjb250ZW50ID0gY29udGV4dC5nZXRDb250ZW50KCksXHJcbiAgICAgIGNvbW1lbnRlZENvbnRlbnQgPSBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID09PSAtMSA/IGNvbnRlbnQgOiBjb250ZW50LnN1YnN0cmluZygwLCBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uKTtcclxuXHJcbiAgdmFyIG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29tbWVudGVkQ29udGVudCksXHJcbiAgICAgIG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuTGVuZ3RoID0gbWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZ2V0TGVuZ3RoKCk7XHJcblxyXG4gIGNvbnRleHQucHVzaFRva2VuKG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuKTtcclxuICBjb250ZXh0LmNob3BDb250ZW50KG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuTGVuZ3RoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb250ZXh0KSB7XHJcbiAgdmFyIGNvbnRlbnQgPSBjb250ZXh0LmdldENvbnRlbnQoKSxcclxuICAgICAgc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbkluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgaWYgKHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9PT0gMCkge1xyXG4gICAgdmFyIHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLmZyb21Db250ZW50KGNvbnRlbnQpLFxyXG4gICAgICAgIHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5MZW5ndGggPSBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLmdldExlbmd0aCgpO1xyXG5cclxuICAgIGNvbnRleHQucHVzaFRva2VuKHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgY29udGV4dC5jaG9wQ29udGVudChzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuTGVuZ3RoKTtcclxuICAgIGNvbnRleHQuc2V0SW5NdWx0aUxpbmVDb21tZW50KHRydWUpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gc2luZ2xlTGluZUNvbW1lbnRUb2tlbihjb250ZXh0KSB7XHJcbiAgdmFyIGNvbnRlbnQgPSBjb250ZXh0LmdldENvbnRlbnQoKSxcclxuICAgICAgc2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gU2luZ2xlTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbkluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgaWYgKHNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9PT0gMCkge1xyXG4gICAgdmFyIHNpbmdsZUxpbmVDb21tZW50VG9rZW4gPSBTaW5nbGVMaW5lQ29tbWVudFRva2VuLmZyb21Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgIGNvbnRleHQucHVzaFRva2VuKHNpbmdsZUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgY29udGV4dC5zZXRDb250ZW50KCcnKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBzaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb247XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHdoaXRlc3BhY2VUb2tlbihjb250ZXh0KSB7XHJcbiAgdmFyIGNvbnRlbnQgPSBjb250ZXh0LmdldENvbnRlbnQoKSxcclxuICAgICAgd2hpdGVzcGFjZVRva2VuUG9zaXRpb24gPSBXaGl0ZXNwYWNlVG9rZW4ucG9zaXRpb25JbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gIGlmICh3aGl0ZXNwYWNlVG9rZW5Qb3NpdGlvbiA9PT0gMCkge1xyXG4gICAgdmFyIHdoaXRlc3BhY2VUb2tlbiA9IFdoaXRlc3BhY2VUb2tlbi5mcm9tQ29udGVudChjb250ZW50KSxcclxuICAgICAgICB3aGl0ZXNwYWNlVG9rZW5MZW5ndGggPSB3aGl0ZXNwYWNlVG9rZW4uZ2V0TGVuZ3RoKCk7XHJcblxyXG4gICAgY29udGV4dC5wdXNoVG9rZW4od2hpdGVzcGFjZVRva2VuKTtcclxuICAgIGNvbnRleHQuY2hvcENvbnRlbnQod2hpdGVzcGFjZVRva2VuTGVuZ3RoKTtcclxuICB9XHJcblxyXG4gIHJldHVybiB3aGl0ZXNwYWNlVG9rZW5Qb3NpdGlvbjtcclxufVxyXG5cclxuZnVuY3Rpb24gcGFyc2VhYmxlVG9rZW4oY29udGV4dCwgc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uLCBzaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24sIHdoaXRlc3BhY2VUb2tlblBvc2l0aW9uKSB7XHJcbiAgdmFyIGNvbnRlbnRMZW5ndGggPSBjb250ZXh0LmdldENvbnRlbnRMZW5ndGgoKSxcclxuICAgICAgcGFyc2VhYmxlQ29udGVudExlbmd0aCA9IHV0aWwubWluQmFyTWludXNPbmUoc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uLCBzaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24sIHdoaXRlc3BhY2VUb2tlblBvc2l0aW9uLCBjb250ZW50TGVuZ3RoKSxcclxuICAgICAgcGFyc2VhYmxlQ29udGVudCA9IGNvbnRleHQuZ2V0Q29udGVudFN1YnN0cmluZyhwYXJzZWFibGVDb250ZW50TGVuZ3RoKSxcclxuICAgICAgY29udGVudCA9IHBhcnNlYWJsZUNvbnRlbnQsIC8vL1xyXG4gICAgICBwYXJzZWFibGVDb250ZW50VG9rZW4gPSBuZXcgUGFyc2VhYmxlVG9rZW4oY29udGVudCk7XHJcblxyXG4gIGNvbnRleHQucHVzaFRva2VuKHBhcnNlYWJsZUNvbnRlbnRUb2tlbik7XHJcbiAgY29udGV4dC5jaG9wQ29udGVudChwYXJzZWFibGVDb250ZW50TGVuZ3RoKTtcclxufVxyXG4iXX0=