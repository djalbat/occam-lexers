'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var util = require('../../util'),
    ParseableToken = require('../common/token/parseable'),
    WhitespaceToken = require('../common/token/whitespace'),
    SingleLineCommentToken = require('./token/comment/singleLine'),
    EndOfMultiLineCommentToken = require('./token/comment/endOfMultiLine'),
    StartOfMultiLineCommentToken = require('./token/comment/startOfMultiLine'),
    MiddleOfMultiLineCommentToken = require('./token/comment/middleOfMultiLine');

var NonSignificantTokens = function () {
  function NonSignificantTokens() {
    _classCallCheck(this, NonSignificantTokens);
  }

  _createClass(NonSignificantTokens, null, [{
    key: 'hasEndOfMultiLineCommentToken',
    value: function hasEndOfMultiLineCommentToken(tokens) {
      return tokens.some(function (token) {
        return token instanceof EndOfMultiLineCommentToken;
      });
    }
  }, {
    key: 'hasStartOfMultiLineCommentToken',
    value: function hasStartOfMultiLineCommentToken(tokens) {
      return tokens.some(function (token) {
        return token instanceof StartOfMultiLineCommentToken;
      });
    }
  }, {
    key: 'pass',
    value: function pass(context) {
      var content = context.getContent(),
          inMultiLineComment = context.isInMultiLineComment();

      while (content !== '') {
        if (inMultiLineComment) {
          var endOfMultiLineCommentTokenPosition = endOfMultiLineCommentToken(context);

          if (endOfMultiLineCommentTokenPosition !== 0) {
            middleOfMultiLineCommentToken(context, endOfMultiLineCommentTokenPosition);
          }
        } else {
          var startOfMultiLineCommentTokenPosition = startOfMultiLineCommentToken(context);

          if (startOfMultiLineCommentTokenPosition !== 0) {
            var singleLineCommentTokenPosition = singleLineCommentToken(context);

            if (singleLineCommentTokenPosition !== 0) {
              var whitespaceTokenPosition = whitespaceToken(context);

              if (whitespaceTokenPosition !== 0) {
                parseableToken(context, startOfMultiLineCommentTokenPosition, singleLineCommentTokenPosition, whitespaceTokenPosition);
              }
            }
          }
        }

        content = context.getContent();
        inMultiLineComment = context.isInMultiLineComment();
      }
    }
  }]);

  return NonSignificantTokens;
}();

module.exports = NonSignificantTokens;

function endOfMultiLineCommentToken(context) {
  var content = context.getContent(),
      endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.position(content);

  if (endOfMultiLineCommentTokenPosition === 0) {
    var endOfMultiLineCommentToken = EndOfMultiLineCommentToken.fromContent(content),
        endOfMultiLineCommentTokenLength = endOfMultiLineCommentToken.getLength();

    context.pushToken(endOfMultiLineCommentToken);
    context.chopContent(endOfMultiLineCommentTokenLength);
    context.setInMultiLineComment(false);
  }

  return endOfMultiLineCommentTokenPosition;
}

function middleOfMultiLineCommentToken(context, endOfMultiLineCommentTokenPosition) {
  var content = context.getContent(),
      commentedContent = endOfMultiLineCommentTokenPosition === -1 ? content : content.substring(0, endOfMultiLineCommentTokenPosition);

  var middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(commentedContent),
      middleOfMultiLineCommentTokenLength = middleOfMultiLineCommentToken.getLength();

  context.pushToken(middleOfMultiLineCommentToken);
  context.chopContent(middleOfMultiLineCommentTokenLength);
}

function startOfMultiLineCommentToken(context) {
  var content = context.getContent(),
      startOfMultiLineCommentTokenPosition = StartOfMultiLineCommentToken.position(content);

  if (startOfMultiLineCommentTokenPosition === 0) {
    var startOfMultiLineCommentToken = StartOfMultiLineCommentToken.fromContent(content),
        startOfMultiLineCommentTokenLength = startOfMultiLineCommentToken.getLength();

    context.pushToken(startOfMultiLineCommentToken);
    context.chopContent(startOfMultiLineCommentTokenLength);
    context.setInMultiLineComment(true);
  }
}

function singleLineCommentToken(context) {
  var content = context.getContent(),
      singleLineCommentTokenPosition = SingleLineCommentToken.position(content);

  if (singleLineCommentTokenPosition === 0) {
    var singleLineCommentToken = SingleLineCommentToken.fromContent(content);

    context.pushToken(singleLineCommentToken);
    context.setContent('');
  }

  return singleLineCommentTokenPosition;
}

function whitespaceToken(context) {
  var content = context.getContent(),
      whitespaceTokenPosition = WhitespaceToken.position(content);

  if (whitespaceTokenPosition === 0) {
    var whitespaceToken = WhitespaceToken.fromContent(content),
        whitespaceTokenLength = whitespaceToken.getLength();

    context.pushToken(whitespaceToken);
    context.chopContent(whitespaceTokenLength);
  }

  return whitespaceTokenPosition;
}

function parseableToken(context, startOfMultiLineCommentTokenPosition, singleLineCommentTokenPosition, whitespaceTokenPosition) {
  var contentLength = context.getContentLength(),
      parseableContentLength = util.minBarMinusOne(startOfMultiLineCommentTokenPosition, singleLineCommentTokenPosition, whitespaceTokenPosition, contentLength),
      parseableContent = context.getContentSubstring(parseableContentLength),
      content = parseableContent,
      ///
  parseableContentToken = new ParseableToken(content);

  context.pushToken(parseableContentToken);
  context.chopContent(parseableContentLength);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9mbG9yZW5jZS9ub25TaWduaWZpY2FudFRva2Vucy5qcyJdLCJuYW1lcyI6WyJ1dGlsIiwicmVxdWlyZSIsIlBhcnNlYWJsZVRva2VuIiwiV2hpdGVzcGFjZVRva2VuIiwiU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIkVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsIk1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiTm9uU2lnbmlmaWNhbnRUb2tlbnMiLCJ0b2tlbnMiLCJzb21lIiwidG9rZW4iLCJjb250ZXh0IiwiY29udGVudCIsImdldENvbnRlbnQiLCJpbk11bHRpTGluZUNvbW1lbnQiLCJpc0luTXVsdGlMaW5lQ29tbWVudCIsImVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24iLCJlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsIm1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwic3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uIiwic3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsInNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInNpbmdsZUxpbmVDb21tZW50VG9rZW4iLCJ3aGl0ZXNwYWNlVG9rZW5Qb3NpdGlvbiIsIndoaXRlc3BhY2VUb2tlbiIsInBhcnNlYWJsZVRva2VuIiwibW9kdWxlIiwiZXhwb3J0cyIsInBvc2l0aW9uIiwiZnJvbUNvbnRlbnQiLCJlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbkxlbmd0aCIsImdldExlbmd0aCIsInB1c2hUb2tlbiIsImNob3BDb250ZW50Iiwic2V0SW5NdWx0aUxpbmVDb21tZW50IiwiY29tbWVudGVkQ29udGVudCIsInN1YnN0cmluZyIsIm1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuTGVuZ3RoIiwic3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbkxlbmd0aCIsInNldENvbnRlbnQiLCJ3aGl0ZXNwYWNlVG9rZW5MZW5ndGgiLCJjb250ZW50TGVuZ3RoIiwiZ2V0Q29udGVudExlbmd0aCIsInBhcnNlYWJsZUNvbnRlbnRMZW5ndGgiLCJtaW5CYXJNaW51c09uZSIsInBhcnNlYWJsZUNvbnRlbnQiLCJnZXRDb250ZW50U3Vic3RyaW5nIiwicGFyc2VhYmxlQ29udGVudFRva2VuIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FBRUEsSUFBSUEsT0FBT0MsUUFBUSxZQUFSLENBQVg7QUFBQSxJQUNJQyxpQkFBaUJELFFBQVEsMkJBQVIsQ0FEckI7QUFBQSxJQUVJRSxrQkFBa0JGLFFBQVEsNEJBQVIsQ0FGdEI7QUFBQSxJQUdJRyx5QkFBeUJILFFBQVEsNEJBQVIsQ0FIN0I7QUFBQSxJQUlJSSw2QkFBNkJKLFFBQVEsZ0NBQVIsQ0FKakM7QUFBQSxJQUtJSywrQkFBK0JMLFFBQVEsa0NBQVIsQ0FMbkM7QUFBQSxJQU1JTSxnQ0FBZ0NOLFFBQVEsbUNBQVIsQ0FOcEM7O0lBUU1PLG9COzs7Ozs7O2tEQUNpQ0MsTSxFQUFRO0FBQzNDLGFBQU9BLE9BQU9DLElBQVAsQ0FBWSxVQUFTQyxLQUFULEVBQWdCO0FBQ2pDLGVBQU9BLGlCQUFpQk4sMEJBQXhCO0FBQ0QsT0FGTSxDQUFQO0FBR0Q7OztvREFFc0NJLE0sRUFBUTtBQUM3QyxhQUFPQSxPQUFPQyxJQUFQLENBQVksVUFBU0MsS0FBVCxFQUFnQjtBQUNqQyxlQUFPQSxpQkFBaUJMLDRCQUF4QjtBQUNELE9BRk0sQ0FBUDtBQUdEOzs7eUJBRVdNLE8sRUFBUztBQUNuQixVQUFJQyxVQUFVRCxRQUFRRSxVQUFSLEVBQWQ7QUFBQSxVQUNJQyxxQkFBcUJILFFBQVFJLG9CQUFSLEVBRHpCOztBQUdBLGFBQU9ILFlBQVksRUFBbkIsRUFBdUI7QUFDckIsWUFBSUUsa0JBQUosRUFBd0I7QUFDdEIsY0FBSUUscUNBQXFDQywyQkFBMkJOLE9BQTNCLENBQXpDOztBQUVBLGNBQUlLLHVDQUF1QyxDQUEzQyxFQUE4QztB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QUFDQVgsWUFBUTRCLFVBQVIsQ0FBbUIsRUFBbkI7QUFDRDs7QUFFRCxTQUFPbEIsOEJBQVA7QUFDRDs7QUFFRCxTQUFTRyxlQUFULENBQXlCYixPQUF6QixFQUFrQztBQUNoQyxNQUFJQyxVQUFVRCxRQUFRRSxVQUFSLEVBQWQ7QUFBQSxNQUNJVSwwQkFBMEJyQixnQkFBZ0IwQixRQUFoQixDQUF5QmhCLE9BQXpCLENBRDlCOztBQUdBLE1BQUlXLDRCQUE0QixDQUFoQyxFQUFtQztBQUNqQyxRQUFJQyxrQkFBa0J0QixnQkFBZ0IyQixXQUFoQixDQUE0QmpCLE9BQTVCLENBQXRCO0FBQUEsUUFDSTRCLHdCQUF3QmhCLGdCQUFnQk8sU0FBaEIsRUFENUI7O0FBR0FwQixZQUFRcUIsU0FBUixDQUFrQlIsZUFBbEI7QUFDQWIsWUFBUXNCLFdBQVIsQ0FBb0JPLHFCQUFwQjtBQUNEOztBQUVELFNBQU9qQix1QkFBUDtBQUNEOztBQUVELFNBQVNFLGNBQVQsQ0FBd0JkLE9BQXhCLEVBQWlDUSxvQ0FBakMsRUFBdUVFLDhCQUF2RSxFQUF1R0UsdUJBQXZHLEVBQWdJO0FBQzlILE1BQUlrQixnQkFBZ0I5QixRQUFRK0IsZ0JBQVIsRUFBcEI7QUFBQSxNQUNJQyx5QkFBeUI1QyxLQUFLNkMsY0FBTCxDQUFvQnpCLG9DQUFwQixFQUEwREUsOEJBQTFELEVBQTBGRSx1QkFBMUYsRUFBbUhrQixhQUFuSCxDQUQ3QjtBQUFBLE1BRUlJLG1CQUFtQmxDLFFBQVFtQyxtQkFBUixDQUE0Qkgsc0JBQTVCLENBRnZCO0FBQUEsTUFHSS9CLFVBQVVpQyxnQkFIZDtBQUFBLE1BR2dDO0FBQzVCRSwwQkFBd0IsSUFBSTlDLGNBQUosQ0FBbUJXLE9BQW5CLENBSjVCOztBQU1BRCxVQUFRcUIsU0FBUixDQUFrQmUscUJBQWxCO0FBQ0FwQyxVQUFRc0IsV0FBUixDQUFvQlUsc0JBQXBCO0FBQ0QiLCJmaWxlIjoibm9uU2lnbmlmaWNhbnRUb2tlbnMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG52YXIgdXRpbCA9IHJlcXVpcmUoJy4uLy4uL3V0aWwnKSxcclxuICAgIFBhcnNlYWJsZVRva2VuID0gcmVxdWlyZSgnLi4vY29tbW9uL3Rva2VuL3BhcnNlYWJsZScpLFxyXG4gICAgV2hpdGVzcGFjZVRva2VuID0gcmVxdWlyZSgnLi4vY29tbW9uL3Rva2VuL3doaXRlc3BhY2UnKSxcclxuICAgIFNpbmdsZUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuL3Rva2VuL2NvbW1lbnQvc2luZ2xlTGluZScpLFxyXG4gICAgRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuL3Rva2VuL2NvbW1lbnQvZW5kT2ZNdWx0aUxpbmUnKSxcclxuICAgIFN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuL3Rva2VuL2NvbW1lbnQvc3RhcnRPZk11bHRpTGluZScpLFxyXG4gICAgTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuL3Rva2VuL2NvbW1lbnQvbWlkZGxlT2ZNdWx0aUxpbmUnKTtcclxuXHJcbmNsYXNzIE5vblNpZ25pZmljYW50VG9rZW5zIHtcclxuICBzdGF0aWMgaGFzRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4odG9rZW5zKSB7XHJcbiAgICByZXR1cm4gdG9rZW5zLnNvbWUoZnVuY3Rpb24odG9rZW4pIHtcclxuICAgICAgcmV0dXJuIHRva2VuIGluc3RhbmNlb2YgRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW47XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBoYXNTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKHRva2Vucykge1xyXG4gICAgcmV0dXJuIHRva2Vucy5zb21lKGZ1bmN0aW9uKHRva2VuKSB7XHJcbiAgICAgIHJldHVybiB0b2tlbiBpbnN0YW5jZW9mIFN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW47XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBwYXNzKGNvbnRleHQpIHtcclxuICAgIHZhciBjb250ZW50ID0gY29udGV4dC5nZXRDb250ZW50KCksXHJcbiAgICAgICAgaW5NdWx0aUxpbmVDb21tZW50ID0gY29udGV4dC5pc0luTXVsdGlMaW5lQ29tbWVudCgpO1xyXG5cclxuICAgIHdoaWxlIChjb250ZW50ICE9PSAnJykge1xyXG4gICAgICBpZiAoaW5NdWx0aUxpbmVDb21tZW50KSB7XHJcbiAgICAgICAgdmFyIGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb250ZXh0KTtcclxuXHJcbiAgICAgICAgaWYgKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gIT09IDApIHtcclxuICAgICAgICAgIG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbnRleHQsIGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB2YXIgc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb250ZXh0KTtcclxuXHJcbiAgICAgICAgaWYgKHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiAhPT0gMCkge1xyXG4gICAgICAgICAgdmFyIHNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IHNpbmdsZUxpbmVDb21tZW50VG9rZW4oY29udGV4dCk7XHJcblxyXG4gICAgICAgICAgaWYgKHNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiAhPT0gMCkge1xyXG4gICAgICAgICAgICB2YXIgd2hpdGVzcGFjZVRva2VuUG9zaXRpb24gPSB3aGl0ZXNwYWNlVG9rZW4oY29udGV4dCk7XHJcblxyXG4gICAgICAgICAgICBpZiAod2hpdGVzcGFjZVRva2VuUG9zaXRpb24gIT09IDApIHtcclxuICAgICAgICAgICAgICBwYXJzZWFibGVUb2tlbihjb250ZXh0LCBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24sIHNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiwgd2hpdGVzcGFjZVRva2VuUG9zaXRpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb250ZW50ID0gY29udGV4dC5nZXRDb250ZW50KCk7ICAgICAgXHJcbiAgICAgIGluTXVsdGlMaW5lQ29tbWVudCA9IGNvbnRleHQuaXNJbk11bHRpTGluZUNvbW1lbnQoKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gTm9uU2lnbmlmaWNhbnRUb2tlbnM7XHJcblxyXG5mdW5jdGlvbiBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb250ZXh0KSB7XHJcbiAgdmFyIGNvbnRlbnQgPSBjb250ZXh0LmdldENvbnRlbnQoKSxcclxuICAgICAgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IEVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLnBvc2l0aW9uKGNvbnRlbnQpO1xyXG5cclxuICBpZiAoZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9PT0gMCkge1xyXG4gICAgdmFyIGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCksXHJcbiAgICAgICAgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5MZW5ndGggPSBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5nZXRMZW5ndGgoKTtcclxuXHJcbiAgICBjb250ZXh0LnB1c2hUb2tlbihlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbik7XHJcbiAgICBjb250ZXh0LmNob3BDb250ZW50KGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuTGVuZ3RoKTtcclxuICAgIGNvbnRleHQuc2V0SW5NdWx0aUxpbmVDb21tZW50KGZhbHNlKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uO1xyXG59XHJcblxyXG5mdW5jdGlvbiBtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb250ZXh0LCBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uKSB7XHJcbiAgdmFyIGNvbnRlbnQgPSBjb250ZXh0LmdldENvbnRlbnQoKSxcclxuICAgICAgY29tbWVudGVkQ29udGVudCA9IGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPT09IC0xID8gY29udGVudCA6IGNvbnRlbnQuc3Vic3RyaW5nKDAsIGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24pO1xyXG5cclxuICB2YXIgbWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb21tZW50ZWRDb250ZW50KSxcclxuICAgICAgbWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5MZW5ndGggPSBtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5nZXRMZW5ndGgoKTtcclxuXHJcbiAgY29udGV4dC5wdXNoVG9rZW4obWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4pO1xyXG4gIGNvbnRleHQuY2hvcENvbnRlbnQobWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5MZW5ndGgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbnRleHQpIHtcclxuICB2YXIgY29udGVudCA9IGNvbnRleHQuZ2V0Q29udGVudCgpLFxyXG4gICAgICBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLnBvc2l0aW9uKGNvbnRlbnQpO1xyXG5cclxuICBpZiAoc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID09PSAwKSB7XHJcbiAgICB2YXIgc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IFN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCksXHJcbiAgICAgICAgc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbkxlbmd0aCA9IHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZ2V0TGVuZ3RoKCk7XHJcblxyXG4gICAgY29udGV4dC5wdXNoVG9rZW4oc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbik7XHJcbiAgICBjb250ZXh0LmNob3BDb250ZW50KHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5MZW5ndGgpO1xyXG4gICAgY29udGV4dC5zZXRJbk11bHRpTGluZUNvbW1lbnQodHJ1ZSk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBzaW5nbGVMaW5lQ29tbWVudFRva2VuKGNvbnRleHQpIHtcclxuICB2YXIgY29udGVudCA9IGNvbnRleHQuZ2V0Q29udGVudCgpLFxyXG4gICAgICBzaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBTaW5nbGVMaW5lQ29tbWVudFRva2VuLnBvc2l0aW9uKGNvbnRlbnQpO1xyXG5cclxuICBpZiAoc2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID09PSAwKSB7XHJcbiAgICB2YXIgc2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IFNpbmdsZUxpbmVDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgY29udGV4dC5wdXNoVG9rZW4oc2luZ2xlTGluZUNvbW1lbnRUb2tlbik7XHJcbiAgICBjb250ZXh0LnNldENvbnRlbnQoJycpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbjtcclxufVxyXG5cclxuZnVuY3Rpb24gd2hpdGVzcGFjZVRva2VuKGNvbnRleHQpIHtcclxuICB2YXIgY29udGVudCA9IGNvbnRleHQuZ2V0Q29udGVudCgpLFxyXG4gICAgICB3aGl0ZXNwYWNlVG9rZW5Qb3NpdGlvbiA9IFdoaXRlc3BhY2VUb2tlbi5wb3NpdGlvbihjb250ZW50KTtcclxuXHJcbiAgaWYgKHdoaXRlc3BhY2VUb2tlblBvc2l0aW9uID09PSAwKSB7XHJcbiAgICB2YXIgd2hpdGVzcGFjZVRva2VuID0gV2hpdGVzcGFjZVRva2VuLmZyb21Db250ZW50KGNvbnRlbnQpLFxyXG4gICAgICAgIHdoaXRlc3BhY2VUb2tlbkxlbmd0aCA9IHdoaXRlc3BhY2VUb2tlbi5nZXRMZW5ndGgoKTtcclxuXHJcbiAgICBjb250ZXh0LnB1c2hUb2tlbih3aGl0ZXNwYWNlVG9rZW4pO1xyXG4gICAgY29udGV4dC5jaG9wQ29udGVudCh3aGl0ZXNwYWNlVG9rZW5MZW5ndGgpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHdoaXRlc3BhY2VUb2tlblBvc2l0aW9uO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwYXJzZWFibGVUb2tlbihjb250ZXh0LCBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24sIHNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiwgd2hpdGVzcGFjZVRva2VuUG9zaXRpb24pIHtcclxuICB2YXIgY29udGVudExlbmd0aCA9IGNvbnRleHQuZ2V0Q29udGVudExlbmd0aCgpLFxyXG4gICAgICBwYXJzZWFibGVDb250ZW50TGVuZ3RoID0gdXRpbC5taW5CYXJNaW51c09uZShzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24sIHNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiwgd2hpdGVzcGFjZVRva2VuUG9zaXRpb24sIGNvbnRlbnRMZW5ndGgpLFxyXG4gICAgICBwYXJzZWFibGVDb250ZW50ID0gY29udGV4dC5nZXRDb250ZW50U3Vic3RyaW5nKHBhcnNlYWJsZUNvbnRlbnRMZW5ndGgpLFxyXG4gICAgICBjb250ZW50ID0gcGFyc2VhYmxlQ29udGVudCwgLy8vXHJcbiAgICAgIHBhcnNlYWJsZUNvbnRlbnRUb2tlbiA9IG5ldyBQYXJzZWFibGVUb2tlbihjb250ZW50KTtcclxuXHJcbiAgY29udGV4dC5wdXNoVG9rZW4ocGFyc2VhYmxlQ29udGVudFRva2VuKTtcclxuICBjb250ZXh0LmNob3BDb250ZW50KHBhcnNlYWJsZUNvbnRlbnRMZW5ndGgpO1xyXG59XHJcbiJdfQ==