'use strict';

var tokens = require('../tokens'),
    MiddleOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/middleOf'),
    MiddleOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/middleOf'),
    HyperlinkInMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/hyperlinkIn'),
    HyperlinkInSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/hyperlinkIn');

var processByCallback = tokens.processByCallback;


function postProcess(tokensOrContents) {
  processByCallback(tokensOrContents, function (tokenOrContent) {
    var commentTokensOrRemainingContents = [];

    postProcessMiddleOfCommentTokens(commentTokensOrRemainingContents, tokenOrContent);

    var tokensOrRemainingContents = commentTokensOrRemainingContents; ///

    return tokensOrRemainingContents;
  });
}

module.exports = {
  postProcess: postProcess
};

function postProcessMiddleOfCommentTokens(commentTokensOrRemainingContents, tokenOrContent) {
  var tokenOrContentString = typeof tokenOrContent === 'string',
      tokenOrContentContent = tokenOrContentString; ///

  if (tokenOrContentContent) {
    var remainingContent = tokenOrContent; ///

    commentTokensOrRemainingContents.push(remainingContent);
  } else {
    var token = tokenOrContent,
        ///
    tokenMiddleOfCommentToken = token.isMiddleOfCommentToken();

    if (tokenMiddleOfCommentToken) {
      var middleOfCommentToken = token,
          ///
      middleOfCommentTokenMultiLineCommentToken = middleOfCommentToken.isMultiLineCommentToken(),
          middleOfCommentTokenSingleLineCommentToken = !middleOfCommentTokenMultiLineCommentToken; ///

      if (false) {} else if (middleOfCommentTokenMultiLineCommentToken) {
        var content = middleOfCommentToken.getContent(),
            ///
        hyperlinkInMultiLineCommentTokenPosition = HyperlinkInMultiLineCommentToken.positionWithinContent(content);

        if (hyperlinkInMultiLineCommentTokenPosition > -1) {
          processHyperlinkInMultiLineCommentToken(commentTokensOrRemainingContents, content);
        } else {
          commentTokensOrRemainingContents.push(token);
        }
      } else if (middleOfCommentTokenSingleLineCommentToken) {
        var _content = middleOfCommentToken.getContent(),
            ///
        hyperlinkInSingleLineCommentTokenPosition = HyperlinkInSingleLineCommentToken.positionWithinContent(_content);

        if (hyperlinkInSingleLineCommentTokenPosition > -1) {
          processHyperlinkInSingleLineCommentToken(commentTokensOrRemainingContents, _content);
        } else {
          commentTokensOrRemainingContents.push(token);
        }
      } else {
        commentTokensOrRemainingContents.push(middleOfCommentToken);
      }
    } else {
      commentTokensOrRemainingContents.push(token);
    }
  }
}

function processHyperlinkInMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  processHyperlinkInCommentToken(HyperlinkInMultiLineCommentToken, MiddleOfMultiLineCommentToken, commentTokensOrRemainingContents, content);
}

function processHyperlinkInSingleLineCommentToken(commentTokensOrRemainingContents, content) {
  processHyperlinkInCommentToken(HyperlinkInSingleLineCommentToken, MiddleOfSingleLineCommentToken, commentTokensOrRemainingContents, content);
}

function processHyperlinkInCommentToken(HyperlinkInCommentToken, MiddleOfCommentToken, commentTokensOrRemainingContents, content) {
  var hyperlinkInCommentToken = HyperlinkInCommentToken.fromWithinContent(content),
      position = HyperlinkInCommentToken.positionWithinContent(content),
      ///
  contentLength = hyperlinkInCommentToken.getContentLength(),
      left = position,
      right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var _content2 = leftContent,
        ///
    middleOfCommentToken = MiddleOfCommentToken.fromContent(_content2);

    commentTokensOrRemainingContents.push(middleOfCommentToken);
  }

  commentTokensOrRemainingContents.push(hyperlinkInCommentToken);

  if (rightContentLength > 0) {
    var _content3 = rightContent,
        ///
    _middleOfCommentToken = MiddleOfCommentToken.fromContent(_content3),
        tokenOrContent = _middleOfCommentToken; ///

    postProcessMiddleOfCommentTokens(commentTokensOrRemainingContents, tokenOrContent);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9jb21tb24vdG9rZW5zL21pZGRsZU9mQ29tbWVudC5qcyJdLCJuYW1lcyI6WyJ0b2tlbnMiLCJyZXF1aXJlIiwiTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJNaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4iLCJIeXBlcmxpbmtJbk11bHRpTGluZUNvbW1lbnRUb2tlbiIsIkh5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsInByb2Nlc3NCeUNhbGxiYWNrIiwicG9zdFByb2Nlc3MiLCJ0b2tlbnNPckNvbnRlbnRzIiwidG9rZW5PckNvbnRlbnQiLCJjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyIsInBvc3RQcm9jZXNzTWlkZGxlT2ZDb21tZW50VG9rZW5zIiwidG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyIsIm1vZHVsZSIsImV4cG9ydHMiLCJ0b2tlbk9yQ29udGVudFN0cmluZyIsInRva2VuT3JDb250ZW50Q29udGVudCIsInJlbWFpbmluZ0NvbnRlbnQiLCJwdXNoIiwidG9rZW4iLCJ0b2tlbk1pZGRsZU9mQ29tbWVudFRva2VuIiwiaXNNaWRkbGVPZkNvbW1lbnRUb2tlbiIsIm1pZGRsZU9mQ29tbWVudFRva2VuIiwibWlkZGxlT2ZDb21tZW50VG9rZW5NdWx0aUxpbmVDb21tZW50VG9rZW4iLCJpc011bHRpTGluZUNvbW1lbnRUb2tlbiIsIm1pZGRsZU9mQ29tbWVudFRva2VuU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsImNvbnRlbnQiLCJnZXRDb250ZW50IiwiaHlwZXJsaW5rSW5NdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInBvc2l0aW9uV2l0aGluQ29udGVudCIsInByb2Nlc3NIeXBlcmxpbmtJbk11bHRpTGluZUNvbW1lbnRUb2tlbiIsImh5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uIiwicHJvY2Vzc0h5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsInByb2Nlc3NIeXBlcmxpbmtJbkNvbW1lbnRUb2tlbiIsIkh5cGVybGlua0luQ29tbWVudFRva2VuIiwiTWlkZGxlT2ZDb21tZW50VG9rZW4iLCJoeXBlcmxpbmtJbkNvbW1lbnRUb2tlbiIsImZyb21XaXRoaW5Db250ZW50IiwicG9zaXRpb24iLCJjb250ZW50TGVuZ3RoIiwiZ2V0Q29udGVudExlbmd0aCIsImxlZnQiLCJyaWdodCIsImxlZnRDb250ZW50Iiwic3Vic3RyaW5nIiwicmlnaHRDb250ZW50IiwibGVmdENvbnRlbnRMZW5ndGgiLCJsZW5ndGgiLCJyaWdodENvbnRlbnRMZW5ndGgiLCJmcm9tQ29udGVudCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsU0FBU0MsUUFBUSxXQUFSLENBQWY7QUFBQSxJQUNNQyxnQ0FBZ0NELFFBQVEsb0RBQVIsQ0FEdEM7QUFBQSxJQUVNRSxpQ0FBaUNGLFFBQVEscURBQVIsQ0FGdkM7QUFBQSxJQUdNRyxtQ0FBbUNILFFBQVEsdURBQVIsQ0FIekM7QUFBQSxJQUlNSSxvQ0FBb0NKLFFBQVEsd0RBQVIsQ0FKMUM7O0lBTVFLLGlCLEdBQXNCTixNLENBQXRCTSxpQjs7O0FBRVIsU0FBU0MsV0FBVCxDQUFxQkMsZ0JBQXJCLEVBQXVDO0FBQ3JDRixvQkFBa0JFLGdCQUFsQixFQUFvQyxVQUFTQyxjQUFULEVBQXlCO0FBQzNELFFBQU1DLG1DQUFtQyxFQUF6Qzs7QUFFQUMscUNBQWlDRCxnQ0FBakMsRUFBbUVELGNBQW5FOztBQUVBLFFBQU1HLDRCQUE0QkYsZ0NBQWxDLENBTDJELENBS1M7O0FBRXBFLFdBQU9FLHlCQUFQO0FBQ0QsR0FSRDtBQVNEOztBQUVEQyxPQUFPQyxPQUFQLEdBQWlCO0FBQ2ZQLGVBQWFBO0FBREUsQ0FBakI7O0FBSUEsU0FBU0ksZ0NBQVQsQ0FBMENELGdDQUExQyxFQUE0RUQsY0FBNUUsRUFBNEY7QUFDMUYsTUFBTU0sdUJBQXdCLE9BQU9OLGNBQVAsS0FBMEIsUUFBeEQ7QUFBQSxNQUNNTyx3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LFdBQXJCLENBQWlDdkIsU0FBakMsQ0FEN0I7O0FBR0FoQixxQ0FBaUNRLElBQWpDLENBQXNDSSxvQkFBdEM7QUFDRDs7QUFFRFosbUNBQWlDUSxJQUFqQyxDQUFzQ2tCLHVCQUF0Qzs7QUFFQSxNQUFJWSxxQkFBcUIsQ0FBekIsRUFBNEI7QUFDMUIsUUFBTXRCLFlBQVVtQixZQUFoQjtBQUFBLFFBQStCO0FBQ3pCdkIsNEJBQXVCYSxxQkFBcUJjLFdBQXJCLENBQWlDdkIsU0FBakMsQ0FEN0I7QUFBQSxRQUVNakIsaUJBQWlCYSxxQkFGdkIsQ0FEMEIsQ0FHb0I7O0FBRTlDWCxxQ0FBaUNELGdDQUFqQyxFQUFtRUQsY0FBbkU7QUFDRDtBQUNGIiwiZmlsZSI6Im1pZGRsZU9mQ29tbWVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbmNvbnN0IHRva2VucyA9IHJlcXVpcmUoJy4uL3Rva2VucycpLFxyXG4gICAgICBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbXVsdGlMaW5lL21pZGRsZU9mJyksXHJcbiAgICAgIE1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvc2luZ2xlTGluZS9taWRkbGVPZicpLFxyXG4gICAgICBIeXBlcmxpbmtJbk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbXVsdGlMaW5lL2h5cGVybGlua0luJyksXHJcbiAgICAgIEh5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvc2luZ2xlTGluZS9oeXBlcmxpbmtJbicpO1xyXG5cclxuY29uc3QgeyBwcm9jZXNzQnlDYWxsYmFjayB9ID0gdG9rZW5zO1xyXG5cclxuZnVuY3Rpb24gcG9zdFByb2Nlc3ModG9rZW5zT3JDb250ZW50cykge1xyXG4gIHByb2Nlc3NCeUNhbGxiYWNrKHRva2Vuc09yQ29udGVudHMsIGZ1bmN0aW9uKHRva2VuT3JDb250ZW50KSB7XHJcbiAgICBjb25zdCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyA9IFtdO1xyXG5cclxuICAgIHBvc3RQcm9jZXNzTWlkZGxlT2ZDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCk7XHJcblxyXG4gICAgY29uc3QgdG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyA9IGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzOyAvLy9cclxuXHJcbiAgICByZXR1cm4gdG9rZW5zT3JSZW1haW5pbmdDb250ZW50cztcclxuICB9KTtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgcG9zdFByb2Nlc3M6IHBvc3RQcm9jZXNzXHJcbn07XHJcblxyXG5mdW5jdGlvbiBwb3N0UHJvY2Vzc01pZGRsZU9mQ29tbWVudFRva2Vucyhjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgdG9rZW5PckNvbnRlbnQpIHtcclxuICBjb25zdCB0b2tlbk9yQ29udGVudFN0cmluZyA9ICh0eXBlb2YgdG9rZW5PckNvbnRlbnQgPT09ICdzdHJpbmcnKSxcclxuICAgICAgICB0b2tlbk9yQ29udGVudENvbnRlbnQgPSB0b2tlbk9yQ29udGVudFN0cmluZzsgLy8vXHJcblxyXG4gIGlmICh0b2tlbk9yQ29udGVudENvbnRlbnQpIHtcclxuICAgIGNvbnN0IHJlbWFpbmluZ0NvbnRlbnQgPSB0b2tlbk9yQ29udGVudDsgIC8vL1xyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gocmVtYWluaW5nQ29udGVudCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbnN0IHRva2VuID0gdG9rZW5PckNvbnRlbnQsICAvLy9cclxuICAgICAgICAgIHRva2VuTWlkZGxlT2ZDb21tZW50VG9rZW4gPSB0b2tlbi5pc01pZGRsZU9mQ29tbWVudFRva2VuKCk7XHJcblxyXG4gICAgaWYgKHRva2VuTWlkZGxlT2ZDb21tZW50VG9rZW4pIHtcclxuICAgICAgY29uc3QgbWlkZGxlT2ZDb21tZW50VG9rZW4gPSB0b2tlbiwgLy8vXHJcbiAgICAgICAgICAgIG1pZGRsZU9mQ29tbWVudFRva2VuTXVsdGlMaW5lQ29tbWVudFRva2VuID0gbWlkZGxlT2ZDb21tZW50VG9rZW4uaXNNdWx0aUxpbmVDb21tZW50VG9rZW4oKSxcclxuICAgICAgICAgICAgbWlkZGxlT2ZDb21tZW50VG9rZW5TaW5nbGVMaW5lQ29tbWVudFRva2VuID0gIW1pZGRsZU9mQ29tbWVudFRva2VuTXVsdGlMaW5lQ29tbWVudFRva2VuOyAvLy9cclxuXHJcbiAgICAgIGlmIChmYWxzZSkge1xyXG5cclxuICAgICAgfSBlbHNlIGlmIChtaWRkbGVPZkNvbW1lbnRUb2tlbk11bHRpTGluZUNvbW1lbnRUb2tlbikge1xyXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBtaWRkbGVPZkNvbW1lbnRUb2tlbi5nZXRDb250ZW50KCksICAvLy9cclxuICAgICAgICAgICAgICBoeXBlcmxpbmtJbk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gSHlwZXJsaW5rSW5NdWx0aUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgICAgICBpZiAoaHlwZXJsaW5rSW5NdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSB7XHJcbiAgICAgICAgICBwcm9jZXNzSHlwZXJsaW5rSW5NdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKHRva2VuKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSBpZiAobWlkZGxlT2ZDb21tZW50VG9rZW5TaW5nbGVMaW5lQ29tbWVudFRva2VuKSB7XHJcbiAgICAgICAgY29uc3QgY29udGVudCA9IG1pZGRsZU9mQ29tbWVudFRva2VuLmdldENvbnRlbnQoKSwgIC8vL1xyXG4gICAgICAgICAgICAgIGh5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gSHlwZXJsaW5rSW5TaW5nbGVMaW5lQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgICAgaWYgKGh5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpIHtcclxuICAgICAgICAgIHByb2Nlc3NIeXBlcmxpbmtJblNpbmdsZUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKHRva2VuKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZkNvbW1lbnRUb2tlbik7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2godG9rZW4pO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcHJvY2Vzc0h5cGVybGlua0luTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KSB7XHJcbiAgcHJvY2Vzc0h5cGVybGlua0luQ29tbWVudFRva2VuKEh5cGVybGlua0luTXVsdGlMaW5lQ29tbWVudFRva2VuLCBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwcm9jZXNzSHlwZXJsaW5rSW5TaW5nbGVMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KSB7XHJcbiAgcHJvY2Vzc0h5cGVybGlua0luQ29tbWVudFRva2VuKEh5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlbiwgTWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3NIeXBlcmxpbmtJbkNvbW1lbnRUb2tlbihIeXBlcmxpbmtJbkNvbW1lbnRUb2tlbiwgTWlkZGxlT2ZDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KSB7XHJcbiAgY29uc3QgaHlwZXJsaW5rSW5Db21tZW50VG9rZW4gPSBIeXBlcmxpbmtJbkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IEh5cGVybGlua0luQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KSwgIC8vL1xyXG4gICAgICAgIGNvbnRlbnRMZW5ndGggPSBoeXBlcmxpbmtJbkNvbW1lbnRUb2tlbi5nZXRDb250ZW50TGVuZ3RoKCksXHJcbiAgICAgICAgbGVmdCA9IHBvc2l0aW9uLFxyXG4gICAgICAgIHJpZ2h0ID0gcG9zaXRpb24gKyBjb250ZW50TGVuZ3RoLFxyXG4gICAgICAgIGxlZnRDb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcoMCwgbGVmdCksXHJcbiAgICAgICAgcmlnaHRDb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcocmlnaHQpLFxyXG4gICAgICAgIGxlZnRDb250ZW50TGVuZ3RoID0gbGVmdENvbnRlbnQubGVuZ3RoLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudExlbmd0aCA9IHJpZ2h0Q29udGVudC5sZW5ndGg7XHJcblxyXG4gIGlmIChsZWZ0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IGNvbnRlbnQgPSBsZWZ0Q29udGVudCwgIC8vL1xyXG4gICAgICAgICAgbWlkZGxlT2ZDb21tZW50VG9rZW4gPSBNaWRkbGVPZkNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKG1pZGRsZU9mQ29tbWVudFRva2VuKTtcclxuICB9XHJcblxyXG4gIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2goaHlwZXJsaW5rSW5Db21tZW50VG9rZW4pO1xyXG5cclxuICBpZiAocmlnaHRDb250ZW50TGVuZ3RoID4gMCkge1xyXG4gICAgY29uc3QgY29udGVudCA9IHJpZ2h0Q29udGVudCwgIC8vL1xyXG4gICAgICAgICAgbWlkZGxlT2ZDb21tZW50VG9rZW4gPSBNaWRkbGVPZkNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KSxcclxuICAgICAgICAgIHRva2VuT3JDb250ZW50ID0gbWlkZGxlT2ZDb21tZW50VG9rZW47ICAvLy9cclxuXHJcbiAgICBwb3N0UHJvY2Vzc01pZGRsZU9mQ29tbWVudFRva2Vucyhjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgdG9rZW5PckNvbnRlbnQpO1xyXG4gIH1cclxufVxyXG4iXX0=