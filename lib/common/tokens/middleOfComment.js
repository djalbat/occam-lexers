'use strict';

var tokens = require('../tokens'),
    MiddleOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/middleOf'),
    MiddleOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/middleOf'),
    HyperlinkInMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/hyperlinkIn'),
    HyperlinkInSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/hyperlinkIn');

var tokeniseByCallback = tokens.tokeniseByCallback;


function reTokenise(tokensOrContents) {
  tokeniseByCallback(tokensOrContents, function (tokenOrContent) {
    var commentTokensOrRemainingContents = [];

    reTokeniseMiddleOfCommentTokens(commentTokensOrRemainingContents, tokenOrContent);

    var tokensOrRemainingContents = commentTokensOrRemainingContents; ///

    return tokensOrRemainingContents;
  });
}

module.exports = {
  reTokenise: reTokenise
};

function reTokeniseMiddleOfCommentTokens(commentTokensOrRemainingContents, tokenOrContent) {
  var tokenOrContentString = typeof tokenOrContent === 'string',
      tokenOrContentContent = tokenOrContentString; ///

  if (tokenOrContentContent) {
    var remainingContent = tokenOrContent; ///

    commentTokensOrRemainingContents.push(remainingContent);
  } else {
    var token = tokenOrContent,
        ///
    tokenMiddleOfCommentToken = token.isMiddleOfCommentToken();

    if (tokenMiddleOfCommentToken) {
      var middleOfCommentToken = token,
          ///
      middleOfCommentTokenMultiLineCommentToken = middleOfCommentToken.isMultiLineCommentToken(),
          middleOfCommentTokenSingleLineCommentToken = !middleOfCommentTokenMultiLineCommentToken; ///

      if (false) {} else if (middleOfCommentTokenMultiLineCommentToken) {
        var content = middleOfCommentToken.getContent(),
            ///
        hyperlinkInMultiLineCommentTokenPosition = HyperlinkInMultiLineCommentToken.positionWithinContent(content);

        if (hyperlinkInMultiLineCommentTokenPosition > -1) {
          tokeniseHyperlinkInMultiLineCommentToken(commentTokensOrRemainingContents, content);
        } else {
          commentTokensOrRemainingContents.push(token);
        }
      } else if (middleOfCommentTokenSingleLineCommentToken) {
        var _content = middleOfCommentToken.getContent(),
            ///
        hyperlinkInSingleLineCommentTokenPosition = HyperlinkInSingleLineCommentToken.positionWithinContent(_content);

        if (hyperlinkInSingleLineCommentTokenPosition > -1) {
          tokeniseHyperlinkInSingleLineCommentToken(commentTokensOrRemainingContents, _content);
        } else {
          commentTokensOrRemainingContents.push(token);
        }
      } else {
        commentTokensOrRemainingContents.push(middleOfCommentToken);
      }
    } else {
      commentTokensOrRemainingContents.push(token);
    }
  }
}

function tokeniseHyperlinkInMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  tokeniseHyperlinkInCommentToken(HyperlinkInMultiLineCommentToken, MiddleOfMultiLineCommentToken, commentTokensOrRemainingContents, content);
}

function tokeniseHyperlinkInSingleLineCommentToken(commentTokensOrRemainingContents, content) {
  tokeniseHyperlinkInCommentToken(HyperlinkInSingleLineCommentToken, MiddleOfSingleLineCommentToken, commentTokensOrRemainingContents, content);
}

function tokeniseHyperlinkInCommentToken(HyperlinkInCommentToken, MiddleOfCommentToken, commentTokensOrRemainingContents, content) {
  var hyperlinkInCommentToken = HyperlinkInCommentToken.fromWithinContent(content),
      position = HyperlinkInCommentToken.positionWithinContent(content),
      ///
  contentLength = hyperlinkInCommentToken.getContentLength(),
      left = position,
      right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var _content2 = leftContent,
        ///
    middleOfCommentToken = MiddleOfCommentToken.fromContent(_content2);

    commentTokensOrRemainingContents.push(middleOfCommentToken);
  }

  commentTokensOrRemainingContents.push(hyperlinkInCommentToken);

  if (rightContentLength > 0) {
    var _content3 = rightContent,
        ///
    _middleOfCommentToken = MiddleOfCommentToken.fromContent(_content3),
        tokenOrContent = _middleOfCommentToken; ///

    reTokeniseMiddleOfCommentTokens(commentTokensOrRemainingContents, tokenOrContent);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9jb21tb24vdG9rZW5zL21pZGRsZU9mQ29tbWVudC5qcyJdLCJuYW1lcyI6WyJ0b2tlbnMiLCJyZXF1aXJlIiwiTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJNaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4iLCJIeXBlcmxpbmtJbk11bHRpTGluZUNvbW1lbnRUb2tlbiIsIkh5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsInRva2VuaXNlQnlDYWxsYmFjayIsInJlVG9rZW5pc2UiLCJ0b2tlbnNPckNvbnRlbnRzIiwidG9rZW5PckNvbnRlbnQiLCJjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyIsInJlVG9rZW5pc2VNaWRkbGVPZkNvbW1lbnRUb2tlbnMiLCJ0b2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzIiwibW9kdWxlIiwiZXhwb3J0cyIsInRva2VuT3JDb250ZW50U3RyaW5nIiwidG9rZW5PckNvbnRlbnRDb250ZW50IiwicmVtYWluaW5nQ29udGVudCIsInB1c2giLCJ0b2tlbiIsInRva2VuTWlkZGxlT2ZDb21tZW50VG9rZW4iLCJpc01pZGRsZU9mQ29tbWVudFRva2VuIiwibWlkZGxlT2ZDb21tZW50VG9rZW4iLCJtaWRkbGVPZkNvbW1lbnRUb2tlbk11bHRpTGluZUNvbW1lbnRUb2tlbiIsImlzTXVsdGlMaW5lQ29tbWVudFRva2VuIiwibWlkZGxlT2ZDb21tZW50VG9rZW5TaW5nbGVMaW5lQ29tbWVudFRva2VuIiwiY29udGVudCIsImdldENvbnRlbnQiLCJoeXBlcmxpbmtJbk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uIiwicG9zaXRpb25XaXRoaW5Db250ZW50IiwidG9rZW5pc2VIeXBlcmxpbmtJbk11bHRpTGluZUNvbW1lbnRUb2tlbiIsImh5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uIiwidG9rZW5pc2VIeXBlcmxpbmtJblNpbmdsZUxpbmVDb21tZW50VG9rZW4iLCJ0b2tlbmlzZUh5cGVybGlua0luQ29tbWVudFRva2VuIiwiSHlwZXJsaW5rSW5Db21tZW50VG9rZW4iLCJNaWRkbGVPZkNvbW1lbnRUb2tlbiIsImh5cGVybGlua0luQ29tbWVudFRva2VuIiwiZnJvbVdpdGhpbkNvbnRlbnQiLCJwb3NpdGlvbiIsImNvbnRlbnRMZW5ndGgiLCJnZXRDb250ZW50TGVuZ3RoIiwibGVmdCIsInJpZ2h0IiwibGVmdENvbnRlbnQiLCJzdWJzdHJpbmciLCJyaWdodENvbnRlbnQiLCJsZWZ0Q29udGVudExlbmd0aCIsImxlbmd0aCIsInJpZ2h0Q29udGVudExlbmd0aCIsImZyb21Db250ZW50Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxTQUFTQyxRQUFRLFdBQVIsQ0FBZjtBQUFBLElBQ01DLGdDQUFnQ0QsUUFBUSxvREFBUixDQUR0QztBQUFBLElBRU1FLGlDQUFpQ0YsUUFBUSxxREFBUixDQUZ2QztBQUFBLElBR01HLG1DQUFtQ0gsUUFBUSx1REFBUixDQUh6QztBQUFBLElBSU1JLG9DQUFvQ0osUUFBUSx3REFBUixDQUoxQzs7SUFNUUssa0IsR0FBdUJOLE0sQ0FBdkJNLGtCOzs7QUFFUixTQUFTQyxVQUFULENBQW9CQyxnQkFBcEIsRUFBc0M7QUFDcENGLHFCQUFtQkUsZ0JBQW5CLEVBQXFDLFVBQVNDLGNBQVQsRUFBeUI7QUFDNUQsUUFBTUMsbUNBQW1DLEVBQXpDOztBQUVBQyxvQ0FBZ0NELGdDQUFoQyxFQUFrRUQsY0FBbEU7O0FBRUEsUUFBTUcsNEJBQTRCRixnQ0FBbEMsQ0FMNEQsQ0FLUTs7QUFFcEUsV0FBT0UseUJBQVA7QUFDRCxHQVJEO0FBU0Q7O0FBRURDLE9BQU9DLE9BQVAsR0FBaUI7QUFDZlA7QUFEZSxDQUFqQjs7QUFJQSxTQUFTSSwrQkFBVCxDQUF5Q0QsZ0NBQXpDLEVBQTJFRCxjQUEzRSxFQUEyRjtBQUN6RixNQUFNTSx1QkFBd0IsT0FBT04sY0FBUCxLQUEwQixRQUF4RDtBQUFBLE1BQ01PLHdCQUF3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ckIsQ0FBaUN2QixTQUFqQyxDQUQ3Qjs7QUFHQWhCLHFDQUFpQ1EsSUFBakMsQ0FBc0NJLG9CQUF0QztBQUNEOztBQUVEWixtQ0FBaUNRLElBQWpDLENBQXNDa0IsdUJBQXRDOztBQUVBLE1BQUlZLHFCQUFxQixDQUF6QixFQUE0QjtBQUMxQixRQUFNdEIsWUFBVW1CLFlBQWhCO0FBQUEsUUFBK0I7QUFDekJ2Qiw0QkFBdUJhLHFCQUFxQmMsV0FBckIsQ0FBaUN2QixTQUFqQyxDQUQ3QjtBQUFBLFFBRU1qQixpQkFBaUJhLHFCQUZ2QixDQUQwQixDQUdvQjs7QUFFOUNYLG9DQUFnQ0QsZ0NBQWhDLEVBQWtFRCxjQUFsRTtBQUNEO0FBQ0YiLCJmaWxlIjoibWlkZGxlT2ZDb21tZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuY29uc3QgdG9rZW5zID0gcmVxdWlyZSgnLi4vdG9rZW5zJyksXHJcbiAgICAgIE1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9tdWx0aUxpbmUvbWlkZGxlT2YnKSxcclxuICAgICAgTWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9zaW5nbGVMaW5lL21pZGRsZU9mJyksXHJcbiAgICAgIEh5cGVybGlua0luTXVsdGlMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9tdWx0aUxpbmUvaHlwZXJsaW5rSW4nKSxcclxuICAgICAgSHlwZXJsaW5rSW5TaW5nbGVMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9zaW5nbGVMaW5lL2h5cGVybGlua0luJyk7XHJcblxyXG5jb25zdCB7IHRva2VuaXNlQnlDYWxsYmFjayB9ID0gdG9rZW5zO1xyXG5cclxuZnVuY3Rpb24gcmVUb2tlbmlzZSh0b2tlbnNPckNvbnRlbnRzKSB7XHJcbiAgdG9rZW5pc2VCeUNhbGxiYWNrKHRva2Vuc09yQ29udGVudHMsIGZ1bmN0aW9uKHRva2VuT3JDb250ZW50KSB7XHJcbiAgICBjb25zdCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyA9IFtdO1xyXG5cclxuICAgIHJlVG9rZW5pc2VNaWRkbGVPZkNvbW1lbnRUb2tlbnMoY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIHRva2VuT3JDb250ZW50KTtcclxuXHJcbiAgICBjb25zdCB0b2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzID0gY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHM7IC8vL1xyXG5cclxuICAgIHJldHVybiB0b2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzO1xyXG4gIH0pO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICByZVRva2VuaXNlXHJcbn07XHJcblxyXG5mdW5jdGlvbiByZVRva2VuaXNlTWlkZGxlT2ZDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCkge1xyXG4gIGNvbnN0IHRva2VuT3JDb250ZW50U3RyaW5nID0gKHR5cGVvZiB0b2tlbk9yQ29udGVudCA9PT0gJ3N0cmluZycpLFxyXG4gICAgICAgIHRva2VuT3JDb250ZW50Q29udGVudCA9IHRva2VuT3JDb250ZW50U3RyaW5nOyAvLy9cclxuXHJcbiAgaWYgKHRva2VuT3JDb250ZW50Q29udGVudCkge1xyXG4gICAgY29uc3QgcmVtYWluaW5nQ29udGVudCA9IHRva2VuT3JDb250ZW50OyAgLy8vXHJcblxyXG4gICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChyZW1haW5pbmdDb250ZW50KTtcclxuICB9IGVsc2Uge1xyXG4gICAgY29uc3QgdG9rZW4gPSB0b2tlbk9yQ29udGVudCwgIC8vL1xyXG4gICAgICAgICAgdG9rZW5NaWRkbGVPZkNvbW1lbnRUb2tlbiA9IHRva2VuLmlzTWlkZGxlT2ZDb21tZW50VG9rZW4oKTtcclxuXHJcbiAgICBpZiAodG9rZW5NaWRkbGVPZkNvbW1lbnRUb2tlbikge1xyXG4gICAgICBjb25zdCBtaWRkbGVPZkNvbW1lbnRUb2tlbiA9IHRva2VuLCAvLy9cclxuICAgICAgICAgICAgbWlkZGxlT2ZDb21tZW50VG9rZW5NdWx0aUxpbmVDb21tZW50VG9rZW4gPSBtaWRkbGVPZkNvbW1lbnRUb2tlbi5pc011bHRpTGluZUNvbW1lbnRUb2tlbigpLFxyXG4gICAgICAgICAgICBtaWRkbGVPZkNvbW1lbnRUb2tlblNpbmdsZUxpbmVDb21tZW50VG9rZW4gPSAhbWlkZGxlT2ZDb21tZW50VG9rZW5NdWx0aUxpbmVDb21tZW50VG9rZW47IC8vL1xyXG5cclxuICAgICAgaWYgKGZhbHNlKSB7XHJcblxyXG4gICAgICB9IGVsc2UgaWYgKG1pZGRsZU9mQ29tbWVudFRva2VuTXVsdGlMaW5lQ29tbWVudFRva2VuKSB7XHJcbiAgICAgICAgY29uc3QgY29udGVudCA9IG1pZGRsZU9mQ29tbWVudFRva2VuLmdldENvbnRlbnQoKSwgIC8vL1xyXG4gICAgICAgICAgICAgIGh5cGVybGlua0luTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBIeXBlcmxpbmtJbk11bHRpTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICAgIGlmIChoeXBlcmxpbmtJbk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpIHtcclxuICAgICAgICAgIHRva2VuaXNlSHlwZXJsaW5rSW5NdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKHRva2VuKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSBpZiAobWlkZGxlT2ZDb21tZW50VG9rZW5TaW5nbGVMaW5lQ29tbWVudFRva2VuKSB7XHJcbiAgICAgICAgY29uc3QgY29udGVudCA9IG1pZGRsZU9mQ29tbWVudFRva2VuLmdldENvbnRlbnQoKSwgIC8vL1xyXG4gICAgICAgICAgICAgIGh5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gSHlwZXJsaW5rSW5TaW5nbGVMaW5lQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgICAgaWYgKGh5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpIHtcclxuICAgICAgICAgIHRva2VuaXNlSHlwZXJsaW5rSW5TaW5nbGVMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaCh0b2tlbik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gobWlkZGxlT2ZDb21tZW50VG9rZW4pO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKHRva2VuKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRva2VuaXNlSHlwZXJsaW5rSW5NdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpIHtcclxuICB0b2tlbmlzZUh5cGVybGlua0luQ29tbWVudFRva2VuKEh5cGVybGlua0luTXVsdGlMaW5lQ29tbWVudFRva2VuLCBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiB0b2tlbmlzZUh5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCkge1xyXG4gIHRva2VuaXNlSHlwZXJsaW5rSW5Db21tZW50VG9rZW4oSHlwZXJsaW5rSW5TaW5nbGVMaW5lQ29tbWVudFRva2VuLCBNaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9rZW5pc2VIeXBlcmxpbmtJbkNvbW1lbnRUb2tlbihIeXBlcmxpbmtJbkNvbW1lbnRUb2tlbiwgTWlkZGxlT2ZDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KSB7XHJcbiAgY29uc3QgaHlwZXJsaW5rSW5Db21tZW50VG9rZW4gPSBIeXBlcmxpbmtJbkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IEh5cGVybGlua0luQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KSwgIC8vL1xyXG4gICAgICAgIGNvbnRlbnRMZW5ndGggPSBoeXBlcmxpbmtJbkNvbW1lbnRUb2tlbi5nZXRDb250ZW50TGVuZ3RoKCksXHJcbiAgICAgICAgbGVmdCA9IHBvc2l0aW9uLFxyXG4gICAgICAgIHJpZ2h0ID0gcG9zaXRpb24gKyBjb250ZW50TGVuZ3RoLFxyXG4gICAgICAgIGxlZnRDb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcoMCwgbGVmdCksXHJcbiAgICAgICAgcmlnaHRDb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcocmlnaHQpLFxyXG4gICAgICAgIGxlZnRDb250ZW50TGVuZ3RoID0gbGVmdENvbnRlbnQubGVuZ3RoLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudExlbmd0aCA9IHJpZ2h0Q29udGVudC5sZW5ndGg7XHJcblxyXG4gIGlmIChsZWZ0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IGNvbnRlbnQgPSBsZWZ0Q29udGVudCwgIC8vL1xyXG4gICAgICAgICAgbWlkZGxlT2ZDb21tZW50VG9rZW4gPSBNaWRkbGVPZkNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKG1pZGRsZU9mQ29tbWVudFRva2VuKTtcclxuICB9XHJcblxyXG4gIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2goaHlwZXJsaW5rSW5Db21tZW50VG9rZW4pO1xyXG5cclxuICBpZiAocmlnaHRDb250ZW50TGVuZ3RoID4gMCkge1xyXG4gICAgY29uc3QgY29udGVudCA9IHJpZ2h0Q29udGVudCwgIC8vL1xyXG4gICAgICAgICAgbWlkZGxlT2ZDb21tZW50VG9rZW4gPSBNaWRkbGVPZkNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KSxcclxuICAgICAgICAgIHRva2VuT3JDb250ZW50ID0gbWlkZGxlT2ZDb21tZW50VG9rZW47ICAvLy9cclxuXHJcbiAgICByZVRva2VuaXNlTWlkZGxlT2ZDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==