'use strict';

var tokens = require('../tokens'),
    MiddleOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/middleOf'),
    MiddleOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/middleOf'),
    HyperlinkInMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/hyperlinkIn'),
    HyperlinkInSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/hyperlinkIn');

var processByCallback = tokens.processByCallback;


function postProcess(tokensOrContents) {
  processByCallback(tokensOrContents, function (tokenOrContent) {
    var commentTokensOrRemainingContents = [];

    postProcessMiddleOfCommentTokens(commentTokensOrRemainingContents, tokenOrContent);

    var tokensOrRemainingContents = commentTokensOrRemainingContents; ///

    return tokensOrRemainingContents;
  });
}

module.exports = {
  postProcess: postProcess
};

function postProcessMiddleOfCommentTokens(commentTokensOrRemainingContents, tokenOrContent) {
  var tokenOrContentString = typeof tokenOrContent === 'string',
      tokenOrContentContent = tokenOrContentString; ///

  if (tokenOrContentContent) {
    var remainingContent = tokenOrContent; ///

    commentTokensOrRemainingContents.push(remainingContent);
  } else {
    var token = tokenOrContent,
        ///
    tokenMiddleOfCommentToken = token.isMiddleOfCommentToken();

    if (tokenMiddleOfCommentToken) {
      var middleOfCommentToken = token,
          ///
      middleOfCommentTokenMultiLineCommentToken = middleOfCommentToken.isMultiLineCommentToken(),
          middleOfCommentTokenSingleLineCommentToken = !middleOfCommentTokenMultiLineCommentToken; ///

      if (false) {} else if (middleOfCommentTokenMultiLineCommentToken) {
        var content = middleOfCommentToken.getContent(),
            ///
        hyperlinkInMultiLineCommentTokenPosition = HyperlinkInMultiLineCommentToken.positionWithinContent(content);

        if (hyperlinkInMultiLineCommentTokenPosition > -1) {
          processHyperlinkInMultiLineCommentToken(commentTokensOrRemainingContents, content);
        } else {
          commentTokensOrRemainingContents.push(token);
        }
      } else if (middleOfCommentTokenSingleLineCommentToken) {
        var _content = middleOfCommentToken.getContent(),
            ///
        hyperlinkInSingleLineCommentTokenPosition = HyperlinkInSingleLineCommentToken.positionWithinContent(_content);

        if (hyperlinkInSingleLineCommentTokenPosition > -1) {
          processHyperlinkInSingleLineCommentToken(commentTokensOrRemainingContents, _content);
        } else {
          commentTokensOrRemainingContents.push(token);
        }
      } else {
        commentTokensOrRemainingContents.push(middleOfCommentToken);
      }
    } else {
      commentTokensOrRemainingContents.push(token);
    }
  }
}

function processHyperlinkInMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  processHyperlinkInCommentToken(HyperlinkInMultiLineCommentToken, MiddleOfMultiLineCommentToken, commentTokensOrRemainingContents, content);
}

function processHyperlinkInSingleLineCommentToken(commentTokensOrRemainingContents, content) {
  processHyperlinkInCommentToken(HyperlinkInSingleLineCommentToken, MiddleOfSingleLineCommentToken, commentTokensOrRemainingContents, content);
}

function processHyperlinkInCommentToken(HyperlinkInCommentToken, MiddleOfCommentToken, commentTokensOrRemainingContents, content) {
  var hyperlinkInCommentToken = HyperlinkInCommentToken.fromWithinContent(content),
      position = HyperlinkInCommentToken.positionWithinContent(content),
      ///
  contentLength = hyperlinkInCommentToken.getContentLength(),
      left = position,
      right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var _content2 = leftContent,
        ///
    middleOfCommentToken = MiddleOfCommentToken.fromContent(_content2);

    commentTokensOrRemainingContents.push(middleOfCommentToken);
  }

  commentTokensOrRemainingContents.push(hyperlinkInCommentToken);

  if (rightContentLength > 0) {
    var _content3 = rightContent,
        ///
    _middleOfCommentToken = MiddleOfCommentToken.fromContent(_content3),
        tokenOrContent = _middleOfCommentToken; ///

    postProcessMiddleOfCommentTokens(commentTokensOrRemainingContents, tokenOrContent);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9jb21tb24vdG9rZW5zL21pZGRsZU9mQ29tbWVudC5qcyJdLCJuYW1lcyI6WyJ0b2tlbnMiLCJyZXF1aXJlIiwiTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJNaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4iLCJIeXBlcmxpbmtJbk11bHRpTGluZUNvbW1lbnRUb2tlbiIsIkh5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsInByb2Nlc3NCeUNhbGxiYWNrIiwicG9zdFByb2Nlc3MiLCJ0b2tlbnNPckNvbnRlbnRzIiwidG9rZW5PckNvbnRlbnQiLCJjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyIsInBvc3RQcm9jZXNzTWlkZGxlT2ZDb21tZW50VG9rZW5zIiwidG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyIsIm1vZHVsZSIsImV4cG9ydHMiLCJ0b2tlbk9yQ29udGVudFN0cmluZyIsInRva2VuT3JDb250ZW50Q29udGVudCIsInJlbWFpbmluZ0NvbnRlbnQiLCJwdXNoIiwidG9rZW4iLCJ0b2tlbk1pZGRsZU9mQ29tbWVudFRva2VuIiwiaXNNaWRkbGVPZkNvbW1lbnRUb2tlbiIsIm1pZGRsZU9mQ29tbWVudFRva2VuIiwibWlkZGxlT2ZDb21tZW50VG9rZW5NdWx0aUxpbmVDb21tZW50VG9rZW4iLCJpc011bHRpTGluZUNvbW1lbnRUb2tlbiIsIm1pZGRsZU9mQ29tbWVudFRva2VuU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsImNvbnRlbnQiLCJnZXRDb250ZW50IiwiaHlwZXJsaW5rSW5NdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInBvc2l0aW9uV2l0aGluQ29udGVudCIsInByb2Nlc3NIeXBlcmxpbmtJbk11bHRpTGluZUNvbW1lbnRUb2tlbiIsImh5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uIiwicHJvY2Vzc0h5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsInByb2Nlc3NIeXBlcmxpbmtJbkNvbW1lbnRUb2tlbiIsIkh5cGVybGlua0luQ29tbWVudFRva2VuIiwiTWlkZGxlT2ZDb21tZW50VG9rZW4iLCJoeXBlcmxpbmtJbkNvbW1lbnRUb2tlbiIsImZyb21XaXRoaW5Db250ZW50IiwicG9zaXRpb24iLCJjb250ZW50TGVuZ3RoIiwiZ2V0Q29udGVudExlbmd0aCIsImxlZnQiLCJyaWdodCIsImxlZnRDb250ZW50Iiwic3Vic3RyaW5nIiwicmlnaHRDb250ZW50IiwibGVmdENvbnRlbnRMZW5ndGgiLCJsZW5ndGgiLCJyaWdodENvbnRlbnRMZW5ndGgiLCJmcm9tQ29udGVudCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsU0FBU0MsUUFBUSxXQUFSLENBQWY7QUFBQSxJQUNNQyxnQ0FBZ0NELFFBQVEsb0RBQVIsQ0FEdEM7QUFBQSxJQUVNRSxpQ0FBaUNGLFFBQVEscURBQVIsQ0FGdkM7QUFBQSxJQUdNRyxtQ0FBbUNILFFBQVEsdURBQVIsQ0FIekM7QUFBQSxJQUlNSSxvQ0FBb0NKLFFBQVEsd0RBQVIsQ0FKMUM7O0lBTVFLLGlCLEdBQXNCTixNLENBQXRCTSxpQjs7O0FBRVIsU0FBU0MsV0FBVCxDQUFxQkMsZ0JBQXJCLEVBQXVDO0FBQ3JDRixvQkFBa0JFLGdCQUFsQixFQUFvQyxVQUFTQyxjQUFULEVBQXlCO0FBQzNELFFBQU1DLG1DQUFtQyxFQUF6Qzs7QUFFQUMscUNBQWlDRCxnQ0FBakMsRUFBbUVELGNBQW5FOztBQUVBLFFBQU1HLDRCQUE0QkYsZ0NBQWxDLENBTDJELENBS1M7O0FBRXBFLFdBQU9FLHlCQUFQO0FBQ0QsR0FSRDtBQVNEOztBQUVEQyxPQUFPQyxPQUFQLEdBQWlCO0FBQ2ZQO0FBRGUsQ0FBakI7O0FBSUEsU0FBU0ksZ0NBQVQsQ0FBMENELGdDQUExQyxFQUE0RUQsY0FBNUUsRUFBNEY7QUFDMUYsTUFBTU0sdUJBQXdCLE9BQU9OLGNBQVAsS0FBMEIsUUFBeEQ7QUFBQSxNQUNNTyx3QkFBd0JE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LENBQWlDdkIsU0FBakMsQ0FEN0I7O0FBR0FoQixxQ0FBaUNRLElBQWpDLENBQXNDSSxvQkFBdEM7QUFDRDs7QUFFRFosbUNBQWlDUSxJQUFqQyxDQUFzQ2tCLHVCQUF0Qzs7QUFFQSxNQUFJWSxxQkFBcUIsQ0FBekIsRUFBNEI7QUFDMUIsUUFBTXRCLFlBQVVtQixZQUFoQjtBQUFBLFFBQStCO0FBQ3pCdkIsNEJBQXVCYSxxQkFBcUJjLFdBQXJCLENBQWlDdkIsU0FBakMsQ0FEN0I7QUFBQSxRQUVNakIsaUJBQWlCYSxxQkFGdkIsQ0FEMEIsQ0FHb0I7O0FBRTlDWCxxQ0FBaUNELGdDQUFqQyxFQUFtRUQsY0FBbkU7QUFDRDtBQUNGIiwiZmlsZSI6Im1pZGRsZU9mQ29tbWVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbmNvbnN0IHRva2VucyA9IHJlcXVpcmUoJy4uL3Rva2VucycpLFxyXG4gICAgICBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbXVsdGlMaW5lL21pZGRsZU9mJyksXHJcbiAgICAgIE1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvc2luZ2xlTGluZS9taWRkbGVPZicpLFxyXG4gICAgICBIeXBlcmxpbmtJbk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbXVsdGlMaW5lL2h5cGVybGlua0luJyksXHJcbiAgICAgIEh5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvc2luZ2xlTGluZS9oeXBlcmxpbmtJbicpO1xyXG5cclxuY29uc3QgeyBwcm9jZXNzQnlDYWxsYmFjayB9ID0gdG9rZW5zO1xyXG5cclxuZnVuY3Rpb24gcG9zdFByb2Nlc3ModG9rZW5zT3JDb250ZW50cykge1xyXG4gIHByb2Nlc3NCeUNhbGxiYWNrKHRva2Vuc09yQ29udGVudHMsIGZ1bmN0aW9uKHRva2VuT3JDb250ZW50KSB7XHJcbiAgICBjb25zdCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyA9IFtdO1xyXG5cclxuICAgIHBvc3RQcm9jZXNzTWlkZGxlT2ZDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCk7XHJcblxyXG4gICAgY29uc3QgdG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyA9IGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzOyAvLy9cclxuXHJcbiAgICByZXR1cm4gdG9rZW5zT3JSZW1haW5pbmdDb250ZW50cztcclxuICB9KTtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgcG9zdFByb2Nlc3NcclxufTtcclxuXHJcbmZ1bmN0aW9uIHBvc3RQcm9jZXNzTWlkZGxlT2ZDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCkge1xyXG4gIGNvbnN0IHRva2VuT3JDb250ZW50U3RyaW5nID0gKHR5cGVvZiB0b2tlbk9yQ29udGVudCA9PT0gJ3N0cmluZycpLFxyXG4gICAgICAgIHRva2VuT3JDb250ZW50Q29udGVudCA9IHRva2VuT3JDb250ZW50U3RyaW5nOyAvLy9cclxuXHJcbiAgaWYgKHRva2VuT3JDb250ZW50Q29udGVudCkge1xyXG4gICAgY29uc3QgcmVtYWluaW5nQ29udGVudCA9IHRva2VuT3JDb250ZW50OyAgLy8vXHJcblxyXG4gICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChyZW1haW5pbmdDb250ZW50KTtcclxuICB9IGVsc2Uge1xyXG4gICAgY29uc3QgdG9rZW4gPSB0b2tlbk9yQ29udGVudCwgIC8vL1xyXG4gICAgICAgICAgdG9rZW5NaWRkbGVPZkNvbW1lbnRUb2tlbiA9IHRva2VuLmlzTWlkZGxlT2ZDb21tZW50VG9rZW4oKTtcclxuXHJcbiAgICBpZiAodG9rZW5NaWRkbGVPZkNvbW1lbnRUb2tlbikge1xyXG4gICAgICBjb25zdCBtaWRkbGVPZkNvbW1lbnRUb2tlbiA9IHRva2VuLCAvLy9cclxuICAgICAgICAgICAgbWlkZGxlT2ZDb21tZW50VG9rZW5NdWx0aUxpbmVDb21tZW50VG9rZW4gPSBtaWRkbGVPZkNvbW1lbnRUb2tlbi5pc011bHRpTGluZUNvbW1lbnRUb2tlbigpLFxyXG4gICAgICAgICAgICBtaWRkbGVPZkNvbW1lbnRUb2tlblNpbmdsZUxpbmVDb21tZW50VG9rZW4gPSAhbWlkZGxlT2ZDb21tZW50VG9rZW5NdWx0aUxpbmVDb21tZW50VG9rZW47IC8vL1xyXG5cclxuICAgICAgaWYgKGZhbHNlKSB7XHJcblxyXG4gICAgICB9IGVsc2UgaWYgKG1pZGRsZU9mQ29tbWVudFRva2VuTXVsdGlMaW5lQ29tbWVudFRva2VuKSB7XHJcbiAgICAgICAgY29uc3QgY29udGVudCA9IG1pZGRsZU9mQ29tbWVudFRva2VuLmdldENvbnRlbnQoKSwgIC8vL1xyXG4gICAgICAgICAgICAgIGh5cGVybGlua0luTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBIeXBlcmxpbmtJbk11bHRpTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICAgIGlmIChoeXBlcmxpbmtJbk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpIHtcclxuICAgICAgICAgIHByb2Nlc3NIeXBlcmxpbmtJbk11bHRpTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2godG9rZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChtaWRkbGVPZkNvbW1lbnRUb2tlblNpbmdsZUxpbmVDb21tZW50VG9rZW4pIHtcclxuICAgICAgICBjb25zdCBjb250ZW50ID0gbWlkZGxlT2ZDb21tZW50VG9rZW4uZ2V0Q29udGVudCgpLCAgLy8vXHJcbiAgICAgICAgICAgICAgaHlwZXJsaW5rSW5TaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBIeXBlcmxpbmtJblNpbmdsZUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgICAgICBpZiAoaHlwZXJsaW5rSW5TaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICAgICAgcHJvY2Vzc0h5cGVybGlua0luU2luZ2xlTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2godG9rZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKG1pZGRsZU9mQ29tbWVudFRva2VuKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaCh0b2tlbik7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBwcm9jZXNzSHlwZXJsaW5rSW5NdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpIHtcclxuICBwcm9jZXNzSHlwZXJsaW5rSW5Db21tZW50VG9rZW4oSHlwZXJsaW5rSW5NdWx0aUxpbmVDb21tZW50VG9rZW4sIE1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3NIeXBlcmxpbmtJblNpbmdsZUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpIHtcclxuICBwcm9jZXNzSHlwZXJsaW5rSW5Db21tZW50VG9rZW4oSHlwZXJsaW5rSW5TaW5nbGVMaW5lQ29tbWVudFRva2VuLCBNaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KTtcclxufVxyXG5cclxuZnVuY3Rpb24gcHJvY2Vzc0h5cGVybGlua0luQ29tbWVudFRva2VuKEh5cGVybGlua0luQ29tbWVudFRva2VuLCBNaWRkbGVPZkNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpIHtcclxuICBjb25zdCBoeXBlcmxpbmtJbkNvbW1lbnRUb2tlbiA9IEh5cGVybGlua0luQ29tbWVudFRva2VuLmZyb21XaXRoaW5Db250ZW50KGNvbnRlbnQpLFxyXG4gICAgICAgIHBvc2l0aW9uID0gSHlwZXJsaW5rSW5Db21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpLCAgLy8vXHJcbiAgICAgICAgY29udGVudExlbmd0aCA9IGh5cGVybGlua0luQ29tbWVudFRva2VuLmdldENvbnRlbnRMZW5ndGgoKSxcclxuICAgICAgICBsZWZ0ID0gcG9zaXRpb24sXHJcbiAgICAgICAgcmlnaHQgPSBwb3NpdGlvbiArIGNvbnRlbnRMZW5ndGgsXHJcbiAgICAgICAgbGVmdENvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZygwLCBsZWZ0KSxcclxuICAgICAgICByaWdodENvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZyhyaWdodCksXHJcbiAgICAgICAgbGVmdENvbnRlbnRMZW5ndGggPSBsZWZ0Q29udGVudC5sZW5ndGgsXHJcbiAgICAgICAgcmlnaHRDb250ZW50TGVuZ3RoID0gcmlnaHRDb250ZW50Lmxlbmd0aDtcclxuXHJcbiAgaWYgKGxlZnRDb250ZW50TGVuZ3RoID4gMCkge1xyXG4gICAgY29uc3QgY29udGVudCA9IGxlZnRDb250ZW50LCAgLy8vXHJcbiAgICAgICAgICBtaWRkbGVPZkNvbW1lbnRUb2tlbiA9IE1pZGRsZU9mQ29tbWVudFRva2VuLmZyb21Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gobWlkZGxlT2ZDb21tZW50VG9rZW4pO1xyXG4gIH1cclxuXHJcbiAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChoeXBlcmxpbmtJbkNvbW1lbnRUb2tlbik7XHJcblxyXG4gIGlmIChyaWdodENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCBjb250ZW50ID0gcmlnaHRDb250ZW50LCAgLy8vXHJcbiAgICAgICAgICBtaWRkbGVPZkNvbW1lbnRUb2tlbiA9IE1pZGRsZU9mQ29tbWVudFRva2VuLmZyb21Db250ZW50KGNvbnRlbnQpLFxyXG4gICAgICAgICAgdG9rZW5PckNvbnRlbnQgPSBtaWRkbGVPZkNvbW1lbnRUb2tlbjsgIC8vL1xyXG5cclxuICAgIHBvc3RQcm9jZXNzTWlkZGxlT2ZDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==