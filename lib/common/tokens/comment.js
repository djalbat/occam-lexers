'use strict';

var types = require('../types'),
    tokens = require('../tokens'),
    EndOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/endOf'),
    StartOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/startOf'),
    MiddleOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/middleOf'),
    StartOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/startOf'),
    MiddleOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/middleOf');

var multiLineType = types.multiLineType,
    singleLineType = types.singleLineType,
    multiLineCommentType = types.multiLineCommentType,
    singleLineCommentType = types.singleLineCommentType,
    processByCallback = tokens.processByCallback;


function process(tokensOrContents, commentType) {
  processByCallback(tokensOrContents, function (tokenOrContent) {
    var commentTokensOrRemainingContents = [];

    commentType = processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);

    var tokensOrRemainingContents = commentTokensOrRemainingContents; ///

    return tokensOrRemainingContents;
  });

  return commentType;
}

module.exports = {
  process: process
};

function processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType) {
  var tokenOrContentString = typeof tokenOrContent === 'string',
      tokenOrContentContent = tokenOrContentString; ///

  if (tokenOrContentContent) {
    var content = tokenOrContent,
        commentTypeSingleLineCommentType = isCommentTypeSingleLineCommentType(commentType),
        commentTypeMultiLineCommentType = isCommentTypeMultiLineCommentType(commentType);

    if (false) {} else if (commentTypeSingleLineCommentType) {
      var middleOfSingleLineCommentToken = MiddleOfSingleLineCommentToken.fromContent(content);

      commentTokensOrRemainingContents.push(middleOfSingleLineCommentToken);
    } else if (commentTypeMultiLineCommentType) {
      var endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.positionWithinContent(content);

      if (endOfMultiLineCommentTokenPosition > -1) {
        commentType = processEndOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
      } else {
        var middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(content);

        commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
      }
    } else {
      var startOfSingleLineCommentTokenPosition = StartOfSingleLineCommentToken.positionWithinContent(content),
          startOfMultiLineCommentTokenPosition = StartOfMultiLineCommentToken.positionWithinContent(content);

      if (startOfSingleLineCommentTokenPosition > -1 && startOfMultiLineCommentTokenPosition > -1) {
        if (false) {} else if (startOfSingleLineCommentTokenPosition < startOfMultiLineCommentTokenPosition) {
          commentType = processStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content);
        } else if (startOfMultiLineCommentTokenPosition < startOfSingleLineCommentTokenPosition) {
          commentType = processStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
        }
      } else if (startOfSingleLineCommentTokenPosition > -1) {
        commentType = processStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content);
      } else if (startOfMultiLineCommentTokenPosition > -1) {
        commentType = processStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
      } else {
        var remainingContent = content; ///

        commentTokensOrRemainingContents.push(remainingContent);
      }
    }
  } else {
    var token = tokenOrContent,
        ///
    tokenEndOfLineToken = token.isEndOfLineToken();

    if (tokenEndOfLineToken) {
      var _commentTypeSingleLineCommentType = isCommentTypeSingleLineCommentType(commentType);

      if (_commentTypeSingleLineCommentType) {
        commentType = null;
      }
    }

    commentTokensOrRemainingContents.push(token);
  }

  return commentType;
}

function isCommentTypeMultiLineCommentType(commentType) {
  var commentTypeMultiLineCommentType = false;

  if (commentType !== null) {
    var commentTypeIncludesMultiLineType = commentType.includes(multiLineType);

    commentTypeMultiLineCommentType = commentTypeIncludesMultiLineType;
  }

  return commentTypeMultiLineCommentType;
}

function isCommentTypeSingleLineCommentType(commentType) {
  var commentTypeSingleLineCommentType = false;

  if (commentType !== null) {
    var commentTypeIncludesSingleLineType = commentType.includes(singleLineType);

    commentTypeSingleLineCommentType = commentTypeIncludesSingleLineType;
  }

  return commentTypeSingleLineCommentType;
}

function processStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = singleLineCommentType; ///

  commentType = processStartOfCommentToken(StartOfSingleLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function processStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = multiLineCommentType; ///

  commentType = processStartOfCommentToken(StartOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function processEndOfMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = null;

  commentType = processEndOfCommentToken(EndOfMultiLineCommentToken, MiddleOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function processStartOfCommentToken(StartOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var startOfSingleLineCommentToken = StartOfCommentToken.fromWithinContent(content),
      position = StartOfCommentToken.positionWithinContent(content),
      ///
  contentLength = startOfSingleLineCommentToken.getContentLength(),
      left = position,
      ///
  right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var remainingContent = leftContent; ///

    commentTokensOrRemainingContents.push(remainingContent);
  }

  commentTokensOrRemainingContents.push(startOfSingleLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentType = processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }

  return commentType;
}

function processEndOfCommentToken(EndOfCommentToken, MiddleOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var endOfMultiLineCommentToken = EndOfCommentToken.fromWithinContent(content),
      position = EndOfCommentToken.positionWithinContent(content),
      contentLength = endOfMultiLineCommentToken.getContentLength(),
      left = position,
      right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var _content = leftContent,
        ///
    middleOfMultiLineCommentToken = MiddleOfCommentToken.fromContent(_content);

    commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
  }

  commentTokensOrRemainingContents.push(endOfMultiLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentType = processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }

  return commentType;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9jb21tb24vdG9rZW5zL2NvbW1lbnQuanMiXSwibmFtZXMiOlsidHlwZXMiLCJyZXF1aXJlIiwidG9rZW5zIiwiRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIk1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIm11bHRpTGluZVR5cGUiLCJzaW5nbGVMaW5lVHlwZSIsIm11bHRpTGluZUNvbW1lbnRUeXBlIiwic2luZ2xlTGluZUNvbW1lbnRUeXBlIiwicHJvY2Vzc0J5Q2FsbGJhY2siLCJwcm9jZXNzIiwidG9rZW5zT3JDb250ZW50cyIsImNvbW1lbnRUeXBlIiwidG9rZW5PckNvbnRlbnQiLCJjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyIsInByb2Nlc3NDb21tZW50VG9rZW5zIiwidG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyIsIm1vZHVsZSIsImV4cG9ydHMiLCJ0b2tlbk9yQ29udGVudFN0cmluZyIsInRva2VuT3JDb250ZW50Q29udGVudCIsImNvbnRlbnQiLCJjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSIsImlzQ29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUiLCJjb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlIiwiaXNDb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlIiwibWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuIiwiZnJvbUNvbnRlbnQiLCJwdXNoIiwiZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInBvc2l0aW9uV2l0aGluQ29udGVudCIsInByb2Nlc3NFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsIm1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwic3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInByb2Nlc3NTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsInByb2Nlc3NTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwicmVtYWluaW5nQ29udGVudCIsInRva2VuIiwidG9rZW5FbmRPZkxpbmVUb2tlbiIsImlzRW5kT2ZMaW5lVG9rZW4iLCJjb21tZW50VHlwZUluY2x1ZGVzTXVsdGlMaW5lVHlwZSIsImluY2x1ZGVzIiwiY29tbWVudFR5cGVJbmNsdWRlc1NpbmdsZUxpbmVUeXBlIiwicHJvY2Vzc1N0YXJ0T2ZDb21tZW50VG9rZW4iLCJwcm9jZXNzRW5kT2ZDb21tZW50VG9rZW4iLCJTdGFydE9mQ29tbWVudFRva2VuIiwic3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4iLCJmcm9tV2l0aGluQ29udGVudCIsInBvc2l0aW9uIiwiY29udGVudExlbmd0aCIsImdldENvbnRlbnRMZW5ndGgiLCJsZWZ0IiwicmlnaHQiLCJsZWZ0Q29udGVudCIsInN1YnN0cmluZyIsInJpZ2h0Q29udGVudCIsImxlZnRDb250ZW50TGVuZ3RoIiwibGVuZ3RoIiwicmlnaHRDb250ZW50TGVuZ3RoIiwiRW5kT2ZDb21tZW50VG9rZW4iLCJNaWRkbGVPZkNvbW1lbnRUb2tlbiIsImVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxRQUFRQyxRQUFRLFVBQVIsQ0FBZDtBQUFBLElBQ01DLFNBQVNELFFBQVEsV0FBUixDQURmO0FBQUEsSUFFTUUsNkJBQTZCRixRQUFRLGlEQUFSLENBRm5DO0FBQUEsSUFHTUcsK0JBQStCSCxRQUFRLG1EQUFSLENBSHJDO0FBQUEsSUFJTUksZ0NBQWdDSixRQUFRLG9EQUFSLENBSnRDO0FBQUEsSUFLTUssZ0NBQWdDTCxRQUFRLG9EQUFSLENBTHRDO0FBQUEsSUFNTU0saUNBQWlDTixRQUFRLHFEQUFSLENBTnZDOztJQVFRTyxhLEdBQStFUixLLENBQS9FUSxhO0lBQWVDLGMsR0FBZ0VULEssQ0FBaEVTLGM7SUFBZ0JDLG9CLEdBQWdEVixLLENBQWhEVSxvQjtJQUFzQkMscUIsR0FBMEJYLEssQ0FBMUJXLHFCO0lBQ3JEQyxpQixHQUFzQlYsTSxDQUF0QlUsaUI7OztBQUVSLFNBQVNDLE9BQVQsQ0FBaUJDLGdCQUFqQixFQUFtQ0MsV0FBbkMsRUFBZ0Q7QUFDOUNILG9CQUFrQkUsZ0JBQWxCLEVBQW9DLFVBQVNFLGNBQVQsRUFBeUI7QUFDM0QsUUFBTUMsbUNBQW1DLEVBQXpDOztBQUVBRixrQkFBY0cscUJBQXFCRCxnQ0FBckIsRUFBdURELGNBQXZELEVBQXVFRCxXQUF2RSxDQUFkOztBQUVBLFFBQU1JLDRCQUE0QkYsZ0NBQWxDLENBTDJELENBS1M7O0FBRXBFLFdBQU9FLHlCQUFQO0FBQ0QsR0FSRDs7QUFVQSxTQUFPSixXQUFQO0FBQ0Q7O0FBRURLLE9BQU9DLE9BQVAsR0FBaUI7QUFDZlIsV0FBU0E7QUFETSxDQUFqQjs7QUFJQSxTQUFTSyxvQkFBVCxDQUE4QkQsZ0NBQTlCLEVBQWdFRCxjQUFoRSxFQUFnRkQsV0FBaEYsRUFBNkY7QUFDM0YsTUFBTU8sdUJBQXdCLE9BQU9OLGNBQVAsS0FBMEIsUUFBeEQ7QUFBQSxNQUNNTyx3QkFBd0JELG9CQUQ5QixDQUQyRixDQUV2Qzs7QUFFcEQsTUFBSUMscUJBQUosRUFBMkI7QUFDekIsUUFBTUMsVUFBVVIsY0FBaEI7QUFBQSxRQUNNUyxtQ0FBbUNDLG1DQUFtQ1gsV0FBbkMsQ0FEekM7QUFBQSxRQUVNWSxrQ0FBa0NDLGtDQUFrQ2IsV0FBbEMsQ0FGeEM7O0FBSUEsUUFBSSxLQUFKLEVBQVcsQ0FFVixDQUZELE1BRU8sSUFBSVUsZ0NBQUosRUFBc0M7QUFDM0MsVUFBTUksaUNBQWlDdEIsK0JBQStCdUIsV0FBL0IsQ0FBMkNOLE9BQTNDLENBQXZDOztBQUVBUCx1Q0FBaUNjLElBQWpDLENBQXNDRiw4QkFBdEM7QUFDRCxLQUpNLE1BSUEsSUFBSUYsK0JBQUosRUFBcUM7QUFDMUMsVUFBTUsscUNBQXFDN0IsMkJBQTJCOEIscUJBQTNCLENBQWlEVCxPQUFqRCxDQUEzQzs7QUFFQSxVQUFJUSxxQ0FBcUMsQ0FBQyxDQUExQyxFQUE2QztBQUMzQ2pCLHNCQUFjbUIsa0NBQWtDakIsZ0NBQWxDLEVBQW9FTyxPQUFwRSxDQUFkO0FBQ0QsT0FGRCxNQUVPO0FBQ0wsWUFBTVcsZ0NBQWdDOUIsOEJBQThCeUIsV0FBOUIsQ0FBMENOLE9BQTFDLENBQXRDOztBQUVBUCx5Q0FBaUNjLElBQWpDLENBQXNDSSw2QkFBdEM7QUFDRDtBQUNGLEtBVk0sTUFVQTtBQUNMLFVBQU1DLHdDQUF3QzlCLDhCQUE4QjJCLHFCQUE5QixDQUFvRFQsT0FBcEQsQ0FBOUM7QUFBQSxVQUNNYSx1Q0FBdUNqQyw2QkFBNkI2QixxQkFBN0IsQ0FBbURULE9BQW5ELENBRDdDOztBQUdBLFVBQUtZLHdDQUF3QyxDQUFDLENBQTFDLElBQWlEQyx1Q0FBdUMsQ0FBQyxDQUE3RixFQUFpRztBQUMvRixZQUFJLEtBQUosRUFBVyxDQUVWLENBRkQsTUFFTyxJQUFJRCx3Q0FBd0NDLG9DQUE1QyxFQUFrRjtBQUN2RnRCLHdCQUFjdUIscUNBQXFDckIsZ0NBQXJDLEVBQXVFTyxPQUF2RSxDQUFkO0FBQ0QsU0FGTSxNQUVBLElBQUlhLHVDQUF1Q0QscUNBQTNDLEVBQWtGO0FBQ3ZGckIsd0JBQWN3QixvQ0FBb0N0QixnQ0FBcEMsRUFBc0VPLE9BQXRFLENBQWQ7QUFDRDtBQUNGLE9BUkQsTUFRTyxJQUFJWSx3Q0FBd0MsQ0FBQyxDQUE3QyxFQUFnRDtBQUNyRHJCLHNCQUFjdUIscUNBQXFDckIsZ0NBQXJDLEVBQXVFTyxPQUF2RSxDQUFkO0FBQ0QsT0FGTSxNQUVBLElBQUlhLHVDQUF1QyxDQUFDLENBQTVDLEVBQStDO0FBQ3BEdEIsc0JBQWN3QixvQ0FBb0N0QixnQ0FBcEMsRUFBc0VPLE9BQXRFLENBQWQ7QUFDRCxPQUZNLE1BRUE7QUFDTCxZQUFNZ0IsbUJBQW1CaEIsT0FBekIsQ0FESyxDQUM2Qjs7QUFFbENQLHlDQUFpQ2MsSUFBakMsQ0FBc0NTLGdCQUF0QztBQUNEO0FBQ0Y7QUFDRixHQTNDRCxNQTJDTztBQUNMLFFBQU1DLFFBQVF6QixjQUFkO0FBQUEsUUFBOEI7QUFDeEIwQiwwQkFBc0JELE1BQU1FLGdCQUFOLEVBRDVCOztBQUdBLFFBQUlELG1CQUFKLEVBQXlCO0FBQ3ZCLFVBQU1qQixvQ0FBbUNDLG1DQUFtQ1gsV0FBbkMsQ0FBekM7O0FBRUEsVUFBSVUsaUNBQUosRUFBc0M7QUFDcENWLHNCQUFjLElBQWQ7QUFDRDtBQUNGOztBQUVERSxxQ0FBaUNjLElBQWpDLENBQXNDVSxLQUF0QztBQUNEOztBQUVELFNBQU8xQixXQUFQO0FBQ0Q7O0FBRUQsU0FBU2EsaUNBQVQsQ0FBMkNiLFdBQTNDLEVBQXdEO0FBQ3RELE1BQUlZLGtDQUFrQyxLQUF0Qzs7QUFFQSxNQUFJWixnQkFBZ0IsSUFBcEIsRUFBMEI7QUFDeEIsUUFBTTZCLG1DQUFtQzdCLFlBQVk4QixRQUFaLENBQXFCckMsYUFBckIsQ0FBekM7O0FBRUFtQixzQ0FBa0NpQixnQ0FBbEM7QUFDRDs7QUFFRCxTQUFPakIsK0JBQVA7QUFDRDs7QUFFRCxTQUFTRCxrQ0FBVCxDQUE0Q1gsV0FBNUMsRUFBeUQ7QUFDdkQsTUFBSVUsbUNBQW1DLEtBQXZDOztBQUVBLE1BQUlWLGdCQUFnQixJQUFwQixFQUEwQjtBQUN4QixRQUFNK0Isb0NBQW9DL0IsWUFBWThCLFFBQVosQ0FBcUJwQyxjQUFyQixDQUExQzs7QUFFQWdCLHVDQUFtQ3FCLGlDQUFuQztBQUNEOztBQUVELFNBQU9yQixnQ0FBUDtBQUNEOztBQUVELFNBQVNhLG9DQUFULENBQThDckIsZ0NBQTlDLEVBQWdGTyxPQUFoRixFQUF5RjtBQUN2RixNQUFJVCxjQUFjSixxQkFBbEIsQ0FEdUYsQ0FDN0M7O0FBRTFDSSxnQkFBY2dDLDJCQUEyQnpDLDZCQUEzQixFQUEwRFcsZ0NBQTFELEVBQTRGTyxPQUE1RixFQUFxR1QsV0FBckcsQ0FBZDs7QUFFQSxTQUFPQSxXQUFQO0FBQ0Q7O0FBRUQsU0FBU3dCLG1DQUFULENBQTZDdEIsZ0NBQTdDLEVBQStFTyxPQUEvRSxFQUF3RjtBQUN0RixNQUFJVCxjQUFjTCxvQkFBbEIsQ0FEc0YsQ0FDOUM7O0FBRXhDSyxnQkFBY2dDLDJCQUEyQjNDLDRCQUEzQixFQUF5RGEsZ0NBQXpELEVBQTJGTyxPQUEzRixFQUFvR1QsV0FBcEcsQ0FBZDs7QUFFQSxTQUFPQSxXQUFQO0FBQ0Q7O0FBRUQsU0FBU21CLGlDQUFULENBQTJDakIsZ0NBQTNDLEVBQTZFTyxPQUE3RSxFQUFzRjtBQUNwRixNQUFJVCxjQUFjLElBQWxCOztBQUVBQSxnQkFBY2lDLHlCQUF5QjdDLDBCQUF6QixFQUFxREUsNkJBQXJELEVBQW9GWSxnQ0FBcEYsRUFBc0hPLE9BQXRILEVBQStIVCxXQUEvSCxDQUFkOztBQUVBLFNBQU9BLFdBQVA7QUFDRDs7QUFFRCxTQUFTZ0MsMEJBQVQsQ0FBb0NFLG1CQUFwQyxFQUF5RGhDLGdDQUF6RCxFQUEyRk8sT0FBM0YsRUFBb0dULFdBQXBHLEVBQWlIO0FBQy9HLE1BQU1tQyxnQ0FBZ0NELG9CQUFvQkUsaUJBQXBCLENBQXNDM0IsT0FBdEMsQ0FBdEM7QUFBQSxNQUNNNEIsV0FBV0gsb0JBQW9CaEIscUJBQXBCLENBQTBDVCxPQUExQyxDQURqQjtBQUFBLE1BQ3NFO0FBQ2hFNkIsa0JBQWdCSCw4QkFBOEJJLGdCQUE5QixFQUZ0QjtBQUFBLE1BR01DLE9BQU9ILFFBSGI7QUFBQSxNQUd3QjtBQUNsQkksVUFBUUosV0FBV0MsYUFKekI7QUFBQSxNQUtNSSxjQUFjakMsUUFBUWtDLFNBQVIsQ0FBa0IsQ0FBbEIsRUFBcUJILElBQXJCLENBTHBCO0FBQUEsTUFNTUksZUFBZW5DLFFBQVFrQyxTQUFSLENBQWtCRixLQUFsQixDQU5yQjtBQUFBLE1BT01JLG9CQUFvQkgsWUFBWUksTUFQdEM7QUFBQSxNQVFNQyxxQkFBcUJILGFBQWFFLE1BUnhDOztBQVVBLE1BQUlELG9CQUFvQixDQUF4QixFQUEyQjtBQUN6QixRQUFNcEIsbUJBQW1CaUIsV0FBekIsQ0FEeUIsQ0FDYTs7QUFFdEN4QyxxQ0FBaUNjLElBQWpDLENBQXNDUyxnQkFBdEM7QUFDRDs7QUFFRHZCLG1DQUFpQ2MsSUFBakMsQ0FBc0NtQiw2QkFBdEM7O0FBRUEsTUFBSVkscUJBQXFCLENBQXpCLEVBQTRCO0FBQzFCLFFBQU05QyxpQkFBaUIyQyxZQUF2QixDQUQwQixDQUNZOztBQUV0QzVDLGtCQUFjRyxxQkFBcUJELGdDQUFyQixFQUF1REQsY0FBdkQsRUFBdUVELFdBQXZFLENBQWQ7QUFDRDs7QUFFRCxTQUFPQSxXQUFQO0FBQ0Q7O0FBRUQsU0FBU2lDLHdCQUFULENBQWtDZSxpQkFBbEMsRUFBcURDLG9CQUFyRCxFQUEyRS9DLGdDQUEzRSxFQUE2R08sT0FBN0csRUFBc0hULFdBQXRILEVBQW1JO0FBQ2pJLE1BQU1rRCw2QkFBNkJGLGtCQUFrQlosaUJBQWxCLENBQW9DM0IsT0FBcEMsQ0FBbkM7QUFBQSxNQUNNNEIsV0FBV1csa0JBQWtCOUIscUJBQWxCLENBQXdDVCxPQUF4QyxDQURqQjtBQUFBLE1BRU02QixnQkFBZ0JZLDJCQUEyQlgsZ0JBQTNCLEVBRnRCO0FBQUEsTUFHTUMsT0FBT0gsUUFIYjtBQUFBLE1BSU1JLFFBQVFKLFdBQVdDLGFBSnpCO0FBQUEsTUFLTUksY0FBY2pDLFFBQVFrQyxTQUFSLENBQWtCLENBQWxCLEVBQXFCSCxJQUFyQixDQUxwQjtBQUFBLE1BTU1JLGVBQWVuQyxRQUFRa0MsU0FBUixDQUFrQkYsS0FBbEIsQ0FOckI7QUFBQSxNQU9NSSxvQkFBb0JILFlBQVlJLE1BUHRDO0FBQUEsTUFRTUMscUJBQXFCSCxhQUFhRSxNQVJ4Qzs7QUFVQSxNQUFJRCxvQkFBb0IsQ0FBeEIsRUFBMkI7QUFDekIsUUFBTXBDLFdBQVVpQyxXQUFoQjtBQUFBLFFBQThCO0FBQ3hCdEIsb0NBQWdDNkIscUJBQXFCbEMsV0FBckIsQ0FBaUNOLFFBQWpDLENBRHRDOztBQUdBUCxxQ0FBaUNjLElBQWpDLENBQXNDSSw2QkFBdEM7QUFDRDs7QUFFRGxCLG1DQUFpQ2MsSUFBakMsQ0FBc0NrQywwQkFBdEM7O0FBRUEsTUFBSUgscUJBQXFCLENBQXpCLEVBQTRCO0FBQzFCLFFBQU05QyxpQkFBaUIyQyxZQUF2QixDQUQwQixDQUNXOztBQUVyQzVDLGtCQUFjRyxxQkFBcUJELGdDQUFyQixFQUF1REQsY0FBdkQsRUFBdUVELFdBQXZFLENBQWQ7QUFDRDs7QUFFRCxTQUFPQSxXQUFQO0FBQ0QiLCJmaWxlIjoiY29tbWVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbmNvbnN0IHR5cGVzID0gcmVxdWlyZSgnLi4vdHlwZXMnKSxcclxuICAgICAgdG9rZW5zID0gcmVxdWlyZSgnLi4vdG9rZW5zJyksXHJcbiAgICAgIEVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9tdWx0aUxpbmUvZW5kT2YnKSxcclxuICAgICAgU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbXVsdGlMaW5lL3N0YXJ0T2YnKSxcclxuICAgICAgTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L211bHRpTGluZS9taWRkbGVPZicpLFxyXG4gICAgICBTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvc2luZ2xlTGluZS9zdGFydE9mJyksXHJcbiAgICAgIE1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvc2luZ2xlTGluZS9taWRkbGVPZicpO1xyXG5cclxuY29uc3QgeyBtdWx0aUxpbmVUeXBlLCBzaW5nbGVMaW5lVHlwZSwgbXVsdGlMaW5lQ29tbWVudFR5cGUsIHNpbmdsZUxpbmVDb21tZW50VHlwZSB9ID0gdHlwZXMsXHJcbiAgICAgIHsgcHJvY2Vzc0J5Q2FsbGJhY2sgfSA9IHRva2VucztcclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3ModG9rZW5zT3JDb250ZW50cywgY29tbWVudFR5cGUpIHtcclxuICBwcm9jZXNzQnlDYWxsYmFjayh0b2tlbnNPckNvbnRlbnRzLCBmdW5jdGlvbih0b2tlbk9yQ29udGVudCkge1xyXG4gICAgY29uc3QgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMgPSBbXTtcclxuXHJcbiAgICBjb21tZW50VHlwZSA9IHByb2Nlc3NDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCwgY29tbWVudFR5cGUpO1xyXG5cclxuICAgIGNvbnN0IHRva2Vuc09yUmVtYWluaW5nQ29udGVudHMgPSBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50czsgLy8vXHJcblxyXG4gICAgcmV0dXJuIHRva2Vuc09yUmVtYWluaW5nQ29udGVudHM7XHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgcHJvY2VzczogcHJvY2Vzc1xyXG59O1xyXG5cclxuZnVuY3Rpb24gcHJvY2Vzc0NvbW1lbnRUb2tlbnMoY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIHRva2VuT3JDb250ZW50LCBjb21tZW50VHlwZSkge1xyXG4gIGNvbnN0IHRva2VuT3JDb250ZW50U3RyaW5nID0gKHR5cGVvZiB0b2tlbk9yQ29udGVudCA9PT0gJ3N0cmluZycpLFxyXG4gICAgICAgIHRva2VuT3JDb250ZW50Q29udGVudCA9IHRva2VuT3JDb250ZW50U3RyaW5nOyAvLy9cclxuXHJcbiAgaWYgKHRva2VuT3JDb250ZW50Q29udGVudCkge1xyXG4gICAgY29uc3QgY29udGVudCA9IHRva2VuT3JDb250ZW50LFxyXG4gICAgICAgICAgY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUgPSBpc0NvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlKGNvbW1lbnRUeXBlKSxcclxuICAgICAgICAgIGNvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUgPSBpc0NvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUoY29tbWVudFR5cGUpO1xyXG5cclxuICAgIGlmIChmYWxzZSkge1xyXG5cclxuICAgIH0gZWxzZSBpZiAoY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUpIHtcclxuICAgICAgY29uc3QgbWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLmZyb21Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgfSBlbHNlIGlmIChjb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlKSB7XHJcbiAgICAgIGNvbnN0IGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICBpZiAoZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSB7XHJcbiAgICAgICAgY29tbWVudFR5cGUgPSBwcm9jZXNzRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gobWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gU3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpLFxyXG4gICAgICAgICAgICBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgIGlmICgoc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSAmJiAoc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpKSB7XHJcbiAgICAgICAgaWYgKGZhbHNlKSB7XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAoc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA8IHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbikge1xyXG4gICAgICAgICAgY29tbWVudFR5cGUgPSBwcm9jZXNzU3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uIDwgc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbikge1xyXG4gICAgICAgICAgY29tbWVudFR5cGUgPSBwcm9jZXNzU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICAgIGNvbW1lbnRUeXBlID0gcHJvY2Vzc1N0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KTtcclxuICAgICAgfSBlbHNlIGlmIChzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICAgIGNvbW1lbnRUeXBlID0gcHJvY2Vzc1N0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHJlbWFpbmluZ0NvbnRlbnQgPSBjb250ZW50OyAvLy9cclxuXHJcbiAgICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChyZW1haW5pbmdDb250ZW50KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zdCB0b2tlbiA9IHRva2VuT3JDb250ZW50LCAvLy9cclxuICAgICAgICAgIHRva2VuRW5kT2ZMaW5lVG9rZW4gPSB0b2tlbi5pc0VuZE9mTGluZVRva2VuKCk7XHJcblxyXG4gICAgaWYgKHRva2VuRW5kT2ZMaW5lVG9rZW4pIHtcclxuICAgICAgY29uc3QgY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUgPSBpc0NvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlKGNvbW1lbnRUeXBlKTtcclxuXHJcbiAgICAgIGlmIChjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSkge1xyXG4gICAgICAgIGNvbW1lbnRUeXBlID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2godG9rZW4pO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc0NvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUoY29tbWVudFR5cGUpIHtcclxuICBsZXQgY29tbWVudFR5cGVNdWx0aUxpbmVDb21tZW50VHlwZSA9IGZhbHNlO1xyXG5cclxuICBpZiAoY29tbWVudFR5cGUgIT09IG51bGwpIHtcclxuICAgIGNvbnN0IGNvbW1lbnRUeXBlSW5jbHVkZXNNdWx0aUxpbmVUeXBlID0gY29tbWVudFR5cGUuaW5jbHVkZXMobXVsdGlMaW5lVHlwZSk7XHJcblxyXG4gICAgY29tbWVudFR5cGVNdWx0aUxpbmVDb21tZW50VHlwZSA9IGNvbW1lbnRUeXBlSW5jbHVkZXNNdWx0aUxpbmVUeXBlO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzQ29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUoY29tbWVudFR5cGUpIHtcclxuICBsZXQgY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUgPSBmYWxzZTtcclxuXHJcbiAgaWYgKGNvbW1lbnRUeXBlICE9PSBudWxsKSB7XHJcbiAgICBjb25zdCBjb21tZW50VHlwZUluY2x1ZGVzU2luZ2xlTGluZVR5cGUgPSBjb21tZW50VHlwZS5pbmNsdWRlcyhzaW5nbGVMaW5lVHlwZSk7XHJcblxyXG4gICAgY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUgPSBjb21tZW50VHlwZUluY2x1ZGVzU2luZ2xlTGluZVR5cGU7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3NTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCkge1xyXG4gIGxldCBjb21tZW50VHlwZSA9IHNpbmdsZUxpbmVDb21tZW50VHlwZTsgIC8vL1xyXG5cclxuICBjb21tZW50VHlwZSA9IHByb2Nlc3NTdGFydE9mQ29tbWVudFRva2VuKFN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCwgY29tbWVudFR5cGUpO1xyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3NTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KSB7XHJcbiAgbGV0IGNvbW1lbnRUeXBlID0gbXVsdGlMaW5lQ29tbWVudFR5cGU7IC8vL1xyXG5cclxuICBjb21tZW50VHlwZSA9IHByb2Nlc3NTdGFydE9mQ29tbWVudFRva2VuKFN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSk7XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gcHJvY2Vzc0VuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KSB7XHJcbiAgbGV0IGNvbW1lbnRUeXBlID0gbnVsbDtcclxuXHJcbiAgY29tbWVudFR5cGUgPSBwcm9jZXNzRW5kT2ZDb21tZW50VG9rZW4oRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4sIE1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCwgY29tbWVudFR5cGUpO1xyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3NTdGFydE9mQ29tbWVudFRva2VuKFN0YXJ0T2ZDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSkge1xyXG4gIGNvbnN0IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gU3RhcnRPZkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IFN0YXJ0T2ZDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpLCAgLy8vXHJcbiAgICAgICAgY29udGVudExlbmd0aCA9IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLmdldENvbnRlbnRMZW5ndGgoKSxcclxuICAgICAgICBsZWZ0ID0gcG9zaXRpb24sICAvLy9cclxuICAgICAgICByaWdodCA9IHBvc2l0aW9uICsgY29udGVudExlbmd0aCxcclxuICAgICAgICBsZWZ0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIGxlZnQpLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKHJpZ2h0KSxcclxuICAgICAgICBsZWZ0Q29udGVudExlbmd0aCA9IGxlZnRDb250ZW50Lmxlbmd0aCxcclxuICAgICAgICByaWdodENvbnRlbnRMZW5ndGggPSByaWdodENvbnRlbnQubGVuZ3RoO1xyXG5cclxuICBpZiAobGVmdENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCByZW1haW5pbmdDb250ZW50ID0gbGVmdENvbnRlbnQ7IC8vL1xyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gocmVtYWluaW5nQ29udGVudCk7XHJcbiAgfVxyXG5cclxuICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuKTtcclxuXHJcbiAgaWYgKHJpZ2h0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHRva2VuT3JDb250ZW50ID0gcmlnaHRDb250ZW50OyAgLy8vXHJcblxyXG4gICAgY29tbWVudFR5cGUgPSBwcm9jZXNzQ29tbWVudFRva2Vucyhjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgdG9rZW5PckNvbnRlbnQsIGNvbW1lbnRUeXBlKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gcHJvY2Vzc0VuZE9mQ29tbWVudFRva2VuKEVuZE9mQ29tbWVudFRva2VuLCBNaWRkbGVPZkNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQsIGNvbW1lbnRUeXBlKSB7XHJcbiAgY29uc3QgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBFbmRPZkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IEVuZE9mQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBjb250ZW50TGVuZ3RoID0gZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZ2V0Q29udGVudExlbmd0aCgpLFxyXG4gICAgICAgIGxlZnQgPSBwb3NpdGlvbixcclxuICAgICAgICByaWdodCA9IHBvc2l0aW9uICsgY29udGVudExlbmd0aCxcclxuICAgICAgICBsZWZ0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIGxlZnQpLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKHJpZ2h0KSxcclxuICAgICAgICBsZWZ0Q29udGVudExlbmd0aCA9IGxlZnRDb250ZW50Lmxlbmd0aCxcclxuICAgICAgICByaWdodENvbnRlbnRMZW5ndGggPSByaWdodENvbnRlbnQubGVuZ3RoO1xyXG5cclxuICBpZiAobGVmdENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCBjb250ZW50ID0gbGVmdENvbnRlbnQsICAvLy9cclxuICAgICAgICAgIG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbik7XHJcbiAgfVxyXG5cclxuICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKTtcclxuXHJcbiAgaWYgKHJpZ2h0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHRva2VuT3JDb250ZW50ID0gcmlnaHRDb250ZW50OyAvLy9cclxuXHJcbiAgICBjb21tZW50VHlwZSA9IHByb2Nlc3NDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCwgY29tbWVudFR5cGUpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcbiJdfQ==