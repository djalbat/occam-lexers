'use strict';

var types = require('../types'),
    tokens = require('../tokens'),
    StringLiteralToken = require('../token/significant/stringLiteral'),
    EndOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/endOf'),
    StartOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/startOf'),
    MiddleOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/middleOf'),
    StartOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/startOf'),
    MiddleOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/middleOf');

var multiLineType = types.multiLineType,
    singleLineType = types.singleLineType,
    multiLineCommentType = types.multiLineCommentType,
    singleLineCommentType = types.singleLineCommentType,
    processByCallback = tokens.processByCallback;


function process(tokensOrContents, commentType) {
  processByCallback(tokensOrContents, function (tokenOrContent) {
    var commentTokensOrRemainingContents = [];

    commentType = processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);

    var tokensOrRemainingContents = commentTokensOrRemainingContents; ///

    return tokensOrRemainingContents;
  });

  return commentType;
}

module.exports = {
  process: process
};

function processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType) {
  var tokenOrContentContent = isTokenOrContentContent(tokenOrContent),
      tokenOrContentStringLiteralToken = isTokenOrContentStringLiteralToken(tokenOrContent),
      commentTypeSingleLineCommentType = isCommentTypeSingleLineCommentType(commentType),
      commentTypeMultiLineCommentType = isCommentTypeMultiLineCommentType(commentType);

  if (false) {} else if (tokenOrContentContent) {
    var content = tokenOrContent; ///

    if (false) {} else if (commentTypeSingleLineCommentType) {
      var middleOfSingleLineCommentToken = MiddleOfSingleLineCommentToken.fromContent(content);

      commentTokensOrRemainingContents.push(middleOfSingleLineCommentToken);
    } else if (commentTypeMultiLineCommentType) {
      var endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.positionWithinContent(content);

      if (endOfMultiLineCommentTokenPosition > -1) {
        commentType = processEndOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
      } else {
        var middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(content);

        commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
      }
    } else {
      var startOfSingleLineCommentTokenPosition = StartOfSingleLineCommentToken.positionWithinContent(content),
          startOfMultiLineCommentTokenPosition = StartOfMultiLineCommentToken.positionWithinContent(content);

      if (startOfSingleLineCommentTokenPosition > -1 && startOfMultiLineCommentTokenPosition > -1) {
        if (false) {} else if (startOfSingleLineCommentTokenPosition < startOfMultiLineCommentTokenPosition) {
          commentType = processStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content);
        } else if (startOfMultiLineCommentTokenPosition < startOfSingleLineCommentTokenPosition) {
          commentType = processStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
        }
      } else if (startOfSingleLineCommentTokenPosition > -1) {
        commentType = processStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content);
      } else if (startOfMultiLineCommentTokenPosition > -1) {
        commentType = processStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
      } else {
        var remainingContent = content; ///

        commentTokensOrRemainingContents.push(remainingContent);
      }
    }
  } else if (tokenOrContentStringLiteralToken) {
    var stringLiteralToken = tokenOrContent; ///

    if (false) {} else if (commentTypeSingleLineCommentType) {
      var _middleOfSingleLineCommentToken = MiddleOfSingleLineCommentToken.fromStringLiteralToken(stringLiteralToken);

      commentTokensOrRemainingContents.push(_middleOfSingleLineCommentToken);
    } else if (commentTypeMultiLineCommentType) {
      var _content = stringLiteralToken.getContent(),
          _endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.positionWithinContent(_content);

      if (_endOfMultiLineCommentTokenPosition > -1) {
        commentType = processEndOfMultiLineCommentToken(commentTokensOrRemainingContents, _content);
      } else {
        var _middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(_content);

        commentTokensOrRemainingContents.push(_middleOfMultiLineCommentToken);
      }
    } else {
      commentTokensOrRemainingContents.push(stringLiteralToken);
    }
  } else {
    var token = tokenOrContent,
        ///
    tokenEndOfLineToken = token.isEndOfLineToken();

    if (tokenEndOfLineToken) {
      var _commentTypeSingleLineCommentType = isCommentTypeSingleLineCommentType(commentType);

      if (_commentTypeSingleLineCommentType) {
        commentType = null;
      }
    }

    commentTokensOrRemainingContents.push(token);
  }

  return commentType;
}

function isTokenOrContentContent(tokenOrContent) {
  var tokenOrContentString = typeof tokenOrContent === 'string',
      tokenOrContentContent = tokenOrContentString; ///

  return tokenOrContentContent;
}

function isTokenOrContentStringLiteralToken(tokenOrContent) {
  var tokenOrContentStringLiteralToken = false;

  var tokenOrContentString = typeof tokenOrContent === 'string',
      tokenOrContentContent = tokenOrContentString,
      ///
  tokenOrContentToken = !tokenOrContentContent;

  if (tokenOrContentToken) {
    var token = tokenOrContent,
        tokenStringLiteralToken = token instanceof StringLiteralToken;

    tokenOrContentStringLiteralToken = tokenStringLiteralToken; ///
  }

  return tokenOrContentStringLiteralToken;
}

function isCommentTypeSingleLineCommentType(commentType) {
  var commentTypeSingleLineCommentType = false;

  if (commentType !== null) {
    var commentTypeIncludesSingleLineType = commentType.includes(singleLineType);

    commentTypeSingleLineCommentType = commentTypeIncludesSingleLineType;
  }

  return commentTypeSingleLineCommentType;
}

function isCommentTypeMultiLineCommentType(commentType) {
  var commentTypeMultiLineCommentType = false;

  if (commentType !== null) {
    var commentTypeIncludesMultiLineType = commentType.includes(multiLineType);

    commentTypeMultiLineCommentType = commentTypeIncludesMultiLineType;
  }

  return commentTypeMultiLineCommentType;
}

function processStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = singleLineCommentType; ///

  commentType = processStartOfCommentToken(StartOfSingleLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function processStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = multiLineCommentType; ///

  commentType = processStartOfCommentToken(StartOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function processEndOfMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = null;

  commentType = processEndOfCommentToken(EndOfMultiLineCommentToken, MiddleOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function processStartOfCommentToken(StartOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var startOfSingleLineCommentToken = StartOfCommentToken.fromWithinContent(content),
      position = StartOfCommentToken.positionWithinContent(content),
      ///
  contentLength = startOfSingleLineCommentToken.getContentLength(),
      left = position,
      ///
  right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var remainingContent = leftContent; ///

    commentTokensOrRemainingContents.push(remainingContent);
  }

  commentTokensOrRemainingContents.push(startOfSingleLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentType = processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }

  return commentType;
}

function processEndOfCommentToken(EndOfCommentToken, MiddleOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var endOfMultiLineCommentToken = EndOfCommentToken.fromWithinContent(content),
      position = EndOfCommentToken.positionWithinContent(content),
      contentLength = endOfMultiLineCommentToken.getContentLength(),
      left = position,
      right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var _content2 = leftContent,
        ///
    middleOfMultiLineCommentToken = MiddleOfCommentToken.fromContent(_content2);

    commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
  }

  commentTokensOrRemainingContents.push(endOfMultiLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentType = processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }

  return commentType;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9jb21tb24vdG9rZW5zL2NvbW1lbnQuanMiXSwibmFtZXMiOlsidHlwZXMiLCJyZXF1aXJlIiwidG9rZW5zIiwiU3RyaW5nTGl0ZXJhbFRva2VuIiwiRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIk1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIm11bHRpTGluZVR5cGUiLCJzaW5nbGVMaW5lVHlwZSIsIm11bHRpTGluZUNvbW1lbnRUeXBlIiwic2luZ2xlTGluZUNvbW1lbnRUeXBlIiwicHJvY2Vzc0J5Q2FsbGJhY2siLCJwcm9jZXNzIiwidG9rZW5zT3JDb250ZW50cyIsImNvbW1lbnRUeXBlIiwidG9rZW5PckNvbnRlbnQiLCJjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyIsInByb2Nlc3NDb21tZW50VG9rZW5zIiwidG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyIsIm1vZHVsZSIsImV4cG9ydHMiLCJ0b2tlbk9yQ29udGVudENvbnRlbnQiLCJpc1Rva2VuT3JDb250ZW50Q29udGVudCIsInRva2VuT3JDb250ZW50U3RyaW5nTGl0ZXJhbFRva2VuIiwiaXNUb2tlbk9yQ29udGVudFN0cmluZ0xpdGVyYWxUb2tlbiIsImNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlIiwiaXNDb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSIsImNvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUiLCJpc0NvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUiLCJjb250ZW50IiwibWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuIiwiZnJvbUNvbnRlbnQiLCJwdXNoIiwiZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInBvc2l0aW9uV2l0aGluQ29udGVudCIsInByb2Nlc3NFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsIm1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwic3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInByb2Nlc3NTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsInByb2Nlc3NTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwicmVtYWluaW5nQ29udGVudCIsInN0cmluZ0xpdGVyYWxUb2tlbiIsImZyb21TdHJpbmdMaXRlcmFsVG9rZW4iLCJnZXRDb250ZW50IiwidG9rZW4iLCJ0b2tlbkVuZE9mTGluZVRva2VuIiwiaXNFbmRPZkxpbmVUb2tlbiIsInRva2VuT3JDb250ZW50U3RyaW5nIiwidG9rZW5PckNvbnRlbnRUb2tlbiIsInRva2VuU3RyaW5nTGl0ZXJhbFRva2VuIiwiY29tbWVudFR5cGVJbmNsdWRlc1NpbmdsZUxpbmVUeXBlIiwiaW5jbHVkZXMiLCJjb21tZW50VHlwZUluY2x1ZGVzTXVsdGlMaW5lVHlwZSIsInByb2Nlc3NTdGFydE9mQ29tbWVudFRva2VuIiwicHJvY2Vzc0VuZE9mQ29tbWVudFRva2VuIiwiU3RhcnRPZkNvbW1lbnRUb2tlbiIsInN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuIiwiZnJvbVdpdGhpbkNvbnRlbnQiLCJwb3NpdGlvbiIsImNvbnRlbnRMZW5ndGgiLCJnZXRDb250ZW50TGVuZ3RoIiwibGVmdCIsInJpZ2h0IiwibGVmdENvbnRlbnQiLCJzdWJzdHJpbmciLCJyaWdodENvbnRlbnQiLCJsZWZ0Q29udGVudExlbmd0aCIsImxlbmd0aCIsInJpZ2h0Q29udGVudExlbmd0aCIsIkVuZE9mQ29tbWVudFRva2VuIiwiTWlkZGxlT2ZDb21tZW50VG9rZW4iLCJlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiJdLCJtYXBwaW5n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QUEsTUFDTThCLFdBQVdXLGtCQUFrQnBDLHFCQUFsQixDQUF3Q0wsT0FBeEMsQ0FEakI7QUFBQSxNQUVNK0IsZ0JBQWdCWSwyQkFBMkJYLGdCQUEzQixFQUZ0QjtBQUFBLE1BR01DLE9BQU9ILFFBSGI7QUFBQSxNQUlNSSxRQUFRSixXQUFXQyxhQUp6QjtBQUFBLE1BS01JLGNBQWNuQyxRQUFRb0MsU0FBUixDQUFrQixDQUFsQixFQUFxQkgsSUFBckIsQ0FMcEI7QUFBQSxNQU1NSSxlQUFlckMsUUFBUW9DLFNBQVIsQ0FBa0JGLEtBQWxCLENBTnJCO0FBQUEsTUFPTUksb0JBQW9CSCxZQUFZSSxNQVB0QztBQUFBLE1BUU1DLHFCQUFxQkgsYUFBYUUsTUFSeEM7O0FBVUEsTUFBSUQsb0JBQW9CLENBQXhCLEVBQTJCO0FBQ3pCLFFBQU10QyxZQUFVbUMsV0FBaEI7QUFBQSxRQUE4QjtBQUN4QjVCLG9DQUFnQ21DLHFCQUFxQnhDLFdBQXJCLENBQWlDRixTQUFqQyxDQUR0Qzs7QUFHQWIscUNBQWlDZ0IsSUFBakMsQ0FBc0NJLDZCQUF0QztBQUNEOztBQUVEcEIsbUNBQWlDZ0IsSUFBakMsQ0FBc0N3QywwQkFBdEM7O0FBRUEsTUFBSUgscUJBQXFCLENBQXpCLEVBQTRCO0FBQzFCLFFBQU10RCxpQkFBaUJtRCxZQUF2QixDQUQwQixDQUNXOztBQUVyQ3BELGtCQUFjRyxxQkFBcUJELGdDQUFyQixFQUF1REQsY0FBdkQsRUFBdUVELFdBQXZFLENBQWQ7QUFDRDs7QUFFRCxTQUFPQSxXQUFQO0FBQ0QiLCJmaWxlIjoiY29tbWVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbmNvbnN0IHR5cGVzID0gcmVxdWlyZSgnLi4vdHlwZXMnKSxcclxuICAgICAgdG9rZW5zID0gcmVxdWlyZSgnLi4vdG9rZW5zJyksXHJcbiAgICAgIFN0cmluZ0xpdGVyYWxUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL3NpZ25pZmljYW50L3N0cmluZ0xpdGVyYWwnKSxcclxuICAgICAgRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L211bHRpTGluZS9lbmRPZicpLFxyXG4gICAgICBTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9tdWx0aUxpbmUvc3RhcnRPZicpLFxyXG4gICAgICBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbXVsdGlMaW5lL21pZGRsZU9mJyksXHJcbiAgICAgIFN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9zaW5nbGVMaW5lL3N0YXJ0T2YnKSxcclxuICAgICAgTWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9zaW5nbGVMaW5lL21pZGRsZU9mJyk7XHJcblxyXG5jb25zdCB7IG11bHRpTGluZVR5cGUsIHNpbmdsZUxpbmVUeXBlLCBtdWx0aUxpbmVDb21tZW50VHlwZSwgc2luZ2xlTGluZUNvbW1lbnRUeXBlIH0gPSB0eXBlcyxcclxuICAgICAgeyBwcm9jZXNzQnlDYWxsYmFjayB9ID0gdG9rZW5zO1xyXG5cclxuZnVuY3Rpb24gcHJvY2Vzcyh0b2tlbnNPckNvbnRlbnRzLCBjb21tZW50VHlwZSkge1xyXG4gIHByb2Nlc3NCeUNhbGxiYWNrKHRva2Vuc09yQ29udGVudHMsIGZ1bmN0aW9uKHRva2VuT3JDb250ZW50KSB7XHJcbiAgICBjb25zdCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyA9IFtdO1xyXG5cclxuICAgIGNvbW1lbnRUeXBlID0gcHJvY2Vzc0NvbW1lbnRUb2tlbnMoY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIHRva2VuT3JDb250ZW50LCBjb21tZW50VHlwZSk7XHJcblxyXG4gICAgY29uc3QgdG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyA9IGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzOyAvLy9cclxuXHJcbiAgICByZXR1cm4gdG9rZW5zT3JSZW1haW5pbmdDb250ZW50cztcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICBwcm9jZXNzOiBwcm9jZXNzXHJcbn07XHJcblxyXG5mdW5jdGlvbiBwcm9jZXNzQ29tbWVudFRva2Vucyhjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgdG9rZW5PckNvbnRlbnQsIGNvbW1lbnRUeXBlKSB7XHJcbiAgY29uc3QgdG9rZW5PckNvbnRlbnRDb250ZW50ID0gaXNUb2tlbk9yQ29udGVudENvbnRlbnQodG9rZW5PckNvbnRlbnQpLFxyXG4gICAgICAgIHRva2VuT3JDb250ZW50U3RyaW5nTGl0ZXJhbFRva2VuID0gaXNUb2tlbk9yQ29udGVudFN0cmluZ0xpdGVyYWxUb2tlbih0b2tlbk9yQ29udGVudCksXHJcbiAgICAgICAgY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUgPSBpc0NvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlKGNvbW1lbnRUeXBlKSxcclxuICAgICAgICBjb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlID0gaXNDb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlKGNvbW1lbnRUeXBlKTtcclxuXHJcbiAgaWYgKGZhbHNlKSB7XHJcblxyXG4gIH0gZWxzZSBpZiAodG9rZW5PckNvbnRlbnRDb250ZW50KSB7XHJcbiAgICBjb25zdCBjb250ZW50ID0gdG9rZW5PckNvbnRlbnQ7IC8vL1xyXG5cclxuICAgIGlmIChmYWxzZSkge1xyXG5cclxuICAgIH0gZWxzZSBpZiAoY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUpIHtcclxuICAgICAgY29uc3QgbWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLmZyb21Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgfSBlbHNlIGlmIChjb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlKSB7XHJcbiAgICAgIGNvbnN0IGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICBpZiAoZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSB7XHJcbiAgICAgICAgY29tbWVudFR5cGUgPSBwcm9jZXNzRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gobWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gU3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpLFxyXG4gICAgICAgICAgICBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgIGlmICgoc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSAmJiAoc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpKSB7XHJcbiAgICAgICAgaWYgKGZhbHNlKSB7XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAoc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA8IHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbikge1xyXG4gICAgICAgICAgY29tbWVudFR5cGUgPSBwcm9jZXNzU3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uIDwgc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbikge1xyXG4gICAgICAgICAgY29tbWVudFR5cGUgPSBwcm9jZXNzU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICAgIGNvbW1lbnRUeXBlID0gcHJvY2Vzc1N0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KTtcclxuICAgICAgfSBlbHNlIGlmIChzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICAgIGNvbW1lbnRUeXBlID0gcHJvY2Vzc1N0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHJlbWFpbmluZ0NvbnRlbnQgPSBjb250ZW50OyAvLy9cclxuXHJcbiAgICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChyZW1haW5pbmdDb250ZW50KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0gZWxzZSBpZiAodG9rZW5PckNvbnRlbnRTdHJpbmdMaXRlcmFsVG9rZW4pIHtcclxuICAgIGNvbnN0IHN0cmluZ0xpdGVyYWxUb2tlbiA9IHRva2VuT3JDb250ZW50OyAgLy8vXHJcblxyXG4gICAgaWYgKGZhbHNlKSB7XHJcblxyXG4gICAgfSBlbHNlIGlmIChjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSkge1xyXG4gICAgICBjb25zdCBtaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4gPSBNaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4uZnJvbVN0cmluZ0xpdGVyYWxUb2tlbihzdHJpbmdMaXRlcmFsVG9rZW4pO1xyXG5cclxuICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgfSBlbHNlIGlmIChjb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlKSB7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBzdHJpbmdMaXRlcmFsVG9rZW4uZ2V0Q29udGVudCgpLFxyXG4gICAgICAgICAgICBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgICAgaWYgKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICAgIGNvbW1lbnRUeXBlID0gcHJvY2Vzc0VuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IE1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuLmZyb21Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgICAgICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChzdHJpbmdMaXRlcmFsVG9rZW4pO1xyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zdCB0b2tlbiA9IHRva2VuT3JDb250ZW50LCAvLy9cclxuICAgICAgICAgIHRva2VuRW5kT2ZMaW5lVG9rZW4gPSB0b2tlbi5pc0VuZE9mTGluZVRva2VuKCk7XHJcblxyXG4gICAgaWYgKHRva2VuRW5kT2ZMaW5lVG9rZW4pIHtcclxuICAgICAgY29uc3QgY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUgPSBpc0NvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlKGNvbW1lbnRUeXBlKTtcclxuXHJcbiAgICAgIGlmIChjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSkge1xyXG4gICAgICAgIGNvbW1lbnRUeXBlID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2godG9rZW4pO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc1Rva2VuT3JDb250ZW50Q29udGVudCh0b2tlbk9yQ29udGVudCkge1xyXG4gIGNvbnN0IHRva2VuT3JDb250ZW50U3RyaW5nID0gKHR5cGVvZiB0b2tlbk9yQ29udGVudCA9PT0gJ3N0cmluZycpLFxyXG4gICAgICAgIHRva2VuT3JDb250ZW50Q29udGVudCA9IHRva2VuT3JDb250ZW50U3RyaW5nOyAvLy9cclxuXHJcbiAgcmV0dXJuIHRva2VuT3JDb250ZW50Q29udGVudDtcclxufVxyXG5cclxuZnVuY3Rpb24gaXNUb2tlbk9yQ29udGVudFN0cmluZ0xpdGVyYWxUb2tlbih0b2tlbk9yQ29udGVudCkge1xyXG4gIGxldCB0b2tlbk9yQ29udGVudFN0cmluZ0xpdGVyYWxUb2tlbiA9IGZhbHNlO1xyXG5cclxuICBjb25zdCB0b2tlbk9yQ29udGVudFN0cmluZyA9ICh0eXBlb2YgdG9rZW5PckNvbnRlbnQgPT09ICdzdHJpbmcnKSxcclxuICAgICAgICB0b2tlbk9yQ29udGVudENvbnRlbnQgPSB0b2tlbk9yQ29udGVudFN0cmluZywgLy8vXHJcbiAgICAgICAgdG9rZW5PckNvbnRlbnRUb2tlbiA9ICF0b2tlbk9yQ29udGVudENvbnRlbnQ7XHJcblxyXG4gIGlmICh0b2tlbk9yQ29udGVudFRva2VuKSB7XHJcbiAgICBjb25zdCB0b2tlbiA9IHRva2VuT3JDb250ZW50LFxyXG4gICAgICAgICAgdG9rZW5TdHJpbmdMaXRlcmFsVG9rZW4gPSAodG9rZW4gaW5zdGFuY2VvZiBTdHJpbmdMaXRlcmFsVG9rZW4pO1xyXG5cclxuICAgIHRva2VuT3JDb250ZW50U3RyaW5nTGl0ZXJhbFRva2VuID0gdG9rZW5TdHJpbmdMaXRlcmFsVG9rZW47IC8vL1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHRva2VuT3JDb250ZW50U3RyaW5nTGl0ZXJhbFRva2VuO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc0NvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlKGNvbW1lbnRUeXBlKSB7XHJcbiAgbGV0IGNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlID0gZmFsc2U7XHJcblxyXG4gIGlmIChjb21tZW50VHlwZSAhPT0gbnVsbCkge1xyXG4gICAgY29uc3QgY29tbWVudFR5cGVJbmNsdWRlc1NpbmdsZUxpbmVUeXBlID0gY29tbWVudFR5cGUuaW5jbHVkZXMoc2luZ2xlTGluZVR5cGUpO1xyXG5cclxuICAgIGNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlID0gY29tbWVudFR5cGVJbmNsdWRlc1NpbmdsZUxpbmVUeXBlO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc0NvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUoY29tbWVudFR5cGUpIHtcclxuICBsZXQgY29tbWVudFR5cGVNdWx0aUxpbmVDb21tZW50VHlwZSA9IGZhbHNlO1xyXG5cclxuICBpZiAoY29tbWVudFR5cGUgIT09IG51bGwpIHtcclxuICAgIGNvbnN0IGNvbW1lbnRUeXBlSW5jbHVkZXNNdWx0aUxpbmVUeXBlID0gY29tbWVudFR5cGUuaW5jbHVkZXMobXVsdGlMaW5lVHlwZSk7XHJcblxyXG4gICAgY29tbWVudFR5cGVNdWx0aUxpbmVDb21tZW50VHlwZSA9IGNvbW1lbnRUeXBlSW5jbHVkZXNNdWx0aUxpbmVUeXBlO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3NTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCkge1xyXG4gIGxldCBjb21tZW50VHlwZSA9IHNpbmdsZUxpbmVDb21tZW50VHlwZTsgIC8vL1xyXG5cclxuICBjb21tZW50VHlwZSA9IHByb2Nlc3NTdGFydE9mQ29tbWVudFRva2VuKFN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCwgY29tbWVudFR5cGUpO1xyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3NTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KSB7XHJcbiAgbGV0IGNvbW1lbnRUeXBlID0gbXVsdGlMaW5lQ29tbWVudFR5cGU7IC8vL1xyXG5cclxuICBjb21tZW50VHlwZSA9IHByb2Nlc3NTdGFydE9mQ29tbWVudFRva2VuKFN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSk7XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gcHJvY2Vzc0VuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KSB7XHJcbiAgbGV0IGNvbW1lbnRUeXBlID0gbnVsbDtcclxuXHJcbiAgY29tbWVudFR5cGUgPSBwcm9jZXNzRW5kT2ZDb21tZW50VG9rZW4oRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4sIE1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCwgY29tbWVudFR5cGUpO1xyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3NTdGFydE9mQ29tbWVudFRva2VuKFN0YXJ0T2ZDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSkge1xyXG4gIGNvbnN0IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gU3RhcnRPZkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IFN0YXJ0T2ZDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpLCAgLy8vXHJcbiAgICAgICAgY29udGVudExlbmd0aCA9IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLmdldENvbnRlbnRMZW5ndGgoKSxcclxuICAgICAgICBsZWZ0ID0gcG9zaXRpb24sICAvLy9cclxuICAgICAgICByaWdodCA9IHBvc2l0aW9uICsgY29udGVudExlbmd0aCxcclxuICAgICAgICBsZWZ0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIGxlZnQpLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKHJpZ2h0KSxcclxuICAgICAgICBsZWZ0Q29udGVudExlbmd0aCA9IGxlZnRDb250ZW50Lmxlbmd0aCxcclxuICAgICAgICByaWdodENvbnRlbnRMZW5ndGggPSByaWdodENvbnRlbnQubGVuZ3RoO1xyXG5cclxuICBpZiAobGVmdENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCByZW1haW5pbmdDb250ZW50ID0gbGVmdENvbnRlbnQ7IC8vL1xyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gocmVtYWluaW5nQ29udGVudCk7XHJcbiAgfVxyXG5cclxuICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuKTtcclxuXHJcbiAgaWYgKHJpZ2h0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHRva2VuT3JDb250ZW50ID0gcmlnaHRDb250ZW50OyAgLy8vXHJcblxyXG4gICAgY29tbWVudFR5cGUgPSBwcm9jZXNzQ29tbWVudFRva2Vucyhjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgdG9rZW5PckNvbnRlbnQsIGNvbW1lbnRUeXBlKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gcHJvY2Vzc0VuZE9mQ29tbWVudFRva2VuKEVuZE9mQ29tbWVudFRva2VuLCBNaWRkbGVPZkNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQsIGNvbW1lbnRUeXBlKSB7XHJcbiAgY29uc3QgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBFbmRPZkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IEVuZE9mQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBjb250ZW50TGVuZ3RoID0gZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZ2V0Q29udGVudExlbmd0aCgpLFxyXG4gICAgICAgIGxlZnQgPSBwb3NpdGlvbixcclxuICAgICAgICByaWdodCA9IHBvc2l0aW9uICsgY29udGVudExlbmd0aCxcclxuICAgICAgICBsZWZ0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIGxlZnQpLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKHJpZ2h0KSxcclxuICAgICAgICBsZWZ0Q29udGVudExlbmd0aCA9IGxlZnRDb250ZW50Lmxlbmd0aCxcclxuICAgICAgICByaWdodENvbnRlbnRMZW5ndGggPSByaWdodENvbnRlbnQubGVuZ3RoO1xyXG5cclxuICBpZiAobGVmdENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCBjb250ZW50ID0gbGVmdENvbnRlbnQsICAvLy9cclxuICAgICAgICAgIG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbik7XHJcbiAgfVxyXG5cclxuICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKTtcclxuXHJcbiAgaWYgKHJpZ2h0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHRva2VuT3JDb250ZW50ID0gcmlnaHRDb250ZW50OyAvLy9cclxuXHJcbiAgICBjb21tZW50VHlwZSA9IHByb2Nlc3NDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCwgY29tbWVudFR5cGUpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcbiJdfQ==