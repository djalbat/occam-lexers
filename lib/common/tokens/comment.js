'use strict';

var types = require('../types'),
    tokens = require('../tokens'),
    EndOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/endOf'),
    StartOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/startOf'),
    MiddleOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/middleOf'),
    HyperlinkMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/hyperlink'),
    StartOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/startOf'),
    MiddleOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/middleOf'),
    HyperlinkSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/hyperlink');

var multiLineCommentType = types.multiLineCommentType,
    singleLineCommentType = types.singleLineCommentType,
    processByCallback = tokens.processByCallback;


function process(tokensOrContents, commentType) {
  processByCallback(tokensOrContents, function (tokenOrContent) {
    var commentTokensOrRemainingContents = [];

    commentType = commentTokensOrRemainingContentsFromTokenOrContent(commentTokensOrRemainingContents, tokenOrContent, commentType);

    var tokensOrRemainingContents = commentTokensOrRemainingContents; ///

    return tokensOrRemainingContents;
  });

  return commentType;
}

module.exports = {
  process: process
};

function commentTokensOrRemainingContentsFromTokenOrContent(commentTokensOrRemainingContents, tokenOrContent, commentType) {
  var tokenOrContentContent = typeof tokenOrContent === 'string';

  if (tokenOrContentContent) {
    var content = tokenOrContent; ///

    if (false) {} else if (commentType === singleLineCommentType) {
      var hyperlinkSingleLineCommentTokenPosition = HyperlinkSingleLineCommentToken.positionWithinContent(content);

      if (hyperlinkSingleLineCommentTokenPosition > -1) {
        hyperlinkCommentTokenFromContent(HyperlinkSingleLineCommentToken, MiddleOfSingleLineCommentToken, commentTokensOrRemainingContents, commentType, content);
      } else {
        var middleOfSingleLineCommentToken = MiddleOfSingleLineCommentToken.fromContent(content);

        commentTokensOrRemainingContents.push(middleOfSingleLineCommentToken);
      }
    } else if (commentType === multiLineCommentType) {
      var hyperlinkMultiLineCommentTokenPosition = HyperlinkMultiLineCommentToken.positionWithinContent(content);

      if (hyperlinkMultiLineCommentTokenPosition > -1) {
        hyperlinkCommentTokenFromContent(HyperlinkMultiLineCommentToken, MiddleOfMultiLineCommentToken, commentTokensOrRemainingContents, commentType, content);
      } else {
        var endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.positionWithinContent(content);

        if (endOfMultiLineCommentTokenPosition > -1) {
          endOfCommentTokenFromContent(EndOfMultiLineCommentToken, EndOfMultiLineCommentToken, commentTokensOrRemainingContents, content);

          commentType = null; ///
        } else {
          var middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(content);

          commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
        }
      }
    } else {
      var startOfSingleLineCommentTokenPosition = StartOfSingleLineCommentToken.positionWithinContent(content),
          startOfMultiLineCommentTokenPosition = StartOfMultiLineCommentToken.positionWithinContent(content);

      if (startOfSingleLineCommentTokenPosition > -1 && startOfMultiLineCommentTokenPosition > -1) {
        if (false) {} else if (startOfSingleLineCommentTokenPosition < startOfMultiLineCommentTokenPosition) {
          commentType = singleLineCommentType; ///

          startOfCommentTokenFromContent(StartOfSingleLineCommentToken, commentTokensOrRemainingContents, commentType, content);
        } else if (startOfMultiLineCommentTokenPosition < startOfSingleLineCommentTokenPosition) {
          commentType = multiLineCommentType; ///

          startOfCommentTokenFromContent(StartOfMultiLineCommentToken, commentTokensOrRemainingContents, commentType, content);
        }
      } else if (startOfSingleLineCommentTokenPosition > -1) {
        commentType = singleLineCommentType; ///

        startOfCommentTokenFromContent(StartOfSingleLineCommentToken, commentTokensOrRemainingContents, commentType, content);
      } else if (startOfMultiLineCommentTokenPosition > -1) {
        commentType = multiLineCommentType; ///

        startOfCommentTokenFromContent(StartOfMultiLineCommentToken, commentTokensOrRemainingContents, commentType, content);
      } else {
        var remainingContent = content; ///

        commentTokensOrRemainingContents.push(remainingContent);
      }
    }
  } else {
    var token = tokenOrContent,
        ///
    tokenEndOfLineToken = token.isEndOfLineToken();

    if (tokenEndOfLineToken) {
      var commentTypeSingleLineCommentType = commentType === singleLineCommentType;

      if (commentTypeSingleLineCommentType) {
        commentType = null;
      }
    }

    commentTokensOrRemainingContents.push(token);
  }

  return commentType;
}

function startOfCommentTokenFromContent(StartOfCommentToken, commentTokensOrRemainingContents, commentType, content) {
  var startOfSingleLineCommentToken = StartOfCommentToken.fromWithinContent(content),
      position = StartOfCommentToken.positionWithinContent(content),
      ///
  contentLength = startOfSingleLineCommentToken.getContentLength(),
      left = position,
      ///
  right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var remainingContent = leftContent; ///

    commentTokensOrRemainingContents.push(remainingContent);
  }

  commentTokensOrRemainingContents.push(startOfSingleLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentTokensOrRemainingContentsFromTokenOrContent(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }
}

function endOfCommentTokenFromContent(EndOfCommentToken, MiddleOfCommentToken, commentTokensOrRemainingContents, content) {
  var endOfMultiLineCommentToken = EndOfCommentToken.fromWithinContent(content),
      position = EndOfCommentToken.positionWithinContent(content),
      contentLength = endOfMultiLineCommentToken.getContentLength(),
      left = position,
      right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var _content = leftContent,
        ///
    middleOfMultiLineCommentToken = MiddleOfCommentToken.fromContent(_content);

    commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
  }

  commentTokensOrRemainingContents.push(endOfMultiLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent,
        ///
    commentType = null; ///

    commentTokensOrRemainingContentsFromTokenOrContent(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }
}

function hyperlinkCommentTokenFromContent(HyperlinkCommentToken, MiddleOfCommentToken, commentTokensOrRemainingContents, commentType, content) {
  var hyperlinkCommentToken = HyperlinkCommentToken.fromWithinContent(content),
      position = HyperlinkCommentToken.positionWithinContent(content),
      ///
  contentLength = hyperlinkCommentToken.getContentLength(),
      left = position,
      right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var _content2 = leftContent,
        ///
    middleOfCommentToken = MiddleOfCommentToken.fromContent(_content2);

    commentTokensOrRemainingContents.push(middleOfCommentToken);
  }

  commentTokensOrRemainingContents.push(hyperlinkCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentTokensOrRemainingContentsFromTokenOrContent(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9jb21tb24vdG9rZW5zL2NvbW1lbnQuanMiXSwibmFtZXMiOlsidHlwZXMiLCJyZXF1aXJlIiwidG9rZW5zIiwiRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJIeXBlcmxpbmtNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIk1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIkh5cGVybGlua1NpbmdsZUxpbmVDb21tZW50VG9rZW4iLCJtdWx0aUxpbmVDb21tZW50VHlwZSIsInNpbmdsZUxpbmVDb21tZW50VHlwZSIsInByb2Nlc3NCeUNhbGxiYWNrIiwicHJvY2VzcyIsInRva2Vuc09yQ29udGVudHMiLCJjb21tZW50VHlwZSIsInRva2VuT3JDb250ZW50IiwiY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMiLCJjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50c0Zyb21Ub2tlbk9yQ29udGVudCIsInRva2Vuc09yUmVtYWluaW5nQ29udGVudHMiLCJtb2R1bGUiLCJleHBvcnRzIiwidG9rZW5PckNvbnRlbnRDb250ZW50IiwiY29udGVudCIsImh5cGVybGlua1NpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInBvc2l0aW9uV2l0aGluQ29udGVudCIsImh5cGVybGlua0NvbW1lbnRUb2tlbkZyb21Db250ZW50IiwibWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuIiwiZnJvbUNvbnRlbnQiLCJwdXNoIiwiaHlwZXJsaW5rTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24iLCJlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uIiwiZW5kT2ZDb21tZW50VG9rZW5Gcm9tQ29udGVudCIsIm1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwic3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInN0YXJ0T2ZDb21tZW50VG9rZW5Gcm9tQ29udGVudCIsInJlbWFpbmluZ0NvbnRlbnQiLCJ0b2tlbiIsInRva2VuRW5kT2ZMaW5lVG9rZW4iLCJpc0VuZE9mTGluZVRva2VuIiwiY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUiLCJTdGFydE9mQ29tbWVudFRva2VuIiwic3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4iLCJmcm9tV2l0aGluQ29udGVudCIsInBvc2l0aW9uIiwiY29udGVudExlbmd0aCIsImdldENvbnRlbnRMZW5ndGgiLCJsZWZ0IiwicmlnaHQiLCJsZWZ0Q29udGVudCIsInN1YnN0cmluZyIsInJpZ2h0Q29udGVudCIsImxlZnRDb250ZW50TGVuZ3RoIiwibGVuZ3RoIiwicmlnaHRDb250ZW50TGVuZ3RoIiwiRW5kT2ZDb21tZW50VG9rZW4iLCJNaWRkbGVPZkNvbW1lbnRUb2tlbiIsImVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiSHlwZXJsaW5rQ29tbWVudFRva2VuIiwiaHlwZXJsaW5rQ29tbWVudFRva2VuIiwibWlkZGxlT2ZDb21tZW50VG9rZW4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQU1BLFFBQVFDLFFBQVEsVUFBUixDQUFkO0FBQUEsSUFDTUMsU0FBU0QsUUFBUSxXQUFSLENBRGY7QUFBQSxJQUVNRSw2QkFBNkJGLFFBQVEsaURBQVIsQ0FGbkM7QUFBQSxJQUdNRywrQkFBK0JILFFBQVEsbURBQVIsQ0FIckM7QUFBQSxJQUlNSSxnQ0FBZ0NKLFFBQVEsb0RBQVIsQ0FKdEM7QUFBQSxJQUtNSyxpQ0FBaUNMLFFBQVEscURBQVIsQ0FMdkM7QUFBQSxJQU1NTSxnQ0FBZ0NOLFFBQVEsb0RBQVIsQ0FOdEM7QUFBQSxJQU9NTyxpQ0FBaUNQLFFBQVEscURBQVIsQ0FQdkM7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QUFrQixDQUFsQixFQUFxQkgsSUFBckIsQ0FMcEI7QUFBQSxNQU1NSSxlQUFlN0IsUUFBUTRCLFNBQVIsQ0FBa0JGLEtBQWxCLENBTnJCO0FBQUEsTUFPTUksb0JBQW9CSCxZQUFZSSxNQVB0QztBQUFBLE1BUU1DLHFCQUFxQkgsYUFBYUUsTUFSeEM7O0FBVUEsTUFBSUQsb0JBQW9CLENBQXhCLEVBQTJCO0FBQ3pCLFFBQU05QixZQUFVMkIsV0FBaEI7QUFBQSxRQUE4QjtBQUN4QlcsMkJBQXVCSixxQkFBcUI3QixXQUFyQixDQUFpQ0wsU0FBakMsQ0FEN0I7O0FBR0FOLHFDQUFpQ1ksSUFBakMsQ0FBc0NnQyxvQkFBdEM7QUFDRDs7QUFFRDVDLG1DQUFpQ1ksSUFBakMsQ0FBc0MrQixxQkFBdEM7O0FBRUEsTUFBSUwscUJBQXFCLENBQXpCLEVBQTRCO0FBQzFCLFFBQU12QyxpQkFBaUJvQyxZQUF2QixDQUQwQixDQUNZOztBQUV0Q2xDLHVEQUFtREQsZ0NBQW5ELEVBQXFGRCxjQUFyRixFQUFxR0QsV0FBckc7QUFDRDtBQUNGIiwiZmlsZSI6ImNvbW1lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG5jb25zdCB0eXBlcyA9IHJlcXVpcmUoJy4uL3R5cGVzJyksXHJcbiAgICAgIHRva2VucyA9IHJlcXVpcmUoJy4uL3Rva2VucycpLFxyXG4gICAgICBFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbXVsdGlMaW5lL2VuZE9mJyksXHJcbiAgICAgIFN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L211bHRpTGluZS9zdGFydE9mJyksXHJcbiAgICAgIE1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9tdWx0aUxpbmUvbWlkZGxlT2YnKSxcclxuICAgICAgSHlwZXJsaW5rTXVsdGlMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9tdWx0aUxpbmUvaHlwZXJsaW5rJyksXHJcbiAgICAgIFN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9zaW5nbGVMaW5lL3N0YXJ0T2YnKSxcclxuICAgICAgTWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9zaW5nbGVMaW5lL21pZGRsZU9mJyksXHJcbiAgICAgIEh5cGVybGlua1NpbmdsZUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L3NpbmdsZUxpbmUvaHlwZXJsaW5rJyk7XHJcblxyXG5jb25zdCB7IG11bHRpTGluZUNvbW1lbnRUeXBlLCBzaW5nbGVMaW5lQ29tbWVudFR5cGUgfSA9IHR5cGVzLFxyXG4gICAgICB7IHByb2Nlc3NCeUNhbGxiYWNrIH0gPSB0b2tlbnM7XHJcblxyXG5mdW5jdGlvbiBwcm9jZXNzKHRva2Vuc09yQ29udGVudHMsIGNvbW1lbnRUeXBlKSB7XHJcbiAgcHJvY2Vzc0J5Q2FsbGJhY2sodG9rZW5zT3JDb250ZW50cywgZnVuY3Rpb24odG9rZW5PckNvbnRlbnQpIHtcclxuICAgIGNvbnN0IGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzID0gW107XHJcblxyXG4gICAgY29tbWVudFR5cGUgPSBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50c0Zyb21Ub2tlbk9yQ29udGVudChjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgdG9rZW5PckNvbnRlbnQsIGNvbW1lbnRUeXBlKTtcclxuXHJcbiAgICBjb25zdCB0b2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzID0gY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHM7IC8vL1xyXG5cclxuICAgIHJldHVybiB0b2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzO1xyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIHByb2Nlc3M6IHByb2Nlc3NcclxufTtcclxuXHJcbmZ1bmN0aW9uIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzRnJvbVRva2VuT3JDb250ZW50KGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCwgY29tbWVudFR5cGUpIHtcclxuICBjb25zdCB0b2tlbk9yQ29udGVudENvbnRlbnQgPSAodHlwZW9mIHRva2VuT3JDb250ZW50ID09PSAnc3RyaW5nJyk7XHJcblxyXG4gIGlmICh0b2tlbk9yQ29udGVudENvbnRlbnQpIHtcclxuICAgIGNvbnN0IGNvbnRlbnQgPSB0b2tlbk9yQ29udGVudDsgLy8vXHJcblxyXG4gICAgaWYgKGZhbHNlKSB7XHJcblxyXG4gICAgfSBlbHNlIGlmIChjb21tZW50VHlwZSA9PT0gc2luZ2xlTGluZUNvbW1lbnRUeXBlKSB7XHJcbiAgICAgIGNvbnN0IGh5cGVybGlua1NpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IEh5cGVybGlua1NpbmdsZUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgICAgaWYgKGh5cGVybGlua1NpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSB7XHJcbiAgICAgICAgaHlwZXJsaW5rQ29tbWVudFRva2VuRnJvbUNvbnRlbnQoSHlwZXJsaW5rU2luZ2xlTGluZUNvbW1lbnRUb2tlbiwgTWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29tbWVudFR5cGUsIGNvbnRlbnQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IG1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IE1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKGNvbW1lbnRUeXBlID09PSBtdWx0aUxpbmVDb21tZW50VHlwZSkge1xyXG4gICAgICBjb25zdCBoeXBlcmxpbmtNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IEh5cGVybGlua011bHRpTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICBpZiAoaHlwZXJsaW5rTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICAgIGh5cGVybGlua0NvbW1lbnRUb2tlbkZyb21Db250ZW50KEh5cGVybGlua011bHRpTGluZUNvbW1lbnRUb2tlbiwgTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb21tZW50VHlwZSwgY29udGVudClcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgICAgICBpZiAoZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSB7XHJcbiAgICAgICAgICBlbmRPZkNvbW1lbnRUb2tlbkZyb21Db250ZW50KEVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLCBFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG5cclxuICAgICAgICAgIGNvbW1lbnRUeXBlID0gbnVsbDsgLy8vXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNvbnN0IG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gU3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpLFxyXG4gICAgICAgICAgICBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgIGlmICgoc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSAmJiAoc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpKSB7XHJcbiAgICAgICAgaWYgKGZhbHNlKSB7XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAoc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA8IHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbikge1xyXG4gICAgICAgICAgY29tbWVudFR5cGUgPSBzaW5nbGVMaW5lQ29tbWVudFR5cGU7IC8vL1xyXG5cclxuICAgICAgICAgIHN0YXJ0T2ZDb21tZW50VG9rZW5Gcm9tQ29udGVudChTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbW1lbnRUeXBlLCBjb250ZW50KTtcclxuICAgICAgICB9IGVsc2UgaWYgKHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA8IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24pIHtcclxuICAgICAgICAgIGNvbW1lbnRUeXBlID0gbXVsdGlMaW5lQ29tbWVudFR5cGU7IC8vL1xyXG5cclxuICAgICAgICAgIHN0YXJ0T2ZDb21tZW50VG9rZW5Gcm9tQ29udGVudChTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29tbWVudFR5cGUsIGNvbnRlbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpIHtcclxuICAgICAgICBjb21tZW50VHlwZSA9IHNpbmdsZUxpbmVDb21tZW50VHlwZTsgLy8vXHJcblxyXG4gICAgICAgIHN0YXJ0T2ZDb21tZW50VG9rZW5Gcm9tQ29udGVudChTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbW1lbnRUeXBlLCBjb250ZW50KTtcclxuICAgICAgfSBlbHNlIGlmIChzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICAgIGNvbW1lbnRUeXBlID0gbXVsdGlMaW5lQ29tbWVudFR5cGU7IC8vL1xyXG5cclxuICAgICAgICBzdGFydE9mQ29tbWVudFRva2VuRnJvbUNvbnRlbnQoU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbW1lbnRUeXBlLCBjb250ZW50KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCByZW1haW5pbmdDb250ZW50ID0gY29udGVudDsgLy8vXHJcblxyXG4gICAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gocmVtYWluaW5nQ29udGVudCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9IGVsc2Uge1xyXG4gICAgY29uc3QgdG9rZW4gPSB0b2tlbk9yQ29udGVudCwgLy8vXHJcbiAgICAgICAgICB0b2tlbkVuZE9mTGluZVRva2VuID0gdG9rZW4uaXNFbmRPZkxpbmVUb2tlbigpO1xyXG5cclxuICAgIGlmICh0b2tlbkVuZE9mTGluZVRva2VuKSB7XHJcbiAgICAgIGNvbnN0IGNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlID0gKGNvbW1lbnRUeXBlID09PSBzaW5nbGVMaW5lQ29tbWVudFR5cGUpO1xyXG5cclxuICAgICAgaWYgKGNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlKSB7XHJcbiAgICAgICAgY29tbWVudFR5cGUgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaCh0b2tlbik7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHN0YXJ0T2ZDb21tZW50VG9rZW5Gcm9tQ29udGVudChTdGFydE9mQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29tbWVudFR5cGUsIGNvbnRlbnQpIHtcclxuICBjb25zdCBzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IFN0YXJ0T2ZDb21tZW50VG9rZW4uZnJvbVdpdGhpbkNvbnRlbnQoY29udGVudCksXHJcbiAgICAgICAgcG9zaXRpb24gPSBTdGFydE9mQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KSwgIC8vL1xyXG4gICAgICAgIGNvbnRlbnRMZW5ndGggPSBzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbi5nZXRDb250ZW50TGVuZ3RoKCksXHJcbiAgICAgICAgbGVmdCA9IHBvc2l0aW9uLCAgLy8vXHJcbiAgICAgICAgcmlnaHQgPSBwb3NpdGlvbiArIGNvbnRlbnRMZW5ndGgsXHJcbiAgICAgICAgbGVmdENvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZygwLCBsZWZ0KSxcclxuICAgICAgICByaWdodENvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZyhyaWdodCksXHJcbiAgICAgICAgbGVmdENvbnRlbnRMZW5ndGggPSBsZWZ0Q29udGVudC5sZW5ndGgsXHJcbiAgICAgICAgcmlnaHRDb250ZW50TGVuZ3RoID0gcmlnaHRDb250ZW50Lmxlbmd0aDtcclxuXHJcbiAgaWYgKGxlZnRDb250ZW50TGVuZ3RoID4gMCkge1xyXG4gICAgY29uc3QgcmVtYWluaW5nQ29udGVudCA9IGxlZnRDb250ZW50OyAvLy9cclxuXHJcbiAgICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKHJlbWFpbmluZ0NvbnRlbnQpO1xyXG4gIH1cclxuXHJcbiAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbik7XHJcblxyXG4gIGlmIChyaWdodENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCB0b2tlbk9yQ29udGVudCA9IHJpZ2h0Q29udGVudDsgIC8vL1xyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzRnJvbVRva2VuT3JDb250ZW50KGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCwgY29tbWVudFR5cGUpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZW5kT2ZDb21tZW50VG9rZW5Gcm9tQ29udGVudChFbmRPZkNvbW1lbnRUb2tlbiwgTWlkZGxlT2ZDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KSB7XHJcbiAgY29uc3QgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBFbmRPZkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IEVuZE9mQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBjb250ZW50TGVuZ3RoID0gZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZ2V0Q29udGVudExlbmd0aCgpLFxyXG4gICAgICAgIGxlZnQgPSBwb3NpdGlvbixcclxuICAgICAgICByaWdodCA9IHBvc2l0aW9uICsgY29udGVudExlbmd0aCxcclxuICAgICAgICBsZWZ0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIGxlZnQpLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKHJpZ2h0KSxcclxuICAgICAgICBsZWZ0Q29udGVudExlbmd0aCA9IGxlZnRDb250ZW50Lmxlbmd0aCxcclxuICAgICAgICByaWdodENvbnRlbnRMZW5ndGggPSByaWdodENvbnRlbnQubGVuZ3RoO1xyXG5cclxuICBpZiAobGVmdENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCBjb250ZW50ID0gbGVmdENvbnRlbnQsICAvLy9cclxuICAgICAgICAgIG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbik7XHJcbiAgfVxyXG5cclxuICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKTtcclxuXHJcbiAgaWYgKHJpZ2h0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHRva2VuT3JDb250ZW50ID0gcmlnaHRDb250ZW50LCAgLy8vXHJcbiAgICAgICAgICBjb21tZW50VHlwZSA9IG51bGw7IC8vL1xyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzRnJvbVRva2VuT3JDb250ZW50KGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCwgY29tbWVudFR5cGUpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaHlwZXJsaW5rQ29tbWVudFRva2VuRnJvbUNvbnRlbnQoSHlwZXJsaW5rQ29tbWVudFRva2VuLCBNaWRkbGVPZkNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbW1lbnRUeXBlLCBjb250ZW50KSB7XHJcbiAgY29uc3QgaHlwZXJsaW5rQ29tbWVudFRva2VuID0gSHlwZXJsaW5rQ29tbWVudFRva2VuLmZyb21XaXRoaW5Db250ZW50KGNvbnRlbnQpLFxyXG4gICAgICAgIHBvc2l0aW9uID0gSHlwZXJsaW5rQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KSwgIC8vL1xyXG4gICAgICAgIGNvbnRlbnRMZW5ndGggPSBoeXBlcmxpbmtDb21tZW50VG9rZW4uZ2V0Q29udGVudExlbmd0aCgpLFxyXG4gICAgICAgIGxlZnQgPSBwb3NpdGlvbixcclxuICAgICAgICByaWdodCA9IHBvc2l0aW9uICsgY29udGVudExlbmd0aCxcclxuICAgICAgICBsZWZ0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIGxlZnQpLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKHJpZ2h0KSxcclxuICAgICAgICBsZWZ0Q29udGVudExlbmd0aCA9IGxlZnRDb250ZW50Lmxlbmd0aCxcclxuICAgICAgICByaWdodENvbnRlbnRMZW5ndGggPSByaWdodENvbnRlbnQubGVuZ3RoO1xyXG5cclxuICBpZiAobGVmdENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCBjb250ZW50ID0gbGVmdENvbnRlbnQsICAvLy9cclxuICAgICAgICAgIG1pZGRsZU9mQ29tbWVudFRva2VuID0gTWlkZGxlT2ZDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZkNvbW1lbnRUb2tlbik7XHJcbiAgfVxyXG5cclxuICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKGh5cGVybGlua0NvbW1lbnRUb2tlbik7XHJcblxyXG4gIGlmIChyaWdodENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCB0b2tlbk9yQ29udGVudCA9IHJpZ2h0Q29udGVudDsgIC8vL1xyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzRnJvbVRva2VuT3JDb250ZW50KGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCwgY29tbWVudFR5cGUpO1xyXG4gIH1cclxufVxyXG4iXX0=