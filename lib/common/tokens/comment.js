'use strict';

var types = require('../types'),
    tokens = require('../tokens'),
    EndOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/endOf'),
    StartOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/startOf'),
    MiddleOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/middleOf'),
    HyperlinkMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/hyperlink'),
    StartOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/startOf'),
    MiddleOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/middleOf'),
    HyperlinkSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/hyperlink');

var multiLineCommentType = types.multiLineCommentType,
    singleLineCommentType = types.singleLineCommentType,
    processByCallback = tokens.processByCallback;


function process(tokensOrContents, commentType) {
  processByCallback(tokensOrContents, function (tokenOrContent) {
    var commentTokensOrRemainingContents = [];

    commentType = processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);

    var tokensOrRemainingContents = commentTokensOrRemainingContents; ///

    return tokensOrRemainingContents;
  });

  return commentType;
}

module.exports = {
  process: process
};

function processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType) {
  var tokenOrContentContent = typeof tokenOrContent === 'string';

  if (tokenOrContentContent) {
    var content = tokenOrContent; ///

    if (false) {} else if (commentType === singleLineCommentType) {
      var hyperlinkSingleLineCommentTokenPosition = HyperlinkSingleLineCommentToken.positionWithinContent(content);

      if (hyperlinkSingleLineCommentTokenPosition > -1) {
        processHyperlinkSingleLineCommentToken(commentTokensOrRemainingContents, content);
      } else {
        var middleOfSingleLineCommentToken = MiddleOfSingleLineCommentToken.fromContent(content);

        commentTokensOrRemainingContents.push(middleOfSingleLineCommentToken);
      }
    } else if (commentType === multiLineCommentType) {
      var hyperlinkMultiLineCommentTokenPosition = HyperlinkMultiLineCommentToken.positionWithinContent(content);

      if (hyperlinkMultiLineCommentTokenPosition > -1) {
        processHyperlinkMultiLineCommentToken(commentTokensOrRemainingContents, content);
      } else {
        var endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.positionWithinContent(content);

        if (endOfMultiLineCommentTokenPosition > -1) {
          commentType = processEndOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
        } else {
          var middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(content);

          commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
        }
      }
    } else {
      var startOfSingleLineCommentTokenPosition = StartOfSingleLineCommentToken.positionWithinContent(content),
          startOfMultiLineCommentTokenPosition = StartOfMultiLineCommentToken.positionWithinContent(content);

      if (startOfSingleLineCommentTokenPosition > -1 && startOfMultiLineCommentTokenPosition > -1) {
        if (false) {} else if (startOfSingleLineCommentTokenPosition < startOfMultiLineCommentTokenPosition) {
          commentType = processStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content);
        } else if (startOfMultiLineCommentTokenPosition < startOfSingleLineCommentTokenPosition) {
          commentType = processStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
        }
      } else if (startOfSingleLineCommentTokenPosition > -1) {
        commentType = processStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content);
      } else if (startOfMultiLineCommentTokenPosition > -1) {
        commentType = processStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
      } else {
        var remainingContent = content; ///

        commentTokensOrRemainingContents.push(remainingContent);
      }
    }
  } else {
    var token = tokenOrContent,
        ///
    tokenEndOfLineToken = token.isEndOfLineToken();

    if (tokenEndOfLineToken) {
      var commentTypeSingleLineCommentType = commentType === singleLineCommentType;

      if (commentTypeSingleLineCommentType) {
        commentType = null;
      }
    }

    commentTokensOrRemainingContents.push(token);
  }

  return commentType;
}

function processStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = singleLineCommentType; ///

  commentType = processStartOfCommentToken(StartOfSingleLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function processStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = multiLineCommentType; ///

  commentType = processStartOfCommentToken(StartOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function processEndOfMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = null;

  commentType = processEndOfCommentToken(EndOfMultiLineCommentToken, EndOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function processHyperlinkSingleLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = singleLineCommentType; ///

  processHyperlinkCommentToken(HyperlinkSingleLineCommentToken, MiddleOfSingleLineCommentToken, commentTokensOrRemainingContents, content, commentType);
}

function processHyperlinkMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = multiLineCommentType; ///

  processHyperlinkCommentToken(HyperlinkMultiLineCommentToken, MiddleOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);
}

function processStartOfCommentToken(StartOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var startOfSingleLineCommentToken = StartOfCommentToken.fromWithinContent(content),
      position = StartOfCommentToken.positionWithinContent(content),
      ///
  contentLength = startOfSingleLineCommentToken.getContentLength(),
      left = position,
      ///
  right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var remainingContent = leftContent; ///

    commentTokensOrRemainingContents.push(remainingContent);
  }

  commentTokensOrRemainingContents.push(startOfSingleLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentType = processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }

  return commentType;
}

function processEndOfCommentToken(EndOfCommentToken, MiddleOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var endOfMultiLineCommentToken = EndOfCommentToken.fromWithinContent(content),
      position = EndOfCommentToken.positionWithinContent(content),
      contentLength = endOfMultiLineCommentToken.getContentLength(),
      left = position,
      right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var _content = leftContent,
        ///
    middleOfMultiLineCommentToken = MiddleOfCommentToken.fromContent(_content);

    commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
  }

  commentTokensOrRemainingContents.push(endOfMultiLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentType = processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }

  return commentType;
}

function processHyperlinkCommentToken(HyperlinkCommentToken, MiddleOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var hyperlinkCommentToken = HyperlinkCommentToken.fromWithinContent(content),
      position = HyperlinkCommentToken.positionWithinContent(content),
      ///
  contentLength = hyperlinkCommentToken.getContentLength(),
      left = position,
      right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var _content2 = leftContent,
        ///
    middleOfCommentToken = MiddleOfCommentToken.fromContent(_content2);

    commentTokensOrRemainingContents.push(middleOfCommentToken);
  }

  commentTokensOrRemainingContents.push(hyperlinkCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9jb21tb24vdG9rZW5zL2NvbW1lbnQuanMiXSwibmFtZXMiOlsidHlwZXMiLCJyZXF1aXJlIiwidG9rZW5zIiwiRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJIeXBlcmxpbmtNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIk1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIkh5cGVybGlua1NpbmdsZUxpbmVDb21tZW50VG9rZW4iLCJtdWx0aUxpbmVDb21tZW50VHlwZSIsInNpbmdsZUxpbmVDb21tZW50VHlwZSIsInByb2Nlc3NCeUNhbGxiYWNrIiwicHJvY2VzcyIsInRva2Vuc09yQ29udGVudHMiLCJjb21tZW50VHlwZSIsInRva2VuT3JDb250ZW50IiwiY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMiLCJwcm9jZXNzQ29tbWVudFRva2VucyIsInRva2Vuc09yUmVtYWluaW5nQ29udGVudHMiLCJtb2R1bGUiLCJleHBvcnRzIiwidG9rZW5PckNvbnRlbnRDb250ZW50IiwiY29udGVudCIsImh5cGVybGlua1NpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInBvc2l0aW9uV2l0aGluQ29udGVudCIsInByb2Nlc3NIeXBlcmxpbmtTaW5nbGVMaW5lQ29tbWVudFRva2VuIiwibWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuIiwiZnJvbUNvbnRlbnQiLCJwdXNoIiwiaHlwZXJsaW5rTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24iLCJwcm9jZXNzSHlwZXJsaW5rTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInByb2Nlc3NFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsIm1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwic3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInByb2Nlc3NTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsInByb2Nlc3NTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwicmVtYWluaW5nQ29udGVudCIsInRva2VuIiwidG9rZW5FbmRPZkxpbmVUb2tlbiIsImlzRW5kT2ZMaW5lVG9rZW4iLCJjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSIsInByb2Nlc3NTdGFydE9mQ29tbWVudFRva2VuIiwicHJvY2Vzc0VuZE9mQ29tbWVudFRva2VuIiwicHJvY2Vzc0h5cGVybGlua0NvbW1lbnRUb2tlbiIsIlN0YXJ0T2ZDb21tZW50VG9rZW4iLCJzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsImZyb21XaXRoaW5Db250ZW50IiwicG9zaXRpb24iLCJjb250ZW50TGVuZ3RoIiwiZ2V0Q29udGVudExlbmd0aCIsImxlZnQiLCJyaWdodCIsImxlZnRDb250ZW50Iiwic3Vic3RyaW5nIiwicmlnaHRDb250ZW50IiwibGVmdENvbnRlbnRMZW5ndGgiLCJsZW5ndGgiLCJyaWdodENvbnRlbnRMZW5ndGgiLCJFbmRPZkNvbW1lbnRUb2tlbiIsIk1pZGRsZU9mQ29tbWVudFRva2VuIiwiZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJIeXBlcmxpbmtDb21tZW50VG9rZW4iLCJoeXBlcmxpbmtDb21tZW50VG9rZW4iLCJtaWRkbGVPZkNvbW1lbnRUb2tlbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsUUFBUUMsUUFBUSxVQUFSLENBQWQ7QUFBQSxJQUNNQyxTQUFTRCxRQUFRLFdBQVIsQ0FEZjtBQUFBLElBRU1FLDZCQUE2QkYsUUFBUSxpREFBUixDQUZuQztBQUFBLElBR01HLCtCQUErQkgsUUFBUSxtREFB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QSxNQVFNQyxxQkFBcUJILGFBQWFFLE1BUnhDOztBQVVBLE1BQUlELG9CQUFvQixDQUF4QixFQUEyQjtBQUN6QixRQUFNbkMsWUFBVWdDLFdBQWhCO0FBQUEsUUFBOEI7QUFDeEJXLDJCQUF1QkoscUJBQXFCbEMsV0FBckIsQ0FBaUNMLFNBQWpDLENBRDdCOztBQUdBTixxQ0FBaUNZLElBQWpDLENBQXNDcUMsb0JBQXRDO0FBQ0Q7O0FBRURqRCxtQ0FBaUNZLElBQWpDLENBQXNDb0MscUJBQXRDOztBQUVBLE1BQUlMLHFCQUFxQixDQUF6QixFQUE0QjtBQUMxQixRQUFNNUMsaUJBQWlCeUMsWUFBdkIsQ0FEMEIsQ0FDWTs7QUFFdEN2Qyx5QkFBcUJELGdDQUFyQixFQUF1REQsY0FBdkQsRUFBdUVELFdBQXZFO0FBQ0Q7QUFDRiIsImZpbGUiOiJjb21tZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuY29uc3QgdHlwZXMgPSByZXF1aXJlKCcuLi90eXBlcycpLFxyXG4gICAgICB0b2tlbnMgPSByZXF1aXJlKCcuLi90b2tlbnMnKSxcclxuICAgICAgRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L211bHRpTGluZS9lbmRPZicpLFxyXG4gICAgICBTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9tdWx0aUxpbmUvc3RhcnRPZicpLFxyXG4gICAgICBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbXVsdGlMaW5lL21pZGRsZU9mJyksXHJcbiAgICAgIEh5cGVybGlua011bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbXVsdGlMaW5lL2h5cGVybGluaycpLFxyXG4gICAgICBTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvc2luZ2xlTGluZS9zdGFydE9mJyksXHJcbiAgICAgIE1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvc2luZ2xlTGluZS9taWRkbGVPZicpLFxyXG4gICAgICBIeXBlcmxpbmtTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9zaW5nbGVMaW5lL2h5cGVybGluaycpO1xyXG5cclxuY29uc3QgeyBtdWx0aUxpbmVDb21tZW50VHlwZSwgc2luZ2xlTGluZUNvbW1lbnRUeXBlIH0gPSB0eXBlcyxcclxuICAgICAgeyBwcm9jZXNzQnlDYWxsYmFjayB9ID0gdG9rZW5zO1xyXG5cclxuZnVuY3Rpb24gcHJvY2Vzcyh0b2tlbnNPckNvbnRlbnRzLCBjb21tZW50VHlwZSkge1xyXG4gIHByb2Nlc3NCeUNhbGxiYWNrKHRva2Vuc09yQ29udGVudHMsIGZ1bmN0aW9uKHRva2VuT3JDb250ZW50KSB7XHJcbiAgICBjb25zdCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyA9IFtdO1xyXG5cclxuICAgIGNvbW1lbnRUeXBlID0gcHJvY2Vzc0NvbW1lbnRUb2tlbnMoY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIHRva2VuT3JDb250ZW50LCBjb21tZW50VHlwZSk7XHJcblxyXG4gICAgY29uc3QgdG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyA9IGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzOyAvLy9cclxuXHJcbiAgICByZXR1cm4gdG9rZW5zT3JSZW1haW5pbmdDb250ZW50cztcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICBwcm9jZXNzOiBwcm9jZXNzXHJcbn07XHJcblxyXG5mdW5jdGlvbiBwcm9jZXNzQ29tbWVudFRva2Vucyhjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgdG9rZW5PckNvbnRlbnQsIGNvbW1lbnRUeXBlKSB7XHJcbiAgY29uc3QgdG9rZW5PckNvbnRlbnRDb250ZW50ID0gKHR5cGVvZiB0b2tlbk9yQ29udGVudCA9PT0gJ3N0cmluZycpO1xyXG5cclxuICBpZiAodG9rZW5PckNvbnRlbnRDb250ZW50KSB7XHJcbiAgICBjb25zdCBjb250ZW50ID0gdG9rZW5PckNvbnRlbnQ7IC8vL1xyXG5cclxuICAgIGlmIChmYWxzZSkge1xyXG5cclxuICAgIH0gZWxzZSBpZiAoY29tbWVudFR5cGUgPT09IHNpbmdsZUxpbmVDb21tZW50VHlwZSkge1xyXG4gICAgICBjb25zdCBoeXBlcmxpbmtTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBIeXBlcmxpbmtTaW5nbGVMaW5lQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgIGlmIChoeXBlcmxpbmtTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICAgIHByb2Nlc3NIeXBlcmxpbmtTaW5nbGVMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IG1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IE1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKGNvbW1lbnRUeXBlID09PSBtdWx0aUxpbmVDb21tZW50VHlwZSkge1xyXG4gICAgICBjb25zdCBoeXBlcmxpbmtNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IEh5cGVybGlua011bHRpTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICBpZiAoaHlwZXJsaW5rTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICAgIHByb2Nlc3NIeXBlcmxpbmtNdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICAgIGlmIChlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpIHtcclxuICAgICAgICAgIGNvbW1lbnRUeXBlID0gcHJvY2Vzc0VuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY29uc3QgbWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgICAgICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCksXHJcbiAgICAgICAgICAgIHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IFN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgICAgaWYgKChzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpICYmIChzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkpIHtcclxuICAgICAgICBpZiAoZmFsc2UpIHtcclxuXHJcbiAgICAgICAgfSBlbHNlIGlmIChzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uIDwgc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uKSB7XHJcbiAgICAgICAgICBjb21tZW50VHlwZSA9IHByb2Nlc3NTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPCBzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uKSB7XHJcbiAgICAgICAgICBjb21tZW50VHlwZSA9IHByb2Nlc3NTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSBpZiAoc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSB7XHJcbiAgICAgICAgY29tbWVudFR5cGUgPSBwcm9jZXNzU3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICB9IGVsc2UgaWYgKHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSB7XHJcbiAgICAgICAgY29tbWVudFR5cGUgPSBwcm9jZXNzU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgcmVtYWluaW5nQ29udGVudCA9IGNvbnRlbnQ7IC8vL1xyXG5cclxuICAgICAgICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKHJlbWFpbmluZ0NvbnRlbnQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbnN0IHRva2VuID0gdG9rZW5PckNvbnRlbnQsIC8vL1xyXG4gICAgICAgICAgdG9rZW5FbmRPZkxpbmVUb2tlbiA9IHRva2VuLmlzRW5kT2ZMaW5lVG9rZW4oKTtcclxuXHJcbiAgICBpZiAodG9rZW5FbmRPZkxpbmVUb2tlbikge1xyXG4gICAgICBjb25zdCBjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSA9IChjb21tZW50VHlwZSA9PT0gc2luZ2xlTGluZUNvbW1lbnRUeXBlKTtcclxuXHJcbiAgICAgIGlmIChjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSkge1xyXG4gICAgICAgIGNvbW1lbnRUeXBlID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2godG9rZW4pO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwcm9jZXNzU3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpIHtcclxuICBsZXQgY29tbWVudFR5cGUgPSBzaW5nbGVMaW5lQ29tbWVudFR5cGU7ICAvLy9cclxuXHJcbiAgY29tbWVudFR5cGUgPSBwcm9jZXNzU3RhcnRPZkNvbW1lbnRUb2tlbihTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQsIGNvbW1lbnRUeXBlKTtcclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwcm9jZXNzU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCkge1xyXG4gIGxldCBjb21tZW50VHlwZSA9IG11bHRpTGluZUNvbW1lbnRUeXBlOyAvLy9cclxuXHJcbiAgY29tbWVudFR5cGUgPSBwcm9jZXNzU3RhcnRPZkNvbW1lbnRUb2tlbihTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCwgY29tbWVudFR5cGUpO1xyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3NFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCkge1xyXG4gIGxldCBjb21tZW50VHlwZSA9IG51bGw7XHJcblxyXG4gIGNvbW1lbnRUeXBlID0gcHJvY2Vzc0VuZE9mQ29tbWVudFRva2VuKEVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLCBFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQsIGNvbW1lbnRUeXBlKTtcclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwcm9jZXNzSHlwZXJsaW5rU2luZ2xlTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCkge1xyXG4gIGNvbnN0IGNvbW1lbnRUeXBlID0gc2luZ2xlTGluZUNvbW1lbnRUeXBlOyAgLy8vXHJcblxyXG4gIHByb2Nlc3NIeXBlcmxpbmtDb21tZW50VG9rZW4oSHlwZXJsaW5rU2luZ2xlTGluZUNvbW1lbnRUb2tlbiwgTWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCwgY29tbWVudFR5cGUpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwcm9jZXNzSHlwZXJsaW5rTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KSB7XHJcbiAgY29uc3QgY29tbWVudFR5cGUgPSBtdWx0aUxpbmVDb21tZW50VHlwZTsgIC8vL1xyXG5cclxuICBwcm9jZXNzSHlwZXJsaW5rQ29tbWVudFRva2VuKEh5cGVybGlua011bHRpTGluZUNvbW1lbnRUb2tlbiwgTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3NTdGFydE9mQ29tbWVudFRva2VuKFN0YXJ0T2ZDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSkge1xyXG4gIGNvbnN0IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gU3RhcnRPZkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IFN0YXJ0T2ZDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpLCAgLy8vXHJcbiAgICAgICAgY29udGVudExlbmd0aCA9IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLmdldENvbnRlbnRMZW5ndGgoKSxcclxuICAgICAgICBsZWZ0ID0gcG9zaXRpb24sICAvLy9cclxuICAgICAgICByaWdodCA9IHBvc2l0aW9uICsgY29udGVudExlbmd0aCxcclxuICAgICAgICBsZWZ0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIGxlZnQpLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKHJpZ2h0KSxcclxuICAgICAgICBsZWZ0Q29udGVudExlbmd0aCA9IGxlZnRDb250ZW50Lmxlbmd0aCxcclxuICAgICAgICByaWdodENvbnRlbnRMZW5ndGggPSByaWdodENvbnRlbnQubGVuZ3RoO1xyXG5cclxuICBpZiAobGVmdENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCByZW1haW5pbmdDb250ZW50ID0gbGVmdENvbnRlbnQ7IC8vL1xyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gocmVtYWluaW5nQ29udGVudCk7XHJcbiAgfVxyXG5cclxuICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuKTtcclxuXHJcbiAgaWYgKHJpZ2h0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHRva2VuT3JDb250ZW50ID0gcmlnaHRDb250ZW50OyAgLy8vXHJcblxyXG4gICAgY29tbWVudFR5cGUgPSBwcm9jZXNzQ29tbWVudFRva2Vucyhjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgdG9rZW5PckNvbnRlbnQsIGNvbW1lbnRUeXBlKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gcHJvY2Vzc0VuZE9mQ29tbWVudFRva2VuKEVuZE9mQ29tbWVudFRva2VuLCBNaWRkbGVPZkNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQsIGNvbW1lbnRUeXBlKSB7XHJcbiAgY29uc3QgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBFbmRPZkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IEVuZE9mQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBjb250ZW50TGVuZ3RoID0gZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZ2V0Q29udGVudExlbmd0aCgpLFxyXG4gICAgICAgIGxlZnQgPSBwb3NpdGlvbixcclxuICAgICAgICByaWdodCA9IHBvc2l0aW9uICsgY29udGVudExlbmd0aCxcclxuICAgICAgICBsZWZ0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIGxlZnQpLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKHJpZ2h0KSxcclxuICAgICAgICBsZWZ0Q29udGVudExlbmd0aCA9IGxlZnRDb250ZW50Lmxlbmd0aCxcclxuICAgICAgICByaWdodENvbnRlbnRMZW5ndGggPSByaWdodENvbnRlbnQubGVuZ3RoO1xyXG5cclxuICBpZiAobGVmdENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCBjb250ZW50ID0gbGVmdENvbnRlbnQsICAvLy9cclxuICAgICAgICAgIG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbik7XHJcbiAgfVxyXG5cclxuICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKTtcclxuXHJcbiAgaWYgKHJpZ2h0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHRva2VuT3JDb250ZW50ID0gcmlnaHRDb250ZW50OyAvLy9cclxuXHJcbiAgICBjb21tZW50VHlwZSA9IHByb2Nlc3NDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCwgY29tbWVudFR5cGUpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwcm9jZXNzSHlwZXJsaW5rQ29tbWVudFRva2VuKEh5cGVybGlua0NvbW1lbnRUb2tlbiwgTWlkZGxlT2ZDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSkge1xyXG4gIGNvbnN0IGh5cGVybGlua0NvbW1lbnRUb2tlbiA9IEh5cGVybGlua0NvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IEh5cGVybGlua0NvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCksICAvLy9cclxuICAgICAgICBjb250ZW50TGVuZ3RoID0gaHlwZXJsaW5rQ29tbWVudFRva2VuLmdldENvbnRlbnRMZW5ndGgoKSxcclxuICAgICAgICBsZWZ0ID0gcG9zaXRpb24sXHJcbiAgICAgICAgcmlnaHQgPSBwb3NpdGlvbiArIGNvbnRlbnRMZW5ndGgsXHJcbiAgICAgICAgbGVmdENvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZygwLCBsZWZ0KSxcclxuICAgICAgICByaWdodENvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZyhyaWdodCksXHJcbiAgICAgICAgbGVmdENvbnRlbnRMZW5ndGggPSBsZWZ0Q29udGVudC5sZW5ndGgsXHJcbiAgICAgICAgcmlnaHRDb250ZW50TGVuZ3RoID0gcmlnaHRDb250ZW50Lmxlbmd0aDtcclxuXHJcbiAgaWYgKGxlZnRDb250ZW50TGVuZ3RoID4gMCkge1xyXG4gICAgY29uc3QgY29udGVudCA9IGxlZnRDb250ZW50LCAgLy8vXHJcbiAgICAgICAgICBtaWRkbGVPZkNvbW1lbnRUb2tlbiA9IE1pZGRsZU9mQ29tbWVudFRva2VuLmZyb21Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gobWlkZGxlT2ZDb21tZW50VG9rZW4pO1xyXG4gIH1cclxuXHJcbiAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChoeXBlcmxpbmtDb21tZW50VG9rZW4pO1xyXG5cclxuICBpZiAocmlnaHRDb250ZW50TGVuZ3RoID4gMCkge1xyXG4gICAgY29uc3QgdG9rZW5PckNvbnRlbnQgPSByaWdodENvbnRlbnQ7ICAvLy9cclxuXHJcbiAgICBwcm9jZXNzQ29tbWVudFRva2Vucyhjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgdG9rZW5PckNvbnRlbnQsIGNvbW1lbnRUeXBlKTtcclxuICB9XHJcbn1cclxuIl19