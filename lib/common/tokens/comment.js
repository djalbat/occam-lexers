'use strict';

var types = require('../types'),
    tokens = require('../tokens'),
    StringLiteralToken = require('../token/significant/stringLiteral'),
    EndOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/endOf'),
    StartOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/startOf'),
    MiddleOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/middleOf'),
    StartOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/startOf'),
    MiddleOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/middleOf');

var multiLineType = types.multiLineType,
    singleLineType = types.singleLineType,
    multiLineCommentType = types.multiLineCommentType,
    singleLineCommentType = types.singleLineCommentType,
    tokeniseByCallback = tokens.tokeniseByCallback;


function tokenise(tokensOrContents, commentType) {
  tokeniseByCallback(tokensOrContents, function (tokenOrContent) {
    var commentTokensOrRemainingContents = [];

    commentType = tokeniseCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);

    var tokensOrRemainingContents = commentTokensOrRemainingContents; ///

    return tokensOrRemainingContents;
  });

  return commentType;
}

module.exports = {
  tokenise: tokenise
};

function tokeniseCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType) {
  var tokenOrContentContent = isTokenOrContentContent(tokenOrContent),
      tokenOrContentStringLiteralToken = isTokenOrContentStringLiteralToken(tokenOrContent),
      commentTypeSingleLineCommentType = isCommentTypeSingleLineCommentType(commentType),
      commentTypeMultiLineCommentType = isCommentTypeMultiLineCommentType(commentType);

  if (false) {} else if (tokenOrContentContent) {
    var content = tokenOrContent; ///

    if (false) {} else if (commentTypeSingleLineCommentType) {
      var middleOfSingleLineCommentToken = MiddleOfSingleLineCommentToken.fromContent(content);

      commentTokensOrRemainingContents.push(middleOfSingleLineCommentToken);
    } else if (commentTypeMultiLineCommentType) {
      var endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.positionWithinContent(content);

      if (endOfMultiLineCommentTokenPosition > -1) {
        commentType = tokeniseEndOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
      } else {
        var middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(content);

        commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
      }
    } else {
      var startOfSingleLineCommentTokenPosition = StartOfSingleLineCommentToken.positionWithinContent(content),
          startOfMultiLineCommentTokenPosition = StartOfMultiLineCommentToken.positionWithinContent(content);

      if (startOfSingleLineCommentTokenPosition > -1 && startOfMultiLineCommentTokenPosition > -1) {
        if (false) {} else if (startOfSingleLineCommentTokenPosition < startOfMultiLineCommentTokenPosition) {
          commentType = tokeniseStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content);
        } else if (startOfMultiLineCommentTokenPosition < startOfSingleLineCommentTokenPosition) {
          commentType = tokeniseStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
        }
      } else if (startOfSingleLineCommentTokenPosition > -1) {
        commentType = tokeniseStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content);
      } else if (startOfMultiLineCommentTokenPosition > -1) {
        commentType = tokeniseStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
      } else {
        var remainingContent = content; ///

        commentTokensOrRemainingContents.push(remainingContent);
      }
    }
  } else if (tokenOrContentStringLiteralToken) {
    var stringLiteralToken = tokenOrContent; ///

    if (false) {} else if (commentTypeSingleLineCommentType) {
      var _middleOfSingleLineCommentToken = MiddleOfSingleLineCommentToken.fromStringLiteralToken(stringLiteralToken);

      commentTokensOrRemainingContents.push(_middleOfSingleLineCommentToken);
    } else if (commentTypeMultiLineCommentType) {
      var _content = stringLiteralToken.getContent(),
          _endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.positionWithinContent(_content);

      if (_endOfMultiLineCommentTokenPosition > -1) {
        commentType = tokeniseEndOfMultiLineCommentToken(commentTokensOrRemainingContents, _content);
      } else {
        var _middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(_content);

        commentTokensOrRemainingContents.push(_middleOfMultiLineCommentToken);
      }
    } else {
      commentTokensOrRemainingContents.push(stringLiteralToken);
    }
  } else {
    var token = tokenOrContent,
        ///
    tokenEndOfLineToken = token.isEndOfLineToken();

    if (tokenEndOfLineToken) {
      var _commentTypeSingleLineCommentType = isCommentTypeSingleLineCommentType(commentType);

      if (_commentTypeSingleLineCommentType) {
        commentType = null;
      }
    }

    commentTokensOrRemainingContents.push(token);
  }

  return commentType;
}

function isTokenOrContentContent(tokenOrContent) {
  var tokenOrContentString = typeof tokenOrContent === 'string',
      tokenOrContentContent = tokenOrContentString; ///

  return tokenOrContentContent;
}

function isTokenOrContentStringLiteralToken(tokenOrContent) {
  var tokenOrContentStringLiteralToken = false;

  var tokenOrContentString = typeof tokenOrContent === 'string',
      tokenOrContentContent = tokenOrContentString,
      ///
  tokenOrContentToken = !tokenOrContentContent;

  if (tokenOrContentToken) {
    var token = tokenOrContent,
        tokenStringLiteralToken = token instanceof StringLiteralToken;

    tokenOrContentStringLiteralToken = tokenStringLiteralToken; ///
  }

  return tokenOrContentStringLiteralToken;
}

function isCommentTypeSingleLineCommentType(commentType) {
  var commentTypeSingleLineCommentType = false;

  if (commentType !== null) {
    var commentTypeIncludesSingleLineType = commentType.includes(singleLineType);

    commentTypeSingleLineCommentType = commentTypeIncludesSingleLineType;
  }

  return commentTypeSingleLineCommentType;
}

function isCommentTypeMultiLineCommentType(commentType) {
  var commentTypeMultiLineCommentType = false;

  if (commentType !== null) {
    var commentTypeIncludesMultiLineType = commentType.includes(multiLineType);

    commentTypeMultiLineCommentType = commentTypeIncludesMultiLineType;
  }

  return commentTypeMultiLineCommentType;
}

function tokeniseStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = singleLineCommentType; ///

  commentType = tokeniseStartOfCommentToken(StartOfSingleLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function tokeniseStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = multiLineCommentType; ///

  commentType = tokeniseStartOfCommentToken(StartOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function tokeniseEndOfMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = null;

  commentType = tokeniseEndOfCommentToken(EndOfMultiLineCommentToken, MiddleOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function tokeniseStartOfCommentToken(StartOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var startOfSingleLineCommentToken = StartOfCommentToken.fromWithinContent(content),
      position = StartOfCommentToken.positionWithinContent(content),
      ///
  contentLength = startOfSingleLineCommentToken.getContentLength(),
      left = position,
      ///
  right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var remainingContent = leftContent; ///

    commentTokensOrRemainingContents.push(remainingContent);
  }

  commentTokensOrRemainingContents.push(startOfSingleLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentType = tokeniseCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }

  return commentType;
}

function tokeniseEndOfCommentToken(EndOfCommentToken, MiddleOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var endOfMultiLineCommentToken = EndOfCommentToken.fromWithinContent(content),
      position = EndOfCommentToken.positionWithinContent(content),
      contentLength = endOfMultiLineCommentToken.getContentLength(),
      left = position,
      right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var _content2 = leftContent,
        ///
    middleOfMultiLineCommentToken = MiddleOfCommentToken.fromContent(_content2);

    commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
  }

  commentTokensOrRemainingContents.push(endOfMultiLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentType = tokeniseCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }

  return commentType;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9jb21tb24vdG9rZW5zL2NvbW1lbnQuanMiXSwibmFtZXMiOlsidHlwZXMiLCJyZXF1aXJlIiwidG9rZW5zIiwiU3RyaW5nTGl0ZXJhbFRva2VuIiwiRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIk1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIm11bHRpTGluZVR5cGUiLCJzaW5nbGVMaW5lVHlwZSIsIm11bHRpTGluZUNvbW1lbnRUeXBlIiwic2luZ2xlTGluZUNvbW1lbnRUeXBlIiwidG9rZW5pc2VCeUNhbGxiYWNrIiwidG9rZW5pc2UiLCJ0b2tlbnNPckNvbnRlbnRzIiwiY29tbWVudFR5cGUiLCJ0b2tlbk9yQ29udGVudCIsImNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzIiwidG9rZW5pc2VDb21tZW50VG9rZW5zIiwidG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyIsIm1vZHVsZSIsImV4cG9ydHMiLCJ0b2tlbk9yQ29udGVudENvbnRlbnQiLCJpc1Rva2VuT3JDb250ZW50Q29udGVudCIsInRva2VuT3JDb250ZW50U3RyaW5nTGl0ZXJhbFRva2VuIiwiaXNUb2tlbk9yQ29udGVudFN0cmluZ0xpdGVyYWxUb2tlbiIsImNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlIiwiaXNDb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSIsImNvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUiLCJpc0NvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUiLCJjb250ZW50IiwibWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuIiwiZnJvbUNvbnRlbnQiLCJwdXNoIiwiZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInBvc2l0aW9uV2l0aGluQ29udGVudCIsInRva2VuaXNlRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsInN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24iLCJzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24iLCJ0b2tlbmlzZVN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuIiwidG9rZW5pc2VTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwicmVtYWluaW5nQ29udGVudCIsInN0cmluZ0xpdGVyYWxUb2tlbiIsImZyb21TdHJpbmdMaXRlcmFsVG9rZW4iLCJnZXRDb250ZW50IiwidG9rZW4iLCJ0b2tlbkVuZE9mTGluZVRva2VuIiwiaXNFbmRPZkxpbmVUb2tlbiIsInRva2VuT3JDb250ZW50U3RyaW5nIiwidG9rZW5PckNvbnRlbnRUb2tlbiIsInRva2VuU3RyaW5nTGl0ZXJhbFRva2VuIiwiY29tbWVudFR5cGVJbmNsdWRlc1NpbmdsZUxpbmVUeXBlIiwiaW5jbHVkZXMiLCJjb21tZW50VHlwZUluY2x1ZGVzTXVsdGlMaW5lVHlwZSIsInRva2VuaXNlU3RhcnRPZkNvbW1lbnRUb2tlbiIsInRva2VuaXNlRW5kT2ZDb21tZW50VG9rZW4iLCJTdGFydE9mQ29tbWVudFRva2VuIiwic3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4iLCJmcm9tV2l0aGluQ29udGVudCIsInBvc2l0aW9uIiwiY29udGVudExlbmd0aCIsImdldENvbnRlbnRMZW5ndGgiLCJsZWZ0IiwicmlnaHQiLCJsZWZ0Q29udGVudCIsInN1YnN0cmluZyIsInJpZ2h0Q29udGVudCIsImxlZnRDb250ZW50TGVuZ3RoIiwibGVuZ3RoIiwicmlnaHRDb250ZW50TGVuZ3RoIiwiRW5kT2ZDb21tZW50VG9rZW4iLCJNaWRkbGVPZkNvbW1lbnRUb2tlbiIsImVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIl0s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QUFBQSxNQUNNOEIsV0FBV1csa0JBQWtCcEMscUJBQWxCLENBQXdDTCxPQUF4QyxDQURqQjtBQUFBLE1BRU0rQixnQkFBZ0JZLDJCQUEyQlgsZ0JBQTNCLEVBRnRCO0FBQUEsTUFHTUMsT0FBT0gsUUFIYjtBQUFBLE1BSU1JLFFBQVFKLFdBQVdDLGFBSnpCO0FBQUEsTUFLTUksY0FBY25DLFFBQVFvQyxTQUFSLENBQWtCLENBQWxCLEVBQXFCSCxJQUFyQixDQUxwQjtBQUFBLE1BTU1JLGVBQWVyQyxRQUFRb0MsU0FBUixDQUFrQkYsS0FBbEIsQ0FOckI7QUFBQSxNQU9NSSxvQkFBb0JILFlBQVlJLE1BUHRDO0FBQUEsTUFRTUMscUJBQXFCSCxhQUFhRSxNQVJ4Qzs7QUFVQSxNQUFJRCxvQkFBb0IsQ0FBeEIsRUFBMkI7QUFDekIsUUFBTXRDLFlBQVVtQyxXQUFoQjtBQUFBLFFBQThCO0FBQ3hCNUIsb0NBQWdDbUMscUJBQXFCeEMsV0FBckIsQ0FBaUNGLFNBQWpDLENBRHRDOztBQUdBYixxQ0FBaUNnQixJQUFqQyxDQUFzQ0ksNkJBQXRDO0FBQ0Q7O0FBRURwQixtQ0FBaUNnQixJQUFqQyxDQUFzQ3dDLDBCQUF0Qzs7QUFFQSxNQUFJSCxxQkFBcUIsQ0FBekIsRUFBNEI7QUFDMUIsUUFBTXRELGlCQUFpQm1ELFlBQXZCLENBRDBCLENBQ1c7O0FBRXJDcEQsa0JBQWNHLHNCQUFzQkQsZ0NBQXRCLEVBQXdERCxjQUF4RCxFQUF3RUQsV0FBeEUsQ0FBZDtBQUNEOztBQUVELFNBQU9BLFdBQVA7QUFDRCIsImZpbGUiOiJjb21tZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuY29uc3QgdHlwZXMgPSByZXF1aXJlKCcuLi90eXBlcycpLFxyXG4gICAgICB0b2tlbnMgPSByZXF1aXJlKCcuLi90b2tlbnMnKSxcclxuICAgICAgU3RyaW5nTGl0ZXJhbFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vc2lnbmlmaWNhbnQvc3RyaW5nTGl0ZXJhbCcpLFxyXG4gICAgICBFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbXVsdGlMaW5lL2VuZE9mJyksXHJcbiAgICAgIFN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L211bHRpTGluZS9zdGFydE9mJyksXHJcbiAgICAgIE1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9tdWx0aUxpbmUvbWlkZGxlT2YnKSxcclxuICAgICAgU3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L3NpbmdsZUxpbmUvc3RhcnRPZicpLFxyXG4gICAgICBNaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L3NpbmdsZUxpbmUvbWlkZGxlT2YnKTtcclxuXHJcbmNvbnN0IHsgbXVsdGlMaW5lVHlwZSwgc2luZ2xlTGluZVR5cGUsIG11bHRpTGluZUNvbW1lbnRUeXBlLCBzaW5nbGVMaW5lQ29tbWVudFR5cGUgfSA9IHR5cGVzLFxyXG4gICAgICB7IHRva2VuaXNlQnlDYWxsYmFjayB9ID0gdG9rZW5zO1xyXG5cclxuZnVuY3Rpb24gdG9rZW5pc2UodG9rZW5zT3JDb250ZW50cywgY29tbWVudFR5cGUpIHtcclxuICB0b2tlbmlzZUJ5Q2FsbGJhY2sodG9rZW5zT3JDb250ZW50cywgZnVuY3Rpb24odG9rZW5PckNvbnRlbnQpIHtcclxuICAgIGNvbnN0IGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzID0gW107XHJcblxyXG4gICAgY29tbWVudFR5cGUgPSB0b2tlbmlzZUNvbW1lbnRUb2tlbnMoY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIHRva2VuT3JDb250ZW50LCBjb21tZW50VHlwZSk7XHJcblxyXG4gICAgY29uc3QgdG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyA9IGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzOyAvLy9cclxuXHJcbiAgICByZXR1cm4gdG9rZW5zT3JSZW1haW5pbmdDb250ZW50cztcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICB0b2tlbmlzZVxyXG59O1xyXG5cclxuZnVuY3Rpb24gdG9rZW5pc2VDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCwgY29tbWVudFR5cGUpIHtcclxuICBjb25zdCB0b2tlbk9yQ29udGVudENvbnRlbnQgPSBpc1Rva2VuT3JDb250ZW50Q29udGVudCh0b2tlbk9yQ29udGVudCksXHJcbiAgICAgICAgdG9rZW5PckNvbnRlbnRTdHJpbmdMaXRlcmFsVG9rZW4gPSBpc1Rva2VuT3JDb250ZW50U3RyaW5nTGl0ZXJhbFRva2VuKHRva2VuT3JDb250ZW50KSxcclxuICAgICAgICBjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSA9IGlzQ29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUoY29tbWVudFR5cGUpLFxyXG4gICAgICAgIGNvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUgPSBpc0NvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUoY29tbWVudFR5cGUpO1xyXG5cclxuICBpZiAoZmFsc2UpIHtcclxuXHJcbiAgfSBlbHNlIGlmICh0b2tlbk9yQ29udGVudENvbnRlbnQpIHtcclxuICAgIGNvbnN0IGNvbnRlbnQgPSB0b2tlbk9yQ29udGVudDsgLy8vXHJcblxyXG4gICAgaWYgKGZhbHNlKSB7XHJcblxyXG4gICAgfSBlbHNlIGlmIChjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSkge1xyXG4gICAgICBjb25zdCBtaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4gPSBNaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKG1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbik7XHJcbiAgICB9IGVsc2UgaWYgKGNvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUpIHtcclxuICAgICAgY29uc3QgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IEVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgIGlmIChlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpIHtcclxuICAgICAgICBjb21tZW50VHlwZSA9IHRva2VuaXNlRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gobWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gU3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpLFxyXG4gICAgICAgICAgICBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgIGlmICgoc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSAmJiAoc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpKSB7XHJcbiAgICAgICAgaWYgKGZhbHNlKSB7XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAoc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA8IHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbikge1xyXG4gICAgICAgICAgY29tbWVudFR5cGUgPSB0b2tlbmlzZVN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KTtcclxuICAgICAgICB9IGVsc2UgaWYgKHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA8IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24pIHtcclxuICAgICAgICAgIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSBpZiAoc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSB7XHJcbiAgICAgICAgY29tbWVudFR5cGUgPSB0b2tlbmlzZVN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KTtcclxuICAgICAgfSBlbHNlIGlmIChzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICAgIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCByZW1haW5pbmdDb250ZW50ID0gY29udGVudDsgLy8vXHJcblxyXG4gICAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gocmVtYWluaW5nQ29udGVudCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9IGVsc2UgaWYgKHRva2VuT3JDb250ZW50U3RyaW5nTGl0ZXJhbFRva2VuKSB7XHJcbiAgICBjb25zdCBzdHJpbmdMaXRlcmFsVG9rZW4gPSB0b2tlbk9yQ29udGVudDsgIC8vL1xyXG5cclxuICAgIGlmIChmYWxzZSkge1xyXG5cclxuICAgIH0gZWxzZSBpZiAoY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUpIHtcclxuICAgICAgY29uc3QgbWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLmZyb21TdHJpbmdMaXRlcmFsVG9rZW4oc3RyaW5nTGl0ZXJhbFRva2VuKTtcclxuXHJcbiAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gobWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuKTtcclxuICAgIH0gZWxzZSBpZiAoY29tbWVudFR5cGVNdWx0aUxpbmVDb21tZW50VHlwZSkge1xyXG4gICAgICBjb25zdCBjb250ZW50ID0gc3RyaW5nTGl0ZXJhbFRva2VuLmdldENvbnRlbnQoKSxcclxuICAgICAgICAgICAgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IEVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgIGlmIChlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpIHtcclxuICAgICAgICBjb21tZW50VHlwZSA9IHRva2VuaXNlRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gobWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKHN0cmluZ0xpdGVyYWxUb2tlbik7XHJcbiAgICB9XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbnN0IHRva2VuID0gdG9rZW5PckNvbnRlbnQsIC8vL1xyXG4gICAgICAgICAgdG9rZW5FbmRPZkxpbmVUb2tlbiA9IHRva2VuLmlzRW5kT2ZMaW5lVG9rZW4oKTtcclxuXHJcbiAgICBpZiAodG9rZW5FbmRPZkxpbmVUb2tlbikge1xyXG4gICAgICBjb25zdCBjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSA9IGlzQ29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUoY29tbWVudFR5cGUpO1xyXG5cclxuICAgICAgaWYgKGNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlKSB7XHJcbiAgICAgICAgY29tbWVudFR5cGUgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaCh0b2tlbik7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzVG9rZW5PckNvbnRlbnRDb250ZW50KHRva2VuT3JDb250ZW50KSB7XHJcbiAgY29uc3QgdG9rZW5PckNvbnRlbnRTdHJpbmcgPSAodHlwZW9mIHRva2VuT3JDb250ZW50ID09PSAnc3RyaW5nJyksXHJcbiAgICAgICAgdG9rZW5PckNvbnRlbnRDb250ZW50ID0gdG9rZW5PckNvbnRlbnRTdHJpbmc7IC8vL1xyXG5cclxuICByZXR1cm4gdG9rZW5PckNvbnRlbnRDb250ZW50O1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc1Rva2VuT3JDb250ZW50U3RyaW5nTGl0ZXJhbFRva2VuKHRva2VuT3JDb250ZW50KSB7XHJcbiAgbGV0IHRva2VuT3JDb250ZW50U3RyaW5nTGl0ZXJhbFRva2VuID0gZmFsc2U7XHJcblxyXG4gIGNvbnN0IHRva2VuT3JDb250ZW50U3RyaW5nID0gKHR5cGVvZiB0b2tlbk9yQ29udGVudCA9PT0gJ3N0cmluZycpLFxyXG4gICAgICAgIHRva2VuT3JDb250ZW50Q29udGVudCA9IHRva2VuT3JDb250ZW50U3RyaW5nLCAvLy9cclxuICAgICAgICB0b2tlbk9yQ29udGVudFRva2VuID0gIXRva2VuT3JDb250ZW50Q29udGVudDtcclxuXHJcbiAgaWYgKHRva2VuT3JDb250ZW50VG9rZW4pIHtcclxuICAgIGNvbnN0IHRva2VuID0gdG9rZW5PckNvbnRlbnQsXHJcbiAgICAgICAgICB0b2tlblN0cmluZ0xpdGVyYWxUb2tlbiA9ICh0b2tlbiBpbnN0YW5jZW9mIFN0cmluZ0xpdGVyYWxUb2tlbik7XHJcblxyXG4gICAgdG9rZW5PckNvbnRlbnRTdHJpbmdMaXRlcmFsVG9rZW4gPSB0b2tlblN0cmluZ0xpdGVyYWxUb2tlbjsgLy8vXHJcbiAgfVxyXG5cclxuICByZXR1cm4gdG9rZW5PckNvbnRlbnRTdHJpbmdMaXRlcmFsVG9rZW47XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzQ29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUoY29tbWVudFR5cGUpIHtcclxuICBsZXQgY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUgPSBmYWxzZTtcclxuXHJcbiAgaWYgKGNvbW1lbnRUeXBlICE9PSBudWxsKSB7XHJcbiAgICBjb25zdCBjb21tZW50VHlwZUluY2x1ZGVzU2luZ2xlTGluZVR5cGUgPSBjb21tZW50VHlwZS5pbmNsdWRlcyhzaW5nbGVMaW5lVHlwZSk7XHJcblxyXG4gICAgY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUgPSBjb21tZW50VHlwZUluY2x1ZGVzU2luZ2xlTGluZVR5cGU7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzQ29tbWVudFR5cGVNdWx0aUxpbmVDb21tZW50VHlwZShjb21tZW50VHlwZSkge1xyXG4gIGxldCBjb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlID0gZmFsc2U7XHJcblxyXG4gIGlmIChjb21tZW50VHlwZSAhPT0gbnVsbCkge1xyXG4gICAgY29uc3QgY29tbWVudFR5cGVJbmNsdWRlc011bHRpTGluZVR5cGUgPSBjb21tZW50VHlwZS5pbmNsdWRlcyhtdWx0aUxpbmVUeXBlKTtcclxuXHJcbiAgICBjb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlID0gY29tbWVudFR5cGVJbmNsdWRlc011bHRpTGluZVR5cGU7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGVNdWx0aUxpbmVDb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9rZW5pc2VTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCkge1xyXG4gIGxldCBjb21tZW50VHlwZSA9IHNpbmdsZUxpbmVDb21tZW50VHlwZTsgIC8vL1xyXG5cclxuICBjb21tZW50VHlwZSA9IHRva2VuaXNlU3RhcnRPZkNvbW1lbnRUb2tlbihTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQsIGNvbW1lbnRUeXBlKTtcclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5mdW5jdGlvbiB0b2tlbmlzZVN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpIHtcclxuICBsZXQgY29tbWVudFR5cGUgPSBtdWx0aUxpbmVDb21tZW50VHlwZTsgLy8vXHJcblxyXG4gIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VTdGFydE9mQ29tbWVudFRva2VuKFN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSk7XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9rZW5pc2VFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCkge1xyXG4gIGxldCBjb21tZW50VHlwZSA9IG51bGw7XHJcblxyXG4gIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VFbmRPZkNvbW1lbnRUb2tlbihFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiwgTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSk7XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9rZW5pc2VTdGFydE9mQ29tbWVudFRva2VuKFN0YXJ0T2ZDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSkge1xyXG4gIGNvbnN0IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gU3RhcnRPZkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IFN0YXJ0T2ZDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpLCAgLy8vXHJcbiAgICAgICAgY29udGVudExlbmd0aCA9IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLmdldENvbnRlbnRMZW5ndGgoKSxcclxuICAgICAgICBsZWZ0ID0gcG9zaXRpb24sICAvLy9cclxuICAgICAgICByaWdodCA9IHBvc2l0aW9uICsgY29udGVudExlbmd0aCxcclxuICAgICAgICBsZWZ0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIGxlZnQpLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKHJpZ2h0KSxcclxuICAgICAgICBsZWZ0Q29udGVudExlbmd0aCA9IGxlZnRDb250ZW50Lmxlbmd0aCxcclxuICAgICAgICByaWdodENvbnRlbnRMZW5ndGggPSByaWdodENvbnRlbnQubGVuZ3RoO1xyXG5cclxuICBpZiAobGVmdENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCByZW1haW5pbmdDb250ZW50ID0gbGVmdENvbnRlbnQ7IC8vL1xyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gocmVtYWluaW5nQ29udGVudCk7XHJcbiAgfVxyXG5cclxuICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuKTtcclxuXHJcbiAgaWYgKHJpZ2h0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHRva2VuT3JDb250ZW50ID0gcmlnaHRDb250ZW50OyAgLy8vXHJcblxyXG4gICAgY29tbWVudFR5cGUgPSB0b2tlbmlzZUNvbW1lbnRUb2tlbnMoY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIHRva2VuT3JDb250ZW50LCBjb21tZW50VHlwZSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRva2VuaXNlRW5kT2ZDb21tZW50VG9rZW4oRW5kT2ZDb21tZW50VG9rZW4sIE1pZGRsZU9mQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCwgY29tbWVudFR5cGUpIHtcclxuICBjb25zdCBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IEVuZE9mQ29tbWVudFRva2VuLmZyb21XaXRoaW5Db250ZW50KGNvbnRlbnQpLFxyXG4gICAgICAgIHBvc2l0aW9uID0gRW5kT2ZDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpLFxyXG4gICAgICAgIGNvbnRlbnRMZW5ndGggPSBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5nZXRDb250ZW50TGVuZ3RoKCksXHJcbiAgICAgICAgbGVmdCA9IHBvc2l0aW9uLFxyXG4gICAgICAgIHJpZ2h0ID0gcG9zaXRpb24gKyBjb250ZW50TGVuZ3RoLFxyXG4gICAgICAgIGxlZnRDb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcoMCwgbGVmdCksXHJcbiAgICAgICAgcmlnaHRDb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcocmlnaHQpLFxyXG4gICAgICAgIGxlZnRDb250ZW50TGVuZ3RoID0gbGVmdENvbnRlbnQubGVuZ3RoLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudExlbmd0aCA9IHJpZ2h0Q29udGVudC5sZW5ndGg7XHJcblxyXG4gIGlmIChsZWZ0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IGNvbnRlbnQgPSBsZWZ0Q29udGVudCwgIC8vL1xyXG4gICAgICAgICAgbWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBNaWRkbGVPZkNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuKTtcclxuICB9XHJcblxyXG4gIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2goZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4pO1xyXG5cclxuICBpZiAocmlnaHRDb250ZW50TGVuZ3RoID4gMCkge1xyXG4gICAgY29uc3QgdG9rZW5PckNvbnRlbnQgPSByaWdodENvbnRlbnQ7IC8vL1xyXG5cclxuICAgIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCwgY29tbWVudFR5cGUpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcbiJdfQ==