'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var EndOfCommentToken = require('../token/nonSignificant/comment/endOf'),
    StartOfCommentToken = require('../token/nonSignificant/comment/startOf'),
    MiddleOfCommentToken = require('../token/nonSignificant/comment/middleOf');

var CommentTokens = function () {
  function CommentTokens() {
    _classCallCheck(this, CommentTokens);
  }

  _createClass(CommentTokens, null, [{
    key: 'pass',
    value: function pass(tokensOrContents, line, context) {
      var content = tokensOrContents.pop(),
          commentToken = void 0,
          commentTokenLength = void 0,
          previousLineInComment = context.isPreviousLineInComment(),
          inComment = previousLineInComment === true;

      while (content !== '') {
        var contentLength = content.length;

        if (inComment) {
          var endOfCommentTokenPositionWithinContent = EndOfCommentToken.positionWithinContent(content);

          if (endOfCommentTokenPositionWithinContent === 0) {
            inComment = false;

            commentToken = EndOfCommentToken.fromWithinContentAndLine(content, line);

            commentTokenLength = commentToken.getLength();
          } else {
            var middleOfCommentTokenLength = minimumBarMinusOne(endOfCommentTokenPositionWithinContent, contentLength);

            commentToken = MiddleOfCommentToken.fromContentAndLine(content, line, middleOfCommentTokenLength);

            commentTokenLength = middleOfCommentTokenLength;
          }

          var previousCommentToken = tokensOrContents.pop();

          commentToken = previousCommentToken === undefined ? commentToken : previousCommentToken.merge(commentToken);

          tokensOrContents.push(commentToken);

          content = content.substring(commentTokenLength);
        } else {
          var startOfCommentTokenPositionWithinContent = StartOfCommentToken.positionWithinContent(content);

          if (startOfCommentTokenPositionWithinContent === 0) {
            inComment = true;

            commentToken = StartOfCommentToken.fromWithinContentAndLine(content, line);

            commentTokenLength = commentToken.getLength();

            tokensOrContents.push(commentToken);

            content = content.substring(commentTokenLength);
          } else {
            contentLength = minimumBarMinusOne(startOfCommentTokenPositionWithinContent, contentLength);

            var remainingContent = content.substring(contentLength);

            content = content.substring(0, contentLength);

            tokensOrContents.push(content);

            content = remainingContent;
          }
        }
      }

      previousLineInComment = inComment; ///

      context.setPreviousLineInComment(previousLineInComment);

      return inComment;
    }
  }]);

  return CommentTokens;
}();

module.exports = CommentTokens;

function minimumBarMinusOne() {
  var values = Array.prototype.slice.call(arguments),
      minimumBarMinusOne = values.reduce(function (minimumBarMinusOne, value) {
    if (value > -1) {
      minimumBarMinusOne = minimumBarMinusOne !== null ? Math.min(minimumBarMinusOne, value) : value;
    }

    return minimumBarMinusOne;
  }, null);

  return minimumBarMinusOne;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9jb21tb24vdG9rZW5zL2NvbW1lbnQuanMiXSwibmFtZXMiOlsiRW5kT2ZDb21tZW50VG9rZW4iLCJyZXF1aXJlIiwiU3RhcnRPZkNvbW1lbnRUb2tlbiIsIk1pZGRsZU9mQ29tbWVudFRva2VuIiwiQ29tbWVudFRva2VucyIsInRva2Vuc09yQ29udGVudHMiLCJsaW5lIiwiY29udGV4dCIsImNvbnRlbnQiLCJwb3AiLCJjb21tZW50VG9rZW4iLCJjb21tZW50VG9rZW5MZW5ndGgiLCJwcmV2aW91c0xpbmVJbkNvbW1lbnQiLCJpc1ByZXZpb3VzTGluZUluQ29tbWVudCIsImluQ29tbWVudCIsImNvbnRlbnRMZW5ndGgiLCJsZW5ndGgiLCJlbmRPZkNvbW1lbnRUb2tlblBvc2l0aW9uV2l0aGluQ29udGVudCIsInBvc2l0aW9uV2l0aGluQ29udGVudCIsImZyb21XaXRoaW5Db250ZW50QW5kTGluZSIsImdldExlbmd0aCIsIm1pZGRsZU9mQ29tbWVudFRva2VuTGVuZ3RoIiwibWluaW11bUJhck1pbnVzT25lIiwiZnJvbUNvbnRlbnRBbmRMaW5lIiwicHJldmlvdXNDb21tZW50VG9rZW4iLCJ1bmRlZmluZWQiLCJtZXJnZSIsInB1c2giLCJzdWJzdHJpbmciLCJzdGFydE9mQ29tbWVudFRva2VuUG9zaXRpb25XaXRoaW5Db250ZW50IiwicmVtYWluaW5nQ29udGVudCIsInNldFByZXZpb3VzTGluZUluQ29tbWVudCIsIm1vZHVsZSIsImV4cG9ydHMiLCJ2YWx1ZXMiLCJBcnJheSIsInByb3RvdHlwZSIsInNsaWNlIiwiY2FsbCIsImFyZ3VtZW50cyIsInJlZHVjZSIsInZhbHVlIiwiTWF0aCIsIm1pbiJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQUVBLElBQU1BLG9CQUFvQkMsUUFBUSx1Q0FBUixDQUExQjtBQUFBLElBQ01DLHNCQUFzQkQsUUFBUSx5Q0FBUixDQUQ1QjtBQUFBLElBRU1FLHVCQUF1QkYsUUFBUSwwQ0FBUixDQUY3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ekI7QUFHRDs7QUFFRCxXQUFPbkIsa0JBQVA7QUFDRCxHQVJvQixFQVFsQixJQVJrQixDQUQzQjs7QUFXQSxTQUFPQSxrQkFBUDtBQUNEIiwiZmlsZSI6ImNvbW1lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG5jb25zdCBFbmRPZkNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvZW5kT2YnKSxcclxuICAgICAgU3RhcnRPZkNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvc3RhcnRPZicpLFxyXG4gICAgICBNaWRkbGVPZkNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbWlkZGxlT2YnKTtcclxuXHJcbmNsYXNzIENvbW1lbnRUb2tlbnMge1xyXG4gIHN0YXRpYyBwYXNzKHRva2Vuc09yQ29udGVudHMsIGxpbmUsIGNvbnRleHQpIHtcclxuICAgIGxldCBjb250ZW50ID0gdG9rZW5zT3JDb250ZW50cy5wb3AoKSxcclxuICAgICAgICBjb21tZW50VG9rZW4sXHJcbiAgICAgICAgY29tbWVudFRva2VuTGVuZ3RoLFxyXG4gICAgICAgIHByZXZpb3VzTGluZUluQ29tbWVudCA9IGNvbnRleHQuaXNQcmV2aW91c0xpbmVJbkNvbW1lbnQoKSxcclxuICAgICAgICBpbkNvbW1lbnQgPSAocHJldmlvdXNMaW5lSW5Db21tZW50ID09PSB0cnVlKTtcclxuXHJcbiAgICB3aGlsZSAoY29udGVudCAhPT0gJycpIHtcclxuICAgICAgbGV0IGNvbnRlbnRMZW5ndGggPSBjb250ZW50Lmxlbmd0aDtcclxuXHJcbiAgICAgIGlmIChpbkNvbW1lbnQpIHtcclxuICAgICAgICBjb25zdCBlbmRPZkNvbW1lbnRUb2tlblBvc2l0aW9uV2l0aGluQ29udGVudCA9IEVuZE9mQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgICAgaWYgKGVuZE9mQ29tbWVudFRva2VuUG9zaXRpb25XaXRoaW5Db250ZW50ID09PSAwKSB7XHJcbiAgICAgICAgICBpbkNvbW1lbnQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICBjb21tZW50VG9rZW4gPSBFbmRPZkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudEFuZExpbmUoY29udGVudCwgbGluZSk7XHJcblxyXG4gICAgICAgICAgY29tbWVudFRva2VuTGVuZ3RoID0gY29tbWVudFRva2VuLmdldExlbmd0aCgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zdCBtaWRkbGVPZkNvbW1lbnRUb2tlbkxlbmd0aCA9IG1pbmltdW1CYXJNaW51c09uZShlbmRPZkNvbW1lbnRUb2tlblBvc2l0aW9uV2l0aGluQ29udGVudCwgY29udGVudExlbmd0aCk7XHJcblxyXG4gICAgICAgICAgY29tbWVudFRva2VuID0gTWlkZGxlT2ZDb21tZW50VG9rZW4uZnJvbUNvbnRlbnRBbmRMaW5lKGNvbnRlbnQsIGxpbmUsIG1pZGRsZU9mQ29tbWVudFRva2VuTGVuZ3RoKTtcclxuXHJcbiAgICAgICAgICBjb21tZW50VG9rZW5MZW5ndGggPSBtaWRkbGVPZkNvbW1lbnRUb2tlbkxlbmd0aDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHByZXZpb3VzQ29tbWVudFRva2VuID0gdG9rZW5zT3JDb250ZW50cy5wb3AoKTtcclxuXHJcbiAgICAgICAgY29tbWVudFRva2VuID0gKHByZXZpb3VzQ29tbWVudFRva2VuID09PSB1bmRlZmluZWQpID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50VG9rZW4gOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNDb21tZW50VG9rZW4ubWVyZ2UoY29tbWVudFRva2VuKTtcclxuXHJcbiAgICAgICAgdG9rZW5zT3JDb250ZW50cy5wdXNoKGNvbW1lbnRUb2tlbik7XHJcblxyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZyhjb21tZW50VG9rZW5MZW5ndGgpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHN0YXJ0T2ZDb21tZW50VG9rZW5Qb3NpdGlvbldpdGhpbkNvbnRlbnQgPSBTdGFydE9mQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgICAgaWYgKHN0YXJ0T2ZDb21tZW50VG9rZW5Qb3NpdGlvbldpdGhpbkNvbnRlbnQgPT09IDApIHtcclxuICAgICAgICAgIGluQ29tbWVudCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgY29tbWVudFRva2VuID0gU3RhcnRPZkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudEFuZExpbmUoY29udGVudCwgbGluZSk7XHJcblxyXG4gICAgICAgICAgY29tbWVudFRva2VuTGVuZ3RoID0gY29tbWVudFRva2VuLmdldExlbmd0aCgpO1xyXG5cclxuICAgICAgICAgIHRva2Vuc09yQ29udGVudHMucHVzaChjb21tZW50VG9rZW4pO1xyXG5cclxuICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZyhjb21tZW50VG9rZW5MZW5ndGgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb250ZW50TGVuZ3RoID0gbWluaW11bUJhck1pbnVzT25lKHN0YXJ0T2ZDb21tZW50VG9rZW5Qb3NpdGlvbldpdGhpbkNvbnRlbnQsIGNvbnRlbnRMZW5ndGgpO1xyXG5cclxuICAgICAgICAgIGNvbnN0IHJlbWFpbmluZ0NvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZyhjb250ZW50TGVuZ3RoKTtcclxuXHJcbiAgICAgICAgICBjb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcoMCwgY29udGVudExlbmd0aCk7XHJcblxyXG4gICAgICAgICAgdG9rZW5zT3JDb250ZW50cy5wdXNoKGNvbnRlbnQpO1xyXG5cclxuICAgICAgICAgIGNvbnRlbnQgPSByZW1haW5pbmdDb250ZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByZXZpb3VzTGluZUluQ29tbWVudCA9IGluQ29tbWVudDsgIC8vL1xyXG5cclxuICAgIGNvbnRleHQuc2V0UHJldmlvdXNMaW5lSW5Db21tZW50KHByZXZpb3VzTGluZUluQ29tbWVudCk7XHJcblxyXG4gICAgcmV0dXJuIGluQ29tbWVudDtcclxuICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gQ29tbWVudFRva2VucztcclxuXHJcbmZ1bmN0aW9uIG1pbmltdW1CYXJNaW51c09uZSgpIHtcclxuICBjb25zdCB2YWx1ZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpLFxyXG4gICAgICAgIG1pbmltdW1CYXJNaW51c09uZSA9IHZhbHVlcy5yZWR1Y2UoZnVuY3Rpb24obWluaW11bUJhck1pbnVzT25lLCB2YWx1ZSkge1xyXG4gICAgICAgICAgaWYgKHZhbHVlID4gLTEpIHtcclxuICAgICAgICAgICAgbWluaW11bUJhck1pbnVzT25lID0gKG1pbmltdW1CYXJNaW51c09uZSAhPT0gbnVsbCkgP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgubWluKG1pbmltdW1CYXJNaW51c09uZSwgdmFsdWUpIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlO1xyXG4gICAgICAgICAgfVxyXG4gIFxyXG4gICAgICAgICAgcmV0dXJuIG1pbmltdW1CYXJNaW51c09uZTtcclxuICAgICAgICB9LCBudWxsKTtcclxuXHJcbiAgcmV0dXJuIG1pbmltdW1CYXJNaW51c09uZTtcclxufVxyXG4iXX0=