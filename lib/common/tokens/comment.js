'use strict';

var types = require('../types'),
    tokens = require('../tokens'),
    EndOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/endOf'),
    StartOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/startOf'),
    MiddleOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/middleOf'),
    HyperlinkMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/hyperlink'),
    StartOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/startOf'),
    MiddleOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/middleOf'),
    HyperlinkSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/hyperlink');

var multiLineCommentType = types.multiLineCommentType,
    singleLineCommentType = types.singleLineCommentType,
    processByCallback = tokens.processByCallback;


function process(tokensOrContents, commentType) {
  processByCallback(tokensOrContents, function (tokenOrContent) {
    var commentTokensOrRemainingContents = [];

    commentType = processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);

    var tokensOrRemainingContents = commentTokensOrRemainingContents; ///

    return tokensOrRemainingContents;
  });

  return commentType;
}

module.exports = {
  process: process
};

function processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType) {
  var tokenOrContentContent = typeof tokenOrContent === 'string';

  if (tokenOrContentContent) {
    var content = tokenOrContent; ///

    if (false) {} else if (commentType === singleLineCommentType) {
      var hyperlinkSingleLineCommentTokenPosition = HyperlinkSingleLineCommentToken.positionWithinContent(content);

      if (hyperlinkSingleLineCommentTokenPosition > -1) {
        commentType = processHyperlinkSingleLineCommentToken(commentTokensOrRemainingContents, content);
      } else {
        var middleOfSingleLineCommentToken = MiddleOfSingleLineCommentToken.fromContent(content);

        commentTokensOrRemainingContents.push(middleOfSingleLineCommentToken);
      }
    } else if (commentType === multiLineCommentType) {
      var hyperlinkMultiLineCommentTokenPosition = HyperlinkMultiLineCommentToken.positionWithinContent(content);

      if (hyperlinkMultiLineCommentTokenPosition > -1) {
        commentType = processHyperlinkMultiLineCommentToken(commentTokensOrRemainingContents, content);
      } else {
        var endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.positionWithinContent(content);

        if (endOfMultiLineCommentTokenPosition > -1) {
          commentType = processEndOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
        } else {
          var middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(content);

          commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
        }
      }
    } else {
      var startOfSingleLineCommentTokenPosition = StartOfSingleLineCommentToken.positionWithinContent(content),
          startOfMultiLineCommentTokenPosition = StartOfMultiLineCommentToken.positionWithinContent(content);

      if (startOfSingleLineCommentTokenPosition > -1 && startOfMultiLineCommentTokenPosition > -1) {
        if (false) {} else if (startOfSingleLineCommentTokenPosition < startOfMultiLineCommentTokenPosition) {
          commentType = processStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content);
        } else if (startOfMultiLineCommentTokenPosition < startOfSingleLineCommentTokenPosition) {
          commentType = processStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
        }
      } else if (startOfSingleLineCommentTokenPosition > -1) {
        commentType = processStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content);
      } else if (startOfMultiLineCommentTokenPosition > -1) {
        commentType = processStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
      } else {
        var remainingContent = content; ///

        commentTokensOrRemainingContents.push(remainingContent);
      }
    }
  } else {
    var token = tokenOrContent,
        ///
    tokenEndOfLineToken = token.isEndOfLineToken();

    if (tokenEndOfLineToken) {
      var commentTypeSingleLineCommentType = commentType === singleLineCommentType;

      if (commentTypeSingleLineCommentType) {
        commentType = null;
      }
    }

    commentTokensOrRemainingContents.push(token);
  }

  return commentType;
}

function processStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = singleLineCommentType; ///

  commentType = processStartOfCommentToken(StartOfSingleLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function processStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = multiLineCommentType; ///

  commentType = processStartOfCommentToken(StartOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function processEndOfMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = null;

  commentType = processEndOfCommentToken(EndOfMultiLineCommentToken, EndOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function processHyperlinkSingleLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = singleLineCommentType; ///

  commentType = processHyperlinkCommentToken(HyperlinkSingleLineCommentToken, MiddleOfSingleLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function processHyperlinkMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = multiLineCommentType; ///

  commentType = processHyperlinkCommentToken(HyperlinkMultiLineCommentToken, MiddleOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function processStartOfCommentToken(StartOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var startOfSingleLineCommentToken = StartOfCommentToken.fromWithinContent(content),
      position = StartOfCommentToken.positionWithinContent(content),
      ///
  contentLength = startOfSingleLineCommentToken.getContentLength(),
      left = position,
      ///
  right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var remainingContent = leftContent; ///

    commentTokensOrRemainingContents.push(remainingContent);
  }

  commentTokensOrRemainingContents.push(startOfSingleLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentType = processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }

  return commentType;
}

function processEndOfCommentToken(EndOfCommentToken, MiddleOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var endOfMultiLineCommentToken = EndOfCommentToken.fromWithinContent(content),
      position = EndOfCommentToken.positionWithinContent(content),
      contentLength = endOfMultiLineCommentToken.getContentLength(),
      left = position,
      right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var _content = leftContent,
        ///
    middleOfMultiLineCommentToken = MiddleOfCommentToken.fromContent(_content);

    commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
  }

  commentTokensOrRemainingContents.push(endOfMultiLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentType = processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }

  return commentType;
}

function processHyperlinkCommentToken(HyperlinkCommentToken, MiddleOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var hyperlinkCommentToken = HyperlinkCommentToken.fromWithinContent(content),
      position = HyperlinkCommentToken.positionWithinContent(content),
      ///
  contentLength = hyperlinkCommentToken.getContentLength(),
      left = position,
      right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var _content2 = leftContent,
        ///
    middleOfCommentToken = MiddleOfCommentToken.fromContent(_content2);

    commentTokensOrRemainingContents.push(middleOfCommentToken);
  }

  commentTokensOrRemainingContents.push(hyperlinkCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentType = processCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }

  return commentType;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9jb21tb24vdG9rZW5zL2NvbW1lbnQuanMiXSwibmFtZXMiOlsidHlwZXMiLCJyZXF1aXJlIiwidG9rZW5zIiwiRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJIeXBlcmxpbmtNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIk1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIkh5cGVybGlua1NpbmdsZUxpbmVDb21tZW50VG9rZW4iLCJtdWx0aUxpbmVDb21tZW50VHlwZSIsInNpbmdsZUxpbmVDb21tZW50VHlwZSIsInByb2Nlc3NCeUNhbGxiYWNrIiwicHJvY2VzcyIsInRva2Vuc09yQ29udGVudHMiLCJjb21tZW50VHlwZSIsInRva2VuT3JDb250ZW50IiwiY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMiLCJwcm9jZXNzQ29tbWVudFRva2VucyIsInRva2Vuc09yUmVtYWluaW5nQ29udGVudHMiLCJtb2R1bGUiLCJleHBvcnRzIiwidG9rZW5PckNvbnRlbnRDb250ZW50IiwiY29udGVudCIsImh5cGVybGlua1NpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInBvc2l0aW9uV2l0aGluQ29udGVudCIsInByb2Nlc3NIeXBlcmxpbmtTaW5nbGVMaW5lQ29tbWVudFRva2VuIiwibWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuIiwiZnJvbUNvbnRlbnQiLCJwdXNoIiwiaHlwZXJsaW5rTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24iLCJwcm9jZXNzSHlwZXJsaW5rTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInByb2Nlc3NFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsIm1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwic3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInByb2Nlc3NTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsInByb2Nlc3NTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwicmVtYWluaW5nQ29udGVudCIsInRva2VuIiwidG9rZW5FbmRPZkxpbmVUb2tlbiIsImlzRW5kT2ZMaW5lVG9rZW4iLCJjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSIsInByb2Nlc3NTdGFydE9mQ29tbWVudFRva2VuIiwicHJvY2Vzc0VuZE9mQ29tbWVudFRva2VuIiwicHJvY2Vzc0h5cGVybGlua0NvbW1lbnRUb2tlbiIsIlN0YXJ0T2ZDb21tZW50VG9rZW4iLCJzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsImZyb21XaXRoaW5Db250ZW50IiwicG9zaXRpb24iLCJjb250ZW50TGVuZ3RoIiwiZ2V0Q29udGVudExlbmd0aCIsImxlZnQiLCJyaWdodCIsImxlZnRDb250ZW50Iiwic3Vic3RyaW5nIiwicmlnaHRDb250ZW50IiwibGVmdENvbnRlbnRMZW5ndGgiLCJsZW5ndGgiLCJyaWdodENvbnRlbnRMZW5ndGgiLCJFbmRPZkNvbW1lbnRUb2tlbiIsIk1pZGRsZU9mQ29tbWVudFRva2VuIiwiZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJIeXBlcmxpbmtDb21tZW50VG9rZW4iLCJoeXBlcmxpbmtDb21tZW50VG9rZW4iLCJtaWRkbGVPZkNvbW1lbnRUb2tlbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsUUFBUUMsUUFBUSxVQUFSLENBQWQ7QUFBQSxJQUNNQyxTQUFTRCxRQUFRLFdBQVIsQ0FEZjtBQUFBLElBRU1FLDZCQUE2QkYsUUFBUSxpREFBUixDQUZuQztBQUFBLElBR01HLCtCQUErQkgsUUFBUSxtREFB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QUFBQSxNQU1NSSxlQUFlbEMsUUFBUWlDLFNBQVIsQ0FBa0JGLEtBQWxCLENBTnJCO0FBQUEsTUFPTUksb0JBQW9CSCxZQUFZSSxNQVB0QztBQUFBLE1BUU1DLHFCQUFxQkgsYUFBYUUsTUFSeEM7O0FBVUEsTUFBSUQsb0JBQW9CLENBQXhCLEVBQTJCO0FBQ3pCLFFBQU1uQyxZQUFVZ0MsV0FBaEI7QUFBQSxRQUE4QjtBQUN4QlcsMkJBQXVCSixxQkFBcUJsQyxXQUFyQixDQUFpQ0wsU0FBakMsQ0FEN0I7O0FBR0FOLHFDQUFpQ1ksSUFBakMsQ0FBc0NxQyxvQkFBdEM7QUFDRDs7QUFFRGpELG1DQUFpQ1ksSUFBakMsQ0FBc0NvQyxxQkFBdEM7O0FBRUEsTUFBSUwscUJBQXFCLENBQXpCLEVBQTRCO0FBQzFCLFFBQU01QyxpQkFBaUJ5QyxZQUF2QixDQUQwQixDQUNZOztBQUV0QzFDLGtCQUFjRyxxQkFBcUJELGdDQUFyQixFQUF1REQsY0FBdkQsRUFBdUVELFdBQXZFLENBQWQ7QUFDRDs7QUFFRCxTQUFPQSxXQUFQO0FBQ0QiLCJmaWxlIjoiY29tbWVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbmNvbnN0IHR5cGVzID0gcmVxdWlyZSgnLi4vdHlwZXMnKSxcclxuICAgICAgdG9rZW5zID0gcmVxdWlyZSgnLi4vdG9rZW5zJyksXHJcbiAgICAgIEVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9tdWx0aUxpbmUvZW5kT2YnKSxcclxuICAgICAgU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbXVsdGlMaW5lL3N0YXJ0T2YnKSxcclxuICAgICAgTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L211bHRpTGluZS9taWRkbGVPZicpLFxyXG4gICAgICBIeXBlcmxpbmtNdWx0aUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L211bHRpTGluZS9oeXBlcmxpbmsnKSxcclxuICAgICAgU3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L3NpbmdsZUxpbmUvc3RhcnRPZicpLFxyXG4gICAgICBNaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L3NpbmdsZUxpbmUvbWlkZGxlT2YnKSxcclxuICAgICAgSHlwZXJsaW5rU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvc2luZ2xlTGluZS9oeXBlcmxpbmsnKTtcclxuXHJcbmNvbnN0IHsgbXVsdGlMaW5lQ29tbWVudFR5cGUsIHNpbmdsZUxpbmVDb21tZW50VHlwZSB9ID0gdHlwZXMsXHJcbiAgICAgIHsgcHJvY2Vzc0J5Q2FsbGJhY2sgfSA9IHRva2VucztcclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3ModG9rZW5zT3JDb250ZW50cywgY29tbWVudFR5cGUpIHtcclxuICBwcm9jZXNzQnlDYWxsYmFjayh0b2tlbnNPckNvbnRlbnRzLCBmdW5jdGlvbih0b2tlbk9yQ29udGVudCkge1xyXG4gICAgY29uc3QgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMgPSBbXTtcclxuXHJcbiAgICBjb21tZW50VHlwZSA9IHByb2Nlc3NDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCwgY29tbWVudFR5cGUpO1xyXG5cclxuICAgIGNvbnN0IHRva2Vuc09yUmVtYWluaW5nQ29udGVudHMgPSBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50czsgLy8vXHJcblxyXG4gICAgcmV0dXJuIHRva2Vuc09yUmVtYWluaW5nQ29udGVudHM7XHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgcHJvY2VzczogcHJvY2Vzc1xyXG59O1xyXG5cclxuZnVuY3Rpb24gcHJvY2Vzc0NvbW1lbnRUb2tlbnMoY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIHRva2VuT3JDb250ZW50LCBjb21tZW50VHlwZSkge1xyXG4gIGNvbnN0IHRva2VuT3JDb250ZW50Q29udGVudCA9ICh0eXBlb2YgdG9rZW5PckNvbnRlbnQgPT09ICdzdHJpbmcnKTtcclxuXHJcbiAgaWYgKHRva2VuT3JDb250ZW50Q29udGVudCkge1xyXG4gICAgY29uc3QgY29udGVudCA9IHRva2VuT3JDb250ZW50OyAvLy9cclxuXHJcbiAgICBpZiAoZmFsc2UpIHtcclxuXHJcbiAgICB9IGVsc2UgaWYgKGNvbW1lbnRUeXBlID09PSBzaW5nbGVMaW5lQ29tbWVudFR5cGUpIHtcclxuICAgICAgY29uc3QgaHlwZXJsaW5rU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gSHlwZXJsaW5rU2luZ2xlTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICBpZiAoaHlwZXJsaW5rU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpIHtcclxuICAgICAgICBjb21tZW50VHlwZSA9IHByb2Nlc3NIeXBlcmxpbmtTaW5nbGVMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IG1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IE1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKGNvbW1lbnRUeXBlID09PSBtdWx0aUxpbmVDb21tZW50VHlwZSkge1xyXG4gICAgICBjb25zdCBoeXBlcmxpbmtNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IEh5cGVybGlua011bHRpTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICBpZiAoaHlwZXJsaW5rTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICAgIGNvbW1lbnRUeXBlID0gcHJvY2Vzc0h5cGVybGlua011bHRpTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IEVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgICAgaWYgKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICAgICAgY29tbWVudFR5cGUgPSBwcm9jZXNzRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zdCBtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IE1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuLmZyb21Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgICAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gobWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3Qgc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IFN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICAgICAgc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICBpZiAoKHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkgJiYgKHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSkge1xyXG4gICAgICAgIGlmIChmYWxzZSkge1xyXG5cclxuICAgICAgICB9IGVsc2UgaWYgKHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPCBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24pIHtcclxuICAgICAgICAgIGNvbW1lbnRUeXBlID0gcHJvY2Vzc1N0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KTtcclxuICAgICAgICB9IGVsc2UgaWYgKHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA8IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24pIHtcclxuICAgICAgICAgIGNvbW1lbnRUeXBlID0gcHJvY2Vzc1N0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpIHtcclxuICAgICAgICBjb21tZW50VHlwZSA9IHByb2Nlc3NTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpIHtcclxuICAgICAgICBjb21tZW50VHlwZSA9IHByb2Nlc3NTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCByZW1haW5pbmdDb250ZW50ID0gY29udGVudDsgLy8vXHJcblxyXG4gICAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gocmVtYWluaW5nQ29udGVudCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9IGVsc2Uge1xyXG4gICAgY29uc3QgdG9rZW4gPSB0b2tlbk9yQ29udGVudCwgLy8vXHJcbiAgICAgICAgICB0b2tlbkVuZE9mTGluZVRva2VuID0gdG9rZW4uaXNFbmRPZkxpbmVUb2tlbigpO1xyXG5cclxuICAgIGlmICh0b2tlbkVuZE9mTGluZVRva2VuKSB7XHJcbiAgICAgIGNvbnN0IGNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlID0gKGNvbW1lbnRUeXBlID09PSBzaW5nbGVMaW5lQ29tbWVudFR5cGUpO1xyXG5cclxuICAgICAgaWYgKGNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlKSB7XHJcbiAgICAgICAgY29tbWVudFR5cGUgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaCh0b2tlbik7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3NTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCkge1xyXG4gIGxldCBjb21tZW50VHlwZSA9IHNpbmdsZUxpbmVDb21tZW50VHlwZTsgIC8vL1xyXG5cclxuICBjb21tZW50VHlwZSA9IHByb2Nlc3NTdGFydE9mQ29tbWVudFRva2VuKFN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCwgY29tbWVudFR5cGUpO1xyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3NTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KSB7XHJcbiAgbGV0IGNvbW1lbnRUeXBlID0gbXVsdGlMaW5lQ29tbWVudFR5cGU7IC8vL1xyXG5cclxuICBjb21tZW50VHlwZSA9IHByb2Nlc3NTdGFydE9mQ29tbWVudFRva2VuKFN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSk7XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gcHJvY2Vzc0VuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KSB7XHJcbiAgbGV0IGNvbW1lbnRUeXBlID0gbnVsbDtcclxuXHJcbiAgY29tbWVudFR5cGUgPSBwcm9jZXNzRW5kT2ZDb21tZW50VG9rZW4oRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4sIEVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCwgY29tbWVudFR5cGUpO1xyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3NIeXBlcmxpbmtTaW5nbGVMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KSB7XHJcbiAgbGV0IGNvbW1lbnRUeXBlID0gc2luZ2xlTGluZUNvbW1lbnRUeXBlOyAgLy8vXHJcblxyXG4gIGNvbW1lbnRUeXBlID0gcHJvY2Vzc0h5cGVybGlua0NvbW1lbnRUb2tlbihIeXBlcmxpbmtTaW5nbGVMaW5lQ29tbWVudFRva2VuLCBNaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSk7XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gcHJvY2Vzc0h5cGVybGlua011bHRpTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCkge1xyXG4gIGxldCBjb21tZW50VHlwZSA9IG11bHRpTGluZUNvbW1lbnRUeXBlOyAgLy8vXHJcblxyXG4gIGNvbW1lbnRUeXBlID0gcHJvY2Vzc0h5cGVybGlua0NvbW1lbnRUb2tlbihIeXBlcmxpbmtNdWx0aUxpbmVDb21tZW50VG9rZW4sIE1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCwgY29tbWVudFR5cGUpO1xyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3NTdGFydE9mQ29tbWVudFRva2VuKFN0YXJ0T2ZDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSkge1xyXG4gIGNvbnN0IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gU3RhcnRPZkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IFN0YXJ0T2ZDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpLCAgLy8vXHJcbiAgICAgICAgY29udGVudExlbmd0aCA9IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLmdldENvbnRlbnRMZW5ndGgoKSxcclxuICAgICAgICBsZWZ0ID0gcG9zaXRpb24sICAvLy9cclxuICAgICAgICByaWdodCA9IHBvc2l0aW9uICsgY29udGVudExlbmd0aCxcclxuICAgICAgICBsZWZ0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIGxlZnQpLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKHJpZ2h0KSxcclxuICAgICAgICBsZWZ0Q29udGVudExlbmd0aCA9IGxlZnRDb250ZW50Lmxlbmd0aCxcclxuICAgICAgICByaWdodENvbnRlbnRMZW5ndGggPSByaWdodENvbnRlbnQubGVuZ3RoO1xyXG5cclxuICBpZiAobGVmdENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCByZW1haW5pbmdDb250ZW50ID0gbGVmdENvbnRlbnQ7IC8vL1xyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gocmVtYWluaW5nQ29udGVudCk7XHJcbiAgfVxyXG5cclxuICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuKTtcclxuXHJcbiAgaWYgKHJpZ2h0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHRva2VuT3JDb250ZW50ID0gcmlnaHRDb250ZW50OyAgLy8vXHJcblxyXG4gICAgY29tbWVudFR5cGUgPSBwcm9jZXNzQ29tbWVudFRva2Vucyhjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgdG9rZW5PckNvbnRlbnQsIGNvbW1lbnRUeXBlKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gcHJvY2Vzc0VuZE9mQ29tbWVudFRva2VuKEVuZE9mQ29tbWVudFRva2VuLCBNaWRkbGVPZkNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQsIGNvbW1lbnRUeXBlKSB7XHJcbiAgY29uc3QgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBFbmRPZkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IEVuZE9mQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBjb250ZW50TGVuZ3RoID0gZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZ2V0Q29udGVudExlbmd0aCgpLFxyXG4gICAgICAgIGxlZnQgPSBwb3NpdGlvbixcclxuICAgICAgICByaWdodCA9IHBvc2l0aW9uICsgY29udGVudExlbmd0aCxcclxuICAgICAgICBsZWZ0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIGxlZnQpLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKHJpZ2h0KSxcclxuICAgICAgICBsZWZ0Q29udGVudExlbmd0aCA9IGxlZnRDb250ZW50Lmxlbmd0aCxcclxuICAgICAgICByaWdodENvbnRlbnRMZW5ndGggPSByaWdodENvbnRlbnQubGVuZ3RoO1xyXG5cclxuICBpZiAobGVmdENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCBjb250ZW50ID0gbGVmdENvbnRlbnQsICAvLy9cclxuICAgICAgICAgIG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbik7XHJcbiAgfVxyXG5cclxuICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKTtcclxuXHJcbiAgaWYgKHJpZ2h0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHRva2VuT3JDb250ZW50ID0gcmlnaHRDb250ZW50OyAvLy9cclxuXHJcbiAgICBjb21tZW50VHlwZSA9IHByb2Nlc3NDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCwgY29tbWVudFR5cGUpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwcm9jZXNzSHlwZXJsaW5rQ29tbWVudFRva2VuKEh5cGVybGlua0NvbW1lbnRUb2tlbiwgTWlkZGxlT2ZDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSkge1xyXG4gIGNvbnN0IGh5cGVybGlua0NvbW1lbnRUb2tlbiA9IEh5cGVybGlua0NvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IEh5cGVybGlua0NvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCksICAvLy9cclxuICAgICAgICBjb250ZW50TGVuZ3RoID0gaHlwZXJsaW5rQ29tbWVudFRva2VuLmdldENvbnRlbnRMZW5ndGgoKSxcclxuICAgICAgICBsZWZ0ID0gcG9zaXRpb24sXHJcbiAgICAgICAgcmlnaHQgPSBwb3NpdGlvbiArIGNvbnRlbnRMZW5ndGgsXHJcbiAgICAgICAgbGVmdENvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZygwLCBsZWZ0KSxcclxuICAgICAgICByaWdodENvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZyhyaWdodCksXHJcbiAgICAgICAgbGVmdENvbnRlbnRMZW5ndGggPSBsZWZ0Q29udGVudC5sZW5ndGgsXHJcbiAgICAgICAgcmlnaHRDb250ZW50TGVuZ3RoID0gcmlnaHRDb250ZW50Lmxlbmd0aDtcclxuXHJcbiAgaWYgKGxlZnRDb250ZW50TGVuZ3RoID4gMCkge1xyXG4gICAgY29uc3QgY29udGVudCA9IGxlZnRDb250ZW50LCAgLy8vXHJcbiAgICAgICAgICBtaWRkbGVPZkNvbW1lbnRUb2tlbiA9IE1pZGRsZU9mQ29tbWVudFRva2VuLmZyb21Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gobWlkZGxlT2ZDb21tZW50VG9rZW4pO1xyXG4gIH1cclxuXHJcbiAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChoeXBlcmxpbmtDb21tZW50VG9rZW4pO1xyXG5cclxuICBpZiAocmlnaHRDb250ZW50TGVuZ3RoID4gMCkge1xyXG4gICAgY29uc3QgdG9rZW5PckNvbnRlbnQgPSByaWdodENvbnRlbnQ7ICAvLy9cclxuXHJcbiAgICBjb21tZW50VHlwZSA9IHByb2Nlc3NDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCwgY29tbWVudFR5cGUpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcbiJdfQ==