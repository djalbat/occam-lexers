'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var EndOfCommentToken = require('../token/nonSignificant/comment/endOf'),
    StartOfCommentToken = require('../token/nonSignificant/comment/startOf'),
    MiddleOfCommentToken = require('../token/nonSignificant/comment/middleOf');

var CommentTokens = function () {
  function CommentTokens() {
    _classCallCheck(this, CommentTokens);
  }

  _createClass(CommentTokens, null, [{
    key: 'pass',
    value: function pass(tokensOrContents, line, configuration) {
      var content = tokensOrContents.pop(),
          commentToken = void 0,
          commentTokenLength = void 0,
          previousLineInComment = configuration.isPreviousLineInComment(),
          inComment = previousLineInComment === true;

      while (content !== '') {
        var contentLength = content.length;

        if (inComment) {
          var endOfCommentTokenPositionWithinContent = EndOfCommentToken.positionWithinContent(content);

          if (endOfCommentTokenPositionWithinContent === 0) {
            inComment = false;

            commentToken = EndOfCommentToken.fromWithinContentAndLine(content, line);

            commentTokenLength = commentToken.getLength();
          } else {
            var middleOfCommentTokenLength = minimumBarMinusOne(endOfCommentTokenPositionWithinContent, contentLength);

            commentToken = MiddleOfCommentToken.fromContentAndLine(content, line, middleOfCommentTokenLength);

            commentTokenLength = middleOfCommentTokenLength;
          }

          var previousCommentToken = tokensOrContents.pop();

          commentToken = previousCommentToken === undefined ? commentToken : previousCommentToken.merge(commentToken);

          tokensOrContents.push(commentToken);

          content = content.substring(commentTokenLength);
        } else {
          var startOfCommentTokenPositionWithinContent = StartOfCommentToken.positionWithinContent(content);

          if (startOfCommentTokenPositionWithinContent === 0) {
            inComment = true;

            commentToken = StartOfCommentToken.fromWithinContentAndLine(content, line);

            commentTokenLength = commentToken.getLength();

            tokensOrContents.push(commentToken);

            content = content.substring(commentTokenLength);
          } else {
            contentLength = minimumBarMinusOne(startOfCommentTokenPositionWithinContent, contentLength);

            var remainingContent = content.substring(contentLength);

            content = content.substring(0, contentLength);

            tokensOrContents.push(content);

            content = remainingContent;
          }
        }
      }

      previousLineInComment = inComment; ///

      configuration.setPreviousLineInComment(previousLineInComment);

      return inComment;
    }
  }]);

  return CommentTokens;
}();

module.exports = CommentTokens;

function minimumBarMinusOne() {
  var values = Array.prototype.slice.call(arguments),
      minimumBarMinusOne = values.reduce(function (minimumBarMinusOne, value) {
    if (value > -1) {
      minimumBarMinusOne = minimumBarMinusOne !== null ? Math.min(minimumBarMinusOne, value) : value;
    }

    return minimumBarMinusOne;
  }, null);

  return minimumBarMinusOne;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9jb21tb24vdG9rZW5zL2NvbW1lbnQuanMiXSwibmFtZXMiOlsiRW5kT2ZDb21tZW50VG9rZW4iLCJyZXF1aXJlIiwiU3RhcnRPZkNvbW1lbnRUb2tlbiIsIk1pZGRsZU9mQ29tbWVudFRva2VuIiwiQ29tbWVudFRva2VucyIsInRva2Vuc09yQ29udGVudHMiLCJsaW5lIiwiY29uZmlndXJhdGlvbiIsImNvbnRlbnQiLCJwb3AiLCJjb21tZW50VG9rZW4iLCJjb21tZW50VG9rZW5MZW5ndGgiLCJwcmV2aW91c0xpbmVJbkNvbW1lbnQiLCJpc1ByZXZpb3VzTGluZUluQ29tbWVudCIsImluQ29tbWVudCIsImNvbnRlbnRMZW5ndGgiLCJsZW5ndGgiLCJlbmRPZkNvbW1lbnRUb2tlblBvc2l0aW9uV2l0aGluQ29udGVudCIsInBvc2l0aW9uV2l0aGluQ29udGVudCIsImZyb21XaXRoaW5Db250ZW50QW5kTGluZSIsImdldExlbmd0aCIsIm1pZGRsZU9mQ29tbWVudFRva2VuTGVuZ3RoIiwibWluaW11bUJhck1pbnVzT25lIiwiZnJvbUNvbnRlbnRBbmRMaW5lIiwicHJldmlvdXNDb21tZW50VG9rZW4iLCJ1bmRlZmluZWQiLCJtZXJnZSIsInB1c2giLCJzdWJzdHJpbmciLCJzdGFydE9mQ29tbWVudFRva2VuUG9zaXRpb25XaXRoaW5Db250ZW50IiwicmVtYWluaW5nQ29udGVudCIsInNldFByZXZpb3VzTGluZUluQ29tbWVudCIsIm1vZHVsZSIsImV4cG9ydHMiLCJ2YWx1ZXMiLCJBcnJheSIsInByb3RvdHlwZSIsInNsaWNlIiwiY2FsbCIsImFyZ3VtZW50cyIsInJlZHVjZSIsInZhbHVlIiwiTWF0aCIsIm1pbiJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQUVBLElBQU1BLG9CQUFvQkMsUUFBUSx1Q0FBUixDQUExQjtBQUFBLElBQ01DLHNCQUFzQkQsUUFBUSx5Q0FBUixDQUQ1QjtBQUFBLElBRU1FLHVCQUF1QkYsUUFBUSwwQ0FB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RUlBLEtBRnpCO0FBR0Q7O0FBRUQsV0FBT25CLGtCQUFQO0FBQ0QsR0FSb0IsRUFRbEIsSUFSa0IsQ0FEM0I7O0FBV0EsU0FBT0Esa0JBQVA7QUFDRCIsImZpbGUiOiJjb21tZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuY29uc3QgRW5kT2ZDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L2VuZE9mJyksXHJcbiAgICAgIFN0YXJ0T2ZDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L3N0YXJ0T2YnKSxcclxuICAgICAgTWlkZGxlT2ZDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L21pZGRsZU9mJyk7XHJcblxyXG5jbGFzcyBDb21tZW50VG9rZW5zIHtcclxuICBzdGF0aWMgcGFzcyh0b2tlbnNPckNvbnRlbnRzLCBsaW5lLCBjb25maWd1cmF0aW9uKSB7XHJcbiAgICBsZXQgY29udGVudCA9IHRva2Vuc09yQ29udGVudHMucG9wKCksXHJcbiAgICAgICAgY29tbWVudFRva2VuLFxyXG4gICAgICAgIGNvbW1lbnRUb2tlbkxlbmd0aCxcclxuICAgICAgICBwcmV2aW91c0xpbmVJbkNvbW1lbnQgPSBjb25maWd1cmF0aW9uLmlzUHJldmlvdXNMaW5lSW5Db21tZW50KCksXHJcbiAgICAgICAgaW5Db21tZW50ID0gKHByZXZpb3VzTGluZUluQ29tbWVudCA9PT0gdHJ1ZSk7XHJcblxyXG4gICAgd2hpbGUgKGNvbnRlbnQgIT09ICcnKSB7XHJcbiAgICAgIGxldCBjb250ZW50TGVuZ3RoID0gY29udGVudC5sZW5ndGg7XHJcblxyXG4gICAgICBpZiAoaW5Db21tZW50KSB7XHJcbiAgICAgICAgY29uc3QgZW5kT2ZDb21tZW50VG9rZW5Qb3NpdGlvbldpdGhpbkNvbnRlbnQgPSBFbmRPZkNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICAgIGlmIChlbmRPZkNvbW1lbnRUb2tlblBvc2l0aW9uV2l0aGluQ29udGVudCA9PT0gMCkge1xyXG4gICAgICAgICAgaW5Db21tZW50ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgY29tbWVudFRva2VuID0gRW5kT2ZDb21tZW50VG9rZW4uZnJvbVdpdGhpbkNvbnRlbnRBbmRMaW5lKGNvbnRlbnQsIGxpbmUpO1xyXG5cclxuICAgICAgICAgIGNvbW1lbnRUb2tlbkxlbmd0aCA9IGNvbW1lbnRUb2tlbi5nZXRMZW5ndGgoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY29uc3QgbWlkZGxlT2ZDb21tZW50VG9rZW5MZW5ndGggPSBtaW5pbXVtQmFyTWludXNPbmUoZW5kT2ZDb21tZW50VG9rZW5Qb3NpdGlvbldpdGhpbkNvbnRlbnQsIGNvbnRlbnRMZW5ndGgpO1xyXG5cclxuICAgICAgICAgIGNvbW1lbnRUb2tlbiA9IE1pZGRsZU9mQ29tbWVudFRva2VuLmZyb21Db250ZW50QW5kTGluZShjb250ZW50LCBsaW5lLCBtaWRkbGVPZkNvbW1lbnRUb2tlbkxlbmd0aCk7XHJcblxyXG4gICAgICAgICAgY29tbWVudFRva2VuTGVuZ3RoID0gbWlkZGxlT2ZDb21tZW50VG9rZW5MZW5ndGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBwcmV2aW91c0NvbW1lbnRUb2tlbiA9IHRva2Vuc09yQ29udGVudHMucG9wKCk7XHJcblxyXG4gICAgICAgIGNvbW1lbnRUb2tlbiA9IChwcmV2aW91c0NvbW1lbnRUb2tlbiA9PT0gdW5kZWZpbmVkKSA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudFRva2VuIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpb3VzQ29tbWVudFRva2VuLm1lcmdlKGNvbW1lbnRUb2tlbik7XHJcblxyXG4gICAgICAgIHRva2Vuc09yQ29udGVudHMucHVzaChjb21tZW50VG9rZW4pO1xyXG5cclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcoY29tbWVudFRva2VuTGVuZ3RoKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBzdGFydE9mQ29tbWVudFRva2VuUG9zaXRpb25XaXRoaW5Db250ZW50ID0gU3RhcnRPZkNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgICAgIGlmIChzdGFydE9mQ29tbWVudFRva2VuUG9zaXRpb25XaXRoaW5Db250ZW50ID09PSAwKSB7XHJcbiAgICAgICAgICBpbkNvbW1lbnQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgIGNvbW1lbnRUb2tlbiA9IFN0YXJ0T2ZDb21tZW50VG9rZW4uZnJvbVdpdGhpbkNvbnRlbnRBbmRMaW5lKGNvbnRlbnQsIGxpbmUpO1xyXG5cclxuICAgICAgICAgIGNvbW1lbnRUb2tlbkxlbmd0aCA9IGNvbW1lbnRUb2tlbi5nZXRMZW5ndGgoKTtcclxuXHJcbiAgICAgICAgICB0b2tlbnNPckNvbnRlbnRzLnB1c2goY29tbWVudFRva2VuKTtcclxuXHJcbiAgICAgICAgICBjb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcoY29tbWVudFRva2VuTGVuZ3RoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY29udGVudExlbmd0aCA9IG1pbmltdW1CYXJNaW51c09uZShzdGFydE9mQ29tbWVudFRva2VuUG9zaXRpb25XaXRoaW5Db250ZW50LCBjb250ZW50TGVuZ3RoKTtcclxuXHJcbiAgICAgICAgICBjb25zdCByZW1haW5pbmdDb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcoY29udGVudExlbmd0aCk7XHJcblxyXG4gICAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIGNvbnRlbnRMZW5ndGgpO1xyXG5cclxuICAgICAgICAgIHRva2Vuc09yQ29udGVudHMucHVzaChjb250ZW50KTtcclxuXHJcbiAgICAgICAgICBjb250ZW50ID0gcmVtYWluaW5nQ29udGVudDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcmV2aW91c0xpbmVJbkNvbW1lbnQgPSBpbkNvbW1lbnQ7ICAvLy9cclxuXHJcbiAgICBjb25maWd1cmF0aW9uLnNldFByZXZpb3VzTGluZUluQ29tbWVudChwcmV2aW91c0xpbmVJbkNvbW1lbnQpO1xyXG5cclxuICAgIHJldHVybiBpbkNvbW1lbnQ7XHJcbiAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IENvbW1lbnRUb2tlbnM7XHJcblxyXG5mdW5jdGlvbiBtaW5pbXVtQmFyTWludXNPbmUoKSB7XHJcbiAgY29uc3QgdmFsdWVzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSxcclxuICAgICAgICBtaW5pbXVtQmFyTWludXNPbmUgPSB2YWx1ZXMucmVkdWNlKGZ1bmN0aW9uKG1pbmltdW1CYXJNaW51c09uZSwgdmFsdWUpIHtcclxuICAgICAgICAgIGlmICh2YWx1ZSA+IC0xKSB7XHJcbiAgICAgICAgICAgIG1pbmltdW1CYXJNaW51c09uZSA9IChtaW5pbXVtQmFyTWludXNPbmUgIT09IG51bGwpID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLm1pbihtaW5pbXVtQmFyTWludXNPbmUsIHZhbHVlKSA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTtcclxuICAgICAgICAgIH1cclxuICBcclxuICAgICAgICAgIHJldHVybiBtaW5pbXVtQmFyTWludXNPbmU7XHJcbiAgICAgICAgfSwgbnVsbCk7XHJcblxyXG4gIHJldHVybiBtaW5pbXVtQmFyTWludXNPbmU7XHJcbn1cclxuIl19