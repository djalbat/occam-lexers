'use strict';

var types = require('../types'),
    tokens = require('../tokens'),
    EndOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/endOf'),
    StartOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/startOf'),
    MiddleOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/middleOf'),
    StartOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/startOf'),
    MiddleOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/middleOf');

var stringLiteralType = types.stringLiteralType,
    multiLineType = types.multiLineType,
    singleLineType = types.singleLineType,
    multiLineCommentType = types.multiLineCommentType,
    singleLineCommentType = types.singleLineCommentType,
    tokeniseByCallback = tokens.tokeniseByCallback;


function tokenise(tokensOrContents) {
  var commentType = null;

  tokeniseByCallback(tokensOrContents, function (tokenOrContent) {
    var commentTokensOrRemainingContents = [];

    commentType = tokeniseTokenOrContent(tokenOrContent, commentTokensOrRemainingContents, commentType);

    var tokensOrRemainingContents = commentTokensOrRemainingContents; ///

    return tokensOrRemainingContents;
  });
}

module.exports = {
  tokenise: tokenise
};

function tokeniseTokenOrContent(tokenOrContent, commentTokensOrRemainingContents, commentType) {
  var tokenOrContentContent = isTokenOrContentContent(tokenOrContent);

  if (tokenOrContentContent) {
    var content = tokenOrContent; ///

    commentType = tokeniseContent(content, commentTokensOrRemainingContents, commentType);
  } else {
    var token = tokenOrContent,
        ///
    tokenStringLiteralToken = isTokenStringLiteralToken(token);

    if (false) {
      ///
    } else if (tokenStringLiteralToken) {
      var stringLiteralToken = token; ///

      commentType = tokeniseStringLiteralToken(stringLiteralToken, commentTokensOrRemainingContents, commentType);
    } else {
      commentType = tokeniseToken(token, commentTokensOrRemainingContents, commentType);
    }
  }

  return commentType;
}

function isTokenOrContentContent(tokenOrContent) {
  var tokenOrContentString = typeof tokenOrContent === 'string',
      tokenOrContentContent = tokenOrContentString; ///

  return tokenOrContentContent;
}

function isTokenStringLiteralToken(token) {
  var type = token.getType(),
      typeStringLiteralType = type === stringLiteralType,
      tokenStringLiteralToken = typeStringLiteralType; ///

  return tokenStringLiteralToken;
}

function isCommentTypeSingleLineCommentType(commentType) {
  var commentTypeSingleLineCommentType = false;

  if (commentType !== null) {
    var commentTypeIncludesSingleLineType = commentType.includes(singleLineType);

    commentTypeSingleLineCommentType = commentTypeIncludesSingleLineType;
  }

  return commentTypeSingleLineCommentType;
}

function isCommentTypeMultiLineCommentType(commentType) {
  var commentTypeMultiLineCommentType = false;

  if (commentType !== null) {
    var commentTypeIncludesMultiLineType = commentType.includes(multiLineType);

    commentTypeMultiLineCommentType = commentTypeIncludesMultiLineType;
  }

  return commentTypeMultiLineCommentType;
}

function tokeniseToken(token, commentTokensOrRemainingContents, commentType) {
  var tokenEndOfLineToken = token.isEndOfLineToken();

  if (tokenEndOfLineToken) {
    var commentTypeSingleLineCommentType = isCommentTypeSingleLineCommentType(commentType);

    if (commentTypeSingleLineCommentType) {
      commentType = null;
    }
  }

  commentTokensOrRemainingContents.push(token);

  return commentType;
}

function tokeniseContent(content, commentTokensOrRemainingContents, commentType) {
  var commentTypeSingleLineCommentType = isCommentTypeSingleLineCommentType(commentType),
      commentTypeMultiLineCommentType = isCommentTypeMultiLineCommentType(commentType);

  if (false) {} else if (commentTypeSingleLineCommentType) {
    var middleOfSingleLineCommentToken = MiddleOfSingleLineCommentToken.fromContent(content);

    commentTokensOrRemainingContents.push(middleOfSingleLineCommentToken);
  } else if (commentTypeMultiLineCommentType) {
    var endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.positionWithinContent(content);

    if (endOfMultiLineCommentTokenPosition > -1) {
      commentType = tokeniseEndOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
    } else {
      var middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(content);

      commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
    }
  } else {
    var startOfSingleLineCommentTokenPosition = StartOfSingleLineCommentToken.positionWithinContent(content),
        startOfMultiLineCommentTokenPosition = StartOfMultiLineCommentToken.positionWithinContent(content);

    if (startOfSingleLineCommentTokenPosition > -1 && startOfMultiLineCommentTokenPosition > -1) {
      if (false) {} else if (startOfSingleLineCommentTokenPosition < startOfMultiLineCommentTokenPosition) {
        commentType = tokeniseStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content);
      } else if (startOfMultiLineCommentTokenPosition < startOfSingleLineCommentTokenPosition) {
        commentType = tokeniseStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
      }
    } else if (startOfSingleLineCommentTokenPosition > -1) {
      commentType = tokeniseStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content);
    } else if (startOfMultiLineCommentTokenPosition > -1) {
      commentType = tokeniseStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
    } else {
      var remainingContent = content; ///

      commentTokensOrRemainingContents.push(remainingContent);
    }
  }

  return commentType;
}

function tokeniseStringLiteralToken(stringLiteralToken, commentTokensOrRemainingContents, commentType) {
  var commentTypeSingleLineCommentType = isCommentTypeSingleLineCommentType(commentType),
      commentTypeMultiLineCommentType = isCommentTypeMultiLineCommentType(commentType);

  if (false) {} else if (commentTypeSingleLineCommentType) {
    var middleOfSingleLineCommentToken = MiddleOfSingleLineCommentToken.fromStringLiteralToken(stringLiteralToken);

    commentTokensOrRemainingContents.push(middleOfSingleLineCommentToken);
  } else if (commentTypeMultiLineCommentType) {
    var content = stringLiteralToken.getContent(),
        endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.positionWithinContent(content);

    if (endOfMultiLineCommentTokenPosition > -1) {
      commentType = tokeniseEndOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
    } else {
      var middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(content);

      commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
    }
  } else {
    commentTokensOrRemainingContents.push(stringLiteralToken);
  }

  return commentType;
}

function tokeniseStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = singleLineCommentType; ///

  commentType = tokeniseStartOfCommentToken(StartOfSingleLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function tokeniseStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = multiLineCommentType; ///

  commentType = tokeniseStartOfCommentToken(StartOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function tokeniseEndOfMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = null;

  commentType = tokeniseEndOfCommentToken(EndOfMultiLineCommentToken, MiddleOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function tokeniseStartOfCommentToken(StartOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var startOfSingleLineCommentToken = StartOfCommentToken.fromWithinContent(content),
      position = StartOfCommentToken.positionWithinContent(content),
      ///
  contentLength = startOfSingleLineCommentToken.getContentLength(),
      left = position,
      ///
  right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var remainingContent = leftContent; ///

    commentTokensOrRemainingContents.push(remainingContent);
  }

  commentTokensOrRemainingContents.push(startOfSingleLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentType = tokeniseTokenOrContent(tokenOrContent, commentTokensOrRemainingContents, commentType);
  }

  return commentType;
}

function tokeniseEndOfCommentToken(EndOfCommentToken, MiddleOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var endOfMultiLineCommentToken = EndOfCommentToken.fromWithinContent(content),
      position = EndOfCommentToken.positionWithinContent(content),
      contentLength = endOfMultiLineCommentToken.getContentLength(),
      left = position,
      right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var _content = leftContent,
        ///
    middleOfMultiLineCommentToken = MiddleOfCommentToken.fromContent(_content);

    commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
  }

  commentTokensOrRemainingContents.push(endOfMultiLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentType = tokeniseTokenOrContent(tokenOrContent, commentTokensOrRemainingContents, commentType);
  }

  return commentType;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9jb21tb24vdG9rZW5zL2NvbW1lbnQuanMiXSwibmFtZXMiOlsidHlwZXMiLCJyZXF1aXJlIiwidG9rZW5zIiwiRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIk1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsInN0cmluZ0xpdGVyYWxUeXBlIiwibXVsdGlMaW5lVHlwZSIsInNpbmdsZUxpbmVUeXBlIiwibXVsdGlMaW5lQ29tbWVudFR5cGUiLCJzaW5nbGVMaW5lQ29tbWVudFR5cGUiLCJ0b2tlbmlzZUJ5Q2FsbGJhY2siLCJ0b2tlbmlzZSIsInRva2Vuc09yQ29udGVudHMiLCJjb21tZW50VHlwZSIsInRva2VuT3JDb250ZW50IiwiY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMiLCJ0b2tlbmlzZVRva2VuT3JDb250ZW50IiwidG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyIsIm1vZHVsZSIsImV4cG9ydHMiLCJ0b2tlbk9yQ29udGVudENvbnRlbnQiLCJpc1Rva2VuT3JDb250ZW50Q29udGVudCIsImNvbnRlbnQiLCJ0b2tlbmlzZUNvbnRlbnQiLCJ0b2tlbiIsInRva2VuU3RyaW5nTGl0ZXJhbFRva2VuIiwiaXNUb2tlblN0cmluZ0xpdGVyYWxUb2tlbiIsInN0cmluZ0xpdGVyYWxUb2tlbiIsInRva2VuaXNlU3RyaW5nTGl0ZXJhbFRva2VuIiwidG9rZW5pc2VUb2tlbiIsInRva2VuT3JDb250ZW50U3RyaW5nIiwidHlwZSIsImdldFR5cGUiLCJ0eXBlU3RyaW5nTGl0ZXJhbFR5cGUiLCJpc0NvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlIiwiY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUiLCJjb21tZW50VHlwZUluY2x1ZGVzU2luZ2xlTGluZVR5cGUiLCJpbmNsdWRlcyIsImlzQ29tbWVudFR5cGVNdWx0aUxpbmVDb21tZW50VHlwZSIsImNvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUiLCJjb21tZW50VHlwZUluY2x1ZGVzTXVsdGlMaW5lVHlwZSIsInRva2VuRW5kT2ZMaW5lVG9rZW4iLCJpc0VuZE9mTGluZVRva2VuIiwicHVzaCIsIm1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsImZyb21Db250ZW50IiwiZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInBvc2l0aW9uV2l0aGluQ29udGVudCIsInRva2VuaXNlRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsInN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24iLCJzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24iLCJ0b2tlbmlzZVN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuIiwidG9rZW5pc2VTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwicmVtYWluaW5nQ29udGVudCIsImZyb21TdHJpbmdMaXRlcmFsVG9rZW4iLCJnZXRDb250ZW50IiwidG9rZW5pc2VTdGFydE9mQ29tbWVudFRva2VuIiwidG9rZW5pc2VFbmRPZkNvbW1lbnRUb2tlbiIsIlN0YXJ0T2ZDb21tZW50VG9rZW4iLCJzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsImZyb21XaXRoaW5Db250ZW50IiwicG9zaXRpb24iLCJjb250ZW50TGVuZ3RoIiwiZ2V0Q29udGVudExlbmd0aCIsImxlZnQiLCJyaWdodCIsImxlZnRDb250ZW50Iiwic3Vic3RyaW5nIiwicmlnaHRDb250ZW50IiwibGVmdENvbnRlbnRMZW5ndGgiLCJsZW5ndGgiLCJyaWdodENvbnRlbnRMZW5ndGgiLCJFbmRPZkNvbW1lbnRUb2tlbiIsIk1pZGRsZU9mQ29tbWVu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O0FBQ0Q7O0FBRURsQyxtQ0FBaUM0QixJQUFqQyxDQUFzQ2dDLDBCQUF0Qzs7QUFFQSxNQUFJSCxxQkFBcUIsQ0FBekIsRUFBNEI7QUFDMUIsUUFBTTFELGlCQUFpQnVELFlBQXZCLENBRDBCLENBQ1c7O0FBRXJDeEQsa0JBQWNHLHVCQUF1QkYsY0FBdkIsRUFBdUNDLGdDQUF2QyxFQUF5RUYsV0FBekUsQ0FBZDtBQUNEOztBQUVELFNBQU9BLFdBQVA7QUFDRCIsImZpbGUiOiJjb21tZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuY29uc3QgdHlwZXMgPSByZXF1aXJlKCcuLi90eXBlcycpLFxyXG4gICAgICB0b2tlbnMgPSByZXF1aXJlKCcuLi90b2tlbnMnKSxcclxuICAgICAgRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L211bHRpTGluZS9lbmRPZicpLFxyXG4gICAgICBTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9tdWx0aUxpbmUvc3RhcnRPZicpLFxyXG4gICAgICBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbXVsdGlMaW5lL21pZGRsZU9mJyksXHJcbiAgICAgIFN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9zaW5nbGVMaW5lL3N0YXJ0T2YnKSxcclxuICAgICAgTWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9zaW5nbGVMaW5lL21pZGRsZU9mJyk7XHJcblxyXG5jb25zdCB7IHN0cmluZ0xpdGVyYWxUeXBlLCBtdWx0aUxpbmVUeXBlLCBzaW5nbGVMaW5lVHlwZSwgbXVsdGlMaW5lQ29tbWVudFR5cGUsIHNpbmdsZUxpbmVDb21tZW50VHlwZSB9ID0gdHlwZXMsXHJcbiAgICAgIHsgdG9rZW5pc2VCeUNhbGxiYWNrIH0gPSB0b2tlbnM7XHJcblxyXG5mdW5jdGlvbiB0b2tlbmlzZSh0b2tlbnNPckNvbnRlbnRzKSB7XHJcbiAgbGV0IGNvbW1lbnRUeXBlID0gbnVsbDtcclxuXHJcbiAgdG9rZW5pc2VCeUNhbGxiYWNrKHRva2Vuc09yQ29udGVudHMsIGZ1bmN0aW9uKHRva2VuT3JDb250ZW50KSB7XHJcbiAgICBjb25zdCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyA9IFtdO1xyXG5cclxuICAgIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VUb2tlbk9yQ29udGVudCh0b2tlbk9yQ29udGVudCwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbW1lbnRUeXBlKTtcclxuXHJcbiAgICBjb25zdCB0b2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzID0gY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHM7IC8vL1xyXG5cclxuICAgIHJldHVybiB0b2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzO1xyXG4gIH0pO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICB0b2tlbmlzZVxyXG59O1xyXG5cclxuZnVuY3Rpb24gdG9rZW5pc2VUb2tlbk9yQ29udGVudCh0b2tlbk9yQ29udGVudCwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbW1lbnRUeXBlKSB7XHJcbiAgY29uc3QgdG9rZW5PckNvbnRlbnRDb250ZW50ID0gaXNUb2tlbk9yQ29udGVudENvbnRlbnQodG9rZW5PckNvbnRlbnQpO1xyXG5cclxuICBpZiAodG9rZW5PckNvbnRlbnRDb250ZW50KSB7XHJcbiAgICBjb25zdCBjb250ZW50ID0gdG9rZW5PckNvbnRlbnQ7IC8vL1xyXG5cclxuICAgIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VDb250ZW50KGNvbnRlbnQsIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb21tZW50VHlwZSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbnN0IHRva2VuID0gdG9rZW5PckNvbnRlbnQsIC8vL1xyXG4gICAgICAgICAgdG9rZW5TdHJpbmdMaXRlcmFsVG9rZW4gPSBpc1Rva2VuU3RyaW5nTGl0ZXJhbFRva2VuKHRva2VuKTtcclxuXHJcbiAgICBpZiAoZmFsc2UpIHtcclxuICAgICAgLy8vXHJcbiAgICB9IGVsc2UgaWYgKHRva2VuU3RyaW5nTGl0ZXJhbFRva2VuKSB7XHJcbiAgICAgIGNvbnN0IHN0cmluZ0xpdGVyYWxUb2tlbiA9IHRva2VuOyAgLy8vXHJcblxyXG4gICAgICBjb21tZW50VHlwZSA9IHRva2VuaXNlU3RyaW5nTGl0ZXJhbFRva2VuKHN0cmluZ0xpdGVyYWxUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbW1lbnRUeXBlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VUb2tlbih0b2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbW1lbnRUeXBlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gaXNUb2tlbk9yQ29udGVudENvbnRlbnQodG9rZW5PckNvbnRlbnQpIHtcclxuICBjb25zdCB0b2tlbk9yQ29udGVudFN0cmluZyA9ICh0eXBlb2YgdG9rZW5PckNvbnRlbnQgPT09ICdzdHJpbmcnKSxcclxuICAgICAgICB0b2tlbk9yQ29udGVudENvbnRlbnQgPSB0b2tlbk9yQ29udGVudFN0cmluZzsgLy8vXHJcblxyXG4gIHJldHVybiB0b2tlbk9yQ29udGVudENvbnRlbnQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzVG9rZW5TdHJpbmdMaXRlcmFsVG9rZW4odG9rZW4pIHtcclxuICBjb25zdCB0eXBlID0gdG9rZW4uZ2V0VHlwZSgpLFxyXG4gICAgICAgIHR5cGVTdHJpbmdMaXRlcmFsVHlwZSA9ICh0eXBlID09PSBzdHJpbmdMaXRlcmFsVHlwZSksXHJcbiAgICAgICAgdG9rZW5TdHJpbmdMaXRlcmFsVG9rZW4gPSB0eXBlU3RyaW5nTGl0ZXJhbFR5cGU7IC8vL1xyXG5cclxuICByZXR1cm4gdG9rZW5TdHJpbmdMaXRlcmFsVG9rZW47XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzQ29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUoY29tbWVudFR5cGUpIHtcclxuICBsZXQgY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUgPSBmYWxzZTtcclxuXHJcbiAgaWYgKGNvbW1lbnRUeXBlICE9PSBudWxsKSB7XHJcbiAgICBjb25zdCBjb21tZW50VHlwZUluY2x1ZGVzU2luZ2xlTGluZVR5cGUgPSBjb21tZW50VHlwZS5pbmNsdWRlcyhzaW5nbGVMaW5lVHlwZSk7XHJcblxyXG4gICAgY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUgPSBjb21tZW50VHlwZUluY2x1ZGVzU2luZ2xlTGluZVR5cGU7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzQ29tbWVudFR5cGVNdWx0aUxpbmVDb21tZW50VHlwZShjb21tZW50VHlwZSkge1xyXG4gIGxldCBjb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlID0gZmFsc2U7XHJcblxyXG4gIGlmIChjb21tZW50VHlwZSAhPT0gbnVsbCkge1xyXG4gICAgY29uc3QgY29tbWVudFR5cGVJbmNsdWRlc011bHRpTGluZVR5cGUgPSBjb21tZW50VHlwZS5pbmNsdWRlcyhtdWx0aUxpbmVUeXBlKTtcclxuXHJcbiAgICBjb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlID0gY29tbWVudFR5cGVJbmNsdWRlc011bHRpTGluZVR5cGU7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGVNdWx0aUxpbmVDb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9rZW5pc2VUb2tlbih0b2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbW1lbnRUeXBlKSB7XHJcbiAgY29uc3QgdG9rZW5FbmRPZkxpbmVUb2tlbiA9IHRva2VuLmlzRW5kT2ZMaW5lVG9rZW4oKTtcclxuXHJcbiAgaWYgKHRva2VuRW5kT2ZMaW5lVG9rZW4pIHtcclxuICAgIGNvbnN0IGNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlID0gaXNDb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZShjb21tZW50VHlwZSk7XHJcblxyXG4gICAgaWYgKGNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlKSB7XHJcbiAgICAgIGNvbW1lbnRUeXBlID0gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2godG9rZW4pO1xyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRva2VuaXNlQ29udGVudChjb250ZW50LCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29tbWVudFR5cGUpIHtcclxuICBjb25zdCBjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSA9IGlzQ29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUoY29tbWVudFR5cGUpLFxyXG4gICAgICAgIGNvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUgPSBpc0NvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUoY29tbWVudFR5cGUpO1xyXG5cclxuICBpZiAoZmFsc2UpIHtcclxuXHJcbiAgfSBlbHNlIGlmIChjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSkge1xyXG4gICAgY29uc3QgbWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLmZyb21Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gobWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuKTtcclxuICB9IGVsc2UgaWYgKGNvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUpIHtcclxuICAgIGNvbnN0IGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgaWYgKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICBjb21tZW50VHlwZSA9IHRva2VuaXNlRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgbWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gobWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zdCBzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gU3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpLFxyXG4gICAgICAgICAgc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgaWYgKChzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpICYmIChzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkpIHtcclxuICAgICAgaWYgKGZhbHNlKSB7XHJcblxyXG4gICAgICB9IGVsc2UgaWYgKHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPCBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24pIHtcclxuICAgICAgICBjb21tZW50VHlwZSA9IHRva2VuaXNlU3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICB9IGVsc2UgaWYgKHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA8IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24pIHtcclxuICAgICAgICBjb21tZW50VHlwZSA9IHRva2VuaXNlU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAoc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSB7XHJcbiAgICAgIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCk7XHJcbiAgICB9IGVsc2UgaWYgKHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSB7XHJcbiAgICAgIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHJlbWFpbmluZ0NvbnRlbnQgPSBjb250ZW50OyAvLy9cclxuXHJcbiAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gocmVtYWluaW5nQ29udGVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRva2VuaXNlU3RyaW5nTGl0ZXJhbFRva2VuKHN0cmluZ0xpdGVyYWxUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbW1lbnRUeXBlKSB7XHJcbiAgY29uc3QgY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUgPSBpc0NvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlKGNvbW1lbnRUeXBlKSxcclxuICAgICAgICBjb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlID0gaXNDb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlKGNvbW1lbnRUeXBlKTtcclxuXHJcbiAgaWYgKGZhbHNlKSB7XHJcblxyXG4gIH0gZWxzZSBpZiAoY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUpIHtcclxuICAgIGNvbnN0IG1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IE1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbi5mcm9tU3RyaW5nTGl0ZXJhbFRva2VuKHN0cmluZ0xpdGVyYWxUb2tlbik7XHJcblxyXG4gICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4pO1xyXG4gIH0gZWxzZSBpZiAoY29tbWVudFR5cGVNdWx0aUxpbmVDb21tZW50VHlwZSkge1xyXG4gICAgY29uc3QgY29udGVudCA9IHN0cmluZ0xpdGVyYWxUb2tlbi5nZXRDb250ZW50KCksXHJcbiAgICAgICAgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IEVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICBpZiAoZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSB7XHJcbiAgICAgIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IE1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuLmZyb21Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbik7XHJcbiAgICB9XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2goc3RyaW5nTGl0ZXJhbFRva2VuKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9rZW5pc2VTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCkge1xyXG4gIGxldCBjb21tZW50VHlwZSA9IHNpbmdsZUxpbmVDb21tZW50VHlwZTsgIC8vL1xyXG5cclxuICBjb21tZW50VHlwZSA9IHRva2VuaXNlU3RhcnRPZkNvbW1lbnRUb2tlbihTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQsIGNvbW1lbnRUeXBlKTtcclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5mdW5jdGlvbiB0b2tlbmlzZVN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpIHtcclxuICBsZXQgY29tbWVudFR5cGUgPSBtdWx0aUxpbmVDb21tZW50VHlwZTsgLy8vXHJcblxyXG4gIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VTdGFydE9mQ29tbWVudFRva2VuKFN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSk7XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9rZW5pc2VFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCkge1xyXG4gIGxldCBjb21tZW50VHlwZSA9IG51bGw7XHJcblxyXG4gIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VFbmRPZkNvbW1lbnRUb2tlbihFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiwgTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSk7XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9rZW5pc2VTdGFydE9mQ29tbWVudFRva2VuKFN0YXJ0T2ZDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSkge1xyXG4gIGNvbnN0IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuID0gU3RhcnRPZkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IFN0YXJ0T2ZDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpLCAgLy8vXHJcbiAgICAgICAgY29udGVudExlbmd0aCA9IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLmdldENvbnRlbnRMZW5ndGgoKSxcclxuICAgICAgICBsZWZ0ID0gcG9zaXRpb24sICAvLy9cclxuICAgICAgICByaWdodCA9IHBvc2l0aW9uICsgY29udGVudExlbmd0aCxcclxuICAgICAgICBsZWZ0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIGxlZnQpLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKHJpZ2h0KSxcclxuICAgICAgICBsZWZ0Q29udGVudExlbmd0aCA9IGxlZnRDb250ZW50Lmxlbmd0aCxcclxuICAgICAgICByaWdodENvbnRlbnRMZW5ndGggPSByaWdodENvbnRlbnQubGVuZ3RoO1xyXG5cclxuICBpZiAobGVmdENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCByZW1haW5pbmdDb250ZW50ID0gbGVmdENvbnRlbnQ7IC8vL1xyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gocmVtYWluaW5nQ29udGVudCk7XHJcbiAgfVxyXG5cclxuICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuKTtcclxuXHJcbiAgaWYgKHJpZ2h0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHRva2VuT3JDb250ZW50ID0gcmlnaHRDb250ZW50OyAgLy8vXHJcblxyXG4gICAgY29tbWVudFR5cGUgPSB0b2tlbmlzZVRva2VuT3JDb250ZW50KHRva2VuT3JDb250ZW50LCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29tbWVudFR5cGUpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5mdW5jdGlvbiB0b2tlbmlzZUVuZE9mQ29tbWVudFRva2VuKEVuZE9mQ29tbWVudFRva2VuLCBNaWRkbGVPZkNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQsIGNvbW1lbnRUeXBlKSB7XHJcbiAgY29uc3QgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBFbmRPZkNvbW1lbnRUb2tlbi5mcm9tV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBwb3NpdGlvbiA9IEVuZE9mQ29tbWVudFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBjb250ZW50TGVuZ3RoID0gZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4uZ2V0Q29udGVudExlbmd0aCgpLFxyXG4gICAgICAgIGxlZnQgPSBwb3NpdGlvbixcclxuICAgICAgICByaWdodCA9IHBvc2l0aW9uICsgY29udGVudExlbmd0aCxcclxuICAgICAgICBsZWZ0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIGxlZnQpLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKHJpZ2h0KSxcclxuICAgICAgICBsZWZ0Q29udGVudExlbmd0aCA9IGxlZnRDb250ZW50Lmxlbmd0aCxcclxuICAgICAgICByaWdodENvbnRlbnRMZW5ndGggPSByaWdodENvbnRlbnQubGVuZ3RoO1xyXG5cclxuICBpZiAobGVmdENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCBjb250ZW50ID0gbGVmdENvbnRlbnQsICAvLy9cclxuICAgICAgICAgIG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gTWlkZGxlT2ZDb21tZW50VG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbik7XHJcbiAgfVxyXG5cclxuICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKTtcclxuXHJcbiAgaWYgKHJpZ2h0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHRva2VuT3JDb250ZW50ID0gcmlnaHRDb250ZW50OyAvLy9cclxuXHJcbiAgICBjb21tZW50VHlwZSA9IHRva2VuaXNlVG9rZW5PckNvbnRlbnQodG9rZW5PckNvbnRlbnQsIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb21tZW50VHlwZSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcblxyXG4iXX0=