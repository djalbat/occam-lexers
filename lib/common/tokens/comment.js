'use strict';

var types = require('../types'),
    tokens = require('../tokens'),
    StringLiteralToken = require('../token/significant/stringLiteral'),
    EndOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/endOf'),
    StartOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/startOf'),
    MiddleOfMultiLineCommentToken = require('../token/nonSignificant/comment/multiLine/middleOf'),
    StartOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/startOf'),
    MiddleOfSingleLineCommentToken = require('../token/nonSignificant/comment/singleLine/middleOf');

var multiLineType = types.multiLineType,
    singleLineType = types.singleLineType,
    multiLineCommentType = types.multiLineCommentType,
    singleLineCommentType = types.singleLineCommentType,
    tokeniseByCallback = tokens.tokeniseByCallback;


function tokenise(tokensOrContents) {
  var commentType = null;

  tokeniseByCallback(tokensOrContents, function (tokenOrContent) {
    var commentTokensOrRemainingContents = [];

    commentType = tokeniseCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);

    var tokensOrRemainingContents = commentTokensOrRemainingContents; ///

    return tokensOrRemainingContents;
  });
}

module.exports = {
  tokenise: tokenise
};

function tokeniseCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType) {
  var tokenOrContentContent = isTokenOrContentContent(tokenOrContent),
      tokenOrContentStringLiteralToken = isTokenOrContentStringLiteralToken(tokenOrContent),
      commentTypeSingleLineCommentType = isCommentTypeSingleLineCommentType(commentType),
      commentTypeMultiLineCommentType = isCommentTypeMultiLineCommentType(commentType);

  if (false) {} else if (tokenOrContentContent) {
    var content = tokenOrContent; ///

    if (false) {} else if (commentTypeSingleLineCommentType) {
      var middleOfSingleLineCommentToken = MiddleOfSingleLineCommentToken.fromContent(content);

      commentTokensOrRemainingContents.push(middleOfSingleLineCommentToken);
    } else if (commentTypeMultiLineCommentType) {
      var endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.positionWithinContent(content);

      if (endOfMultiLineCommentTokenPosition > -1) {
        commentType = tokeniseEndOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
      } else {
        var middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(content);

        commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
      }
    } else {
      var startOfSingleLineCommentTokenPosition = StartOfSingleLineCommentToken.positionWithinContent(content),
          startOfMultiLineCommentTokenPosition = StartOfMultiLineCommentToken.positionWithinContent(content);

      if (startOfSingleLineCommentTokenPosition > -1 && startOfMultiLineCommentTokenPosition > -1) {
        if (false) {} else if (startOfSingleLineCommentTokenPosition < startOfMultiLineCommentTokenPosition) {
          commentType = tokeniseStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content);
        } else if (startOfMultiLineCommentTokenPosition < startOfSingleLineCommentTokenPosition) {
          commentType = tokeniseStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
        }
      } else if (startOfSingleLineCommentTokenPosition > -1) {
        commentType = tokeniseStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content);
      } else if (startOfMultiLineCommentTokenPosition > -1) {
        commentType = tokeniseStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content);
      } else {
        var remainingContent = content; ///

        commentTokensOrRemainingContents.push(remainingContent);
      }
    }
  } else if (tokenOrContentStringLiteralToken) {
    var stringLiteralToken = tokenOrContent; ///

    if (false) {} else if (commentTypeSingleLineCommentType) {
      var _middleOfSingleLineCommentToken = MiddleOfSingleLineCommentToken.fromStringLiteralToken(stringLiteralToken);

      commentTokensOrRemainingContents.push(_middleOfSingleLineCommentToken);
    } else if (commentTypeMultiLineCommentType) {
      var _content = stringLiteralToken.getContent(),
          _endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.positionWithinContent(_content);

      if (_endOfMultiLineCommentTokenPosition > -1) {
        commentType = tokeniseEndOfMultiLineCommentToken(commentTokensOrRemainingContents, _content);
      } else {
        var _middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(_content);

        commentTokensOrRemainingContents.push(_middleOfMultiLineCommentToken);
      }
    } else {
      commentTokensOrRemainingContents.push(stringLiteralToken);
    }
  } else {
    var token = tokenOrContent,
        ///
    tokenEndOfLineToken = token.isEndOfLineToken();

    if (tokenEndOfLineToken) {
      var _commentTypeSingleLineCommentType = isCommentTypeSingleLineCommentType(commentType);

      if (_commentTypeSingleLineCommentType) {
        commentType = null;
      }
    }

    commentTokensOrRemainingContents.push(token);
  }

  return commentType;
}

function isTokenOrContentContent(tokenOrContent) {
  var tokenOrContentString = typeof tokenOrContent === 'string',
      tokenOrContentContent = tokenOrContentString; ///

  return tokenOrContentContent;
}

function isTokenOrContentStringLiteralToken(tokenOrContent) {
  var tokenOrContentStringLiteralToken = false;

  var tokenOrContentString = typeof tokenOrContent === 'string',
      tokenOrContentContent = tokenOrContentString,
      ///
  tokenOrContentToken = !tokenOrContentContent;

  if (tokenOrContentToken) {
    var token = tokenOrContent,
        tokenStringLiteralToken = token instanceof StringLiteralToken;

    tokenOrContentStringLiteralToken = tokenStringLiteralToken; ///
  }

  return tokenOrContentStringLiteralToken;
}

function isCommentTypeSingleLineCommentType(commentType) {
  var commentTypeSingleLineCommentType = false;

  if (commentType !== null) {
    var commentTypeIncludesSingleLineType = commentType.includes(singleLineType);

    commentTypeSingleLineCommentType = commentTypeIncludesSingleLineType;
  }

  return commentTypeSingleLineCommentType;
}

function isCommentTypeMultiLineCommentType(commentType) {
  var commentTypeMultiLineCommentType = false;

  if (commentType !== null) {
    var commentTypeIncludesMultiLineType = commentType.includes(multiLineType);

    commentTypeMultiLineCommentType = commentTypeIncludesMultiLineType;
  }

  return commentTypeMultiLineCommentType;
}

function tokeniseStartOfSingleLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = singleLineCommentType; ///

  commentType = tokeniseStartOfCommentToken(StartOfSingleLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function tokeniseStartOfMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = multiLineCommentType; ///

  commentType = tokeniseStartOfCommentToken(StartOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function tokeniseEndOfMultiLineCommentToken(commentTokensOrRemainingContents, content) {
  var commentType = null;

  commentType = tokeniseEndOfCommentToken(EndOfMultiLineCommentToken, MiddleOfMultiLineCommentToken, commentTokensOrRemainingContents, content, commentType);

  return commentType;
}

function tokeniseStartOfCommentToken(StartOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var startOfSingleLineCommentToken = StartOfCommentToken.fromWithinContent(content),
      position = StartOfCommentToken.positionWithinContent(content),
      ///
  contentLength = startOfSingleLineCommentToken.getContentLength(),
      left = position,
      ///
  right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var remainingContent = leftContent; ///

    commentTokensOrRemainingContents.push(remainingContent);
  }

  commentTokensOrRemainingContents.push(startOfSingleLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentType = tokeniseCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }

  return commentType;
}

function tokeniseEndOfCommentToken(EndOfCommentToken, MiddleOfCommentToken, commentTokensOrRemainingContents, content, commentType) {
  var endOfMultiLineCommentToken = EndOfCommentToken.fromWithinContent(content),
      position = EndOfCommentToken.positionWithinContent(content),
      contentLength = endOfMultiLineCommentToken.getContentLength(),
      left = position,
      right = position + contentLength,
      leftContent = content.substring(0, left),
      rightContent = content.substring(right),
      leftContentLength = leftContent.length,
      rightContentLength = rightContent.length;

  if (leftContentLength > 0) {
    var _content2 = leftContent,
        ///
    middleOfMultiLineCommentToken = MiddleOfCommentToken.fromContent(_content2);

    commentTokensOrRemainingContents.push(middleOfMultiLineCommentToken);
  }

  commentTokensOrRemainingContents.push(endOfMultiLineCommentToken);

  if (rightContentLength > 0) {
    var tokenOrContent = rightContent; ///

    commentType = tokeniseCommentTokens(commentTokensOrRemainingContents, tokenOrContent, commentType);
  }

  return commentType;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9jb21tb24vdG9rZW5zL2NvbW1lbnQuanMiXSwibmFtZXMiOlsidHlwZXMiLCJyZXF1aXJlIiwidG9rZW5zIiwiU3RyaW5nTGl0ZXJhbFRva2VuIiwiRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIk1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIm11bHRpTGluZVR5cGUiLCJzaW5nbGVMaW5lVHlwZSIsIm11bHRpTGluZUNvbW1lbnRUeXBlIiwic2luZ2xlTGluZUNvbW1lbnRUeXBlIiwidG9rZW5pc2VCeUNhbGxiYWNrIiwidG9rZW5pc2UiLCJ0b2tlbnNPckNvbnRlbnRzIiwiY29tbWVudFR5cGUiLCJ0b2tlbk9yQ29udGVudCIsImNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzIiwidG9rZW5pc2VDb21tZW50VG9rZW5zIiwidG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyIsIm1vZHVsZSIsImV4cG9ydHMiLCJ0b2tlbk9yQ29udGVudENvbnRlbnQiLCJpc1Rva2VuT3JDb250ZW50Q29udGVudCIsInRva2VuT3JDb250ZW50U3RyaW5nTGl0ZXJhbFRva2VuIiwiaXNUb2tlbk9yQ29udGVudFN0cmluZ0xpdGVyYWxUb2tlbiIsImNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlIiwiaXNDb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSIsImNvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUiLCJpc0NvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUiLCJjb250ZW50IiwibWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuIiwiZnJvbUNvbnRlbnQiLCJwdXNoIiwiZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsInBvc2l0aW9uV2l0aGluQ29udGVudCIsInRva2VuaXNlRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsInN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24iLCJzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24iLCJ0b2tlbmlzZVN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuIiwidG9rZW5pc2VTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwicmVtYWluaW5nQ29udGVudCIsInN0cmluZ0xpdGVyYWxUb2tlbiIsImZyb21TdHJpbmdMaXRlcmFsVG9rZW4iLCJnZXRDb250ZW50IiwidG9rZW4iLCJ0b2tlbkVuZE9mTGluZVRva2VuIiwiaXNFbmRPZkxpbmVUb2tlbiIsInRva2VuT3JDb250ZW50U3RyaW5nIiwidG9rZW5PckNvbnRlbnRUb2tlbiIsInRva2VuU3RyaW5nTGl0ZXJhbFRva2VuIiwiY29tbWVudFR5cGVJbmNsdWRlc1NpbmdsZUxpbmVUeXBlIiwiaW5jbHVkZXMiLCJjb21tZW50VHlwZUluY2x1ZGVzTXVsdGlMaW5lVHlwZSIsInRva2VuaXNlU3RhcnRPZkNvbW1lbnRUb2tlbiIsInRva2VuaXNlRW5kT2ZDb21tZW50VG9rZW4iLCJTdGFydE9mQ29tbWVudFRva2VuIiwic3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4iLCJmcm9tV2l0aGluQ29udGVudCIsInBvc2l0aW9uIiwiY29udGVudExlbmd0aCIsImdldENvbnRlbnRMZW5ndGgiLCJsZWZ0IiwicmlnaHQiLCJsZWZ0Q29udGVudCIsInN1YnN0cmluZyIsInJpZ2h0Q29udGVudCIsImxlZnRDb250ZW50TGVuZ3RoIiwibGVuZ3RoIiwicmlnaHRDb250ZW50TGVuZ3RoIiwiRW5kT2ZDb21tZW50VG9rZW4iLCJNaWRkbGVPZkNvbW1lbnRUb2tlbiIsImVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIl0s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Q004QixXQUFXVyxrQkFBa0JwQyxxQkFBbEIsQ0FBd0NMLE9BQXhDLENBRGpCO0FBQUEsTUFFTStCLGdCQUFnQlksMkJBQTJCWCxnQkFBM0IsRUFGdEI7QUFBQSxNQUdNQyxPQUFPSCxRQUhiO0FBQUEsTUFJTUksUUFBUUosV0FBV0MsYUFKekI7QUFBQSxNQUtNSSxjQUFjbkMsUUFBUW9DLFNBQVIsQ0FBa0IsQ0FBbEIsRUFBcUJILElBQXJCLENBTHBCO0FBQUEsTUFNTUksZUFBZXJDLFFBQVFvQyxTQUFSLENBQWtCRixLQUFsQixDQU5yQjtBQUFBLE1BT01JLG9CQUFvQkgsWUFBWUksTUFQdEM7QUFBQSxNQVFNQyxxQkFBcUJILGFBQWFFLE1BUnhDOztBQVVBLE1BQUlELG9CQUFvQixDQUF4QixFQUEyQjtBQUN6QixRQUFNdEMsWUFBVW1DLFdBQWhCO0FBQUEsUUFBOEI7QUFDeEI1QixvQ0FBZ0NtQyxxQkFBcUJ4QyxXQUFyQixDQUFpQ0YsU0FBakMsQ0FEdEM7O0FBR0FiLHFDQUFpQ2dCLElBQWpDLENBQXNDSSw2QkFBdEM7QUFDRDs7QUFFRHBCLG1DQUFpQ2dCLElBQWpDLENBQXNDd0MsMEJBQXRDOztBQUVBLE1BQUlILHFCQUFxQixDQUF6QixFQUE0QjtBQUMxQixRQUFNdEQsaUJBQWlCbUQsWUFBdkIsQ0FEMEIsQ0FDVzs7QUFFckNwRCxrQkFBY0csc0JBQXNCRCxnQ0FBdEIsRUFBd0RELGNBQXhELEVBQXdFRCxXQUF4RSxDQUFkO0FBQ0Q7O0FBRUQsU0FBT0EsV0FBUDtBQUNEIiwiZmlsZSI6ImNvbW1lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG5jb25zdCB0eXBlcyA9IHJlcXVpcmUoJy4uL3R5cGVzJyksXHJcbiAgICAgIHRva2VucyA9IHJlcXVpcmUoJy4uL3Rva2VucycpLFxyXG4gICAgICBTdHJpbmdMaXRlcmFsVG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9zaWduaWZpY2FudC9zdHJpbmdMaXRlcmFsJyksXHJcbiAgICAgIEVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZSgnLi4vdG9rZW4vbm9uU2lnbmlmaWNhbnQvY29tbWVudC9tdWx0aUxpbmUvZW5kT2YnKSxcclxuICAgICAgU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbXVsdGlMaW5lL3N0YXJ0T2YnKSxcclxuICAgICAgTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKCcuLi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L211bHRpTGluZS9taWRkbGVPZicpLFxyXG4gICAgICBTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvc2luZ2xlTGluZS9zdGFydE9mJyksXHJcbiAgICAgIE1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvc2luZ2xlTGluZS9taWRkbGVPZicpO1xyXG5cclxuY29uc3QgeyBtdWx0aUxpbmVUeXBlLCBzaW5nbGVMaW5lVHlwZSwgbXVsdGlMaW5lQ29tbWVudFR5cGUsIHNpbmdsZUxpbmVDb21tZW50VHlwZSB9ID0gdHlwZXMsXHJcbiAgICAgIHsgdG9rZW5pc2VCeUNhbGxiYWNrIH0gPSB0b2tlbnM7XHJcblxyXG5mdW5jdGlvbiB0b2tlbmlzZSh0b2tlbnNPckNvbnRlbnRzKSB7XHJcbiAgbGV0IGNvbW1lbnRUeXBlID0gbnVsbDtcclxuXHJcbiAgdG9rZW5pc2VCeUNhbGxiYWNrKHRva2Vuc09yQ29udGVudHMsIGZ1bmN0aW9uKHRva2VuT3JDb250ZW50KSB7XHJcbiAgICBjb25zdCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cyA9IFtdO1xyXG5cclxuICAgIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VDb21tZW50VG9rZW5zKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCB0b2tlbk9yQ29udGVudCwgY29tbWVudFR5cGUpO1xyXG5cclxuICAgIGNvbnN0IHRva2Vuc09yUmVtYWluaW5nQ29udGVudHMgPSBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50czsgLy8vXHJcblxyXG4gICAgcmV0dXJuIHRva2Vuc09yUmVtYWluaW5nQ29udGVudHM7XHJcbiAgfSk7XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIHRva2VuaXNlXHJcbn07XHJcblxyXG5mdW5jdGlvbiB0b2tlbmlzZUNvbW1lbnRUb2tlbnMoY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIHRva2VuT3JDb250ZW50LCBjb21tZW50VHlwZSkge1xyXG4gIGNvbnN0IHRva2VuT3JDb250ZW50Q29udGVudCA9IGlzVG9rZW5PckNvbnRlbnRDb250ZW50KHRva2VuT3JDb250ZW50KSxcclxuICAgICAgICB0b2tlbk9yQ29udGVudFN0cmluZ0xpdGVyYWxUb2tlbiA9IGlzVG9rZW5PckNvbnRlbnRTdHJpbmdMaXRlcmFsVG9rZW4odG9rZW5PckNvbnRlbnQpLFxyXG4gICAgICAgIGNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlID0gaXNDb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZShjb21tZW50VHlwZSksXHJcbiAgICAgICAgY29tbWVudFR5cGVNdWx0aUxpbmVDb21tZW50VHlwZSA9IGlzQ29tbWVudFR5cGVNdWx0aUxpbmVDb21tZW50VHlwZShjb21tZW50VHlwZSk7XHJcblxyXG4gIGlmIChmYWxzZSkge1xyXG5cclxuICB9IGVsc2UgaWYgKHRva2VuT3JDb250ZW50Q29udGVudCkge1xyXG4gICAgY29uc3QgY29udGVudCA9IHRva2VuT3JDb250ZW50OyAvLy9cclxuXHJcbiAgICBpZiAoZmFsc2UpIHtcclxuXHJcbiAgICB9IGVsc2UgaWYgKGNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlKSB7XHJcbiAgICAgIGNvbnN0IG1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IE1pZGRsZU9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gobWlkZGxlT2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuKTtcclxuICAgIH0gZWxzZSBpZiAoY29tbWVudFR5cGVNdWx0aUxpbmVDb21tZW50VHlwZSkge1xyXG4gICAgICBjb25zdCBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgICAgaWYgKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICAgIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgbWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbik7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBTdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCksXHJcbiAgICAgICAgICAgIHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IFN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgICAgaWYgKChzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpICYmIChzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkpIHtcclxuICAgICAgICBpZiAoZmFsc2UpIHtcclxuXHJcbiAgICAgICAgfSBlbHNlIGlmIChzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uIDwgc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uKSB7XHJcbiAgICAgICAgICBjb21tZW50VHlwZSA9IHRva2VuaXNlU3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uIDwgc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbikge1xyXG4gICAgICAgICAgY29tbWVudFR5cGUgPSB0b2tlbmlzZVN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChzdGFydE9mU2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID4gLTEpIHtcclxuICAgICAgICBjb21tZW50VHlwZSA9IHRva2VuaXNlU3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICB9IGVsc2UgaWYgKHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA+IC0xKSB7XHJcbiAgICAgICAgY29tbWVudFR5cGUgPSB0b2tlbmlzZVN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4oY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHJlbWFpbmluZ0NvbnRlbnQgPSBjb250ZW50OyAvLy9cclxuXHJcbiAgICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChyZW1haW5pbmdDb250ZW50KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0gZWxzZSBpZiAodG9rZW5PckNvbnRlbnRTdHJpbmdMaXRlcmFsVG9rZW4pIHtcclxuICAgIGNvbnN0IHN0cmluZ0xpdGVyYWxUb2tlbiA9IHRva2VuT3JDb250ZW50OyAgLy8vXHJcblxyXG4gICAgaWYgKGZhbHNlKSB7XHJcblxyXG4gICAgfSBlbHNlIGlmIChjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSkge1xyXG4gICAgICBjb25zdCBtaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4gPSBNaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4uZnJvbVN0cmluZ0xpdGVyYWxUb2tlbihzdHJpbmdMaXRlcmFsVG9rZW4pO1xyXG5cclxuICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4pO1xyXG4gICAgfSBlbHNlIGlmIChjb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlKSB7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBzdHJpbmdMaXRlcmFsVG9rZW4uZ2V0Q29udGVudCgpLFxyXG4gICAgICAgICAgICBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgICAgaWYgKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPiAtMSkge1xyXG4gICAgICAgIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgbWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICAgICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbik7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2goc3RyaW5nTGl0ZXJhbFRva2VuKTtcclxuICAgIH1cclxuICB9IGVsc2Uge1xyXG4gICAgY29uc3QgdG9rZW4gPSB0b2tlbk9yQ29udGVudCwgLy8vXHJcbiAgICAgICAgICB0b2tlbkVuZE9mTGluZVRva2VuID0gdG9rZW4uaXNFbmRPZkxpbmVUb2tlbigpO1xyXG5cclxuICAgIGlmICh0b2tlbkVuZE9mTGluZVRva2VuKSB7XHJcbiAgICAgIGNvbnN0IGNvbW1lbnRUeXBlU2luZ2xlTGluZUNvbW1lbnRUeXBlID0gaXNDb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZShjb21tZW50VHlwZSk7XHJcblxyXG4gICAgICBpZiAoY29tbWVudFR5cGVTaW5nbGVMaW5lQ29tbWVudFR5cGUpIHtcclxuICAgICAgICBjb21tZW50VHlwZSA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cy5wdXNoKHRva2VuKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gaXNUb2tlbk9yQ29udGVudENvbnRlbnQodG9rZW5PckNvbnRlbnQpIHtcclxuICBjb25zdCB0b2tlbk9yQ29udGVudFN0cmluZyA9ICh0eXBlb2YgdG9rZW5PckNvbnRlbnQgPT09ICdzdHJpbmcnKSxcclxuICAgICAgICB0b2tlbk9yQ29udGVudENvbnRlbnQgPSB0b2tlbk9yQ29udGVudFN0cmluZzsgLy8vXHJcblxyXG4gIHJldHVybiB0b2tlbk9yQ29udGVudENvbnRlbnQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzVG9rZW5PckNvbnRlbnRTdHJpbmdMaXRlcmFsVG9rZW4odG9rZW5PckNvbnRlbnQpIHtcclxuICBsZXQgdG9rZW5PckNvbnRlbnRTdHJpbmdMaXRlcmFsVG9rZW4gPSBmYWxzZTtcclxuXHJcbiAgY29uc3QgdG9rZW5PckNvbnRlbnRTdHJpbmcgPSAodHlwZW9mIHRva2VuT3JDb250ZW50ID09PSAnc3RyaW5nJyksXHJcbiAgICAgICAgdG9rZW5PckNvbnRlbnRDb250ZW50ID0gdG9rZW5PckNvbnRlbnRTdHJpbmcsIC8vL1xyXG4gICAgICAgIHRva2VuT3JDb250ZW50VG9rZW4gPSAhdG9rZW5PckNvbnRlbnRDb250ZW50O1xyXG5cclxuICBpZiAodG9rZW5PckNvbnRlbnRUb2tlbikge1xyXG4gICAgY29uc3QgdG9rZW4gPSB0b2tlbk9yQ29udGVudCxcclxuICAgICAgICAgIHRva2VuU3RyaW5nTGl0ZXJhbFRva2VuID0gKHRva2VuIGluc3RhbmNlb2YgU3RyaW5nTGl0ZXJhbFRva2VuKTtcclxuXHJcbiAgICB0b2tlbk9yQ29udGVudFN0cmluZ0xpdGVyYWxUb2tlbiA9IHRva2VuU3RyaW5nTGl0ZXJhbFRva2VuOyAvLy9cclxuICB9XHJcblxyXG4gIHJldHVybiB0b2tlbk9yQ29udGVudFN0cmluZ0xpdGVyYWxUb2tlbjtcclxufVxyXG5cclxuZnVuY3Rpb24gaXNDb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZShjb21tZW50VHlwZSkge1xyXG4gIGxldCBjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSA9IGZhbHNlO1xyXG5cclxuICBpZiAoY29tbWVudFR5cGUgIT09IG51bGwpIHtcclxuICAgIGNvbnN0IGNvbW1lbnRUeXBlSW5jbHVkZXNTaW5nbGVMaW5lVHlwZSA9IGNvbW1lbnRUeXBlLmluY2x1ZGVzKHNpbmdsZUxpbmVUeXBlKTtcclxuXHJcbiAgICBjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZSA9IGNvbW1lbnRUeXBlSW5jbHVkZXNTaW5nbGVMaW5lVHlwZTtcclxuICB9XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZVNpbmdsZUxpbmVDb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gaXNDb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlKGNvbW1lbnRUeXBlKSB7XHJcbiAgbGV0IGNvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUgPSBmYWxzZTtcclxuXHJcbiAgaWYgKGNvbW1lbnRUeXBlICE9PSBudWxsKSB7XHJcbiAgICBjb25zdCBjb21tZW50VHlwZUluY2x1ZGVzTXVsdGlMaW5lVHlwZSA9IGNvbW1lbnRUeXBlLmluY2x1ZGVzKG11bHRpTGluZVR5cGUpO1xyXG5cclxuICAgIGNvbW1lbnRUeXBlTXVsdGlMaW5lQ29tbWVudFR5cGUgPSBjb21tZW50VHlwZUluY2x1ZGVzTXVsdGlMaW5lVHlwZTtcclxuICB9XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZU11bHRpTGluZUNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5mdW5jdGlvbiB0b2tlbmlzZVN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KSB7XHJcbiAgbGV0IGNvbW1lbnRUeXBlID0gc2luZ2xlTGluZUNvbW1lbnRUeXBlOyAgLy8vXHJcblxyXG4gIGNvbW1lbnRUeXBlID0gdG9rZW5pc2VTdGFydE9mQ29tbWVudFRva2VuKFN0YXJ0T2ZTaW5nbGVMaW5lQ29tbWVudFRva2VuLCBjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCwgY29tbWVudFR5cGUpO1xyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRva2VuaXNlU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbihjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgY29udGVudCkge1xyXG4gIGxldCBjb21tZW50VHlwZSA9IG11bHRpTGluZUNvbW1lbnRUeXBlOyAvLy9cclxuXHJcbiAgY29tbWVudFR5cGUgPSB0b2tlbmlzZVN0YXJ0T2ZDb21tZW50VG9rZW4oU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQsIGNvbW1lbnRUeXBlKTtcclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5mdW5jdGlvbiB0b2tlbmlzZUVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50KSB7XHJcbiAgbGV0IGNvbW1lbnRUeXBlID0gbnVsbDtcclxuXHJcbiAgY29tbWVudFR5cGUgPSB0b2tlbmlzZUVuZE9mQ29tbWVudFRva2VuKEVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLCBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQsIGNvbW1lbnRUeXBlKTtcclxuXHJcbiAgcmV0dXJuIGNvbW1lbnRUeXBlO1xyXG59XHJcblxyXG5mdW5jdGlvbiB0b2tlbmlzZVN0YXJ0T2ZDb21tZW50VG9rZW4oU3RhcnRPZkNvbW1lbnRUb2tlbiwgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIGNvbnRlbnQsIGNvbW1lbnRUeXBlKSB7XHJcbiAgY29uc3Qgc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4gPSBTdGFydE9mQ29tbWVudFRva2VuLmZyb21XaXRoaW5Db250ZW50KGNvbnRlbnQpLFxyXG4gICAgICAgIHBvc2l0aW9uID0gU3RhcnRPZkNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCksICAvLy9cclxuICAgICAgICBjb250ZW50TGVuZ3RoID0gc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4uZ2V0Q29udGVudExlbmd0aCgpLFxyXG4gICAgICAgIGxlZnQgPSBwb3NpdGlvbiwgIC8vL1xyXG4gICAgICAgIHJpZ2h0ID0gcG9zaXRpb24gKyBjb250ZW50TGVuZ3RoLFxyXG4gICAgICAgIGxlZnRDb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcoMCwgbGVmdCksXHJcbiAgICAgICAgcmlnaHRDb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcocmlnaHQpLFxyXG4gICAgICAgIGxlZnRDb250ZW50TGVuZ3RoID0gbGVmdENvbnRlbnQubGVuZ3RoLFxyXG4gICAgICAgIHJpZ2h0Q29udGVudExlbmd0aCA9IHJpZ2h0Q29udGVudC5sZW5ndGg7XHJcblxyXG4gIGlmIChsZWZ0Q29udGVudExlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHJlbWFpbmluZ0NvbnRlbnQgPSBsZWZ0Q29udGVudDsgLy8vXHJcblxyXG4gICAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChyZW1haW5pbmdDb250ZW50KTtcclxuICB9XHJcblxyXG4gIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2goc3RhcnRPZlNpbmdsZUxpbmVDb21tZW50VG9rZW4pO1xyXG5cclxuICBpZiAocmlnaHRDb250ZW50TGVuZ3RoID4gMCkge1xyXG4gICAgY29uc3QgdG9rZW5PckNvbnRlbnQgPSByaWdodENvbnRlbnQ7ICAvLy9cclxuXHJcbiAgICBjb21tZW50VHlwZSA9IHRva2VuaXNlQ29tbWVudFRva2Vucyhjb21tZW50VG9rZW5zT3JSZW1haW5pbmdDb250ZW50cywgdG9rZW5PckNvbnRlbnQsIGNvbW1lbnRUeXBlKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBjb21tZW50VHlwZTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9rZW5pc2VFbmRPZkNvbW1lbnRUb2tlbihFbmRPZkNvbW1lbnRUb2tlbiwgTWlkZGxlT2ZDb21tZW50VG9rZW4sIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLCBjb250ZW50LCBjb21tZW50VHlwZSkge1xyXG4gIGNvbnN0IGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gRW5kT2ZDb21tZW50VG9rZW4uZnJvbVdpdGhpbkNvbnRlbnQoY29udGVudCksXHJcbiAgICAgICAgcG9zaXRpb24gPSBFbmRPZkNvbW1lbnRUb2tlbi5wb3NpdGlvbldpdGhpbkNvbnRlbnQoY29udGVudCksXHJcbiAgICAgICAgY29udGVudExlbmd0aCA9IGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLmdldENvbnRlbnRMZW5ndGgoKSxcclxuICAgICAgICBsZWZ0ID0gcG9zaXRpb24sXHJcbiAgICAgICAgcmlnaHQgPSBwb3NpdGlvbiArIGNvbnRlbnRMZW5ndGgsXHJcbiAgICAgICAgbGVmdENvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZygwLCBsZWZ0KSxcclxuICAgICAgICByaWdodENvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZyhyaWdodCksXHJcbiAgICAgICAgbGVmdENvbnRlbnRMZW5ndGggPSBsZWZ0Q29udGVudC5sZW5ndGgsXHJcbiAgICAgICAgcmlnaHRDb250ZW50TGVuZ3RoID0gcmlnaHRDb250ZW50Lmxlbmd0aDtcclxuXHJcbiAgaWYgKGxlZnRDb250ZW50TGVuZ3RoID4gMCkge1xyXG4gICAgY29uc3QgY29udGVudCA9IGxlZnRDb250ZW50LCAgLy8vXHJcbiAgICAgICAgICBtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IE1pZGRsZU9mQ29tbWVudFRva2VuLmZyb21Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICAgIGNvbW1lbnRUb2tlbnNPclJlbWFpbmluZ0NvbnRlbnRzLnB1c2gobWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4pO1xyXG4gIH1cclxuXHJcbiAgY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMucHVzaChlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbik7XHJcblxyXG4gIGlmIChyaWdodENvbnRlbnRMZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCB0b2tlbk9yQ29udGVudCA9IHJpZ2h0Q29udGVudDsgLy8vXHJcblxyXG4gICAgY29tbWVudFR5cGUgPSB0b2tlbmlzZUNvbW1lbnRUb2tlbnMoY29tbWVudFRva2Vuc09yUmVtYWluaW5nQ29udGVudHMsIHRva2VuT3JDb250ZW50LCBjb21tZW50VHlwZSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gY29tbWVudFR5cGU7XHJcbn1cclxuIl19