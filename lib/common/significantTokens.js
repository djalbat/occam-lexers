'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var ErrorToken = require('../common/token/error');

var SignificantTokens = function () {
  function SignificantTokens() {
    _classCallCheck(this, SignificantTokens);
  }

  _createClass(SignificantTokens, null, [{
    key: 'pass',
    value: function pass(nonSignificantTokenOrSignificantContents, line, rules) {
      var tokens = nonSignificantTokenOrSignificantContents.reduce(function (tokens, nonSignificantTokenOrSignificantContent) {
        if (typeof nonSignificantTokenOrSignificantContent === 'string') {
          var significantContent = nonSignificantTokenOrSignificantContent,
              ///
          content = significantContent,
              ///
          depth = 0,
              significantTokens = significantTokensFromContent(content, line, rules, depth);

          tokens = tokens.concat(significantTokens);
        } else {
          var nonSignificantToken = nonSignificantTokenOrSignificantContent; ///

          tokens.push(nonSignificantToken);
        }

        return tokens;
      }, []);

      return tokens;
    }
  }]);

  return SignificantTokens;
}();

module.exports = SignificantTokens;

function significantTokensFromContent(content, line, rules, depth) {
  var significantTokens,
      rule = rules.getRule(depth),
      ruleIsUndefined = rule === undefined;

  if (content === '') {
    significantTokens = [];
  } else if (ruleIsUndefined) {
    var errorToken = ErrorToken.fromContent(content);

    significantTokens = [errorToken]; ///
  } else {
    var nextDepth = depth + 1,
        significantTokenPosition = rule.significantTokenPosition(content);

    if (significantTokenPosition === -1) {
      significantTokens = significantTokensFromContent(content, line, rules, nextDepth);
    } else {
      var significantToken = rule.significantTokenFromContent(content, line),
          significantTokenLength = significantToken.getLength(),
          left = significantTokenPosition,
          ///
      right = significantTokenPosition + significantTokenLength,
          ///
      leftContent = content.substr(0, left),
          rightContent = content.substr(right),
          leftSignificantTokens = significantTokensFromContent(leftContent, line, rules, nextDepth),
          rightSignificantTokens = significantTokensFromContent(rightContent, line, rules, depth);

      significantTokens = [].concat(leftSignificantTokens).concat(significantToken).concat(rightSignificantTokens);
    }
  }

  return significantTokens;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9jb21tb24vc2lnbmlmaWNhbnRUb2tlbnMuanMiXSwibmFtZXMiOlsiRXJyb3JUb2tlbiIsInJlcXVpcmUiLCJTaWduaWZpY2FudFRva2VucyIsIm5vblNpZ25pZmljYW50VG9rZW5PclNpZ25pZmljYW50Q29udGVudHMiLCJsaW5lIiwicnVsZXMiLCJ0b2tlbnMiLCJyZWR1Y2UiLCJub25TaWduaWZpY2FudFRva2VuT3JTaWduaWZpY2FudENvbnRlbnQiLCJzaWduaWZpY2FudENvbnRlbnQiLCJjb250ZW50IiwiZGVwdGgiLCJzaWduaWZpY2FudFRva2VucyIsInNpZ25pZmljYW50VG9rZW5zRnJvbUNvbnRlbnQiLCJjb25jYXQiLCJub25TaWduaWZpY2FudFRva2VuIiwicHVzaCIsIm1vZHVsZSIsImV4cG9ydHMiLCJydWxlIiwiZ2V0UnVsZSIsInJ1bGVJc1VuZGVmaW5lZCIsInVuZGVmaW5lZCIsImVycm9yVG9rZW4iLCJmcm9tQ29udGVudCIsIm5leHREZXB0aCIsInNpZ25pZmljYW50VG9rZW5Qb3NpdGlvbiIsInNpZ25pZmljYW50VG9rZW4iLCJzaWduaWZpY2FudFRva2VuRnJvbUNvbnRlbnQiLCJzaWduaWZpY2FudFRva2VuTGVuZ3RoIiwiZ2V0TGVuZ3RoIiwibGVmdCIsInJpZ2h0IiwibGVmdENvbnRlbnQiLCJzdWJzdHIiLCJyaWdodENvbnRlbnQiLCJsZWZ0U2lnbmlmaWNhbnRUb2tlbnMiLCJyaWdodFNpZ25pZmljYW50VG9rZW5zIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FBRUEsSUFBSUEsYUFBYUMsUUFBUSx1QkFBUixDQUFqQjs7SUFFTUMsaUI7Ozs7Ozs7eUJBQ1FDLHdDLEVBQTBDQyxJLEVBQU1DLEssRUFBTztBQUNqRSxVQUFJQyxTQUFTSCx5Q0FBeUNJLE1BQXpDLENBQWdELFVBQVNELE1BQVQsRUFBaUJFLHVDQUFqQixFQUEwRDtBQUNySCxZQUFJLE9BQU9BLHVDQUFQLEtBQW1ELFFBQXZELEVBQWlFO0FBQy9ELGNBQUlDLHFCQUFxQkQsdUNBQXpCO0FBQUEsY0FBbUU7QUFDL0RFLG9CQUFVRCxrQkFEZDtBQUFBLGNBQ2tDO0FBQzlCRSxrQkFBUSxDQUZaO0FBQUEsY0FHSUMsb0JBQW9CQyw2QkFBNkJILE9BQTdCLEVBQXNDTixJQUF0QyxFQUE0Q0MsS0FBNUMsRUFBbURNLEtBQW5ELENBSHhCOztBQUtBTCxtQkFBU0EsT0FBT1EsTUFBUCxDQUFjRixpQkFBZCxDQUFUO0FBQ0QsU0FQRCxNQU9PO0FBQ0wsY0FBSUcsc0JBQXNCUCx1Q0FBMUIsQ0FESyxDQUMrRDs7QUFFcEVGLGlCQUFPVSxJQUFQLENBQVlELG1CQUFaO0FBQ0Q7O0FBRUQsZUFBT1QsTUFBUDtBQUNELE9BZlksRUFlVixFQWZVLENBQWI7O0FBaUJBLGFBQU9BLE1BQVA7QUFDRDs7Ozs7O0FBR0hXLE9BQU9DLE9BQVAsR0FBaUJoQixpQkFBakI7O0FBRUEsU0FBU1csNEJBQVQsQ0FBc0NILE9BQXRDLEVBQStDTixJQUEvQyxFQUFxREMsS0FBckQsRUFBNERNLEtBQTVELEVBQW1FO0FBQ2pFLE1BQUlDLGlCQUFKO0FBQUEsTUFDSU8sT0FBT2QsTUFBTWUsT0FBTixDQUFjVCxLQUFkLENBRFg7QUFBQSxNQUVJVSxrQkFBbUJGLFNBQVNHLFNBRmhDOztBQUlBLE1BQUlaLFlBQVksRUFBaEIsRUFBb0I7QUFDbEJFLHdCQUFvQixFQUFwQjtBQUNELEdBRkQsTUFFTyxJQUFJUyxlQUFKLEVBQXFCO0FBQzFCLFFBQUlFLGFBQWF2QixXQUFXd0IsV0FBWCxDQUF1QmQsT0FBdkIsQ0FBakI7O0FBRUFFLHdCQUFvQixDQUFDVyxVQUFELENBQXBCLENBSDBCLENBR1E7QUFDbkMsR0FKTSxNQUlBO0FBQ0wsUUFBSUUsWUFBWWQsUUFBUSxDQUF4QjtBQUFBLFFBQ0llLDJCQUEyQlAsS0FBS08sd0JBQUwsQ0FBOEJoQixPQUE5QixDQUQvQjs7QUFHQSxRQUFJZ0IsNkJBQTZCLENBQUMsQ0FBbEMsRUFBcUM7QUFDbkNkLDBCQUFvQkMsNkJBQTZCSCxPQUE3QixFQUFzQ04sSUFBdEMsRUFBNENDLEtBQTVDLEVBQW1Eb0IsU0FBbkQsQ0FBcEI7QUFDRCxLQUZELE1BRU87QUFDTCxVQUFJRSxtQkFBbUJSLEtBQUtTLDJCQUFMLENBQWlDbEIsT0FBakMsRUFBMENOLElBQTFDLENBQXZCO0FBQUEsVUFDSXlCLHlCQUF5QkYsaUJBQWlCRyxTQUFqQixFQUQ3QjtBQUFBLFVBRUlDLE9BQU9MLHdCQUZYO0FBQUEsVUFFc0M7QUFDbENNLGNBQVFOLDJCQUEyQkcsc0JBSHZDO0FBQUEsVUFHZ0U7QUFDNURJLG9CQUFjdkIsUUFBUXdCLE1BQVIsQ0FBZSxDQUFmLEVBQWtCSCxJQUFsQixDQUpsQjtBQUFBLFVBS0lJLGVBQWV6QixRQUFRd0IsTUFBUixDQUFlRixLQUFmLENBTG5CO0FBQUEsVUFNSUksd0JBQXdCdkIsNkJBQTZCb0IsV0FBN0IsRUFBMEM3QixJQUExQyxFQUFnREMsS0FBaEQsRUFBdURvQixTQUF2RCxDQU41QjtBQUFBLFVBT0lZLHlCQUF5QnhCLDZCQUE2QnNCLFlBQTdCLEVBQTJDL0IsSUFBM0MsRUFBaURDLEtBQWpELEVBQXdETSxLQUF4RCxDQVA3Qjs7QUFTQUMsMEJBQW9CLEdBQUdFLE1BQUgsQ0FBVXNCLHFCQUFWLEVBQWlDdEIsTUFBakMsQ0FBd0NhLGdCQUF4QyxFQUEwRGIsTUFBMUQsQ0FBaUV1QixzQkFBakUsQ0FBcEI7QUFDRDtBQUNGOztBQUVELFNBQU96QixpQkFBUDtBQUNEIiwiZmlsZSI6InNpZ25pZmljYW50VG9rZW5zLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxudmFyIEVycm9yVG9rZW4gPSByZXF1aXJlKCcuLi9jb21tb24vdG9rZW4vZXJyb3InKTtcclxuXHJcbmNsYXNzIFNpZ25pZmljYW50VG9rZW5zIHtcclxuICBzdGF0aWMgcGFzcyhub25TaWduaWZpY2FudFRva2VuT3JTaWduaWZpY2FudENvbnRlbnRzLCBsaW5lLCBydWxlcykge1xyXG4gICAgdmFyIHRva2VucyA9IG5vblNpZ25pZmljYW50VG9rZW5PclNpZ25pZmljYW50Q29udGVudHMucmVkdWNlKGZ1bmN0aW9uKHRva2Vucywgbm9uU2lnbmlmaWNhbnRUb2tlbk9yU2lnbmlmaWNhbnRDb250ZW50KSB7XHJcbiAgICAgIGlmICh0eXBlb2Ygbm9uU2lnbmlmaWNhbnRUb2tlbk9yU2lnbmlmaWNhbnRDb250ZW50ID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIHZhciBzaWduaWZpY2FudENvbnRlbnQgPSBub25TaWduaWZpY2FudFRva2VuT3JTaWduaWZpY2FudENvbnRlbnQsICAvLy9cclxuICAgICAgICAgICAgY29udGVudCA9IHNpZ25pZmljYW50Q29udGVudCwgLy8vXHJcbiAgICAgICAgICAgIGRlcHRoID0gMCxcclxuICAgICAgICAgICAgc2lnbmlmaWNhbnRUb2tlbnMgPSBzaWduaWZpY2FudFRva2Vuc0Zyb21Db250ZW50KGNvbnRlbnQsIGxpbmUsIHJ1bGVzLCBkZXB0aCk7XHJcblxyXG4gICAgICAgIHRva2VucyA9IHRva2Vucy5jb25jYXQoc2lnbmlmaWNhbnRUb2tlbnMpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHZhciBub25TaWduaWZpY2FudFRva2VuID0gbm9uU2lnbmlmaWNhbnRUb2tlbk9yU2lnbmlmaWNhbnRDb250ZW50OyAgLy8vXHJcbiAgICAgICAgXHJcbiAgICAgICAgdG9rZW5zLnB1c2gobm9uU2lnbmlmaWNhbnRUb2tlbik7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB0b2tlbnM7XHJcbiAgICB9LCBbXSk7XHJcblxyXG4gICAgcmV0dXJuIHRva2VucztcclxuICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gU2lnbmlmaWNhbnRUb2tlbnM7XHJcblxyXG5mdW5jdGlvbiBzaWduaWZpY2FudFRva2Vuc0Zyb21Db250ZW50KGNvbnRlbnQsIGxpbmUsIHJ1bGVzLCBkZXB0aCkge1xyXG4gIHZhciBzaWduaWZpY2FudFRva2VucyxcclxuICAgICAgcnVsZSA9IHJ1bGVzLmdldFJ1bGUoZGVwdGgpLFxyXG4gICAgICBydWxlSXNVbmRlZmluZWQgPSAocnVsZSA9PT0gdW5kZWZpbmVkKTtcclxuXHJcbiAgaWYgKGNvbnRlbnQgPT09ICcnKSB7XHJcbiAgICBzaWduaWZpY2FudFRva2VucyA9IFtdO1xyXG4gIH0gZWxzZSBpZiAocnVsZUlzVW5kZWZpbmVkKSB7XHJcbiAgICB2YXIgZXJyb3JUb2tlbiA9IEVycm9yVG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gICAgc2lnbmlmaWNhbnRUb2tlbnMgPSBbZXJyb3JUb2tlbl07IC8vL1xyXG4gIH0gZWxzZSB7XHJcbiAgICB2YXIgbmV4dERlcHRoID0gZGVwdGggKyAxLFxyXG4gICAgICAgIHNpZ25pZmljYW50VG9rZW5Qb3NpdGlvbiA9IHJ1bGUuc2lnbmlmaWNhbnRUb2tlblBvc2l0aW9uKGNvbnRlbnQpO1xyXG5cclxuICAgIGlmIChzaWduaWZpY2FudFRva2VuUG9zaXRpb24gPT09IC0xKSB7XHJcbiAgICAgIHNpZ25pZmljYW50VG9rZW5zID0gc2lnbmlmaWNhbnRUb2tlbnNGcm9tQ29udGVudChjb250ZW50LCBsaW5lLCBydWxlcywgbmV4dERlcHRoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHZhciBzaWduaWZpY2FudFRva2VuID0gcnVsZS5zaWduaWZpY2FudFRva2VuRnJvbUNvbnRlbnQoY29udGVudCwgbGluZSksXHJcbiAgICAgICAgICBzaWduaWZpY2FudFRva2VuTGVuZ3RoID0gc2lnbmlmaWNhbnRUb2tlbi5nZXRMZW5ndGgoKSxcclxuICAgICAgICAgIGxlZnQgPSBzaWduaWZpY2FudFRva2VuUG9zaXRpb24sICAvLy9cclxuICAgICAgICAgIHJpZ2h0ID0gc2lnbmlmaWNhbnRUb2tlblBvc2l0aW9uICsgc2lnbmlmaWNhbnRUb2tlbkxlbmd0aCwgIC8vL1xyXG4gICAgICAgICAgbGVmdENvbnRlbnQgPSBjb250ZW50LnN1YnN0cigwLCBsZWZ0KSxcclxuICAgICAgICAgIHJpZ2h0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyKHJpZ2h0KSxcclxuICAgICAgICAgIGxlZnRTaWduaWZpY2FudFRva2VucyA9IHNpZ25pZmljYW50VG9rZW5zRnJvbUNvbnRlbnQobGVmdENvbnRlbnQsIGxpbmUsIHJ1bGVzLCBuZXh0RGVwdGgpLFxyXG4gICAgICAgICAgcmlnaHRTaWduaWZpY2FudFRva2VucyA9IHNpZ25pZmljYW50VG9rZW5zRnJvbUNvbnRlbnQocmlnaHRDb250ZW50LCBsaW5lLCBydWxlcywgZGVwdGgpO1xyXG5cclxuICAgICAgc2lnbmlmaWNhbnRUb2tlbnMgPSBbXS5jb25jYXQobGVmdFNpZ25pZmljYW50VG9rZW5zKS5jb25jYXQoc2lnbmlmaWNhbnRUb2tlbikuY29uY2F0KHJpZ2h0U2lnbmlmaWNhbnRUb2tlbnMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHNpZ25pZmljYW50VG9rZW5zO1xyXG59XHJcbiJdfQ==