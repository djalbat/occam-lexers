'use strict';

var necessary = require('necessary');

var arrayUtilities = necessary.arrayUtilities,
    splice = arrayUtilities.splice;


function passGivenToken(tokensOrContents, Token) {
  passGivenCallback(tokensOrContents, function (content) {
    return tokensOrRemainingContentFromWithinContent(content, Token);
  });
}

function passGivenCallback(tokensOrContents, callback) {
  var index = 0,
      tokensOrContentsLength = tokensOrContents.length;

  while (index < tokensOrContentsLength) {
    var tokenOrContent = tokensOrContents[index],
        tokenOrContentContent = typeof tokenOrContent === 'string';

    if (tokenOrContentContent) {
      var content = tokenOrContent,
          ///
      tokensOrRemainingContent = callback(content),
          tokensOrRemainingContentLength = tokensOrRemainingContent.length,
          start = index,
          ///
      deleteCount = 1;

      splice(tokensOrContents, start, deleteCount, tokensOrRemainingContent);

      tokensOrContentsLength -= 1;

      tokensOrContentsLength += tokensOrRemainingContentLength;

      index += tokensOrRemainingContentLength;
    } else {
      index += 1;
    }
  }
}

module.exports = {
  passGivenToken: passGivenToken,
  passGivenCallback: passGivenCallback
};

function tokensOrRemainingContentFromWithinContent(content, Token) {
  var remainingContent = void 0,
      tokensOrRemainingContent = [],
      tokenPositionWithinContent = Token.positionWithinContent(content);

  while (tokenPositionWithinContent !== -1) {
    if (tokenPositionWithinContent > 0) {
      remainingContent = content.substring(0, tokenPositionWithinContent);

      tokensOrRemainingContent.push(remainingContent);
    }

    var token = Token.fromWithinContent(content),
        tokenContentLength = token.getContentLength(),
        tokenOffset = tokenPositionWithinContent + tokenContentLength;

    tokensOrRemainingContent.push(token);

    content = content.substring(tokenOffset);

    tokenPositionWithinContent = Token.positionWithinContent(content);
  }

  if (content !== '') {
    remainingContent = content;

    tokensOrRemainingContent.push(remainingContent);
  }

  return tokensOrRemainingContent;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9jb21tb24vdG9rZW5zLmpzIl0sIm5hbWVzIjpbIm5lY2Vzc2FyeSIsInJlcXVpcmUiLCJhcnJheVV0aWxpdGllcyIsInNwbGljZSIsInBhc3NHaXZlblRva2VuIiwidG9rZW5zT3JDb250ZW50cyIsIlRva2VuIiwicGFzc0dpdmVuQ2FsbGJhY2siLCJjb250ZW50IiwidG9rZW5zT3JSZW1haW5pbmdDb250ZW50RnJvbVdpdGhpbkNvbnRlbnQiLCJjYWxsYmFjayIsImluZGV4IiwidG9rZW5zT3JDb250ZW50c0xlbmd0aCIsImxlbmd0aCIsInRva2VuT3JDb250ZW50IiwidG9rZW5PckNvbnRlbnRDb250ZW50IiwidG9rZW5zT3JSZW1haW5pbmdDb250ZW50IiwidG9rZW5zT3JSZW1haW5pbmdDb250ZW50TGVuZ3RoIiwic3RhcnQiLCJkZWxldGVDb3VudCIsIm1vZHVsZSIsImV4cG9ydHMiLCJyZW1haW5pbmdDb250ZW50IiwidG9rZW5Qb3NpdGlvbldpdGhpbkNvbnRlbnQiLCJwb3NpdGlvbldpdGhpbkNvbnRlbnQiLCJzdWJzdHJpbmciLCJwdXNoIiwidG9rZW4iLCJmcm9tV2l0aGluQ29udGVudCIsInRva2VuQ29udGVudExlbmd0aCIsImdldENvbnRlbnRMZW5ndGgiLCJ0b2tlbk9mZnNldCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsWUFBWUMsUUFBUSxXQUFSLENBQWxCOztBQUVNLElBQUVDLGNBQUYsR0FBcUJGLFNBQXJCLENBQUVFLGNBQUY7QUFBQSxJQUNFQyxNQURGLEdBQ2FELGNBRGIsQ0FDRUMsTUFERjs7O0FBR04sU0FBU0MsY0FBVCxDQUF3QkMsZ0JBQXhCLEVBQTBDQyxLQUExQyxFQUFpRDtBQUMvQ0Msb0JBQWtCRixnQkFBbEIsRUFBb0MsVUFBU0csT0FBVCxFQUFrQjtBQUFFLFdBQU9DLDBDQUEwQ0QsT0FBMUMsRUFBbURGLEtBQW5ELENBQVA7QUFBbUUsR0FBM0g7QUFDRDs7QUFFRCxTQUFTQyxpQkFBVCxDQUEyQkYsZ0JBQTNCLEVBQTZDSyxRQUE3QyxFQUF1RDtBQUNyRCxNQUFJQyxRQUFRLENBQVo7QUFBQSxNQUNJQyx5QkFBeUJQLGlCQUFpQlEsTUFEOUM7O0FBR0EsU0FBT0YsUUFBUUMsc0JBQWYsRUFBdUM7QUFDckMsUUFBTUUsaUJBQWlCVCxpQkFBaUJNLEtBQWpCLENBQXZCO0FBQUEsUUFDSUksd0JBQXlCLE9BQU9ELGNBQVAsS0FBMEIsUUFEdkQ7O0FBR0EsUUFBSUMscUJBQUosRUFBMkI7QUFDekIsVUFBTVAsVUFBVU0sY0FBaEI7QUFBQSxVQUFpQztBQUMzQkUsaUNBQTJCTixTQUFTRixPQUFULENBRGpDO0FBQUEsVUFFTVMsaUNBQWlDRCx5QkFBeUJILE1BRmhFO0FBQUEsVUFHTUssUUFBUVAsS0FIZDtBQUFBLFVBR3NCO0FBQ2hCUSxvQkFBYyxDQUpwQjs7QUFNQWhCLGFBQU9FLGdCQUFQLEVBQXlCYSxLQUF6QixFQUFnQ0MsV0FBaEMsRUFBNkNILHdCQUE3Qzs7QUFFQUosZ0NBQTBCLENBQTFCOztBQUVBQSxnQ0FBMEJLLDhCQUExQjs7QUFFQU4sZUFBU00sOEJBQVQ7QUFDRCxLQWRELE1BY087QUFDTE4sZUFBUyxDQUFUO0FBQ0Q7QUFDRjtBQUNGOztBQUVEUyxPQUFPQyxPQUFQLEdBQWlCO0FBQ2ZqQixrQkFBZ0JBLGNBREQ7QUFFZkcscUJBQW1CQTtBQUZKLENBQWpCOztBQUtBLFNBQVNFLHlDQUFULENBQW1ERCxPQUFuRCxFQUE0REYsS0FBNUQsRUFBbUU7QUFDakUsTUFBSWdCLHlCQUFKO0FBQUEsTUFDSU4sMkJBQTJCLEVBRC9CO0FBQUEsTUFFSU8sNkJBQTZCakIsTUFBTWtCLHFCQUFOLENBQTRCaEIsT0FBNUIsQ0FGakM7O0FBSUEsU0FBT2UsK0JBQStCLENBQUMsQ0FBdkMsRUFBMEM7QUFDeEMsUUFBSUEsNkJBQTZCLENBQWpDLEVBQW9DO0FBQ2xDRCx5QkFBbUJkLFFBQVFpQixTQUFSLENBQWtCLENBQWxCLEVBQXFCRiwwQkFBckIsQ0FBbkI7O0FBRUFQLCtCQUF5QlUsSUFBekIsQ0FBOEJKLGdCQUE5QjtBQUNEOztBQUVELFFBQU1LLFFBQVFyQixNQUFNc0IsaUJBQU4sQ0FBd0JwQixPQUF4QixDQUFkO0FBQUEsUUFDTXFCLHFCQUFxQkYsTUFBTUcsZ0JBQU4sRUFEM0I7QUFBQSxRQUVNQyxjQUFjUiw2QkFBNkJNLGtCQUZqRDs7QUFJQWIsNkJBQXlCVSxJQUF6QixDQUE4QkMsS0FBOUI7O0FBRUFuQixjQUFVQSxRQUFRaUIsU0FBUixDQUFrQk0sV0FBbEIsQ0FBVjs7QUFFQVIsaUNBQTZCakIsTUFBTWtCLHFCQUFOLENBQTRCaEIsT0FBNUIsQ0FBN0I7QUFDRDs7QUFFRCxNQUFJQSxZQUFZLEVBQWhCLEVBQW9CO0FBQ2xCYyx1QkFBbUJkLE9BQW5COztBQUVBUSw2QkFBeUJVLElBQXpCLENBQThCSixnQkFBOUI7QUFDRDs7QUFFRCxTQUFPTix3QkFBUDtBQUNEIiwiZmlsZSI6InRva2Vucy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbmNvbnN0IG5lY2Vzc2FyeSA9IHJlcXVpcmUoJ25lY2Vzc2FyeScpO1xyXG5cclxuY29uc3QgeyBhcnJheVV0aWxpdGllcyB9ID0gbmVjZXNzYXJ5LFxyXG4gICAgICB7IHNwbGljZSB9ID0gYXJyYXlVdGlsaXRpZXM7XHJcblxyXG5mdW5jdGlvbiBwYXNzR2l2ZW5Ub2tlbih0b2tlbnNPckNvbnRlbnRzLCBUb2tlbikge1xyXG4gIHBhc3NHaXZlbkNhbGxiYWNrKHRva2Vuc09yQ29udGVudHMsIGZ1bmN0aW9uKGNvbnRlbnQpIHsgcmV0dXJuIHRva2Vuc09yUmVtYWluaW5nQ29udGVudEZyb21XaXRoaW5Db250ZW50KGNvbnRlbnQsIFRva2VuKTsgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBhc3NHaXZlbkNhbGxiYWNrKHRva2Vuc09yQ29udGVudHMsIGNhbGxiYWNrKSB7XHJcbiAgbGV0IGluZGV4ID0gMCxcclxuICAgICAgdG9rZW5zT3JDb250ZW50c0xlbmd0aCA9IHRva2Vuc09yQ29udGVudHMubGVuZ3RoO1xyXG5cclxuICB3aGlsZSAoaW5kZXggPCB0b2tlbnNPckNvbnRlbnRzTGVuZ3RoKSB7XHJcbiAgICBjb25zdCB0b2tlbk9yQ29udGVudCA9IHRva2Vuc09yQ29udGVudHNbaW5kZXhdLFxyXG4gICAgICAgIHRva2VuT3JDb250ZW50Q29udGVudCA9ICh0eXBlb2YgdG9rZW5PckNvbnRlbnQgPT09ICdzdHJpbmcnKTtcclxuXHJcbiAgICBpZiAodG9rZW5PckNvbnRlbnRDb250ZW50KSB7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSB0b2tlbk9yQ29udGVudCwgIC8vL1xyXG4gICAgICAgICAgICB0b2tlbnNPclJlbWFpbmluZ0NvbnRlbnQgPSBjYWxsYmFjayhjb250ZW50KSxcclxuICAgICAgICAgICAgdG9rZW5zT3JSZW1haW5pbmdDb250ZW50TGVuZ3RoID0gdG9rZW5zT3JSZW1haW5pbmdDb250ZW50Lmxlbmd0aCxcclxuICAgICAgICAgICAgc3RhcnQgPSBpbmRleCwgIC8vL1xyXG4gICAgICAgICAgICBkZWxldGVDb3VudCA9IDE7XHJcblxyXG4gICAgICBzcGxpY2UodG9rZW5zT3JDb250ZW50cywgc3RhcnQsIGRlbGV0ZUNvdW50LCB0b2tlbnNPclJlbWFpbmluZ0NvbnRlbnQpO1xyXG5cclxuICAgICAgdG9rZW5zT3JDb250ZW50c0xlbmd0aCAtPSAxO1xyXG5cclxuICAgICAgdG9rZW5zT3JDb250ZW50c0xlbmd0aCArPSB0b2tlbnNPclJlbWFpbmluZ0NvbnRlbnRMZW5ndGg7XHJcblxyXG4gICAgICBpbmRleCArPSB0b2tlbnNPclJlbWFpbmluZ0NvbnRlbnRMZW5ndGg7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpbmRleCArPSAxO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgcGFzc0dpdmVuVG9rZW46IHBhc3NHaXZlblRva2VuLFxyXG4gIHBhc3NHaXZlbkNhbGxiYWNrOiBwYXNzR2l2ZW5DYWxsYmFja1xyXG59O1xyXG5cclxuZnVuY3Rpb24gdG9rZW5zT3JSZW1haW5pbmdDb250ZW50RnJvbVdpdGhpbkNvbnRlbnQoY29udGVudCwgVG9rZW4pIHtcclxuICBsZXQgcmVtYWluaW5nQ29udGVudCxcclxuICAgICAgdG9rZW5zT3JSZW1haW5pbmdDb250ZW50ID0gW10sICAgICAgIFxyXG4gICAgICB0b2tlblBvc2l0aW9uV2l0aGluQ29udGVudCA9IFRva2VuLnBvc2l0aW9uV2l0aGluQ29udGVudChjb250ZW50KTtcclxuICBcclxuICB3aGlsZSAodG9rZW5Qb3NpdGlvbldpdGhpbkNvbnRlbnQgIT09IC0xKSB7XHJcbiAgICBpZiAodG9rZW5Qb3NpdGlvbldpdGhpbkNvbnRlbnQgPiAwKSB7XHJcbiAgICAgIHJlbWFpbmluZ0NvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZygwLCB0b2tlblBvc2l0aW9uV2l0aGluQ29udGVudCk7XHJcblxyXG4gICAgICB0b2tlbnNPclJlbWFpbmluZ0NvbnRlbnQucHVzaChyZW1haW5pbmdDb250ZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0b2tlbiA9IFRva2VuLmZyb21XaXRoaW5Db250ZW50KGNvbnRlbnQpLFxyXG4gICAgICAgICAgdG9rZW5Db250ZW50TGVuZ3RoID0gdG9rZW4uZ2V0Q29udGVudExlbmd0aCgpLFxyXG4gICAgICAgICAgdG9rZW5PZmZzZXQgPSB0b2tlblBvc2l0aW9uV2l0aGluQ29udGVudCArIHRva2VuQ29udGVudExlbmd0aDtcclxuICAgIFxyXG4gICAgdG9rZW5zT3JSZW1haW5pbmdDb250ZW50LnB1c2godG9rZW4pO1xyXG4gICAgXHJcbiAgICBjb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcodG9rZW5PZmZzZXQpO1xyXG5cclxuICAgIHRva2VuUG9zaXRpb25XaXRoaW5Db250ZW50ID0gVG9rZW4ucG9zaXRpb25XaXRoaW5Db250ZW50KGNvbnRlbnQpO1xyXG4gIH1cclxuICBcclxuICBpZiAoY29udGVudCAhPT0gJycpIHtcclxuICAgIHJlbWFpbmluZ0NvbnRlbnQgPSBjb250ZW50O1xyXG5cclxuICAgIHRva2Vuc09yUmVtYWluaW5nQ29udGVudC5wdXNoKHJlbWFpbmluZ0NvbnRlbnQpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHRva2Vuc09yUmVtYWluaW5nQ29udGVudDtcclxufVxyXG4iXX0=