"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var necessary = require("necessary");

var Rule = require("./rule"),
    WhitespaceToken = require("../common/token/nonSignificant/whitespace"),
    BrokenCommentToken = require("../common/token/nonSignificant/brokenComment"),
    RegularExpressionToken = require("../common/token/significant/regularExpression"),
    SingleLineCommentToken = require("../common/token/nonSignificant/comment/singleLine"),
    EndOfMultiLineCommentToken = require("../common/token/nonSignificant/comment/multiLine/endOf"),
    EndOfLineNonSignificantToken = require("../common/token/nonSignificant/endOfLine"),
    StartOfMultiLineCommentToken = require("../common/token/nonSignificant/comment/multiLine/startOf"),
    MiddleOfMultiLineCommentToken = require("../common/token/nonSignificant/comment/multiLine/middleOf"),
    SinglyQuotedStringLiteralToken = require("../common/token/significant/stringLiteral/singlyQuoted"),
    DoublyQuotedStringLiteralToken = require("../common/token/significant/stringLiteral/doublyQuoted"),
    SinglyQuotedBrokenStringLiteralToken = require("../common/token/significant/brokenStringLiteral/singlyQuoted"),
    DoublyQuotedBrokenStringLiteralToken = require("../common/token/significant/brokenStringLiteral/doublyQuoted");

var arrayUtilities = necessary.arrayUtilities,
    splice = arrayUtilities.splice;

var CommonLexer = /*#__PURE__*/function () {
  function CommonLexer(rules) {
    _classCallCheck(this, CommonLexer);

    this.rules = rules;
  }

  _createClass(CommonLexer, [{
    key: "getRules",
    value: function getRules() {
      return this.rules;
    }
  }, {
    key: "tokenise",
    value: function tokenise(content) {
      var endOfLineTokensOrContents = this.tokeniseEndOfLines(content),
          tokensOrContents = endOfLineTokensOrContents; ///

      this.tokeniseContents(tokensOrContents);
      var tokens = tokensOrContents; ///

      return tokens;
    }
  }, {
    key: "tokeniseEndOfLines",
    value: function tokeniseEndOfLines(content) {
      var EndOfLineToken = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : EndOfLineNonSignificantToken;
      var endOfLineTokensOrContents = [];
      var endOfLineToken = EndOfLineToken.match(content);

      while (endOfLineToken !== null) {
        var endOfLineTokenIndex = endOfLineToken.getIndex(),
            endOfLineTokenContentLength = endOfLineToken.getContentLength(),
            left = endOfLineTokenIndex,
            ///
        right = endOfLineTokenIndex + endOfLineTokenContentLength,
            leftContent = content.substring(0, left),
            rightContent = content.substring(right);
        content = leftContent; ///

        endOfLineTokensOrContents.push(content);
        endOfLineTokensOrContents.push(endOfLineToken);
        content = rightContent; ///

        endOfLineToken = EndOfLineToken.match(content);
      }

      endOfLineTokensOrContents.push(content);
      return endOfLineTokensOrContents;
    }
  }, {
    key: "tokeniseContents",
    value: function tokeniseContents(tokensOrContents) {
      var inComment = false;
      var index = 0,
          tokensOrContentsLength = tokensOrContents.length;

      while (index < tokensOrContentsLength) {
        var tokenOrContent = tokensOrContents[index],
            tokenOrContentString = typeof tokenOrContent === "string",
            tokenOrContentContent = tokenOrContentString; ///

        if (tokenOrContentContent) {
          var tokens = [],
              content = tokenOrContent; ///

          inComment = this.tokeniseContent(content, tokens, inComment);
          var tokensLength = tokens.length,
              start = index,
              ///
          deleteCount = 1;
          splice(tokensOrContents, start, deleteCount, tokens);
          tokensOrContentsLength += tokensLength - 1;
          index += tokensLength - 1;
        }

        index++;
      }
    }
  }, {
    key: "tokeniseContent",
    value: function tokeniseContent(content, tokens, inComment) {
      var _this = this;

      while (content !== "") {
        var token = this.matchMultiLineCommentInComment(content, inComment) || this.matchWhitespace(content) || this.matchMultiLineCommentNotInComment(content, inComment) || this.matchSingleLineComment(content, inComment) || this.matchBrokenComment(content, inComment) || this.matchRegularExpression(content) || this.matchSinglyQuotedStringLiteral(content) || this.matchDoublyQuotedStringLiteral(content);

        if (token === null) {
          (function () {
            var significantToken = null;

            _this.rules.some(function (rule) {
              significantToken = rule.match(content);

              if (significantToken !== null) {
                token = significantToken; ///

                return true;
              }
            });
          })();
        }

        if (token === null) {
          throw new Error("The content '".concat(content, "' cannot be tokenised."));
        }

        tokens.push(token);
        var tokenContentLength = token.getContentLength(),
            start = tokenContentLength; ///

        content = content = content.substring(start);
        var tokenCommentToken = token.isCommentToken();

        if (tokenCommentToken) {
          var commentToken = token; ///

          inComment = commentToken.isInComment();
        }
      }

      return inComment;
    }
  }, {
    key: "matchBrokenComment",
    value: function matchBrokenComment(content, inComment) {
      var brokenCommentToken = inComment ? null : BrokenCommentToken.match(content);
      return brokenCommentToken;
    }
  }, {
    key: "matchSingleLineComment",
    value: function matchSingleLineComment(content, inComment) {
      var singleLineCommentToken = inComment ? null : SingleLineCommentToken.match(content);
      return singleLineCommentToken;
    }
  }, {
    key: "matchMultiLineCommentInComment",
    value: function matchMultiLineCommentInComment(content, inComment) {
      var multiLinCommentToken = inComment ? EndOfMultiLineCommentToken.match(content) || MiddleOfMultiLineCommentToken.match(content) : null;
      return multiLinCommentToken;
    }
  }, {
    key: "matchMultiLineCommentNotInComment",
    value: function matchMultiLineCommentNotInComment(content, inComment) {
      var multiLinCommentToken = inComment ? null : StartOfMultiLineCommentToken.match(content);
      return multiLinCommentToken;
    }
  }, {
    key: "matchWhitespace",
    value: function matchWhitespace(content) {
      return WhitespaceToken.match(content);
    }
  }, {
    key: "matchRegularExpression",
    value: function matchRegularExpression(content) {
      return RegularExpressionToken.match(content);
    }
  }, {
    key: "matchSinglyQuotedStringLiteral",
    value: function matchSinglyQuotedStringLiteral(content) {
      return SinglyQuotedStringLiteralToken.match(content) || SinglyQuotedBrokenStringLiteralToken.match(content);
    }
  }, {
    key: "matchDoublyQuotedStringLiteral",
    value: function matchDoublyQuotedStringLiteral(content) {
      return DoublyQuotedStringLiteralToken.match(content) || DoublyQuotedBrokenStringLiteralToken.match(content);
    }
  }], [{
    key: "fromNothing",
    value: function fromNothing(Class) {
      var entries = Class.entries,
          rules = entries.map(function (entry) {
        return Rule.fromEntry(entry);
      }),
          lexer = new Class(rules);
      return lexer;
    }
  }, {
    key: "fromEntries",
    value: function fromEntries(Class, entries) {
      var rules = entries.map(function (entry) {
        return Rule.fromEntry(entry);
      }),
          lexer = new Class(rules);
      return lexer;
    }
  }]);

  return CommonLexer;
}();

module.exports = CommonLexer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxleGVyLmpzIl0sIm5hbWVzIjpbIm5lY2Vzc2FyeSIsInJlcXVpcmUiLCJSdWxlIiwiV2hpdGVzcGFjZVRva2VuIiwiQnJva2VuQ29tbWVudFRva2VuIiwiUmVndWxhckV4cHJlc3Npb25Ub2tlbiIsIlNpbmdsZUxpbmVDb21tZW50VG9rZW4iLCJFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsIkVuZE9mTGluZU5vblNpZ25pZmljYW50VG9rZW4iLCJTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTaW5nbHlRdW90ZWRTdHJpbmdMaXRlcmFsVG9rZW4iLCJEb3VibHlRdW90ZWRTdHJpbmdMaXRlcmFsVG9rZW4iLCJTaW5nbHlRdW90ZWRCcm9rZW5TdHJpbmdMaXRlcmFsVG9rZW4iLCJEb3VibHlRdW90ZWRCcm9rZW5TdHJpbmdMaXRlcmFsVG9rZW4iLCJhcnJheVV0aWxpdGllcyIsInNwbGljZSIsIkNvbW1vbkxleGVyIiwicnVsZXMiLCJjb250ZW50IiwiZW5kT2ZMaW5lVG9rZW5zT3JDb250ZW50cyIsInRva2VuaXNlRW5kT2ZMaW5lcyIsInRva2Vuc09yQ29udGVudHMiLCJ0b2tlbmlzZUNvbnRlbnRzIiwidG9rZW5zIiwiRW5kT2ZMaW5lVG9rZW4iLCJlbmRPZkxpbmVUb2tlbiIsIm1hdGNoIiwiZW5kT2ZMaW5lVG9rZW5JbmRleCIsImdldEluZGV4IiwiZW5kT2ZMaW5lVG9rZW5Db250ZW50TGVuZ3RoIiwiZ2V0Q29udGVudExlbmd0aCIsImxlZnQiLCJyaWdodCIsImxlZnRDb250ZW50Iiwic3Vic3RyaW5nIiwicmlnaHRDb250ZW50IiwicHVzaCIsImluQ29tbWVudCIsImluZGV4IiwidG9rZW5zT3JDb250ZW50c0xlbmd0aCIsImxlbmd0aCIsInRva2VuT3JDb250ZW50IiwidG9rZW5PckNvbnRlbnRTdHJpbmciLCJ0b2tlbk9yQ29udGVudENvbnRlbnQiLCJ0b2tlbmlzZUNvbnRlbnQiLCJ0b2tlbnNMZW5ndGgiLCJzdGFydCIsImRlbGV0ZUNvdW50IiwidG9rZW4iLCJtYXRjaE11bHRpTGluZUNvbW1lbnRJbkNvbW1lbnQiLCJtYXRjaFdoaXRlc3BhY2UiLCJtYXRjaE11bHRpTGluZUNvbW1lbnROb3RJbkNvbW1lbnQiLCJtYXRjaFNpbmdsZUxpbmVDb21tZW50IiwibWF0Y2hCcm9rZW5Db21tZW50IiwibWF0Y2hSZWd1bGFyRXhwcmVzc2lvbiIsIm1hdGNoU2luZ2x5UXVvdGVkU3RyaW5nTGl0ZXJhbCIsIm1hdGNoRG91Ymx5UXVvdGVkU3RyaW5nTGl0ZXJhbCIsInNpZ25pZmljYW50VG9rZW4iLCJzb21lIiwicnVsZSIsIkVycm9yIiwidG9rZW5Db250ZW50TGVuZ3RoIiwidG9rZW5Db21tZW50VG9rZW4iLCJpc0NvbW1lbnRUb2tlbiIsImNvbW1lbnRUb2tlbiIsImlzSW5Db21tZW50IiwiYnJva2VuQ29tbWVudFRva2VuIiwic2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIm11bHRpTGluQ29tbWVudFRva2VuIiwiQ2xhc3MiLCJlbnRyaWVzIiwibWFwIiwiZW50cnkiLCJmcm9tRW50cnkiLCJsZXhlciIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7OztBQUVBLElBQU1BLFNBQVMsR0FBR0MsT0FBTyxDQUFDLFdBQUQsQ0FBekI7O0FBRUEsSUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsUUFBRCxDQUFwQjtBQUFBLElBQ01FLGVBQWUsR0FBR0YsT0FBTyxDQUFDLDJDQUFELENBRC9CO0FBQUEsSUFFTUcsa0JBQWtCLEdBQUdILE9BQU8sQ0FBQyw4Q0FBRCxDQUZsQztBQUFBLElBR01JLHNCQUFzQixHQUFHSixPQUFPLENBQUMsK0NBQUQsQ0FIdEM7QUFBQSxJQUlNSyxzQkFBc0IsR0FBR0wsT0FBTyxDQUFDLG1EQUFELENBSnRDO0FBQUEsSUFLTU0sMEJBQTBCLEdBQUdOLE9BQU8sQ0FBQyx3REFBRCxDQUwxQztBQUFBLElBTU1PLDRCQUE0QixHQUFHUCxPQUFPLENBQUMsMENBQUQsQ0FONUM7QUFBQSxJQU9NUSw0QkFBNEIsR0FBR1IsT0FBTyxDQUFDLDBEQUFELENBUDVDO0FBQUEsSUFRTVMsNkJBQTZCLEdBQUdULE9BQU8sQ0FBQywyREFBRCxDQVI3QztBQUFBLElBU01VLDhCQUE4QixHQUFHVixPQUFPLENBQUMsd0RBQUQsQ0FUOUM7QUFBQSxJQVVNVyw4QkFBOEIsR0FBR1gsT0FBTyxDQUFDLHdEQUFELENBVjlDO0FBQUEsSUFXTVksb0NBQW9DLEdBQUdaLE9BQU8sQ0FBQyw4REFBRCxDQVhwRDtBQUFBLElBWU1hLG9DQUFvQyxHQUFHYixPQUFPLENBQUMsOERBQUQsQ0FacEQ7O0FBY00sSUFBRWMsY0FBRixHQUFxQmYsU0FBckIsQ0FBRWUsY0FBRjtBQUFBLElBQ0VDLE1BREYsR0FDYUQsY0FEYixDQUNFQyxNQURGOztJQUdBQyxXO0FBQ0osdUJBQVlDLEtBQVosRUFBbUI7QUFBQTs7QUFDakIsU0FBS0EsS0FBTCxHQUFhQSxLQUFiO0FBQ0Q7Ozs7K0JBRVU7QUFDVCxhQUFPLEtBQUtBLEtBQVo7QUFDRDs7OzZCQUVRQyxPLEVBQVM7QUFDaEIsVUFBTUMseUJBQXlCLEdBQUcsS0FBS0Msa0JBQUwsQ0FBd0JGLE9BQXhCLENBQWxDO0FBQUEsVUFDTUcsZ0JBQWdCLEdBQUdGLHlCQUR6QixDQURnQixDQUVvQzs7QUFFcEQsV0FBS0csZ0JBQUwsQ0FBc0JELGdCQUF0QjtBQUVBLFVBQU1FLE1BQU0sR0FBR0YsZ0JBQWYsQ0FOZ0IsQ0FNa0I7O0FBRWxDLGFBQU9FLE1BQVA7QUFDRDs7O3VDQUVrQkwsTyxFQUF3RDtBQUFBLFVBQS9DTSxjQUErQyx1RUFBOUJqQiw0QkFBOEI7QUFDekUsVUFBTVkseUJBQXlCLEdBQUcsRUFBbEM7QUFFQSxVQUFJTSxjQUFjLEdBQUdELGNBQWMsQ0FBQ0UsS0FBZixDQUFxQlIsT0FBckIsQ0FBckI7O0FBRUEsYUFBT08sY0FBYyxLQUFLLElBQTFCLEVBQWdDO0FBQzlCLFlBQU1FLG1CQUFtQixHQUFHRixjQUFjLENBQUNHLFFBQWYsRUFBNUI7QUFBQSxZQUNNQywyQkFBMkIsR0FBR0osY0FBYyxDQUFDSyxnQkFBZixFQURwQztBQUFBLFlBRU1DLElBQUksR0FBR0osbUJBRmI7QUFBQSxZQUVrQztBQUM1QkssUUFBQUEsS0FBSyxHQUFHTCxtQkFBbUIsR0FBR0UsMkJBSHBDO0FBQUEsWUFJTUksV0FBVyxHQUFHZixPQUFPLENBQUNnQixTQUFSLENBQWtCLENBQWxCLEVBQXFCSCxJQUFyQixDQUpwQjtBQUFBLFlBS01JLFlBQVksR0FBR2pCLE9BQU8sQ0FBQ2dCLFNBQVIsQ0FBa0JGLEtBQWxCLENBTHJCO0FBT0FkLFFBQUFBLE9BQU8sR0FBR2UsV0FBVixDQVI4QixDQVFOOztBQUV4QmQsUUFBQUEseUJBQXlCLENBQUNpQixJQUExQixDQUErQmxCLE9BQS9CO0FBRUFDLFFBQUFBLHlCQUF5QixDQUFDaUIsSUFBMUIsQ0FBK0JYLGNBQS9CO0FBRUFQLFFBQUFBLE9BQU8sR0FBR2lCLFlBQVYsQ0FkOEIsQ0FjTjs7QUFFeEJWLFFBQUFBLGNBQWMsR0FBR0QsY0FBYyxDQUFDRSxLQUFmLENBQXFCUixPQUFyQixDQUFqQjtBQUNEOztBQUVEQyxNQUFBQSx5QkFBeUIsQ0FBQ2lCLElBQTFCLENBQStCbEIsT0FBL0I7QUFFQSxhQUFPQyx5QkFBUDtBQUNEOzs7cUNBRWdCRSxnQixFQUFrQjtBQUNqQyxVQUFJZ0IsU0FBUyxHQUFHLEtBQWhCO0FBRUEsVUFBSUMsS0FBSyxHQUFHLENBQVo7QUFBQSxVQUNJQyxzQkFBc0IsR0FBR2xCLGdCQUFnQixDQUFDbUIsTUFEOUM7O0FBR0EsYUFBT0YsS0FBSyxHQUFHQyxzQkFBZixFQUF1QztBQUNyQyxZQUFNRSxjQUFjLEdBQUdwQixnQkFBZ0IsQ0FBQ2lCLEtBQUQsQ0FBdkM7QUFBQSxZQUNNSSxvQkFBb0IsR0FBSSxPQUFPRCxjQUFQLEtBQTBCLFFBRHhEO0FBQUEsWUFFTUUscUJBQXFCLEdBQUdELG9CQUY5QixDQURxQyxDQUdlOztBQUVwRCxZQUFJQyxxQkFBSixFQUEyQjtBQUN6QixjQUFNcEIsTUFBTSxHQUFHLEVBQWY7QUFBQSxjQUNNTCxPQUFPLEdBQUd1QixjQURoQixDQUR5QixDQUVPOztBQUVoQ0osVUFBQUEsU0FBUyxHQUFHLEtBQUtPLGVBQUwsQ0FBcUIxQixPQUFyQixFQUE4QkssTUFBOUIsRUFBc0NjLFNBQXRDLENBQVo7QUFFQSxjQUFNUSxZQUFZLEdBQUd0QixNQUFNLENBQUNpQixNQUE1QjtBQUFBLGNBQ01NLEtBQUssR0FBR1IsS0FEZDtBQUFBLGNBQ3NCO0FBQ2hCUyxVQUFBQSxXQUFXLEdBQUcsQ0FGcEI7QUFJQWhDLFVBQUFBLE1BQU0sQ0FBQ00sZ0JBQUQsRUFBbUJ5QixLQUFuQixFQUEwQkMsV0FBMUIsRUFBdUN4QixNQUF2QyxDQUFOO0FBRUFnQixVQUFBQSxzQkFBc0IsSUFBSU0sWUFBWSxHQUFHLENBQXpDO0FBRUFQLFVBQUFBLEtBQUssSUFBSU8sWUFBWSxHQUFHLENBQXhCO0FBQ0Q7O0FBRURQLFFBQUFBLEtBQUs7QUFDTjtBQUNGOzs7b0NBRWVwQixPLEVBQVNLLE0sRUFBUWMsUyxFQUFXO0FBQUE7O0FBQzFDLGFBQU9uQixPQUFPLEtBQUssRUFBbkIsRUFBdUI7QUFDckIsWUFBSThCLEtBQUssR0FBRyxLQUFLQyw4QkFBTCxDQUFvQy9CLE9BQXBDLEVBQTZDbUIsU0FBN0MsS0FDQSxLQUFLYSxlQUFMLENBQXFCaEMsT0FBckIsQ0FEQSxJQUVBLEtBQUtpQyxpQ0FBTCxDQUF1Q2pDLE9BQXZDLEVBQWdEbUIsU0FBaEQsQ0FGQSxJQUdBLEtBQUtlLHNCQUFMLENBQTRCbEMsT0FBNUIsRUFBcUNtQixTQUFyQyxDQUhBLElBSUEsS0FBS2dCLGtCQUFMLENBQXdCbkMsT0FBeEIsRUFBaUNtQixTQUFqQyxDQUpBLElBS0EsS0FBS2lCLHNCQUFMLENBQTRCcEMsT0FBNUIsQ0FMQSxJQU1BLEtBQUtxQyw4QkFBTCxDQUFvQ3JDLE9BQXBDLENBTkEsSUFPQSxLQUFLc0MsOEJBQUwsQ0FBb0N0QyxPQUFwQyxDQVBaOztBQVNBLFlBQUk4QixLQUFLLEtBQUssSUFBZCxFQUFvQjtBQUFBO0FBQ2xCLGdCQUFJUyxnQkFBZ0IsR0FBRyxJQUF2Qjs7QUFFQSxZQUFBLEtBQUksQ0FBQ3hDLEtBQUwsQ0FBV3lDLElBQVgsQ0FBZ0IsVUFBQ0MsSUFBRCxFQUFVO0FBQ3hCRixjQUFBQSxnQkFBZ0IsR0FBR0UsSUFBSSxDQUFDakMsS0FBTCxDQUFXUixPQUFYLENBQW5COztBQUVBLGtCQUFJdUMsZ0JBQWdCLEtBQUssSUFBekIsRUFBK0I7QUFDN0JULGdCQUFBQSxLQUFLLEdBQUdTLGdCQUFSLENBRDZCLENBQ0g7O0FBRTFCLHVCQUFPLElBQVA7QUFDRDtBQUNGLGFBUkQ7QUFIa0I7QUFZbkI7O0FBRUQsWUFBSVQsS0FBSyxLQUFLLElBQWQsRUFBb0I7QUFDbEIsZ0JBQU0sSUFBSVksS0FBSix3QkFBMEIxQyxPQUExQiw0QkFBTjtBQUNEOztBQUVESyxRQUFBQSxNQUFNLENBQUNhLElBQVAsQ0FBWVksS0FBWjtBQUVBLFlBQU1hLGtCQUFrQixHQUFHYixLQUFLLENBQUNsQixnQkFBTixFQUEzQjtBQUFBLFlBQ01nQixLQUFLLEdBQUdlLGtCQURkLENBOUJxQixDQStCYTs7QUFFbEMzQyxRQUFBQSxPQUFPLEdBQUdBLE9BQU8sR0FBR0EsT0FBTyxDQUFDZ0IsU0FBUixDQUFrQlksS0FBbEIsQ0FBcEI7QUFFQSxZQUFNZ0IsaUJBQWlCLEdBQUdkLEtBQUssQ0FBQ2UsY0FBTixFQUExQjs7QUFFQSxZQUFJRCxpQkFBSixFQUF1QjtBQUNyQixjQUFNRSxZQUFZLEdBQUdoQixLQUFyQixDQURxQixDQUNPOztBQUU1QlgsVUFBQUEsU0FBUyxHQUFHMkIsWUFBWSxDQUFDQyxXQUFiLEVBQVo7QUFDRDtBQUNGOztBQUVELGFBQU81QixTQUFQO0FBQ0Q7Ozt1Q0FFa0JuQixPLEVBQVNtQixTLEVBQVc7QUFDckMsVUFBTTZCLGtCQUFrQixHQUFHN0IsU0FBUyxHQUNQLElBRE8sR0FFTGxDLGtCQUFrQixDQUFDdUIsS0FBbkIsQ0FBeUJSLE9BQXpCLENBRi9CO0FBSUEsYUFBT2dELGtCQUFQO0FBQ0Q7OzsyQ0FFc0JoRCxPLEVBQVNtQixTLEVBQVc7QUFDekMsVUFBTThCLHNCQUFzQixHQUFHOUIsU0FBUyxHQUNQLElBRE8sR0FFTGhDLHNCQUFzQixDQUFDcUIsS0FBdkIsQ0FBNkJSLE9BQTdCLENBRm5DO0FBSUEsYUFBT2lELHNCQUFQO0FBQ0Q7OzttREFFOEJqRCxPLEVBQVNtQixTLEVBQVc7QUFDakQsVUFBTStCLG9CQUFvQixHQUFHL0IsU0FBUyxHQUNQL0IsMEJBQTBCLENBQUNvQixLQUEzQixDQUFpQ1IsT0FBakMsS0FBNkNULDZCQUE2QixDQUFDaUIsS0FBOUIsQ0FBb0NSLE9BQXBDLENBRHRDLEdBRUwsSUFGakM7QUFJQSxhQUFPa0Qsb0JBQVA7QUFDRDs7O3NEQUVpQ2xELE8sRUFBU21CLFMsRUFBVztBQUNwRCxVQUFNK0Isb0JBQW9CLEdBQUcvQixTQUFTLEdBQ1AsSUFETyxHQUVMN0IsNEJBQTRCLENBQUNrQixLQUE3QixDQUFtQ1IsT0FBbkMsQ0FGakM7QUFJQSxhQUFPa0Qsb0JBQVA7QUFDRDs7O29DQUVlbEQsTyxFQUFTO0FBQUUsYUFBT2hCLGVBQWUsQ0FBQ3dCLEtBQWhCLENBQXNCUixPQUF0QixDQUFQO0FBQXdDOzs7MkNBRTVDQSxPLEVBQVM7QUFBRSxhQUFPZCxzQkFBc0IsQ0FBQ3NCLEtBQXZCLENBQTZCUixPQUE3QixDQUFQO0FBQStDOzs7bURBRWxEQSxPLEVBQVM7QUFBRSxhQUFPUiw4QkFBOEIsQ0FBQ2dCLEtBQS9CLENBQXFDUixPQUFyQyxLQUFpRE4sb0NBQW9DLENBQUNjLEtBQXJDLENBQTJDUixPQUEzQyxDQUF4RDtBQUE4Rzs7O21EQUV6SEEsTyxFQUFTO0FBQUUsYUFBT1AsOEJBQThCLENBQUNlLEtBQS9CLENBQXFDUixPQUFyQyxLQUFpREwsb0NBQW9DLENBQUNhLEtBQXJDLENBQTJDUixPQUEzQyxDQUF4RDtBQUE4Rzs7O2dDQUVySW1ELEssRUFBTztBQUNsQixVQUFFQyxPQUFGLEdBQWNELEtBQWQsQ0FBRUMsT0FBRjtBQUFBLFVBQ0FyRCxLQURBLEdBQ1FxRCxPQUFPLENBQUNDLEdBQVIsQ0FBWSxVQUFDQyxLQUFEO0FBQUEsZUFBV3ZFLElBQUksQ0FBQ3dFLFNBQUwsQ0FBZUQsS0FBZixDQUFYO0FBQUEsT0FBWixDQURSO0FBQUEsVUFFQUUsS0FGQSxHQUVRLElBQUlMLEtBQUosQ0FBVXBELEtBQVYsQ0FGUjtBQUlOLGFBQU95RCxLQUFQO0FBQ0Q7OztnQ0FFa0JMLEssRUFBT0MsTyxFQUFTO0FBQ2pDLFVBQU1yRCxLQUFLLEdBQUdxRCxPQUFPLENBQUNDLEdBQVIsQ0FBWSxVQUFDQyxLQUFEO0FBQUEsZUFBV3ZFLElBQUksQ0FBQ3dFLFNBQUwsQ0FBZUQsS0FBZixDQUFYO0FBQUEsT0FBWixDQUFkO0FBQUEsVUFDTUUsS0FBSyxHQUFHLElBQUlMLEtBQUosQ0FBVXBELEtBQVYsQ0FEZDtBQUdBLGFBQU95RCxLQUFQO0FBQ0Q7Ozs7OztBQUdIQyxNQUFNLENBQUNDLE9BQVAsR0FBaUI1RCxXQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG5cclxuY29uc3QgbmVjZXNzYXJ5ID0gcmVxdWlyZShcIm5lY2Vzc2FyeVwiKTtcclxuXHJcbmNvbnN0IFJ1bGUgPSByZXF1aXJlKFwiLi9ydWxlXCIpLFxyXG4gICAgICBXaGl0ZXNwYWNlVG9rZW4gPSByZXF1aXJlKFwiLi4vY29tbW9uL3Rva2VuL25vblNpZ25pZmljYW50L3doaXRlc3BhY2VcIiksXHJcbiAgICAgIEJyb2tlbkNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoXCIuLi9jb21tb24vdG9rZW4vbm9uU2lnbmlmaWNhbnQvYnJva2VuQ29tbWVudFwiKSxcclxuICAgICAgUmVndWxhckV4cHJlc3Npb25Ub2tlbiA9IHJlcXVpcmUoXCIuLi9jb21tb24vdG9rZW4vc2lnbmlmaWNhbnQvcmVndWxhckV4cHJlc3Npb25cIiksXHJcbiAgICAgIFNpbmdsZUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKFwiLi4vY29tbW9uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvc2luZ2xlTGluZVwiKSxcclxuICAgICAgRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKFwiLi4vY29tbW9uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbXVsdGlMaW5lL2VuZE9mXCIpLFxyXG4gICAgICBFbmRPZkxpbmVOb25TaWduaWZpY2FudFRva2VuID0gcmVxdWlyZShcIi4uL2NvbW1vbi90b2tlbi9ub25TaWduaWZpY2FudC9lbmRPZkxpbmVcIiksXHJcbiAgICAgIFN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSByZXF1aXJlKFwiLi4vY29tbW9uL3Rva2VuL25vblNpZ25pZmljYW50L2NvbW1lbnQvbXVsdGlMaW5lL3N0YXJ0T2ZcIiksXHJcbiAgICAgIE1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gcmVxdWlyZShcIi4uL2NvbW1vbi90b2tlbi9ub25TaWduaWZpY2FudC9jb21tZW50L211bHRpTGluZS9taWRkbGVPZlwiKSxcclxuICAgICAgU2luZ2x5UXVvdGVkU3RyaW5nTGl0ZXJhbFRva2VuID0gcmVxdWlyZShcIi4uL2NvbW1vbi90b2tlbi9zaWduaWZpY2FudC9zdHJpbmdMaXRlcmFsL3NpbmdseVF1b3RlZFwiKSxcclxuICAgICAgRG91Ymx5UXVvdGVkU3RyaW5nTGl0ZXJhbFRva2VuID0gcmVxdWlyZShcIi4uL2NvbW1vbi90b2tlbi9zaWduaWZpY2FudC9zdHJpbmdMaXRlcmFsL2RvdWJseVF1b3RlZFwiKSxcclxuICAgICAgU2luZ2x5UXVvdGVkQnJva2VuU3RyaW5nTGl0ZXJhbFRva2VuID0gcmVxdWlyZShcIi4uL2NvbW1vbi90b2tlbi9zaWduaWZpY2FudC9icm9rZW5TdHJpbmdMaXRlcmFsL3NpbmdseVF1b3RlZFwiKSxcclxuICAgICAgRG91Ymx5UXVvdGVkQnJva2VuU3RyaW5nTGl0ZXJhbFRva2VuID0gcmVxdWlyZShcIi4uL2NvbW1vbi90b2tlbi9zaWduaWZpY2FudC9icm9rZW5TdHJpbmdMaXRlcmFsL2RvdWJseVF1b3RlZFwiKTtcclxuXHJcbmNvbnN0IHsgYXJyYXlVdGlsaXRpZXMgfSA9IG5lY2Vzc2FyeSxcclxuICAgICAgeyBzcGxpY2UgfSA9IGFycmF5VXRpbGl0aWVzO1xyXG5cclxuY2xhc3MgQ29tbW9uTGV4ZXIge1xyXG4gIGNvbnN0cnVjdG9yKHJ1bGVzKSB7XHJcbiAgICB0aGlzLnJ1bGVzID0gcnVsZXM7XHJcbiAgfVxyXG4gIFxyXG4gIGdldFJ1bGVzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMucnVsZXM7XHJcbiAgfVxyXG5cclxuICB0b2tlbmlzZShjb250ZW50KSB7XHJcbiAgICBjb25zdCBlbmRPZkxpbmVUb2tlbnNPckNvbnRlbnRzID0gdGhpcy50b2tlbmlzZUVuZE9mTGluZXMoY29udGVudCksXHJcbiAgICAgICAgICB0b2tlbnNPckNvbnRlbnRzID0gZW5kT2ZMaW5lVG9rZW5zT3JDb250ZW50czsgLy8vXHJcblxyXG4gICAgdGhpcy50b2tlbmlzZUNvbnRlbnRzKHRva2Vuc09yQ29udGVudHMpO1xyXG5cclxuICAgIGNvbnN0IHRva2VucyA9IHRva2Vuc09yQ29udGVudHM7ICAvLy9cclxuXHJcbiAgICByZXR1cm4gdG9rZW5zO1xyXG4gIH1cclxuXHJcbiAgdG9rZW5pc2VFbmRPZkxpbmVzKGNvbnRlbnQsIEVuZE9mTGluZVRva2VuID0gRW5kT2ZMaW5lTm9uU2lnbmlmaWNhbnRUb2tlbikge1xyXG4gICAgY29uc3QgZW5kT2ZMaW5lVG9rZW5zT3JDb250ZW50cyA9IFtdO1xyXG5cclxuICAgIGxldCBlbmRPZkxpbmVUb2tlbiA9IEVuZE9mTGluZVRva2VuLm1hdGNoKGNvbnRlbnQpO1xyXG5cclxuICAgIHdoaWxlIChlbmRPZkxpbmVUb2tlbiAhPT0gbnVsbCkge1xyXG4gICAgICBjb25zdCBlbmRPZkxpbmVUb2tlbkluZGV4ID0gZW5kT2ZMaW5lVG9rZW4uZ2V0SW5kZXgoKSxcclxuICAgICAgICAgICAgZW5kT2ZMaW5lVG9rZW5Db250ZW50TGVuZ3RoID0gZW5kT2ZMaW5lVG9rZW4uZ2V0Q29udGVudExlbmd0aCgpLFxyXG4gICAgICAgICAgICBsZWZ0ID0gZW5kT2ZMaW5lVG9rZW5JbmRleCwgLy8vXHJcbiAgICAgICAgICAgIHJpZ2h0ID0gZW5kT2ZMaW5lVG9rZW5JbmRleCArIGVuZE9mTGluZVRva2VuQ29udGVudExlbmd0aCxcclxuICAgICAgICAgICAgbGVmdENvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZygwLCBsZWZ0KSxcclxuICAgICAgICAgICAgcmlnaHRDb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcocmlnaHQpO1xyXG5cclxuICAgICAgY29udGVudCA9IGxlZnRDb250ZW50OyAgLy8vXHJcblxyXG4gICAgICBlbmRPZkxpbmVUb2tlbnNPckNvbnRlbnRzLnB1c2goY29udGVudCk7XHJcblxyXG4gICAgICBlbmRPZkxpbmVUb2tlbnNPckNvbnRlbnRzLnB1c2goZW5kT2ZMaW5lVG9rZW4pO1xyXG5cclxuICAgICAgY29udGVudCA9IHJpZ2h0Q29udGVudDsgLy8vXHJcblxyXG4gICAgICBlbmRPZkxpbmVUb2tlbiA9IEVuZE9mTGluZVRva2VuLm1hdGNoKGNvbnRlbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIGVuZE9mTGluZVRva2Vuc09yQ29udGVudHMucHVzaChjb250ZW50KTtcclxuXHJcbiAgICByZXR1cm4gZW5kT2ZMaW5lVG9rZW5zT3JDb250ZW50cztcclxuICB9XHJcblxyXG4gIHRva2VuaXNlQ29udGVudHModG9rZW5zT3JDb250ZW50cykge1xyXG4gICAgbGV0IGluQ29tbWVudCA9IGZhbHNlO1xyXG5cclxuICAgIGxldCBpbmRleCA9IDAsXHJcbiAgICAgICAgdG9rZW5zT3JDb250ZW50c0xlbmd0aCA9IHRva2Vuc09yQ29udGVudHMubGVuZ3RoO1xyXG5cclxuICAgIHdoaWxlIChpbmRleCA8IHRva2Vuc09yQ29udGVudHNMZW5ndGgpIHtcclxuICAgICAgY29uc3QgdG9rZW5PckNvbnRlbnQgPSB0b2tlbnNPckNvbnRlbnRzW2luZGV4XSxcclxuICAgICAgICAgICAgdG9rZW5PckNvbnRlbnRTdHJpbmcgPSAodHlwZW9mIHRva2VuT3JDb250ZW50ID09PSBcInN0cmluZ1wiKSxcclxuICAgICAgICAgICAgdG9rZW5PckNvbnRlbnRDb250ZW50ID0gdG9rZW5PckNvbnRlbnRTdHJpbmc7IC8vL1xyXG5cclxuICAgICAgaWYgKHRva2VuT3JDb250ZW50Q29udGVudCkge1xyXG4gICAgICAgIGNvbnN0IHRva2VucyA9IFtdLFxyXG4gICAgICAgICAgICAgIGNvbnRlbnQgPSB0b2tlbk9yQ29udGVudDsgLy8vXHJcblxyXG4gICAgICAgIGluQ29tbWVudCA9IHRoaXMudG9rZW5pc2VDb250ZW50KGNvbnRlbnQsIHRva2VucywgaW5Db21tZW50KTtcclxuXHJcbiAgICAgICAgY29uc3QgdG9rZW5zTGVuZ3RoID0gdG9rZW5zLmxlbmd0aCxcclxuICAgICAgICAgICAgICBzdGFydCA9IGluZGV4LCAgLy8vXHJcbiAgICAgICAgICAgICAgZGVsZXRlQ291bnQgPSAxO1xyXG5cclxuICAgICAgICBzcGxpY2UodG9rZW5zT3JDb250ZW50cywgc3RhcnQsIGRlbGV0ZUNvdW50LCB0b2tlbnMpO1xyXG5cclxuICAgICAgICB0b2tlbnNPckNvbnRlbnRzTGVuZ3RoICs9IHRva2Vuc0xlbmd0aCAtIDE7XHJcblxyXG4gICAgICAgIGluZGV4ICs9IHRva2Vuc0xlbmd0aCAtIDE7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGluZGV4Kys7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB0b2tlbmlzZUNvbnRlbnQoY29udGVudCwgdG9rZW5zLCBpbkNvbW1lbnQpIHtcclxuICAgIHdoaWxlIChjb250ZW50ICE9PSBcIlwiKSB7XHJcbiAgICAgIGxldCB0b2tlbiA9IHRoaXMubWF0Y2hNdWx0aUxpbmVDb21tZW50SW5Db21tZW50KGNvbnRlbnQsIGluQ29tbWVudClcclxuICAgICAgICAgICAgICAgfHwgdGhpcy5tYXRjaFdoaXRlc3BhY2UoY29udGVudClcclxuICAgICAgICAgICAgICAgfHwgdGhpcy5tYXRjaE11bHRpTGluZUNvbW1lbnROb3RJbkNvbW1lbnQoY29udGVudCwgaW5Db21tZW50KVxyXG4gICAgICAgICAgICAgICB8fCB0aGlzLm1hdGNoU2luZ2xlTGluZUNvbW1lbnQoY29udGVudCwgaW5Db21tZW50KVxyXG4gICAgICAgICAgICAgICB8fCB0aGlzLm1hdGNoQnJva2VuQ29tbWVudChjb250ZW50LCBpbkNvbW1lbnQpXHJcbiAgICAgICAgICAgICAgIHx8IHRoaXMubWF0Y2hSZWd1bGFyRXhwcmVzc2lvbihjb250ZW50KVxyXG4gICAgICAgICAgICAgICB8fCB0aGlzLm1hdGNoU2luZ2x5UXVvdGVkU3RyaW5nTGl0ZXJhbChjb250ZW50KVxyXG4gICAgICAgICAgICAgICB8fCB0aGlzLm1hdGNoRG91Ymx5UXVvdGVkU3RyaW5nTGl0ZXJhbChjb250ZW50KTtcclxuXHJcbiAgICAgIGlmICh0b2tlbiA9PT0gbnVsbCkge1xyXG4gICAgICAgIGxldCBzaWduaWZpY2FudFRva2VuID0gbnVsbDtcclxuXHJcbiAgICAgICAgdGhpcy5ydWxlcy5zb21lKChydWxlKSA9PiB7XHJcbiAgICAgICAgICBzaWduaWZpY2FudFRva2VuID0gcnVsZS5tYXRjaChjb250ZW50KTtcclxuXHJcbiAgICAgICAgICBpZiAoc2lnbmlmaWNhbnRUb2tlbiAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0b2tlbiA9IHNpZ25pZmljYW50VG9rZW47IC8vL1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICh0b2tlbiA9PT0gbnVsbCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGNvbnRlbnQgJyR7Y29udGVudH0nIGNhbm5vdCBiZSB0b2tlbmlzZWQuYCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRva2Vucy5wdXNoKHRva2VuKTtcclxuXHJcbiAgICAgIGNvbnN0IHRva2VuQ29udGVudExlbmd0aCA9IHRva2VuLmdldENvbnRlbnRMZW5ndGgoKSxcclxuICAgICAgICAgICAgc3RhcnQgPSB0b2tlbkNvbnRlbnRMZW5ndGg7IC8vL1xyXG5cclxuICAgICAgY29udGVudCA9IGNvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZyhzdGFydCk7XHJcblxyXG4gICAgICBjb25zdCB0b2tlbkNvbW1lbnRUb2tlbiA9IHRva2VuLmlzQ29tbWVudFRva2VuKCk7XHJcblxyXG4gICAgICBpZiAodG9rZW5Db21tZW50VG9rZW4pIHtcclxuICAgICAgICBjb25zdCBjb21tZW50VG9rZW4gPSB0b2tlbjsgLy8vXHJcblxyXG4gICAgICAgIGluQ29tbWVudCA9IGNvbW1lbnRUb2tlbi5pc0luQ29tbWVudCgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGluQ29tbWVudDtcclxuICB9XHJcblxyXG4gIG1hdGNoQnJva2VuQ29tbWVudChjb250ZW50LCBpbkNvbW1lbnQpIHtcclxuICAgIGNvbnN0IGJyb2tlbkNvbW1lbnRUb2tlbiA9IGluQ29tbWVudCA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJyb2tlbkNvbW1lbnRUb2tlbi5tYXRjaChjb250ZW50KTtcclxuXHJcbiAgICByZXR1cm4gYnJva2VuQ29tbWVudFRva2VuO1xyXG4gIH1cclxuXHJcbiAgbWF0Y2hTaW5nbGVMaW5lQ29tbWVudChjb250ZW50LCBpbkNvbW1lbnQpIHtcclxuICAgIGNvbnN0IHNpbmdsZUxpbmVDb21tZW50VG9rZW4gPSBpbkNvbW1lbnQgP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNpbmdsZUxpbmVDb21tZW50VG9rZW4ubWF0Y2goY29udGVudCk7XHJcblxyXG4gICAgcmV0dXJuIHNpbmdsZUxpbmVDb21tZW50VG9rZW47XHJcbiAgfVxyXG5cclxuICBtYXRjaE11bHRpTGluZUNvbW1lbnRJbkNvbW1lbnQoY29udGVudCwgaW5Db21tZW50KSB7XHJcbiAgICBjb25zdCBtdWx0aUxpbkNvbW1lbnRUb2tlbiA9IGluQ29tbWVudCA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4ubWF0Y2goY29udGVudCkgfHwgTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4ubWF0Y2goY29udGVudCkgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbDtcclxuXHJcbiAgICByZXR1cm4gbXVsdGlMaW5Db21tZW50VG9rZW47XHJcbiAgfVxyXG5cclxuICBtYXRjaE11bHRpTGluZUNvbW1lbnROb3RJbkNvbW1lbnQoY29udGVudCwgaW5Db21tZW50KSB7XHJcbiAgICBjb25zdCBtdWx0aUxpbkNvbW1lbnRUb2tlbiA9IGluQ29tbWVudCA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLm1hdGNoKGNvbnRlbnQpO1xyXG5cclxuICAgIHJldHVybiBtdWx0aUxpbkNvbW1lbnRUb2tlbjtcclxuICB9XHJcblxyXG4gIG1hdGNoV2hpdGVzcGFjZShjb250ZW50KSB7IHJldHVybiBXaGl0ZXNwYWNlVG9rZW4ubWF0Y2goY29udGVudCk7IH1cclxuXHJcbiAgbWF0Y2hSZWd1bGFyRXhwcmVzc2lvbihjb250ZW50KSB7IHJldHVybiBSZWd1bGFyRXhwcmVzc2lvblRva2VuLm1hdGNoKGNvbnRlbnQpOyB9XHJcblxyXG4gIG1hdGNoU2luZ2x5UXVvdGVkU3RyaW5nTGl0ZXJhbChjb250ZW50KSB7IHJldHVybiBTaW5nbHlRdW90ZWRTdHJpbmdMaXRlcmFsVG9rZW4ubWF0Y2goY29udGVudCkgfHwgU2luZ2x5UXVvdGVkQnJva2VuU3RyaW5nTGl0ZXJhbFRva2VuLm1hdGNoKGNvbnRlbnQpOyB9XHJcblxyXG4gIG1hdGNoRG91Ymx5UXVvdGVkU3RyaW5nTGl0ZXJhbChjb250ZW50KSB7IHJldHVybiBEb3VibHlRdW90ZWRTdHJpbmdMaXRlcmFsVG9rZW4ubWF0Y2goY29udGVudCkgfHwgRG91Ymx5UXVvdGVkQnJva2VuU3RyaW5nTGl0ZXJhbFRva2VuLm1hdGNoKGNvbnRlbnQpOyB9XHJcblxyXG4gIHN0YXRpYyBmcm9tTm90aGluZyhDbGFzcykge1xyXG4gICAgY29uc3QgeyBlbnRyaWVzIH0gPSBDbGFzcyxcclxuICAgICAgICAgIHJ1bGVzID0gZW50cmllcy5tYXAoKGVudHJ5KSA9PiBSdWxlLmZyb21FbnRyeShlbnRyeSkpLFxyXG4gICAgICAgICAgbGV4ZXIgPSBuZXcgQ2xhc3MocnVsZXMpO1xyXG5cclxuICAgIHJldHVybiBsZXhlcjtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBmcm9tRW50cmllcyhDbGFzcywgZW50cmllcykge1xyXG4gICAgY29uc3QgcnVsZXMgPSBlbnRyaWVzLm1hcCgoZW50cnkpID0+IFJ1bGUuZnJvbUVudHJ5KGVudHJ5KSksXHJcbiAgICAgICAgICBsZXhlciA9IG5ldyBDbGFzcyhydWxlcyk7XHJcblxyXG4gICAgcmV0dXJuIGxleGVyO1xyXG4gIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBDb21tb25MZXhlcjtcclxuIl19