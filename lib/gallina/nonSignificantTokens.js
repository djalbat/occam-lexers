'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var util = require('../util'),
    ParseableToken = require('../common/token/parseable'),
    WhitespaceToken = require('../common/token/whitespace'),
    EndOfMultiLineCommentToken = require('./token/comment/endOfMultiLine'),
    StartOfMultiLineCommentToken = require('./token/comment/startOfMultiLine'),
    MiddleOfMultiLineCommentToken = require('./token/comment/middleOfMultiLine');

var NonSignificantTokens = function () {
  function NonSignificantTokens() {
    _classCallCheck(this, NonSignificantTokens);
  }

  _createClass(NonSignificantTokens, null, [{
    key: 'pass',
    value: function pass(line) {
      var content = line.getContent(),
          multiLineCommentDepth = line.getMultiLineCommentDepth();

      while (content !== '') {
        var startOfMultiLineCommentTokenPosition = startOfMultiLineCommentToken(line);

        if (startOfMultiLineCommentTokenPosition !== 0) {
          multiLineCommentDepth = line.getMultiLineCommentDepth();

          if (multiLineCommentDepth > 0) {
            var endOfMultiLineCommentTokenPosition = endOfMultiLineToken(line);

            if (endOfMultiLineCommentTokenPosition !== 0) {
              middleOfMultiLineToken(line, startOfMultiLineCommentTokenPosition, endOfMultiLineCommentTokenPosition);
            }
          } else {
            var whitespaceTokenPosition = whitespaceToken(line);

            if (whitespaceTokenPosition !== 0) {
              parseableToken(line, startOfMultiLineCommentTokenPosition, whitespaceTokenPosition);
            }
          }
        }

        content = line.getContent();
      }
    }
  }]);

  return NonSignificantTokens;
}();

module.exports = NonSignificantTokens;

function startOfMultiLineCommentToken(line) {
  var content = line.getContent(),
      startOfMultiLineCommentTokenPosition = StartOfMultiLineCommentToken.positionInContent(content);

  if (startOfMultiLineCommentTokenPosition === 0) {
    var startOfMultiLineCommentToken = StartOfMultiLineCommentToken.fromContent(content),
        startOfMultiLineCommentTokenLength = startOfMultiLineCommentToken.getLength();

    line.pushToken(startOfMultiLineCommentToken);
    line.chopContent(startOfMultiLineCommentTokenLength);
    line.increaseMultiLineCommentDepth();
  }

  return startOfMultiLineCommentTokenPosition;
}

function endOfMultiLineToken(line) {
  var content = line.getContent(),
      endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.positionInContent(content);

  if (endOfMultiLineCommentTokenPosition === 0) {
    var endOfMultiLineCommentToken = EndOfMultiLineCommentToken.fromContent(content),
        endOfMultiLineCommentTokenLength = endOfMultiLineCommentToken.getLength();

    line.pushToken(endOfMultiLineCommentToken);
    line.chopContent(endOfMultiLineCommentTokenLength);
    line.decreaseMultiLineCommentDepth();
  }

  return endOfMultiLineCommentTokenPosition;
}

function middleOfMultiLineToken(line, startOfMultiLineCommentTokenPosition, endOfMultiLineCommentTokenPosition) {
  var contentLength = line.getContentLength(),
      commentedContentLength = util.minBarMinusOne(startOfMultiLineCommentTokenPosition, endOfMultiLineCommentTokenPosition, contentLength),
      commentedContent = line.getContentSubstring(commentedContentLength),
      middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(commentedContent),
      middleOfMultiLineCommentTokenLength = middleOfMultiLineCommentToken.getLength();

  line.pushToken(middleOfMultiLineCommentToken);
  line.chopContent(middleOfMultiLineCommentTokenLength);
}

function whitespaceToken(line) {
  var content = line.getContent(),
      whitespaceTokenPosition = WhitespaceToken.positionInContent(content);

  if (whitespaceTokenPosition === 0) {
    var whitespaceToken = WhitespaceToken.fromContent(content),
        whitespaceTokenLength = whitespaceToken.getLength();

    line.pushToken(whitespaceToken);
    line.chopContent(whitespaceTokenLength);
  }

  return whitespaceTokenPosition;
}

function parseableToken(line, startOfMultiLineCommentTokenPosition, whitespaceTokenPosition) {
  var content = line.getContent(),
      contentLength = content.length,
      parseableTokenContentLength = util.minBarMinusOne(startOfMultiLineCommentTokenPosition, whitespaceTokenPosition, contentLength),
      parseableTokenContent = line.getContentSubstring(parseableTokenContentLength);

  content = parseableTokenContent; ///

  var parseableToken = new ParseableToken(content);

  line.pushToken(parseableToken);
  line.chopContent(parseableTokenContentLength);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9nYWxsaW5hL25vblNpZ25pZmljYW50VG9rZW5zLmpzIl0sIm5hbWVzIjpbInV0aWwiLCJyZXF1aXJlIiwiUGFyc2VhYmxlVG9rZW4iLCJXaGl0ZXNwYWNlVG9rZW4iLCJFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsIlN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsIk5vblNpZ25pZmljYW50VG9rZW5zIiwibGluZSIsImNvbnRlbnQiLCJnZXRDb250ZW50IiwibXVsdGlMaW5lQ29tbWVudERlcHRoIiwiZ2V0TXVsdGlMaW5lQ29tbWVudERlcHRoIiwic3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uIiwic3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiIsImVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24iLCJlbmRPZk11bHRpTGluZVRva2VuIiwibWlkZGxlT2ZNdWx0aUxpbmVUb2tlbiIsIndoaXRlc3BhY2VUb2tlblBvc2l0aW9uIiwid2hpdGVzcGFjZVRva2VuIiwicGFyc2VhYmxlVG9rZW4iLCJtb2R1bGUiLCJleHBvcnRzIiwicG9zaXRpb25JbkNvbnRlbnQiLCJmcm9tQ29udGVudCIsInN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5MZW5ndGgiLCJnZXRMZW5ndGgiLCJwdXNoVG9rZW4iLCJjaG9wQ29udGVudCIsImluY3JlYXNlTXVsdGlMaW5lQ29tbWVudERlcHRoIiwiZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbkxlbmd0aCIsImRlY3JlYXNlTXVsdGlMaW5lQ29tbWVudERlcHRoIiwiY29udGVudExlbmd0aCIsImdldENvbnRlbnRMZW5ndGgiLCJjb21tZW50ZWRDb250ZW50TGVuZ3RoIiwibWluQmFyTWludXNPbmUiLCJjb21tZW50ZWRDb250ZW50IiwiZ2V0Q29udGVudFN1YnN0cmluZyIsIm1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwibWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5MZW5ndGgiLCJ3aGl0ZXNwYWNlVG9rZW5MZW5ndGgiLCJsZW5ndGgiLCJwYXJzZWFibGVUb2tlbkNvbnRlbnRMZW5ndGgiLCJwYXJzZWFibGVUb2tlbkNvbnRlbnQiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7QUFFQSxJQUFJQSxPQUFPQyxRQUFRLFNBQVIsQ0FBWDtBQUFBLElBQ0lDLGlCQUFpQkQsUUFBUSwyQkFBUixDQURyQjtBQUFBLElBRUlFLGtCQUFrQkYsUUFBUSw0QkFBUixDQUZ0QjtBQUFBLElBR0lHLDZCQUE2QkgsUUFBUSxnQ0FBUixDQUhqQztBQUFBLElBSUlJLCtCQUErQkosUUFBUSxrQ0FBUixDQUpuQztBQUFBLElBS0lLLGdDQUFnQ0wsUUFBUSxtQ0FBUixDQUxwQzs7SUFPTU0sb0I7Ozs7Ozs7eUJBQ1FDLEksRUFBTTtBQUNoQixVQUFJQyxVQUFVRCxLQUFLRSxVQUFMLEVBQWQ7QUFBQSxVQUNJQyx3QkFBd0JILEtBQUtJLHdCQUFMLEVBRDVCOztBQUdBLGFBQU9ILFlBQVksRUFBbkIsRUFBdUI7QUFDckIsWUFBSUksdUNBQXVDQyw2QkFBNkJOLElBQTdCLENBQTNDOztBQUVBLFlBQUlLLHlDQUF5QyxDQUE3QyxFQUFnRDtBQUM5Q0Ysa0NBQXdCSCxLQUFLSSx3QkFBTCxFQUF4Qjs7QUFFQSxjQUFJRCx3QkFBd0IsQ0FBNUIsRUFBK0I7QUFDN0IsZ0JBQUlJLHFDQUFxQ0Msb0JBQW9CUixJQUFwQixDQUF6Qzs7QUFFQSxnQkFBSU8sdUNBQXVDLENBQTNDLEVBQThDO0FBQzVDRSxxQ0FBdUJULElBQXZCLEVBQTZCSyxvQ0FBN0IsRUFBbUVFLGtDQUFuRTtBQUNEO0FBQ0YsV0FORCxNQU1PO0FBQ0wsZ0JBQUlHLDBCQUEwQkMsZ0JBQWdCWCxJQUFoQixDQUE5Qjs7QUFFQSxnQkFBSVUsNEJBQTRCLENBQWhDLEVBQW1DO0FBQ2pDRSw2QkFBZVos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YUFBbkYsQ0FGbEM7QUFBQSxNQUdJVyx3QkFBd0JwQyxLQUFLOEIsbUJBQUwsQ0FBeUJLLDJCQUF6QixDQUg1Qjs7QUFLQWxDLFlBQVVtQyxxQkFBVixDQU4wRixDQU14RDs7QUFFbEMsTUFBSXhCLGlCQUFpQixJQUFJbEIsY0FBSixDQUFtQk8sT0FBbkIsQ0FBckI7O0FBRUFELE9BQUttQixTQUFMLENBQWVQLGNBQWY7QUFDQVosT0FBS29CLFdBQUwsQ0FBaUJlLDJCQUFqQjtBQUNEIiwiZmlsZSI6Im5vblNpZ25pZmljYW50VG9rZW5zLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxudmFyIHV0aWwgPSByZXF1aXJlKCcuLi91dGlsJyksXHJcbiAgICBQYXJzZWFibGVUb2tlbiA9IHJlcXVpcmUoJy4uL2NvbW1vbi90b2tlbi9wYXJzZWFibGUnKSxcclxuICAgIFdoaXRlc3BhY2VUb2tlbiA9IHJlcXVpcmUoJy4uL2NvbW1vbi90b2tlbi93aGl0ZXNwYWNlJyksXHJcbiAgICBFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4vdG9rZW4vY29tbWVudC9lbmRPZk11bHRpTGluZScpLFxyXG4gICAgU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4vdG9rZW4vY29tbWVudC9zdGFydE9mTXVsdGlMaW5lJyksXHJcbiAgICBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4vdG9rZW4vY29tbWVudC9taWRkbGVPZk11bHRpTGluZScpO1xyXG5cclxuY2xhc3MgTm9uU2lnbmlmaWNhbnRUb2tlbnMge1xyXG4gIHN0YXRpYyBwYXNzKGxpbmUpIHtcclxuICAgIHZhciBjb250ZW50ID0gbGluZS5nZXRDb250ZW50KCksXHJcbiAgICAgICAgbXVsdGlMaW5lQ29tbWVudERlcHRoID0gbGluZS5nZXRNdWx0aUxpbmVDb21tZW50RGVwdGgoKTtcclxuICAgIFxyXG4gICAgd2hpbGUgKGNvbnRlbnQgIT09ICcnKSB7XHJcbiAgICAgIHZhciBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGxpbmUpO1xyXG5cclxuICAgICAgaWYgKHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiAhPT0gMCkge1xyXG4gICAgICAgIG11bHRpTGluZUNvbW1lbnREZXB0aCA9IGxpbmUuZ2V0TXVsdGlMaW5lQ29tbWVudERlcHRoKCk7XHJcblxyXG4gICAgICAgIGlmIChtdWx0aUxpbmVDb21tZW50RGVwdGggPiAwKSB7XHJcbiAgICAgICAgICB2YXIgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IGVuZE9mTXVsdGlMaW5lVG9rZW4obGluZSk7XHJcblxyXG4gICAgICAgICAgaWYgKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gIT09IDApIHtcclxuICAgICAgICAgICAgbWlkZGxlT2ZNdWx0aUxpbmVUb2tlbihsaW5lLCBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24sIGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB2YXIgd2hpdGVzcGFjZVRva2VuUG9zaXRpb24gPSB3aGl0ZXNwYWNlVG9rZW4obGluZSk7XHJcblxyXG4gICAgICAgICAgaWYgKHdoaXRlc3BhY2VUb2tlblBvc2l0aW9uICE9PSAwKSB7XHJcbiAgICAgICAgICAgIHBhcnNlYWJsZVRva2VuKGxpbmUsIHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiwgd2hpdGVzcGFjZVRva2VuUG9zaXRpb24pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgY29udGVudCA9IGxpbmUuZ2V0Q29udGVudCgpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBOb25TaWduaWZpY2FudFRva2VucztcclxuXHJcbmZ1bmN0aW9uIHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4obGluZSkge1xyXG4gIHZhciBjb250ZW50ID0gbGluZS5nZXRDb250ZW50KCksXHJcbiAgICAgIHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IFN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25JbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gIGlmIChzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPT09IDApIHtcclxuICAgIHZhciBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuTGVuZ3RoID0gc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5nZXRMZW5ndGgoKTtcclxuXHJcbiAgICBsaW5lLnB1c2hUb2tlbihzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKTtcclxuICAgIGxpbmUuY2hvcENvbnRlbnQoc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbkxlbmd0aCk7XHJcbiAgICBsaW5lLmluY3JlYXNlTXVsdGlMaW5lQ29tbWVudERlcHRoKCk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uO1xyXG59XHJcblxyXG5mdW5jdGlvbiBlbmRPZk11bHRpTGluZVRva2VuKGxpbmUpIHtcclxuICB2YXIgY29udGVudCA9IGxpbmUuZ2V0Q29udGVudCgpLFxyXG4gICAgICBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25JbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gIGlmIChlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID09PSAwKSB7XHJcbiAgICB2YXIgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbkxlbmd0aCA9IGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLmdldExlbmd0aCgpO1xyXG5cclxuICAgIGxpbmUucHVzaFRva2VuKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKTtcclxuICAgIGxpbmUuY2hvcENvbnRlbnQoZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5MZW5ndGgpO1xyXG4gICAgbGluZS5kZWNyZWFzZU11bHRpTGluZUNvbW1lbnREZXB0aCgpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb247XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG1pZGRsZU9mTXVsdGlMaW5lVG9rZW4obGluZSwgc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uLCBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uKSB7XHJcbiAgdmFyIGNvbnRlbnRMZW5ndGggPSBsaW5lLmdldENvbnRlbnRMZW5ndGgoKSxcclxuICAgICAgY29tbWVudGVkQ29udGVudExlbmd0aCA9IHV0aWwubWluQmFyTWludXNPbmUoc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uLCBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uLCBjb250ZW50TGVuZ3RoKSxcclxuICAgICAgY29tbWVudGVkQ29udGVudCA9IGxpbmUuZ2V0Q29udGVudFN1YnN0cmluZyhjb21tZW50ZWRDb250ZW50TGVuZ3RoKSxcclxuICAgICAgbWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb21tZW50ZWRDb250ZW50KSxcclxuICAgICAgbWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5MZW5ndGggPSBtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5nZXRMZW5ndGgoKTtcclxuXHJcbiAgbGluZS5wdXNoVG9rZW4obWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4pO1xyXG4gIGxpbmUuY2hvcENvbnRlbnQobWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5MZW5ndGgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiB3aGl0ZXNwYWNlVG9rZW4obGluZSkge1xyXG4gIHZhciBjb250ZW50ID0gbGluZS5nZXRDb250ZW50KCksXHJcbiAgICAgIHdoaXRlc3BhY2VUb2tlblBvc2l0aW9uID0gV2hpdGVzcGFjZVRva2VuLnBvc2l0aW9uSW5Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICBpZiAod2hpdGVzcGFjZVRva2VuUG9zaXRpb24gPT09IDApIHtcclxuICAgIHZhciB3aGl0ZXNwYWNlVG9rZW4gPSBXaGl0ZXNwYWNlVG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCksXHJcbiAgICAgICAgd2hpdGVzcGFjZVRva2VuTGVuZ3RoID0gd2hpdGVzcGFjZVRva2VuLmdldExlbmd0aCgpO1xyXG5cclxuICAgIGxpbmUucHVzaFRva2VuKHdoaXRlc3BhY2VUb2tlbik7XHJcbiAgICBsaW5lLmNob3BDb250ZW50KHdoaXRlc3BhY2VUb2tlbkxlbmd0aCk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gd2hpdGVzcGFjZVRva2VuUG9zaXRpb247XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBhcnNlYWJsZVRva2VuKGxpbmUsIHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiwgd2hpdGVzcGFjZVRva2VuUG9zaXRpb24pe1xyXG4gIHZhciBjb250ZW50ID0gbGluZS5nZXRDb250ZW50KCksXHJcbiAgICAgIGNvbnRlbnRMZW5ndGggPSBjb250ZW50Lmxlbmd0aCxcclxuICAgICAgcGFyc2VhYmxlVG9rZW5Db250ZW50TGVuZ3RoID0gdXRpbC5taW5CYXJNaW51c09uZShzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24sIHdoaXRlc3BhY2VUb2tlblBvc2l0aW9uLCBjb250ZW50TGVuZ3RoKSxcclxuICAgICAgcGFyc2VhYmxlVG9rZW5Db250ZW50ID0gbGluZS5nZXRDb250ZW50U3Vic3RyaW5nKHBhcnNlYWJsZVRva2VuQ29udGVudExlbmd0aCk7XHJcblxyXG4gIGNvbnRlbnQgPSBwYXJzZWFibGVUb2tlbkNvbnRlbnQ7ICAvLy9cclxuXHJcbiAgdmFyIHBhcnNlYWJsZVRva2VuID0gbmV3IFBhcnNlYWJsZVRva2VuKGNvbnRlbnQpO1xyXG5cclxuICBsaW5lLnB1c2hUb2tlbihwYXJzZWFibGVUb2tlbik7XHJcbiAgbGluZS5jaG9wQ29udGVudChwYXJzZWFibGVUb2tlbkNvbnRlbnRMZW5ndGgpO1xyXG59XHJcbiJdfQ==