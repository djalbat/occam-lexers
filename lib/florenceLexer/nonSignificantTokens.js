'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var util = require('../../util'),
    ParseableToken = require('../common/token/parseable'),
    WhitespaceToken = require('../common/token/whitespace'),
    SingleLineCommentToken = require('./token/comment/singleLine'),
    EndOfMultiLineCommentToken = require('./token/comment/endOfMultiLine'),
    StartOfMultiLineCommentToken = require('./token/comment/startOfMultiLine'),
    MiddleOfMultiLineCommentToken = require('./token/comment/middleOfMultiLine');

var NonSignificantTokens = function () {
  function NonSignificantTokens() {
    _classCallCheck(this, NonSignificantTokens);
  }

  _createClass(NonSignificantTokens, null, [{
    key: 'hasEndOfMultiLineCommentToken',
    value: function hasEndOfMultiLineCommentToken(tokens) {
      return tokens.some(function (token) {
        return token instanceof EndOfMultiLineCommentToken;
      });
    }
  }, {
    key: 'hasStartOfMultiLineCommentToken',
    value: function hasStartOfMultiLineCommentToken(tokens) {
      return tokens.some(function (token) {
        return token instanceof StartOfMultiLineCommentToken;
      });
    }
  }, {
    key: 'pass',
    value: function pass(context) {
      var content = context.getContent(),
          inMultiLineComment = context.isInMultilineComment();

      while (content !== '') {
        if (inMultiLineComment) {
          var endOfMultiLineCommentTokenPosition = endOfMultiLineCommentToken(context);

          if (endOfMultiLineCommentTokenPosition !== 0) {
            middleOfMultilineCommentToken(context, endOfMultiLineCommentTokenPosition);
          }
        } else {
          var startOfMultiLineCommentTokenPosition = startOfMultilineCommentToken(context);

          if (startOfMultiLineCommentTokenPosition !== 0) {
            var singleLineCommentTokenPosition = singleLineCommentToken(context);

            if (singleLineCommentTokenPosition !== 0) {
              var whitespaceTokenPosition = whitespaceToken(context);

              if (whitespaceTokenPosition !== 0) {
                parseableToken(context, startOfMultiLineCommentTokenPosition, singleLineCommentTokenPosition, whitespaceTokenPosition);
              }
            }
          }
        }

        content = context.getContent();
        inMultiLineComment = context.isInMultilineComment();
      }
    }
  }]);

  return NonSignificantTokens;
}();

module.exports = NonSignificantTokens;

function endOfMultiLineCommentToken(context) {
  var content = context.getContent(),
      endOfMultiLineCommentTokenPosition = EndOfMultiLineCommentToken.positionInContent(content);

  if (endOfMultiLineCommentTokenPosition === 0) {
    var endOfMultiLineCommentToken = EndOfMultiLineCommentToken.fromContent(content),
        endOfMultiLineCommentTokenLength = endOfMultiLineCommentToken.getLength();

    context.pushToken(endOfMultiLineCommentToken);
    context.chopContent(endOfMultiLineCommentTokenLength);
    context.setInMultilineComment(false);
  }

  return endOfMultiLineCommentTokenPosition;
}

function middleOfMultilineCommentToken(context, endOfMultiLineCommentTokenPosition) {
  var content = context.getContent(),
      commentedContent = endOfMultiLineCommentTokenPosition === -1 ? content : content.substring(0, endOfMultiLineCommentTokenPosition);

  var middleOfMultiLineCommentToken = MiddleOfMultiLineCommentToken.fromContent(commentedContent),
      middleOfMultiLineCommentTokenLength = middleOfMultiLineCommentToken.getLength();

  context.pushToken(middleOfMultiLineCommentToken);
  context.chopContent(middleOfMultiLineCommentTokenLength);
}

function startOfMultilineCommentToken(context) {
  var content = context.getContent(),
      startOfMultiLineCommentTokenPosition = StartOfMultiLineCommentToken.positionInContent(content);

  if (startOfMultiLineCommentTokenPosition === 0) {
    var startOfMultiLineCommentToken = StartOfMultiLineCommentToken.fromContent(content),
        startOfMultiLineCommentTokenLength = startOfMultiLineCommentToken.getLength();

    context.pushToken(startOfMultiLineCommentToken);
    context.chopContent(startOfMultiLineCommentTokenLength);
    context.setInMultilineComment(true);
  }
}

function singleLineCommentToken(context) {
  var content = context.getContent(),
      singleLineCommentTokenPosition = SingleLineCommentToken.positionInContent(content);

  if (singleLineCommentTokenPosition === 0) {
    var singleLineCommentToken = SingleLineCommentToken.fromContent(content);

    context.pushToken(singleLineCommentToken);
    context.setContent('');
  }

  return singleLineCommentTokenPosition;
}

function whitespaceToken(context) {
  var content = context.getContent(),
      whitespaceTokenPosition = WhitespaceToken.positionInContent(content);

  if (whitespaceTokenPosition === 0) {
    var whitespaceToken = WhitespaceToken.fromContent(content),
        whitespaceTokenLength = whitespaceToken.getLength();

    context.pushToken(whitespaceToken);
    context.chopContent(whitespaceTokenLength);
  }

  return whitespaceTokenPosition;
}

function parseableToken(context, startOfMultiLineCommentTokenPosition, singleLineCommentTokenPosition, whitespaceTokenPosition) {
  var contentLength = context.getContentLength(),
      parseableContentLength = util.minBarMinusOne(startOfMultiLineCommentTokenPosition, singleLineCommentTokenPosition, whitespaceTokenPosition, contentLength),
      parseableContent = context.getContentSubstring(parseableContentLength),
      content = parseableContent,
      ///
  parseableContentToken = new ParseableToken(content);

  context.pushToken(parseableContentToken);
  context.chopContent(parseableContentLength);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9mbG9yZW5jZUxleGVyL25vblNpZ25pZmljYW50VG9rZW5zLmpzIl0sIm5hbWVzIjpbInV0aWwiLCJyZXF1aXJlIiwiUGFyc2VhYmxlVG9rZW4iLCJXaGl0ZXNwYWNlVG9rZW4iLCJTaW5nbGVMaW5lQ29tbWVudFRva2VuIiwiRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJTdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwiTWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJOb25TaWduaWZpY2FudFRva2VucyIsInRva2VucyIsInNvbWUiLCJ0b2tlbiIsImNvbnRleHQiLCJjb250ZW50IiwiZ2V0Q29udGVudCIsImluTXVsdGlMaW5lQ29tbWVudCIsImlzSW5NdWx0aWxpbmVDb21tZW50IiwiZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiIsImVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuIiwibWlkZGxlT2ZNdWx0aWxpbmVDb21tZW50VG9rZW4iLCJzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24iLCJzdGFydE9mTXVsdGlsaW5lQ29tbWVudFRva2VuIiwic2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uIiwic2luZ2xlTGluZUNvbW1lbnRUb2tlbiIsIndoaXRlc3BhY2VUb2tlblBvc2l0aW9uIiwid2hpdGVzcGFjZVRva2VuIiwicGFyc2VhYmxlVG9rZW4iLCJtb2R1bGUiLCJleHBvcnRzIiwicG9zaXRpb25JbkNvbnRlbnQiLCJmcm9tQ29udGVudCIsImVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuTGVuZ3RoIiwiZ2V0TGVuZ3RoIiwicHVzaFRva2VuIiwiY2hvcENvbnRlbnQiLCJzZXRJbk11bHRpbGluZUNvbW1lbnQiLCJjb21tZW50ZWRDb250ZW50Iiwic3Vic3RyaW5nIiwibWlkZGxlT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbkxlbmd0aCIsInN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4iLCJzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuTGVuZ3RoIiwic2V0Q29udGVudCIsIndoaXRlc3BhY2VUb2tlbkxlbmd0aCIsImNvbnRlbnRMZW5ndGgiLCJnZXRDb250ZW50TGVuZ3RoIiwicGFyc2VhYmxlQ29udGVudExlbmd0aCIsIm1pbkJhck1pbnVzT25lIiwicGFyc2VhYmxlQ29udGVudCIsImdldENvbnRlbnRTdWJzdHJpbmciLCJwYXJzZWFibGVDb250ZW50VG9rZW4iXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7QUFFQSxJQUFJQSxPQUFPQyxRQUFRLFlBQVIsQ0FBWDtBQUFBLElBQ0lDLGlCQUFpQkQsUUFBUSwyQkFBUixDQURyQjtBQUFBLElBRUlFLGtCQUFrQkYsUUFBUSw0QkFBUixDQUZ0QjtBQUFBLElBR0lHLHlCQUF5QkgsUUFBUSw0QkFBUixDQUg3QjtBQUFBLElBSUlJLDZCQUE2QkosUUFBUSxnQ0FBUixDQUpqQztBQUFBLElBS0lLLCtCQUErQkwsUUFBUSxrQ0FBUixDQUxuQztBQUFBLElBTUlNLGdDQUFnQ04sUUFBUSxtQ0FBUixDQU5wQzs7SUFRTU8sb0I7Ozs7Ozs7a0RBQ2lDQyxNLEVBQVE7QUFDM0MsYUFBT0EsT0FBT0MsSUFBUCxDQUFZLFVBQVNDLEtBQVQsRUFBZ0I7QUFDakMsZUFBT0EsaUJBQWlCTiwwQkFBeEI7QUFDRCxPQUZNLENBQVA7QUFHRDs7O29EQUVzQ0ksTSxFQUFRO0FBQzdDLGFBQU9BLE9BQU9DLElBQVAsQ0FBWSxVQUFTQyxLQUFULEVBQWdCO0FBQ2pDLGVBQU9BLGlCQUFpQkwsNEJBQXhCO0FBQ0QsT0FGTSxDQUFQO0FBR0Q7Ozt5QkFFV00sTyxFQUFTO0FBQ25CLFVBQUlDLFVBQVVELFFBQVFFLFVBQVIsRUFBZDtBQUFBLFVBQ0lDLHFCQUFxQkgsUUFBUUksb0JBQVIsRUFEekI7O0FBR0EsYUFBT0gsWUFBWSxFQUFuQixFQUF1QjtBQUNyQixZQUFJRSxrQkFBSixF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QkFBcEI7QUFDRCIsImZpbGUiOiJub25TaWduaWZpY2FudFRva2Vucy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbnZhciB1dGlsID0gcmVxdWlyZSgnLi4vLi4vdXRpbCcpLFxyXG4gICAgUGFyc2VhYmxlVG9rZW4gPSByZXF1aXJlKCcuLi9jb21tb24vdG9rZW4vcGFyc2VhYmxlJyksXHJcbiAgICBXaGl0ZXNwYWNlVG9rZW4gPSByZXF1aXJlKCcuLi9jb21tb24vdG9rZW4vd2hpdGVzcGFjZScpLFxyXG4gICAgU2luZ2xlTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4vdG9rZW4vY29tbWVudC9zaW5nbGVMaW5lJyksXHJcbiAgICBFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4vdG9rZW4vY29tbWVudC9lbmRPZk11bHRpTGluZScpLFxyXG4gICAgU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4vdG9rZW4vY29tbWVudC9zdGFydE9mTXVsdGlMaW5lJyksXHJcbiAgICBNaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IHJlcXVpcmUoJy4vdG9rZW4vY29tbWVudC9taWRkbGVPZk11bHRpTGluZScpO1xyXG5cclxuY2xhc3MgTm9uU2lnbmlmaWNhbnRUb2tlbnMge1xyXG4gIHN0YXRpYyBoYXNFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbih0b2tlbnMpIHtcclxuICAgIHJldHVybiB0b2tlbnMuc29tZShmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICByZXR1cm4gdG9rZW4gaW5zdGFuY2VvZiBFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbjtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGhhc1N0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4odG9rZW5zKSB7XHJcbiAgICByZXR1cm4gdG9rZW5zLnNvbWUoZnVuY3Rpb24odG9rZW4pIHtcclxuICAgICAgcmV0dXJuIHRva2VuIGluc3RhbmNlb2YgU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbjtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHBhc3MoY29udGV4dCkge1xyXG4gICAgdmFyIGNvbnRlbnQgPSBjb250ZXh0LmdldENvbnRlbnQoKSxcclxuICAgICAgICBpbk11bHRpTGluZUNvbW1lbnQgPSBjb250ZXh0LmlzSW5NdWx0aWxpbmVDb21tZW50KCk7XHJcblxyXG4gICAgd2hpbGUgKGNvbnRlbnQgIT09ICcnKSB7XHJcbiAgICAgIGlmIChpbk11bHRpTGluZUNvbW1lbnQpIHtcclxuICAgICAgICB2YXIgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbnRleHQpO1xyXG5cclxuICAgICAgICBpZiAoZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiAhPT0gMCkge1xyXG4gICAgICAgICAgbWlkZGxlT2ZNdWx0aWxpbmVDb21tZW50VG9rZW4oY29udGV4dCwgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHZhciBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPSBzdGFydE9mTXVsdGlsaW5lQ29tbWVudFRva2VuKGNvbnRleHQpO1xyXG5cclxuICAgICAgICBpZiAoc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uICE9PSAwKSB7XHJcbiAgICAgICAgICB2YXIgc2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gc2luZ2xlTGluZUNvbW1lbnRUb2tlbihjb250ZXh0KTtcclxuXHJcbiAgICAgICAgICBpZiAoc2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uICE9PSAwKSB7XHJcbiAgICAgICAgICAgIHZhciB3aGl0ZXNwYWNlVG9rZW5Qb3NpdGlvbiA9IHdoaXRlc3BhY2VUb2tlbihjb250ZXh0KTtcclxuXHJcbiAgICAgICAgICAgIGlmICh3aGl0ZXNwYWNlVG9rZW5Qb3NpdGlvbiAhPT0gMCkge1xyXG4gICAgICAgICAgICAgIHBhcnNlYWJsZVRva2VuKGNvbnRleHQsIHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiwgc2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uLCB3aGl0ZXNwYWNlVG9rZW5Qb3NpdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnRlbnQgPSBjb250ZXh0LmdldENvbnRlbnQoKTsgICAgICBcclxuICAgICAgaW5NdWx0aUxpbmVDb21tZW50ID0gY29udGV4dC5pc0luTXVsdGlsaW5lQ29tbWVudCgpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBOb25TaWduaWZpY2FudFRva2VucztcclxuXHJcbmZ1bmN0aW9uIGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKGNvbnRleHQpIHtcclxuICB2YXIgY29udGVudCA9IGNvbnRleHQuZ2V0Q29udGVudCgpLFxyXG4gICAgICBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID0gRW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25JbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gIGlmIChlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uID09PSAwKSB7XHJcbiAgICB2YXIgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW4gPSBFbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBlbmRPZk11bHRpTGluZUNvbW1lbnRUb2tlbkxlbmd0aCA9IGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuLmdldExlbmd0aCgpO1xyXG5cclxuICAgIGNvbnRleHQucHVzaFRva2VuKGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKTtcclxuICAgIGNvbnRleHQuY2hvcENvbnRlbnQoZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5MZW5ndGgpO1xyXG4gICAgY29udGV4dC5zZXRJbk11bHRpbGluZUNvbW1lbnQoZmFsc2UpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb247XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG1pZGRsZU9mTXVsdGlsaW5lQ29tbWVudFRva2VuKGNvbnRleHQsIGVuZE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24pIHtcclxuICB2YXIgY29udGVudCA9IGNvbnRleHQuZ2V0Q29udGVudCgpLFxyXG4gICAgICBjb21tZW50ZWRDb250ZW50ID0gZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9PT0gLTEgPyBjb250ZW50IDogY29udGVudC5zdWJzdHJpbmcoMCwgZW5kT2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbik7XHJcblxyXG4gIHZhciBtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbiA9IE1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuLmZyb21Db250ZW50KGNvbW1lbnRlZENvbnRlbnQpLFxyXG4gICAgICBtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbkxlbmd0aCA9IG1pZGRsZU9mTXVsdGlMaW5lQ29tbWVudFRva2VuLmdldExlbmd0aCgpO1xyXG5cclxuICBjb250ZXh0LnB1c2hUb2tlbihtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbik7XHJcbiAgY29udGV4dC5jaG9wQ29udGVudChtaWRkbGVPZk11bHRpTGluZUNvbW1lbnRUb2tlbkxlbmd0aCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHN0YXJ0T2ZNdWx0aWxpbmVDb21tZW50VG9rZW4oY29udGV4dCkge1xyXG4gIHZhciBjb250ZW50ID0gY29udGV4dC5nZXRDb250ZW50KCksXHJcbiAgICAgIHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IFN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25JbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gIGlmIChzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPT09IDApIHtcclxuICAgIHZhciBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuID0gU3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KSxcclxuICAgICAgICBzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuTGVuZ3RoID0gc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbi5nZXRMZW5ndGgoKTtcclxuXHJcbiAgICBjb250ZXh0LnB1c2hUb2tlbihzdGFydE9mTXVsdGlMaW5lQ29tbWVudFRva2VuKTtcclxuICAgIGNvbnRleHQuY2hvcENvbnRlbnQoc3RhcnRPZk11bHRpTGluZUNvbW1lbnRUb2tlbkxlbmd0aCk7XHJcbiAgICBjb250ZXh0LnNldEluTXVsdGlsaW5lQ29tbWVudCh0cnVlKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNpbmdsZUxpbmVDb21tZW50VG9rZW4oY29udGV4dCkge1xyXG4gIHZhciBjb250ZW50ID0gY29udGV4dC5nZXRDb250ZW50KCksXHJcbiAgICAgIHNpbmdsZUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiA9IFNpbmdsZUxpbmVDb21tZW50VG9rZW4ucG9zaXRpb25JbkNvbnRlbnQoY29udGVudCk7XHJcblxyXG4gIGlmIChzaW5nbGVMaW5lQ29tbWVudFRva2VuUG9zaXRpb24gPT09IDApIHtcclxuICAgIHZhciBzaW5nbGVMaW5lQ29tbWVudFRva2VuID0gU2luZ2xlTGluZUNvbW1lbnRUb2tlbi5mcm9tQ29udGVudChjb250ZW50KTtcclxuXHJcbiAgICBjb250ZXh0LnB1c2hUb2tlbihzaW5nbGVMaW5lQ29tbWVudFRva2VuKTtcclxuICAgIGNvbnRleHQuc2V0Q29udGVudCgnJyk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gc2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uO1xyXG59XHJcblxyXG5mdW5jdGlvbiB3aGl0ZXNwYWNlVG9rZW4oY29udGV4dCkge1xyXG4gIHZhciBjb250ZW50ID0gY29udGV4dC5nZXRDb250ZW50KCksXHJcbiAgICAgIHdoaXRlc3BhY2VUb2tlblBvc2l0aW9uID0gV2hpdGVzcGFjZVRva2VuLnBvc2l0aW9uSW5Db250ZW50KGNvbnRlbnQpO1xyXG5cclxuICBpZiAod2hpdGVzcGFjZVRva2VuUG9zaXRpb24gPT09IDApIHtcclxuICAgIHZhciB3aGl0ZXNwYWNlVG9rZW4gPSBXaGl0ZXNwYWNlVG9rZW4uZnJvbUNvbnRlbnQoY29udGVudCksXHJcbiAgICAgICAgd2hpdGVzcGFjZVRva2VuTGVuZ3RoID0gd2hpdGVzcGFjZVRva2VuLmdldExlbmd0aCgpO1xyXG5cclxuICAgIGNvbnRleHQucHVzaFRva2VuKHdoaXRlc3BhY2VUb2tlbik7XHJcbiAgICBjb250ZXh0LmNob3BDb250ZW50KHdoaXRlc3BhY2VUb2tlbkxlbmd0aCk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gd2hpdGVzcGFjZVRva2VuUG9zaXRpb247XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBhcnNlYWJsZVRva2VuKGNvbnRleHQsIHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiwgc2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uLCB3aGl0ZXNwYWNlVG9rZW5Qb3NpdGlvbikge1xyXG4gIHZhciBjb250ZW50TGVuZ3RoID0gY29udGV4dC5nZXRDb250ZW50TGVuZ3RoKCksXHJcbiAgICAgIHBhcnNlYWJsZUNvbnRlbnRMZW5ndGggPSB1dGlsLm1pbkJhck1pbnVzT25lKHN0YXJ0T2ZNdWx0aUxpbmVDb21tZW50VG9rZW5Qb3NpdGlvbiwgc2luZ2xlTGluZUNvbW1lbnRUb2tlblBvc2l0aW9uLCB3aGl0ZXNwYWNlVG9rZW5Qb3NpdGlvbiwgY29udGVudExlbmd0aCksXHJcbiAgICAgIHBhcnNlYWJsZUNvbnRlbnQgPSBjb250ZXh0LmdldENvbnRlbnRTdWJzdHJpbmcocGFyc2VhYmxlQ29udGVudExlbmd0aCksXHJcbiAgICAgIGNvbnRlbnQgPSBwYXJzZWFibGVDb250ZW50LCAvLy9cclxuICAgICAgcGFyc2VhYmxlQ29udGVudFRva2VuID0gbmV3IFBhcnNlYWJsZVRva2VuKGNvbnRlbnQpO1xyXG5cclxuICBjb250ZXh0LnB1c2hUb2tlbihwYXJzZWFibGVDb250ZW50VG9rZW4pO1xyXG4gIGNvbnRleHQuY2hvcENvbnRlbnQocGFyc2VhYmxlQ29udGVudExlbmd0aCk7XHJcbn1cclxuIl19